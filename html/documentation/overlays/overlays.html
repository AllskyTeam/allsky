<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="../js/documentation.js" type="application/javascript"></script>
	<link href="../css/light.css" rel="stylesheet">
	<link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="../bower_components/jquery/dist/jquery.min.js"></script>
	<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<style>
		#pageTitle::before {
			content: "Allsky Overlays";
		}
	</style>
	<link href="../css/documentation.css" rel="stylesheet">
	<link href="../documentation-favicon.ico" rel="shortcut icon" type="image/png">
	<script src="../js/all.min.js" type="application/javascript"></script>
	<title>Allsky Overlays</title>
</head>

<body>
	<div w3-include-html="/documentation/pageHeader.html" id="pageHeader"></div>
	<div class="Layout">
		<div class="Layout-sidebar" w3-include-html="/documentation/sidebar.html" id="sidebar"></div>
		<div class="Layout-main markdown-body" id="mainContents">

			<h1>What are overlays?</h1>
			<p>An overlay is information that is added, i.e., overlayed, on top of each captured image.
				This often includes the time the image was taken, the sensor temperature,
				and the exposure length, but can include any other text or images you want.
			</p>
			<p>Allsky has always had the ability to add <em>text</em> to the captured image but in a very limited way.
				There are now two ways to add an overlay.
				You choose the method via the <span class="WebUISetting">Overlay Method</span> setting
				in the WebUI's <span class="WebUILink">Allsky Settings</span> page.
				<ol>
					<li>The newer <b>overlay</b> method has many new features and is significantly more flexible
						than the older method.
						For example, you can add an overlay ONLY to the live image but not to saved images.
						You can also easily add images and text using a drag-and-drop method.
					<li>The <b>legacy</b> method is what's been in Allsky since it began.
						It allows only text to be placed in a single location with limited formatting.
				</ol>
				<blockquote>
				The <b>overlay</b> method will be the default in the next version of Allsky,
				and will be the ONLY method in the version after that.
				</blockquote>
			</p>

			<!-- ================================================= -->
			<h2>New Overlay Method</h2>
			<details><summary></summary>
			<p>
				The <b>overlay</b> method allows almost any piece of
				information to be added to the captured Allsky image.
				Some of the key features of the include:
			</p>
			<ul>
				<li><span class="managerName">Overlay Manager</span> - The main application for managing overlays:
					<ul class="minimalPadding">
						<li><strong>Drag and Drop interface</strong> - Fields can be dragged around the screen
							to position them.</li>
						<li><strong>Customisable Interface</strong> - The <span class="managerName">Overlay Manager</span>
							user interface can be highly customised to your requirements.</li>
						<li><span class="managerName">Font Manager</span> - You can upload any TrueType font and use
							it in the overlays, or use any font already on your Pi.</li>
						<li><span class="managerName">Variable Manager</span> - Provides a library of fields that you
							can add to the image. You can also add your own fields.</li>
						<li><span class="managerName">Image Manager</span> - Allows you to upload and manage images
							you wish to add to the image.</li>
					</ul>
				</li>
				<li><strong>Text Fields</strong> - This allows text to be added to the image.:
					Key features include:
					<ul class="minimalPadding">
						<li>Ability to add any data from Allsky to the image</li>
						<li>Ability to add custom (extra) data to the image</li>
						<li>Any TrueType font can be used</li>
						<li>Text can be any colour or size</li>
						<li>Text can be rotated</li>
					</ul>
				</li>
				<li><strong>Image Fields</strong> - This allows images to be added to the image:
					<ul class="minimalPadding">
						<li>Any image can be uploaded</li>
						<li>Images can be scaled and rotated and their opacity changed</li>
					</ul>
				</li>
			</ul>

			<h4>How overlays work</h4>
			<p>
			<blockquote>The <span class="managerName">Overlay Manager</span> is what you use to define what information
				you want on the captured images and where it should go.
				Once you have specified that information, you won't use the manager again until
				you want to change something.
				<br>
				The <span class="moduleName">Overlay Module</span> is invoked every time an image is captured and places
				the information you specified in the <span class="managerName">Overlay Manager</span> onto the images.
				This module is one of
				<a allsky="true" href="/documentation/modules/modules.html">several modules</a> that
				can be invoked after every image is captured.
			</blockquote>
			</p>

			<p>In order to use the the <span class="moduleName">Overlay Module</span> you must enable it by
				going to the WebUI and clicking on the <span class="WebUILink">Allsky Settings</span> link,
				then selecting <span class="WebUIValue">overlay</span> in the
				<span class="WebUISetting">Image Overlay</span> setting.
				This disables all the remaining settings in the <strong>Image overlay settings</strong> section
				(you will specify those items in the <span class="managerName">Overlay Manager</span>).
			</p>
			<p>In the <span class="managerName">Overlay Manager</span> you specify what information you want to go where,
				and what it should look like.
				For example, you want the date and time the image was taken to be in blue, 12 point font
				in the upper left of the image and a compass rotated 20 degrees so it's pointing north
				in the upper right of the image.
				You also have a graph of weather information you want on the bottom of the image,
				but because it will hide some of the image you want it to be partially transparent.
			</p>
			<p>After Allsky captures an image it passes that image as well as information
				about the image to the <span class="moduleName">Overlay Module</span>.
				Examples include the time the image was taken, the exposure length,
				and the sensor temperature.
				This information is put into <strong>system variables</strong> that can be used
				per you configuration in the <span class="managerName">Overlay Manager</span>, which then:
			</p>
			<ol class="minimalPadding">
				<li>Replaces the system variables with their values and adds them to the captured image.</li>
				<li>Replaces any module variables with their values and adds them to the captured image.</li>
				<li>Adds any images you specified to the captured image.</li>
			</ol>

			<h2>Allsky Fields and Variables</h2>
			<p>The heart of the <span class="managerName">Overlay Manager</span> is fields.
				There are two types of fields:
				<ol class="minimalPadding">
					<li><strong>Text</strong> fields consist of text and/or system and module variables.
						Variables are enclosed within <code><strong>${}</strong></code>
						and replaced with their values before being added to the captured image.
					<li><strong>Image</strong> fields contain images - pictures, graphics, or anything you want.
						Common uses are logos, weather graphs, and compasses.
				</ol>
			</p>
			<div>
				<details sub>
					<summary></summary>
					<p>Some example fields and variables are:</p>
					<table>
						<thead>
							<tr>
								<th>Field</th>
								<th>Example Output</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><code>${DATE}</code></td>
								<td>24/10/22</td>
								<td>Displays the date from the DATE system variable.
									The date can be formatted in a variety of ways,
									see the section on formatting fields for details.</td>
							</tr>
							<tr>
								<td><code>Date: ${DATE}</code></td>
								<td>Date: 24/10/22</td>
								<td>Displays the string "Date: " then the date from the DATE system variable.
									As above, the date can be formatted in a variety of ways.</td>
							</tr>
							<tr>
								<td><code>Date: ${DATE} ${TIME}</code></td>
								<td>Date: 24/10/22 23:12:34</td>
								<td>Displays the date from the DATE system variable and the time from the
									TIME system variable.
									Both variables can be formatted in a variety of ways.</td>
							</tr>
							<tr>
								<td><code>Exposure</code></td>
								<td>Exposure</td>
								<td>Simply displays the text "Exposure".</td>
							</tr>
						</tbody>
					</table>
					<p>Variables can come from a variety of sources:</p>
					<ul class="minimalPadding">
						<li><strong>Allsky</strong> - The main Allsky application generates system variables.</li>
						<li><strong>Modules</strong> - Any module can create variables.</li>
						<li><strong>Extra Data</strong> - Typically created by an application external to Allsky.</li>
					</ul>

					<h3>Allsky variables</h3>
					<p>The table below shows the most commonly used system variables produced by Allsky;
						a complete list can be found in the <span class="managerName">Field Manager</span>.</p>
					<details sub>
						<summary></summary>
						<p>All the variables refer to the current image.</p>
						<table>
							<thead>
								<tr>
									<th>Variable</th>
									<th>Example Data</th>
									<th>Description</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td><code>${DATE}</code></td>
									<td>20221024</td>
									<td>The date the image was taken.</td>
								</tr>
								<tr>
									<td><code>${TIME}</code></td>
									<td>221623</td>
									<td>The time the image was taken.</td>
								</tr>
								<tr>
									<td><code>${GAIN}</code></td>
									<td>4.692540</td>
									<td>The gain used for the image.</td>
								</tr>
								<tr>
									<td><code>${AUTOGAIN}</code></td>
									<td>1</td>
									<td>1 if auto-gain was enabled, 0 if disabled.</td>
								</tr>
								<tr>
									<td><code>${sAUTOGAIN}</code></td>
									<td>(auto)</td>
									<td>A string containing either <strong>(auto)</strong> if auto-gain was
										enabled, or blank.  Useful to put after the gain, e.g.,
										<code>Gain: ${GAIN} ${sAUTOGAIN}</code>.</td>
								</tr>
								<tr>
									<td><code>${EXPOSURE_US}</code></td>
									<td>90000000</td>
									<td>The exposure of the image in micro seconds.</td>
								</tr>
								<tr>
									<td><code>${sEXPOSURE}</code></td>
									<td>90.0 sec</td>
									<td>The exposure of the image in a human readable format.
										The format changes depending on the exposure time,
										for example, very short exposures may be <code>218.48 ms</code>
										whereas a long exposure may be <code>45.3 sec</code>.
									</td>
								</tr>
								<tr>
									<td><code>${AUTOEXPOSURE}</code></td>
									<td>1</td>
									<td>1 if auto-exposure was enabled, 0 if auto-exposure was disabled.</td>
								</tr>
								<tr>
									<td><code>${sAUTOEXPOSURE}</code></td>
									<td>(auto)</td>
									<td>A string containing either <strong>(auto)</strong> or blank -
										similar to <code>${sAUTOGAIN}</code>.</td>
								</tr>
								<tr>
									<td><code>${TEMPERATURE}</code></td>
									<td>36</td>
									<td>The temperature of the camera sensor, if available.
										This does NOT include the <code>C</code> or <code>F</code> for
										centigrade or fahrenheit so you'll need to add them yourself, e.g.,
										<br><code>Sensor Temp: ${TEMPERATURE} C</code>.</td>
								</tr>
								<tr>
									<td><code>${MEAN}</code></td>
									<td>0.108564</td>
									<td>The mean value brightness for the image.
										The values for ZWO cameras are from 0 (pure black) to 255 (pure white).
										The values for RPi cameras are from 0.0 (pure black) to 1.0 (pure white).
									</td>
								</tr>
								<tr>
									<td><code>${BRIGHTNESS}</code></td>
									<td>0</td>
									<td>The brightness you set in the
										<span class="WebUISetting">Brightness</span> setting in the WebUI.</td>
								</tr>
							</tbody>
						</table>
						<hr class="separatorMinor">
					</details>

					<h3>Module variables</h3>
					<p>Any module can create variables for use in the <span class="moduleName">Overlay Module</span>.
						For this reason it is important that the <span class="moduleName">Overlay Module</span>
						runs as late as possible within the module flow.</p>
						Module variables are used the same way system variables are.
					</p>
					<details sub>
						<summary></summary>
						<p>As an example, the <span class="moduleName">Star Count Module</span> creates a
							variabled called <code>${STARCOUNT}</code> and passes it to the next module.</p>
						<p>Please refer to the documentation on each module for any variables that it makes available.</p>
					</details>

					<h3>Extra data variables</h3>
					<p>Allsky was always able to add additional information to captured images but in a limited way.
						The <span class="managerName">Overlay Manager</span> provides a much more sophisticated method for
						making this data available.</p>
					<details sub>
						<summary></summary>
						<blockquote>This is an advanced topic and as such you will need to have an understanding
							of the Linux file system and how to manage files within it.</blockquote>
						<p>All extra data now resides in the <span class="fileName">~/allsky/tmp/extra</span> directory
							which the <span class="managerName">Overlay Manager</span> will use to create variables.</p>
						<p>Let's assume you want to add weather data to your images. You first need to create
							or obtain a program that gathers that data and writes it to a file. How you obtain
							that file is outside the scope of this documentation, but the program needs to write
							the data in a specific format in a file called
							<span class="fileName">~/allsky/tmp/extra/xxxxx</span>
							(replace the <span class="fileName">xxxxx</span> with an appropriate name).
							This file can be either a simple text file or preferably a json file since it
							provides a lot more flexibility.</p>
						<blockquote class="warning">The <span class="fileName">extra</span> directory will normally
							be re-created after every reboot so don't save anything there that needs to remain
							permanately.
						</blockquote>

						<h4>Text Files</h4>
						<p>Text files must end with a <span class="fileName">.txt</span> extension.
							The format is a simple name=value structure as shown below:</p>
						<table class="module-settings">
							<thead>
								<tr>
									<th width="400">File Contents</th>
									<th>Allsky Result</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td valign="top">
										<div class="code">
											AGTEMP=14.0C<br>
											AGHUMIDITY=90.1%<br>
											AGHEATERCURRENT=215<br>
											AGSTAT=Night<br>
										</div>
									</td>
									<td>
										<table>
											<thead>
												<tr>
													<th>Line in File</th>
													<th>Resulting Variable</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>AGTEMP=14.0C</td>
													<td><code>${AGTEMP}</code></td>
												</tr>
												<tr>
													<td>AGHUMIDITY=90.1%</td>
													<td><code>${AGHUMIDITY}</code></td>
												</tr>
												<tr>
													<td>AGHEATERCURRENT=215</td>
													<td><code>${AGHEATERCURRENT}</code></td>
												</tr>
												<tr>
													<td>AGSTAT=Night</td>
													<td><code>${AGSTAT}</code></td>
												</tr>
											</tbody>
										</table>
									</td>
								</tr>
							</tbody>
						</table>
						<p>The data in these files could become 'old' if the application creating them
							fails or is not running. To allow Allsky to detect this you can tell Allsky
							to ignore the files in the <span class="fileName">extra</span>
							directory when they are over a certain age.
							For <span class="fileName">.txt</span> files this value is specified in the
							<span class="managerName">Overlay Manager</span> settings dialog.</p>

						<h4>JSON Files</h4>
						<p>json files are more complex in their structure but provide a lot more flexibility
							for you to add your own variables and even control the attributes of a field.</p>
						<table class="three-col">
							<thead>
								<tr>
									<td>This json will produce exactly the same variables as the txt file
										described above. The data will expire as defined in the
										<span class="managerName">Overlay Manager</span> settings dialog.</td>
									<td>This json includes expiry times for some of the elements. In this case
										the expiry time for the relevant elements will be used and the
										<span class="managerName">Overlay Manager</span>
										dialog expiry setting for the remaining variables.</td>
									<td>This json, which has been truncated for brevity, includes all of the
										attributes that a field can set. It also adds an image.</td>
								</tr>
							</thead>
							<tr>
								<td valign="top">
									<div class="json">
										<div class="indent1">{</div>

										<div class="indent2">"AGTEMP": {</div>
										<div class="indent3">"value": "14.0C"</div>
										<div class="indent2">},</div>

										<div class="indent2">"AGHUMIDITY": {</div>
										<div class="indent3">"value": "90.1%",</div>
										<div class="indent2">},</div>

										<div class="indent2">"AGHEATERCURRENT": {</div>
										<div class="indent3">"value": "215",</div>
										<div class="indent2">},</div>

										<div class="indent2">"AGSTAT": {</div>
										<div class="indent3">"value": "Night",</div>
										<div class="indent2">},</div>

										<div class="indent1">}</div>
									</div>
								</td>
								<td valign="top">
									<div class="json">
										<div class="indent1">{</div>

										<div class="indent2">"AGTEMP": {</div>
										<div class="indent3">"value": "14.0C",</div>
										<div class="indent3">"expires": 600</div>
										<div class="indent2">},</div>

										<div class="indent2">"AGHUMIDITY": {</div>
										<div class="indent3">"value": "90.1%",</div>
										<div class="indent3">"expires": 600</div>
										<div class="indent2">},</div>

										<div class="indent2">"AGHEATERCURRENT": {</div>
										<div class="indent3">"value": "215",</div>
										<div class="indent2">},</div>

										<div class="indent2">"AGSTAT": {</div>
										<div class="indent3">"value": "Night",</div>
										<div class="indent2">},</div>

										<div class="indent1">}</div>
									</div>
								</td>
								<td valign="top">
									<div class="json">
										<div class="indent1">{</div>
										<div class="indent2">"AGTEMP": {</div>
										<div class="indent3">"value": "14.0C",</div>
										<div class="indent3">"x": 800,</div>
										<div class="indent3">"y": 200,</div>
										<div class="indent3">"fill": "#333333",</div>
										<div class="indent3">"font": "ledsled",</div>
										<div class="indent3">"fontsize": 40,</div>
										<div class="indent3">"opacity": 0.2,</div>
										<div class="indent2">},</div>
										<div class="indent2">"AGHUMIDITY": {</div>
										<div class="indent3">"value": "90.1%",</div>
										<div class="indent2">},</div>
										<div class="indent2">"AGCLOUD": {</div>
										<div class="indent3">"value": "11%",</div>
										<div class="indent2">},</div>
										<div class="indent2">"AGSCOPE": {</div>
										<div class="indent3">"image": "crosshair.png",</div>
										<div class="indent3">"x": 300,</div>
										<div class="indent3">"y": 400,</div>
										<div class="indent3">"scale": 0.1,</div>
										<div class="indent3">"expires": 6000,</div>
										<div class="indent3">"opacity": 0.5</div>
										<div class="indent2">}</div>
										<div class="indent1">}</div>
										<p></p>
										<blockquote>This example demonstrates some important points:
											<ul>
												<li>The attributes of a variable can be used to control how a
													field appears, so for example if the temperature is close to
													the dew point then some text could be displayed in a
													highlighted colour. Note that this makes a variable a
													'Field' and can only be used where a single variable is used
													within a field.</li>
												<li>Images can by dynamically added to the captured image. So if you
													wanted to control when an image is added or not added,
													simply add it to, or remove it from, the json file.</li>
											</ul>
										</blockquote>
								</td>
							</tr>

						</table>

						<p>The txt/json files must be created by some application outside of Allsky and there
							are a few things that must be considered when creating the files:</p>
						<ul>
							<li><strong>Variable Name</strong> - Since you could end up conflicting with the names
								of Allsky system variables its best to prefix your own variables. This will help
								prevent any clashes. In the examples above the variables are prefixed with
								<code>AG</code>.
							</li>
							<li><strong>Permissions</strong> - You must ensure that the files created in the
								<span class="fileName">extra</span> directory can be read by Allsky.
								It is up to the application creating them to ensure the permissions are correct.
								The <span class="managerName">Overlay Manager</span> will silently ignore any
								files it cannot read.</li>
						</ul>
					</details>
					<hr class="separatorSmall">
				</details>
			</div>

			<h2>The Main Overlay Manager User Interface</h2>
			<div>
				<p>The <span class="managerName">Overlay Manager</span> consists of two key areas:
					the <strong>toolbar</strong> and <strong>working area</strong>.  The working area
					contains the latest image captured in the background.</p>
				<details sub>
					<summary></summary>
					<p>There are various settings to control
						how visible the image is. A grid is also overlayed on the working area by default to allow easier
						placement of fields, and there are various settings to control how the grid is displayed.
					</p>
					<img allsky="true" src="overlay-window.png" alt="The Main Overlay Window" loading="lazy" class="imgCenter" />
					<table>
						<thead>
							<tr>
								<th>Annotation</th>
								<th>Icon</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">1</span> - Save</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-save fa-lg"></i></td>
								<td>
									<p>This is enabled when any changes have been made that require saving.
									</p>
									<blockquote>This icon is only enabled when <em>leaving</em> certain fields.
										For example if you change a field label you must click out of the field
										before this icon will be enabled.</blockquote>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">2</span> - Add New Text Field</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-font fa-lg"></i></td>
								<td>
									<p>Click to add a new text field or label. When adding
										a field you must manually enter the correct field label.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">3</span> - Add New Image Field</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-image fa-lg"></i></td>
								<td>
									<p>Click to add an image to the overlay. The image must have
										previously been uploaded using the
										<span class="managerName">Image Manager</span>.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">4</span> - Delete the selected field</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-times fa-lg"></i></td>
								<td>
									<p>Click to delete the selected field.
										The "del" or "delete" keys on the keyboard can also be used.</p>
										The button is only enable when a field is selected.
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">5</span> - Add a field</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-list fa-lg"></i></td>
								<td>
									<p>Click to add a <em>pre-defined</em> field from the
										<strong>Available Variables</strong> editor.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">6</span> - Test fields</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-regular fa-square-check fa-lg"></i></td>
								<td>
									<p>Click to display sample data in each of the fields. This is
										useful to see what actual data will look like on the overlay so you can
										better align fields.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">7</span> - Zoom In</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-search-plus fa-lg"></i></td>
								<td>
									<p>Click to zoom in on the image.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">8</span> - Zoom Out</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-search-minus fa-lg"></i></td>
								<td>
									<p>Click to zoom out of the image.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">9</span> - Full Size</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-compress-alt fa-lg"></i></td>
								<td>
									<p>Click to zoom to the full size of the image.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">10</span> - Fit To Screen</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-expand-alt fa-lg"></i></td>
								<td>
									<p>Click to zoom to fit the image on the screen.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">11</span> - Display Font Manager</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-solid fa-download fa-lg"></i></td>
								<td>
									<p>Displays the <span class="managerName">Font Manager</span>.
									See the <a href="#fontManager">Font Manager</a> section for more details.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">12</span> - Display Image Manager</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-arrow-alt-circle-up fa-lg"></i></td>
								<td>
									<p>Displays the <span class="managerName">Image Manager</span>.
									See the <a href="#imageManager">Image Manager</a> section for more details.</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">13</span> - Display Settings</p>
								</td>
								<td class="overlayIcon"><i class="fa fa-cog fa-lg"></i></td>
								<td>
									<p>Displays the <span class="managerName">Overlay Manager</span> settings dialog
										which allows you to change settings of the manager itself.
										See the <a href="#overlayManagerSettings">Overlay Manager Settings</a>
										section for more details.
									</p>
								</td>
							</tr>
							<tr>
								<td>
									<p class="moduleToolbar"><span class="moduleToolbarIconNumber">14</span> - Working Area</p>
								</td>
								<td></td>
								<td>
									<p>The main working area. The image here is the last one captured by Allsky
									</p>
									<blockquote>It's best to create overlays when Allsky is running
										since you will have access to the latest image. Whilst there is nothing
										stopping you creating overlays when Allsky is not running bear in
										mind that you may not be using all of the available screen area since
										the Notification images (e.g., "Allsky is starting") may be smaller than
										those captured by your camera.</blockquote>
								</td>
							</tr>
						</tbody>
					</table>
					<hr class="separatorSmall">
				</details>
			</div>


			<h2>Using The Overlay Manager</h2>
			<p>The following sub-sections detail the basic operation of the
				<span class="managerName">Overlay Manager</span> and how to manage fields and their contents.</p>
			<details sub>
				<summary></summary>
			<div>
				<h3 id="fontManager">The Font Manager</h3>
				<p>The <span class="managerName">Font Manager</span> supports all mainstream browser fonts
					and allows you to upload any TrueType font for use on overlays.</p>
				<details sub>
					<summary></summary>

					<table class="two-col">
						<tbody>
							<tr>
								<td>
									<img allsky="true" src="font-manager.png" alt="Font Manager" loading="lazy" />
								</td>
								<td valign="top">
									<ul>
										<li><span class="moduleToolbarIconNumber">1</span>
											<strong>Installed Fonts</strong> - Lists all the fonts
											installed that can be used.</li>
										<li><span class="moduleToolbarIconNumber">2</span>
											<strong>Delete Button</strong> - Deletes a previously-installed font.
											<blockquote>It is not possible to delete a System Font.</blockquote>
											<blockquote>If a font is in use when deleted then any
												fields using the font will revert to the default font as
												specified in the overlay settings.
											</blockquote>
										</li>
										<li><span class="moduleToolbarIconNumber">3</span>
											<strong>Add from daFont.com</strong> - Allows you to add a
											font from daFont.com by entering a URL.
											See <a href="#dafont">below</a>.</li>
										<li><span class="moduleToolbarIconNumber">4</span>
											<strong>Upload from zip file</strong> - Allows you to upload a
											zip file to install fonts.
											See <a href="#zip">below</a>.</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<p>To use a font it must be installed in the <span class="managerName">Font Manager</span>
						and there are two ways to do this, as described next.</p>
					<ol>
						<li><h4 id="dafont">Install from daFont.com</h4>
							<p>In a separate browser window, navigate to the font page on
								<a href="http://daFont.com" target="_blank">http://daFont.com</a>
								that you wish to install, for example
								https://www.dafont.com/led-sled.font.  Copy the font URL to the clipboard.
								In the <span class="managerName">Font Manager</span> click the <strong>Add Font</strong>
								button and enter the font URL.
								The font will be installed and the installed fonts list refreshed.</p>
							</li>
						<li><h4 id="zip">Installation via a zip file</h4></li>
							<p>First ensure that the font(s) you wish to installed are contained within a zip file.
								You can create the zip file yourself or download from a place like
								<a href="https://fonts.google.com" target="_blank">https://fonts.google.com/</a>.</p>
							<p>In the <span class="managerName">Font Manager</span> click the <strong>Upload Font</strong>
								button and browse to the zip file.
								The fonts will be extracted from the zip file and installed.</p>
							</li>
					</ol>

					<blockquote>When installing fonts if any issues arise the
						<span class="managerName">Font Manager</span> will display a notice
						indicating why the font(s) could not be installed.</blockquote>
					<hr class="separatorMinor">
				</details>

				<h3 id="imageManager">The Image Manager</h3>
				<p>The <span class="managerName">Image Manager</span> allows you to upload images for use on overlays.
				</p>
				<details sub>
					<summary></summary>
					<table class="two-col">
						<tbody>
							<tr>
								<td>
									<img allsky="true" src="image-manager.png" alt="Image Manager" loading="lazy" />
								</td>
								<td valign="top">
									<ul>
										<li><span class="moduleToolbarIconNumber">1</span>
											<strong>Add selected image</strong> - Adds the selected image to the
											overlay. The selected image is outlined in
											<span style="color: red">red</span>.</li>
										<li><span class="moduleToolbarIconNumber">2</span>
											<strong>Delete selected image</strong> - Deletes the selected image
											from the overlay.
											<blockquote>When deleting an image it will also be deleted from the
												Pi. If you want the image to remain on the Pi, select it in the
												<span class="managerName">Overlay Manager</span> and delete it.
											</blockquote>
										</li>
										<li><span class="moduleToolbarIconNumber">3</span>
										<strong>Uploaded Images</strong> - Previously uploaded images
											that can be selected.
											Not all images need to be used on the overlay.</li>
										<li><span class="moduleToolbarIconNumber">4</span>
											<strong>File Upload Area</strong> - Either click on this area
											to upload an image or drag an image onto it.</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<hr class="separatorMinor">
				</details>

				<h3>Adding fields to the overlay</h3>
				<p>There are three ways to add fields to the overlay, two for text fields and one for images.</p>
				<details sub>
					<summary></summary>
					<ol>
						<li>Manually add a new text field.
							<br>
							Click the <strong>Add New Text Field</strong> icon
							(<i class="fa fa-font fa-lg"></i>) on the toolbar to display the
							<strong>Text Properties</strong> editor.
							Enter some text and/or variables in the <strong>Item</strong> field of the editor.
							The new field will initially be positioned in the top left of the captured image but
							can be dragged to wherever you want and its properties set in the editor.
							The <a href="#propertyEditors">property editors</a> are
							described in detail later in this document.
						</li>
						<li>Add fields via the <strong>Available Variables</strong> editor.
							<br>
							Click the <strong>Available Variables</strong> icon
							(<i class="fa fa-list fa-lg"></i>) on the toolbar to display the
							and navigate to the variable you require. Click the plus symbol to add the
							variable to the overlay. The field will start off with just the variable you selected;
							you can add text or other variables to the field later.
							Initially the field will be positioned at the top left but
							can be dragged to wherever you want and its properties changed.
						</li>
						<li>Add an image field.
							<br>
							Click the <strong>Add New Image Field</strong> icon
							(<i class="fa fa-image fa-lg"></i>)
							to display the <strong>Image Properties</strong> editor.
							Select the image you want from the drop
							down and then move it to the overlay, resizing and rotating as required.
							The image must have first been
							uploaded via the <span class="managerName">Image Manager</span> as described above.
						</li>
					</ol>
					<hr class="separatorMinor">
				</details>

				<h3 id="propertyEditors">The property editors</h3>
				<p>The property editors allow setting of the various elements of text and image fields.</p>
				<details sub>
					<summary></summary>
					<h4>Text Property Editor</h4>
					<table class="module-settings">
						<tbody>
							<tr>
								<td><img allsky="true" src="text-property-editor.png" alt="Text Property Editor"
										loading="lazy" /></td>
								<td>
									<ul>
										<li><strong>Item</strong> - The text for the field, including any
											variables.</li>
										<li><strong>Format</strong> - Certain field types allow for
											formatting, including dates, times, and numbers.
											Details of the formats that can be entered is covered under
											the formatting text section.</li>
										<li><strong>Sample</strong> - A value that is displayed when the
											'Test fields' icon
											(<i class="fa fa-regular fa-square-check fa-lg"></i>)
											is selected. This field is useful if the
											variables in the field do not have inbuilt sample values.</li>
										<li><strong>Empty Value</strong> - Normally if there is no value for a variable
											nothing will be displayed for it on the overlay. This
											attribute can be used to set a value for the variable when it is empty.</li>
										<li><strong>X</strong> - The 'x' position of the field in pixels from the left
											of the image. If setting manually you need to take into account the
											width of the field so it doesn't go off the right side.</li>
										<li><strong>Y</strong> - The 'y' position of the field in pixels from the top
											of the image. If setting manually you need to take into account the
											height of the field so it doesn't go off the bottom of the captured image.</li>
										<li><strong>Rotation</strong> - The rotation of the text in degrees.</li>
										<li><strong>Name</strong> - The font to use for the field.</li>
										<li><strong>Size</strong> - The font size.</li>
										<li><strong>Opacity</strong> - The font opacity.</li>
										<li><strong>Colour</strong> - The font colour.</li>
										<li><strong>Stroke Size</strong> - The size in pixels for applying a stroke
											to the field. A stroke can be useful to distinguish the text
											from the background.
											Setting to <code>0</code> disables the stroke.</li>
										<li><strong>Stroke Colour</strong> - The stroke colour to use for the font.</li>
									</ul>
									<blockquote>When using the 'Extra Data' files in json format all of the
										attributes can be overridden in the json file allowing for external
										control of how fields appear.
										For example, you may want the CPU temperature to turn red if it gets too hot.
									</blockquote>
								</td>
							</tr>
						</tbody>
					</table>

					<h4>Image Property Editor</h4>
					<table class="module-settings">
						<tbody>
							<tr>
								<td><img allsky="true" src="image-property-editor.png" alt="Text Property Editor"
										loading="lazy" /></td>
								<td>
									<ul>
										<li><strong>Image</strong> - Select the image to add from the
											dropdown. Images will only appear in the drop down after they have been
											added via the <span class="managerName">Image Manager</span>.</li>
										<li><strong>X</strong> - The 'x' position of the field in pixels from the left
											of the captured image.
											If setting manually you need to take into account the
											width of the image so it doesn't go off the right side.</li>
										<li><strong>Y</strong> - The 'y' position of the field in pixels from the top
											of the captured image.
											If setting manually you need to take into account the
											height of the image so it doesn't go off the bottom of the captured image.</li>
											</li>
										<li><strong>Rotation</strong> - The rotation of the image in degrees.</li>
										<li><strong>Opacity</strong> - The image opacity.</li>
										<li><strong>Scale</strong> - Allows the image to be scaled and resized.</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<hr class="separatorMinor">
				</details>

				<h3>Variable Manager</h3>
				<p>The <span class="managerName">Variable Manager</span> provides a mechanism for storing variables
					and text to create
					fields. Allsky ships with a default set of variables but this can be amended as required.</p>
				<details sub>
					<summary></summary>

					<p>This manager provides a quick method for storing details
						of the available variables and adding them to the overlay. The
						manager comes preinstalled with a set of system variables that
						can be modified but not deleted.
						You can also add your own variables to the manager; typically
						these will come from modules or extra data.</p>
					<p>The manager consists of two tabs.
						The first, 'Allsky Variables' is the library
						of available variables and the second, 'All Variables' is a list of all variables.</p>
					<h4>Allsky Variables tab</h4>
					<table class="two-col vtop">
						<tbody>
							<tr>
								<td>
									<img allsky="true" src="variable-manager-p2.png" alt="Variable Manager"
										loading="lazy" />
								</td>
								<td>
									<p>The 'Allsky Variables' tab shows all variables <em>available to use</em> on
										overlays. Three icons are available for each variable.</p>
									<ul>
										<li>The <img allsky="true" src="variable-manager-add-field.png" alt="Add variable"
												loading="lazy" />
											button adds the field to
											the overlay. It will initially be added at the top left allowing
											you to drag it to where ever required. The <strong>Text Properties</strong>
											editor will also be displayed and populated with the relevant
											data for the variable.</li>
										<li>The <img allsky="true" src="variable-manager-edit-field.png" alt="Edit variable"
												loading="lazy" />
											button allows you to
											edit the field. If the variable is a system variable then only
											certain fields can be changed.</li>
										<li>The <img allsky="true" src="variable-manager-delete-field.png"
												alt="Delete variable" loading="lazy" /> button
											deletes a variable. You can only delete variables that you added.</li>
									</ul>
									<p>The 'Add Variable' button allows you to add your own
										variables and will display the 'Add Variable' dialog box for entering
										information about the variable.</p>
									<p>The search option can be used to quickly search for a variable by name.
										The search is not case sensitive.</p>
								</td>
							</tr>
						</tbody>
					</table>

					<h4>All Variables tab</h4>
					<table class="two-col vtop">
						<tbody>
							<tr>
								<td>
									<img allsky="true" src="variable-manager-all.png" alt="Variable Manager All"
										loading="lazy" />
								</td>
								<td>
									<p>Sometimes it can be hard to find variables from newly added modules or extra
										data. This tab lists every variable that Allsky can see and the last value it
										had. This list provides a faster way to add variables.</p>
									<ul>
										<li>Clicking the <img allsky="true" src="variable-manager-add-field.png" alt="Add variable"
												loading="lazy" />
											button adds the field to the 'Allsky Variables' tab making it
											available for use on overlays.</li>
									</ul>
									<blockquote>If the add button is disabled then it means that the variable is alread
										in the 'Allsky Variables' list.</blockquote>
									<blockquote><strong>IMPORTANT:</strong> This list is only populated if the debug
										mode is enabled for the <span class="moduleName">Overlay Module</span>
										in the <span class="managerName">Module Manager</span>.</blockquote>
								</td>
							</tr>
						</tbody>
					</table>

					<h4>The Add/Edit Variable dialog box</h4>
					<table class="two-col vtop">
						<tbody>
							<tr>
								<td>
									<img allsky="true" src="variable-manager-edit.png" alt="Edit variable"
										loading="lazy" />
								</td>
								<td>
									<ul>
										<li><strong>Variable Name</strong> - The name of the
											variable. This follows the standard method for formatting
											variables. For system variables this cannot be changed.</li>
										<li><strong>Description</strong> - An optional description of the
											variable. This is only for reference and is displayed in the
											<span class="managerName">Variable Manager</span>.</li>
										<li><strong>Format</strong> - This is the
											<a href="#formattingVariables">formatting</a> used to
											display the variable.</li>
										<li><strong>Sample Data</strong> - Sample data that is used when displaying
											sample data in the <span class="managerName">Overlay Manager</span>.</li>
										<li><strong>Type</strong> - Each variable has a <em>type</em> that
											is used to determine what formatting to use. The variable types are:
											<ul class="minimalPadding">
												<li><strong>Text</strong> - A text field</li>
												<li><strong>Number</strong> - A numeric field</li>
												<li><strong>Date</strong> - A date field</li>
												<li><strong>Time</strong> - A time field</li>
											</ul>
										</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>

					<h4 id="formattingVariables">Formatting Variables</h4>
					<p>Date, Time and Number fields can be formatted to alter their appearance. Each
						variable type has a different set of codes for formatting. The codes are loosely
						based on Python.</p>
					<h5>Formatting Numbers</h5>
					<table>
						<thead>
							<tr>
								<th>Directive</th>
								<th>Meaning</th>
								<th>Output Format</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>%0f</td>
								<td>Formats a number to 0 decimal places</td>
								<td>2</td>
							</tr>
							<tr>
								<td>%2f</td>
								<td>Formats a number to 2 decimal places</td>
								<td>2.00</td>
							</tr>
						</tbody>
					</table>

					<h5>Date and Time formats</h5>
					<table>
						<thead>
							<tr>
								<th>Directive</th>
								<th>Meaning</th>
								<th>Output Format</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>%a</td>
								<td>Abbreviated weekday name.</td>
								<td>Sun, Mon, ...</td>
							</tr>
							<tr>
								<td>%A</td>
								<td>Full weekday name.</td>
								<td>Sunday, Monday, ...</td>
							</tr>
							<tr>
								<td>%w</td>
								<td>Weekday as a decimal number.</td>
								<td>0, 1, ..., 6</td>
							</tr>
							<tr>
								<td>%d</td>
								<td>Day of the month as a zero added decimal.</td>
								<td>01, 02, ..., 31</td>
							</tr>
							<tr>
								<td>%-d</td>
								<td>Day of the month as a decimal number.</td>
								<td>1, 2, ..., 31</td>
							</tr>
							<tr>
								<td>%b</td>
								<td>Abbreviated month name.</td>
								<td>Jan, Feb, ..., Dec</td>
							</tr>
							<tr>
								<td>%B</td>
								<td>Full month name.</td>
								<td>January, February, ...</td>
							</tr>
							<tr>
								<td>%m</td>
								<td>Month as a zero added decimal number.</td>
								<td>01, 02, ..., 12</td>
							</tr>
							<tr>
								<td>%-m</td>
								<td>Month as a decimal number.</td>
								<td>1, 2, ..., 12</td>
							</tr>
							<tr>
								<td>%y</td>
								<td>Year without century as a zero added decimal number.</td>
								<td>00, 01, ..., 99</td>
							</tr>
							<tr>
								<td>%-y</td>
								<td>Year without century as a decimal number.</td>
								<td>0, 1, ..., 99</td>
							</tr>
							<tr>
								<td>%Y</td>
								<td>Year with century as a decimal number.</td>
								<td>2013, 2019 etc.</td>
							</tr>
							<tr>
								<td>%H</td>
								<td>Hour (24-hour clock) as a zero added decimal number.</td>
								<td>00, 01, ..., 23</td>
							</tr>
							<tr>
								<td>%-H</td>
								<td>Hour (24-hour clock) as a decimal number.</td>
								<td>0, 1, ..., 23</td>
							</tr>
							<tr>
								<td>%I</td>
								<td>Hour (12-hour clock) as a zero added decimal number.</td>
								<td>01, 02, ..., 12</td>
							</tr>
							<tr>
								<td>%-I</td>
								<td>Hour (12-hour clock) as a decimal number.</td>
								<td>1, 2, ..., 12</td>
							</tr>
							<tr>
								<td>%p</td>
								<td>Locale's AM or PM.</td>
								<td>AM, PM</td>
							</tr>
							<tr>
								<td>%M</td>
								<td>Minute as a zero added decimal number.</td>
								<td>00, 01, ..., 59</td>
							</tr>
							<tr>
								<td>%-M</td>
								<td>Minute as a decimal number.</td>
								<td>0, 1, ..., 59</td>
							</tr>
							<tr>
								<td>%S</td>
								<td>Second as a zero added decimal number.</td>
								<td>00, 01, ..., 59</td>
							</tr>
							<tr>
								<td>%-S</td>
								<td>Second as a decimal number.</td>
								<td>0, 1, ..., 59</td>
							</tr>
							<tr>
								<td>%f</td>
								<td>Microsecond as a decimal number, zero added on the left. Please note that
									Allsky's times are only to the nearest second.</td>
								<td>000000 ... 999999</td>
							</tr>
							<tr>
								<td>%z</td>
								<td>UTC offset in the form +HHMM or -HHMM.</td>
								<td>+0100</td>
							</tr>
							<tr>
								<td>%Z</td>
								<td>Time zone name.</td>
								<td>Europe/London</td>
							</tr>
							<tr>
								<td>%j</td>
								<td>Day of the year as a zero added decimal number.</td>
								<td>001, 002, ..., 366</td>
							</tr>
							<tr>
								<td>%-j</td>
								<td>Day of the year as a decimal number.</td>
								<td>1, 2, ..., 366</td>
							</tr>
							<tr>
								<td>%U</td>
								<td>Week number of the year (Sunday as the first day of the week). All
									days in a new year preceding the first Sunday are considered to be
									in week 0.</td>
								<td>00, 01, ..., 53</td>
							</tr>
							<tr>
								<td>%W</td>
								<td>Week number of the year (Monday as the first day of the week). All
									days in a new year preceding the first Monday are considered to be
									in week 0.</td>
								<td>00, 01, ..., 53</td>
							</tr>
						</tbody>
					</table>
				</details>

			</div>
			<hr class="separator">
			</details>

			<h2 id="overlayManagerSettings">Overlay Manager Settings</h2>
			<p>The <span class="managerName">Overlay Manager</span> has a settings dialog that can be used to manage
				settings for both the current overlay and the <span class="managerName">Overlay Manager</span> itself.</p>
			<details sub>
				<summary></summary>
			<div>

				<h3>Layout Defaults tab</h3>
				<p>The 'Layout Defaults' are settings that apply to the current layout.</p>
				<details sub>
					<summary></summary>
					<table class="two-col">
						<tbody>
							<tr>
								<td valign="top">
									<img allsky="true" src="overlay-settings-layout.png" alt="Layout Settings"
										loading="lazy" />
								</td>
								<td>
									<ul style="padding-top: 0px">
										<li><strong>Default Image Opacity</strong> - When adding a new image
											this will be set as the default opacity.</li>
										<li><strong>Default Image Rotation</strong> - When adding a new image
											this will be set as the default rotation.</li>
										<li><strong>Default Font</strong> - When adding a new variable this will
											be used as the default font.</li>
										<li><strong>Default Font Size</strong> - When adding a new variable this
											will be used as the default font size.</li>
										<li><strong>Default Font Opacity</strong> - When adding a new variable
											this will be used as the default font opacity.</li>
										<li><strong>Default Font Colour</strong> - When adding a new variable
											this will be used as the default font colour.</li>
										<li><strong>Default Text Rotation</strong> - When adding a new variable
											this will be used as the default text rotation.</li>
										<li><strong>Default Extra Data Expiry</strong> - For extra data files
											that do not specify an expiry time this default will be used.</li>
										<li><strong>Norad ID's</strong> - List of NORAD ID's for generating
											<a href="#satelliteData">satellite data</a>.</li>
										<li><strong>Include Planets</strong> - When enabled, data for the
											Planets's position will be generated as variables.</li>
										<li><strong>Include Sun</strong> - When enabled, data for the Sun's
											position will be generated as variables.</li>
										<li><strong>Include Moon</strong> - When enabled, data for the Moon's
											position will be generated as variables.</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<blockquote>The Satellite and Planet options can be CPU intensive and are disabled by
						default. When enabling these please use the <span class="moduleName">Module Manager's</span>
						debug option to ensure these settings
						are not causing an issue with the capture process. Details of how to use the
						<span class="managerName">Module Manager</span> debug option are covered in the <a allsky="true"
							href="/documentation/modules/modules.html">Module Manager</a> section.</blockquote>
					<hr class="separatorMinor">
				</details>

				<h3>Editor Defaults tab</h3>
				<p>'Editor Defaults' are default settings that apply to the <strong>Overlay Editor</strong>.</p>
				<details sub>
					<summary></summary>
					<table class="two-col">
						<tbody>
							<tr>
								<td valign="top">
									<img allsky="true" src="overlay-settings-editor.png" alt="Editor Settings"
										loading="lazy" />
								</td>
								<td>
									<ul style="padding-top: 0px">
										<li><strong>Display Grid</strong> - Displays the grid for easier
											alignment of fields on the overlay.</li>
										<li><strong>Grid Size</strong> - The size of the grid in pixels.
											This grid is used to 'snap' fields making their placement easier.</li>
										<li><strong>Grid Opacity</strong> - The grid opacity, reduce this
											for finer grids to make them more visible.</li>
										<li><strong>Show Snap Rectangle</strong> - When moving a field a
											rectangle will be displayed showing where the field will snap to
											if dropped.</li>
										<li><strong>Add List Page Size</strong> - The number of variables to
											show per page in the <span class="managerName">Variable Manager</span>.</li>
										<li><strong>Add Field Opacity</strong> - When adding a new field all
											other fields will be set to this opacity to make the new field
											easier to see and place.</li>
										<li><strong>Select Field Opacity</strong> - When selecting a field
											all other fields will be set to this opacity to make the new field easier
											to see and place.</li>
										<li><strong>Zoom With Mouse Wheel</strong> - When enabled scrolling the
											mouse wheel will zoom the overlay.</li>
										<li><strong>Background Image Opacity</strong> - When opacity of the
											image being overlayed. Lower this if the image is bright to make
											it easier to see the fields.</li>
										<li><strong>Enable Debug Mode</strong> - Displays an additional toolbar
											button with access to debug information.
<!-- TODO: There are no details below:     See below for more details. -->
											</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
				</details>
				<hr class="separatorSmall">
			</div>
			</details>

			<h2 id="satelliteData">Satellites / Sun / Moon / Planets</h2>
			<p>The <span class="managerName">Overlay Manager</span> can generate data for celestial bodies.
				Normally these are
				disabled unless the relevant options are selected in the <span class="managerName">Overlay Manager</span>
				settings. All calculations are based upon the latitude and longitude in the WebUI.</p>
			<details sub>
				<summary></summary>
				<h3>The Sun</h3>
				<blockquote>The Sun must be enabled in the <span class="managerName">Overlay Manager</span>
					settings before any variables are created.</blockquote>
				<p>For the Sun various timings are generated for sunrise/sunset etc.</p>
				<p>The Sun times furing daytime capture are for the current day.
					During nighttime capture they are for the period the night time capture is in progress,
					i.e. prior to midnight the sunset times are for the current day and the sun rise for the next day.
					After midnight the sunset times are for the previous day and the sunrise times for the current day.</p>
				<p>There are times when there is no Astronomical darkness.
					In these cases <code>SUN_NIGHT</code> and <code>SUN_NIGHTEND</code>
					will be set to the value defined in the
					<span class="moduleName">Overlay Module</span> settings,
					in the <span class="managerName">Module Manager</span>.</p>
				<p>The following Sun-related variables are available in the
					<span class="managerName">Variable Manager</span>:</p>
				<table>
					<thead>
						<tr>
							<th>Variable</th>
							<th>Description</th>
						</tr>
					</thead>

					<tbody>
						<tr>
							<td>${SUN_AZIMUTH}</td>
							<td>The Azimuth of the Sun with respect to the Allsky camera location.</td>
						</tr>
						<tr>
							<td>${SUN_ELEVATION}</td>
							<td>The Elevation of the Sun with respect to the Allsky camera location.</td>
						</tr>
						<tr>
							<td>${SUN_DARKEST}</td>
							<td>Darkest moment of the night, Sun is in the lowest position.</td>
						</tr>
						<tr>
							<td>${SUN_NIGHTEND}</td>
							<td>Morning astronomical twilight start.</td>
						</tr>
						<tr>
							<td>${SUN_NAUTICALDAWN}</td>
							<td>End of Civilian twilight.</td>
						</tr>
						<tr>
							<td>${SUN_DAWN}</td>
							<td>Morning nautical twilight ends, morning civil twilight starts.</td>
						</tr>
						<tr>
							<td>${SUN_SUNRISE}</td>
							<td>Top edge of the sun appears on the horizon.</td>
						</tr>
						<tr>
							<td>${SUN_SUNRISEEND}</td>
							<td>Sunrise ends (bottom edge of the Sun touches the horizon).</td>
						</tr>
						<tr>
							<td>${SUN_NOON}</td>
							<td>Solar noon (Sun is in the highest position).</td>
						</tr>
						<tr>
							<td>${SUN_SUNSETSTART}</td>
							<td>Sunset starts (bottom edge of the Sun touches the horizon).</td>
						</tr>
						<tr>
							<td>${SUN_SUNSET}</td>
							<td>Sunset (Sun disappears below the horizon, evening civil twilight starts).</td>
						</tr>
						<tr>
							<td>${SUN_DUSK}</td>
							<td>Dusk (evening nautical twilight starts).</td>
						</tr>
						<tr>
							<td>${SUN_NAUTICALDUSK}</td>
							<td>Nautical dusk (evening astronomical twilight starts).</td>
						</tr>
						<tr>
							<td>${SUN_NIGHT}</td>
							<td>Night starts (dark enough for astronomical observations).</td>
						</tr>
					</tbody>
				</table>

				<h3>The Moon</h3>
				<blockquote>The Moon must be enabled in the <span class="managerName">Overlay Manager</span>
					settings before any variables are created.</blockquote>
				<p>The following Moon-related variables are available:</p>
				<table>
					<thead>
						<tr>
							<th>Variable</th>
							<th>Example Value</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>${MOON_AZIMUTH}</td>
							<td>262&deg;</td>
							<td>Azimuth of the Moon.</td>
						</tr>
						<tr>
							<td>${MOON_ELEVATION}</td>
							<td>-24.65&deg;</td>
							<td>Elevation of the Moon.</td>
						</tr>
						<tr>
							<td>${MOON_ILLUMINATION}</td>
							<td>7.3</td>
							<td>Illumination of the Moon in %.</td>
						</tr>
						<tr>
							<td>${MOON_SYMBOL}</td>
							<td></td>
							<td>Using this variable and the Moon Font will display the current phase of the Moon.</td>
						</tr>
					</tbody>
				</table>

				<h3>The planets</h3>
				<blockquote>The planets must be enabled in the <span class="managerName">Overlay Manager</span>
					settings before any variables are created.</blockquote>
				<p>The following planet-related variables are available:</p>
				<table>
					<thead>
						<tr>
							<th>Variable</th>
							<th>Example Value</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>${MERCURYALT}</td>
							<td>-27deg 06' 55.2"</td>
							<td>The Altitude of Mercury in Degrees.</td>
						</tr>
						<tr>
							<td>${MERCURYAZ}</td>
							<td>292deg 07' 41.6"</td>
							<td>The Azimuth of Mercury.</td>
						</tr>
						<tr>
							<td>${MERCURYVISIBLE}</td>
							<td>No</td>
							<td>Yes/No to indicate if Mercury is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
						<tr>
							<td>${VENUSALT}</td>
							<td>-25deg 03' 52.8"</td>
							<td>The Altitude of Venus in Degrees.</td>
						</tr>
						<tr>
							<td>${VENUSAZ}</td>
							<td>282deg 23' 21.9"</td>
							<td>The Azimuth of Venus.</td>
						</tr>
						<tr>
							<td>${VENUSVISIBLE}</td>
							<td>No</td>
							<td>Yes/No to indicate if Venus is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
						<tr>
							<td>${MARSALT}</td>
							<td>03deg 56' 06.7"</td>
							<td>The Altitude of Mars in Degrees.</td>
						</tr>
						<tr>
							<td>${MARSAZ}</td>
							<td>55deg 12' 53.7"</td>
							<td>The Azimuth of Mars.</td>
						</tr>
						<tr>
							<td>${MARSVISIBLE}</td>
							<td>Yes</td>
							<td>Yes/No to indicate if Mars is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
						<tr>
							<td>${JUPITERALT}</td>
							<td>29deg 49' 30.9"</td>
							<td>The Altitude of Jupiter in Degrees.</td>
						</tr>
						<tr>
							<td>${JUPITERAZ}</td>
							<td>142deg 19' 20.8"</td>
							<td>The Azimuth of Jupiter.</td>
						</tr>
						<tr>
							<td>${JUPITERVISIBLE}</td>
							<td>Yes</td>
							<td>Yes/No to indicate if Jupiter is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
						<tr>
							<td>${SATURNALT}</td>
							<td>20deg 50' 21.6"</td>
							<td>The Altitude of Saturn in Degrees.</td>
						</tr>
						<tr>
							<td>${SATURNAZ}</td>
							<td>187deg 21' 15.3"</td>
							<td>The Azimuth of Saturn.</td>
						</tr>
						<tr>
							<td>${SATURNVISIBLE}</td>
							<td>Yes</td>
							<td>Yes/No to indicate if Saturn is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
						<tr>
							<td>${URANUSALT}</td>
							<td>21deg 21' 51.3"</td>
							<td>The Altitude of Uranus in Degrees.</td>
						</tr>
						<tr>
							<td>${URANUSAZ}</td>
							<td>90deg 10' 23.5"</td>
							<td>The Azimuth of Uranus.</td>
						</tr>
						<tr>
							<td>${URANUSVISIBLE}</td>
							<td>Yes</td>
							<td>Yes/No to indicate if Uranus is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
						<tr>
							<td>${NEPTUNEALT}</td>
							<td>29deg 43' 44.2"</td>
							<td>The Altitude of Neptune in Degrees.</td>
						</tr>
						<tr>
							<td>${NEPTUNEAZ}</td>
							<td>150deg 24' 55.8"</td>
							<td>The Azimuth of Neptune.</td>
						</tr>
						<tr>
							<td>${NEPTUNEVISIBLE}</td>
							<td>Yes</td>
							<td>Yes/No to indicate if Neptune is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
						<tr>
							<td>${PLUTOALT}</td>
							<td>10deg 07' 14.9"</td>
							<td>The Altitude of Pluto in Degrees.</td>
						</tr>
						<tr>
							<td>${PLUTOAZ}</td>
							<td>207deg 49' 18.1"</td>
							<td>The Azimuth of Pluto.</td>
						</tr>
						<tr>
							<td>${PLUTOVISIBLE}</td>
							<td>Yes</td>
							<td>Yes/No to indicate if Pluto is visible. This does NOT mean its visible to the
								naked eye just that its above the horizon.</td>
						</tr>
					</tbody>
				</table>

				<h3>Satellites</h3>
				<p>The <span class="managerName">Overlay Manager</span> can generate position elements for satellites.
					To enable this enter a comma separated list of NORAD IDs in the
					<span class="managerName">Overlay Manager's</span> settings.</p>
				<p>To find NORAD IDs browse to the <a href="https://celestrak.org/satcat/search.php" />Celestrak</a>
					website and search for the desired object.
					Then enter the IDs as a comma-separated list in the <span class="managerName">Overlay Manager's</span>
					settings.</p>

				<table class="two-col">
					<tbody>
						<tr>
							<td>
								<img allsky="true" src="satellite-options.png" alt="Satellite Settings"
									loading="lazy" />
							</td>
							<td>
								<p>In this example we have entered two Norad IDs:</p>
								<ul class="minimalPadding">
									<li><strong>25544</strong> - The International Space Station.</li>
									<li><strong>20580</strong> - The Hubble Space telescope.</li>
								</ul>
							</td>
						</tr>
					</tbody>
				</table>
				<p>This will generate the following variables that can be used in overlays.</p>
				<table>
					<thead>
						<tr>
							<th>Variable</th>
							<th>Example Value</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>${25544ALT}</td>
							<td>-32deg 41' 34.3"</td>
							<td>The Altitude of the ISS in Degrees.</td>
						</tr>
						<tr>
							<td>${25544AZ}</td>
							<td>58deg 46' 59.3"</td>
							<td>The Azimuth of the ISS in Degrees.</td>
						</tr>
						<tr>
							<td>${25544VISIBLE}</td>
							<td>No</td>
							<td>Yes/No to indicate if the ISS is above the horizon
								(it may or may not be visible to the naked eye).</td>
						</tr>
						<tr>
							<td>${20580ALT}</td>
							<td>-32deg 41' 34.3"</td>
							<td>The Altitude of the Hubble in Degrees.</td>
						</tr>
						<tr>
							<td>${20580AZ}</td>
							<td>58deg 46' 59.3"</td>
							<td>The Azimuth of the Hubble in Degrees.</td>
						</tr>
						<tr>
							<td>${20580VISIBLE}</td>
							<td>No</td>
							<td>Yes/No to indicate if the Hubble is above the horizon
								(it may or may not be visible to the naked eye).</td>
						</tr>
					</tbody>
				</table>
			</details>
			<br><hr class="separator">
			</details>

			<!-- ================================================= -->
			<p>&nbsp;</p>
			<h2>Legacy Overlay Method</h2>
			<details><summary></summary>
				<p>
				With the <b>legacy</b> overlay method you can add text to an image automatically or manually,
				or add images manually.
				</p>

				<h3>Automatically add text</h3>
				<details sub><summary></summary>
				<p>
				In the <span class="WebUILink">Allsky Settings</span> page of the WebUI under the <b>Image overlay settings</b> section,
				look for the "Show" settings, like <span class="WebUISetting">Show Exposure</span>.
				Turning any of these settings on will cause that information to be added to the overlay.
				You can also add your own single line of text by entering it into the
				<span class="WebUISetting">Text Overlay</span> field.
				This line is added after the optional time and before the "Show" data fields.
				</p>

				<p>
				Allsky can also add text from a file you create using the
				<span class="WebUISetting">Extra Text File</span> and
				<span class="WebUISetting">Max Age Of Extra</span> (Text File) settings.
				Allsky reads the
				<span class="WebUISetting">Extra Text File</span> file and overlays the contents onto your images.
				The file can have multiple lines.
				The <span class="WebUISetting">Max Age Of Extra</span>
				setting determines how old in seconds the file can be before it is no longer used.
				Set it to <span class="WebUIValue">0</span> to always display the information.
				This file is often used to add text that is updated regularly, for example, weather information.
				See the <a href="#extraTextFileExample">Extra Text File example</a> below for an example
				of how to use this file.
				<br>
				When considering what to include in the file,
				remember the size of your image - do you care if the text covers the image, for example?
				The contents of the text file will go below the optional time, sensor temperature,
				and other information.
				</p>

				<p>
				You can format the text that's displayed.
				The optional time and <span class="WebUISetting">Text Overlay</span>
				line are formatted using the <span class="WebUISetting">Font Color</span> and other settings;
				the remaining text is formatted with the
				<span class="WebUISetting">Small Font Color</span> setting.
				The small font's size is 80% of the size of the large fonts.
				You'll want to play around with these values to get the best results based on your sensor size,
				cropping, resizing, etc.

				<blockquote>
				Many people have lines that are either too close together or too far apart,
				and this looks unsightly.
				The spacing between text lines can be adjusted via the
				<span class="WebUISetting">Line Height</span> setting.
				</blockquote>
				</p>

				<h3 id="extraTextFileExample">Extra Text File example</h3>
				<p>
				Let's say you want to display the humidity on each image.
				The camera doesn't report this information and Allsky doesn't know it,
				so you'll need to provide that information to Allsky so it can add it to the images.
				This requires hardware that reports the humidity,
				and some software to read the humidity from the hardware and save it to a file.
				You need to provide the hardware and software;
				how they work are outside the scope of this documenation
				since that varies drastically depending on what you have.
				Assume you have a script that writes the word "humidity" followed by the humidity
				and a percent sign to a file called <span class="fileName">/home/pi/allsky/humidity.txt</span>
				every 10 minutes (for example, <b>Humidity 21%</b>).
				In order to display the humidity on the images,
				enter <span class="fileName">/home/pi/allsky/humidity.txt</span>
				into the <b>Extra Text File</b> field and click on the
				<img allsky="true" src="/documentation/img/saveChangesButton.png" class="buttonIcon" title="Save Changes button" alt="Save Changes">
				button.
				The next image will show the humidity in the
				<span class="WebUIValue">Small Font Color</span> you specified.
				</p>

				<p>
				Now, let's say your script stops working - the
				<span class="fileName">/home/pi/allsky/humidity.txt</span> file will still have
				<b>Humidity 21%</b> forever and that's what your pictures will show.
				You may not notice for several days.
				As a failsafe, set the
				<span class="WebUISetting">Max Age Of Extra</span> field to <b>1800</b> seconds (30 minutes).
				Before Allsky saves every picture it checks the age of the file,
				and if it's LESS than the
				<span class="WebUISetting">Max Age Of Extra</span> seconds old it will add the contents of the file to the image.
				If the file is MORE than
				<span class="WebUISetting">Max Age Of Extra</span> seconds old it will ignore the file.
				If your software starts running again, the next image will automatically
				have the humidity because Allsky checks the age of the file before every picture.
				Why 30 minutes in this example?
				Clearly you can set it to anything,
				but 30 allows for a couple humidity measurements to be missed before it stops
				displaying the humidity.
				For humidity it probably doesn't matter,
				but for something like wind speed you may want to save it every minute and have a
				<span class="WebUISetting">Max Age Of Extra</span> of 180 seconds (3 minutes), for example.
				</p>
				<p>
				If you want to stop using the
				<span class="WebUISetting">Extra Text File</span>
				simply erase what's in the field in the WebUI.  At that point it won't matter what's in the
				<span class="WebUISetting">Max Age Of Extra</span>
				field since that field only applies if you are using a extra text file.
				</p>
				<hr class="separator">
				</details>


			<h3>Manually add text and/or images (advanced)</h3>
			<details sub><summary></summary>
			<blockquote>
			The new <b>overlay</b> method of adding text and/or images anywhere on the image
			is <b>much</b> easier than what's described in this section.
			</blockquote>
			<p>
			Allsky doesn't directly support adding images in the <b>legacy</b> overlay mode so you'll
			need to do some fairly simple programming.
			The <code>convert</code> command is a great way to add images.
			Below are <i>some</i> of the options, but execute <code>convert --help</code> to see all of them.
			<a href="https://legacy.imagemagick.org/Usage/annotating/">This page</a> has some good examples
			and <a href="https://imagemagick.org/script/convert.php">this page</a> and
			<a href="https://imagemagick.org/script/command-line-options.php">this page</a>
			are great resources for options.
			</p>

			<blockquote>
			If you create a script to add something to an image,
			there is no way using the <b>legacy</b> overlay method
			to have that script automatically called after an image is written to disk.
			The <b>overlay</b> method allows that, however.
			</blockquote>
			<p>
			When specifying the starting location of the text or image,
			remember that <b>0,0</b> is the upper left pixel of the Allsky image.
			</p>

			In general, the <code>convert</code> command takes an input image,
			a set of operations to perform, and an output image.
			The simple example below writes "Hello World!" in white, 60-pixel helvetica font,
			starting 0 pixels from the left and 300 pixels from the top of the
			image called "input_image.png" and writes it to
			<span class="fileName">output_image.png</span>.
<pre>convert -font helvetica -fill white -pointsize 60 \
	 -draw "text 0,300 'Hello World!'" input_image.png output_image.png</pre>

			<p>
			Some options to <code>convert</code> you may find useful:
			</p>
			<table>
			<thead>
				<tr> <th>Option</th> <th>Description</th> </tr>
			</thead>
			<tbody>
			<tr>
				<td>-draw</td>
				<td>Allows adding text and all sorts of shapes to an image.
					See <a href="https://imagemagick.org/script/command-line-options.php#draw">this page</a>.
				</td>
			</tr><tr>
				<td>-weight &lt;font weight&gt;</td>
				<td>See <a href="https://imagemagick.org/script/command-line-options.php#weight">this page</a>
					for a list of possible weights, such as <b>bold</b>.
				</td>
			</tr><tr>
				<td>-fill &lt;color&gt;</td>
				<td>text color</td>
			</tr><tr>
				<td>-stroke &lt;color&gt;</td>
				<td>text stroke (i.e., outline) color</td>
			</tr><tr>
				<td>-strokewidth &lt;number&gt;</td>
				<td>width of -stroke in pixels</td>
			</tr><tr>
				<td>-pointsize &lt;number&gt;</td>
				<td>size of text in pixels</td>
			</tr><tr>
				<td>-gravity &lt;north/south/east/west/center/northeast&gt;</td>
				<td>Specifies where the text should be placed.
					It's needed if specifying and exact text position
					for example, using "0,300" in the sample command above).
				</td>
			</tr><tr>
				<td>-font &lt;name&gt;</td>
				<td>Name of the font to use, for example "helvetica", "arial", etc.</td>
			</tr><tr>
				<td>-rectangle &lt;width,height,x,y&gt;</td>
				<td>Creates a rectangle and is usually used with "-fill &lt;color&gt;" before it.</td>
			</tr>
			</tbody>
			</table>

			Notes:
			<ul>
				<li>&lt;color&gt; can be a word like "white" or a hex value without opacity like "#ff44aa"
					or with opacity like "#ff44aa88"
					(where "88" is the opacity - "00" is transparent, "ff" is opaque).
			</ul>
			</details>
		</details>


		</div><!-- Layout-main -->
	</div><!-- Layout -->
</body>

</html>
<script> includeHTML(); </script>
