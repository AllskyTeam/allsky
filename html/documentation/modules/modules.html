<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="../js/documentation.js" type="application/javascript"></script>
	<link href="../css/light.css" rel="stylesheet">
	<link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="../bower_components/jquery/dist/jquery.min.js"></script>
	<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<style>
		#pageTitle::before {
			content: "Modules";
		}
	</style>
	<link href="../css/documentation.css" rel="stylesheet">
	<link href="../documentation-favicon.ico" rel="shortcut icon" type="image/png">
	<script src="../js/all.min.js" type="application/javascript"></script>
	<title>Modules</title>
</head>

<body>
	<div w3-include-html="/documentation/pageHeader.html" id="pageHeader"></div>
	<div class="Layout">
		<div class="Layout-sidebar" w3-include-html="/documentation/sidebar.html" id="sidebar"></div>
		<div class="Layout-main markdown-body" id="mainContents">

			<p><strong>Modules</strong> can be used to enhance images created by Allsky.
				Different modules perform different tasks,
				and the <span class="managerName">Module Manager</span>
				allows you to control which modules run and when.
			</p>
			<p>There are two types of modules:</p>
			<ol>
				<li><strong>Allsky Modules</strong> are developed and maintained
					by the Allsky team and are installed with Allsky.</li>
				<li><strong>User Modules</strong> are developed and maintained
					by other people and can optionally be installed
					and deleted if no longer required.
					<blockquote class="warning">
						User Modules should only be installed from the official
						<a external="true" href="https://github.com/AllskyTeam/allsky-modules">
						user-modules</a> repository using the directions listed there.
						Installing from other source can be dangerous.
					</blockquote>
					</li>
			</ol>

			Warning:
			<ul>
				<li>Some modules are shown as <strong>experimental</strong>.
					Before using these modules you should ensure that you are proficient
					in analysing Linux log files.
					Experimental modules can be unstable and as such may "break" Allsky.</li>
				<li>Some modules are designed to operate with external hardware,
					typically connected to the Pi's GPIO pins.
					Before attempting to use any of these modules make sure
					you have an understanding of interfacing hardware to the PI's GPIO.</li>
			</ul>

			<p>Don't be discouraged by the above warnings -
				the module system is very flexible and allows you to
				customise Allsky without having to change any Allsky code.</p>


			<h1>Module Flows</h1>
			<div>
				<p>Modules are run within <strong>Flows</strong>
					which determine when the modules run.
					Each flow can have a different list of modules that are run
					and the order in which they are run.
					The different flows are listed below.
				</p>
				<details>
					<summary></summary>
					<p>The flows in which modules run are:</p>
					<ul class="minimalPadding">
						<li><strong>Daytime Capture</strong> - Modules in this flow
							are run after every daytime image is captured and initially saved.
						</li>
						<li><strong>Nighttime Capture</strong> - Modules in this flow
							are run after every nighttime image is captured and saved.
						</li>
						<li><strong>Day to Night Transition</strong> - Modules in this flow
							are run when Allsky switches from Daytime to Nighttime capturing per the
							<span class="WebUISetting">Latitude</span>,
							<span class="WebUISetting">Longitude</span>, and
							<span class="WebUISetting">Angle</span>
							you've defined in the WebUI.
						</li>
						<li><strong>Night to Day Transition</strong> - Modules in this flow
							are run when Allsky switches from Nighttime to Daytime capturing.
						</li>
						<li><strong>Periodic jobs</strong> - Modules in this flow
							are run periodically and are not related to image capture.
							Each module defines how often it runs.</li>
					</ul>
					<p>The diagram below shows each stage of the capture process and how modules fit into it.
					</p>

					<img allsky="true" loading="lazy" src="Flows.png" alt="Flows" class="imgCenter" />
				</details>
			</div>


			<h1>The <span class="managerName">Module Manager</span></h1>
			<div>
				<p>Modules are managed via the <span class="managerName">Module Manager</span>.</p>
				<details>
					<summary></summary>
					<img allsky="true" class="imgCenter" loading="lazy"
						src="Module-Manager.png" alt="Module Manager" />
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th>Annotation</th>
								<th>Icon</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td class="WebUISetting">Save</td>
								<td><i class="fa fa-save fa-lg"></i></td>
								<td>This is enabled when any changes are made.</td>
							</tr>
							<tr>
								<td class="WebUISetting">Upload</td>
								<td><i class="fa-solid fa-upload"></i></td>
								<td>This allows you to upload a zip file containing
									a new or updated module.
									Please see the section on uploading a modules for
									more details on how to use this feature.</td>
							</tr>
							<tr>
								<td class="WebUISetting">Flow</td>
								<td></td>
								<td>The flow you wish to manage.
									If you have unsaved changes from the current
									flow you will be prompted to save them before switching</td>
							</tr>
							<tr>
								<td class="WebUISetting">Settings</td>
								<td><i class="fa-solid fa-gear"></i></td>
								<td>Displays the settings dialog for the
									<span class="managerName">Module Manager</span>.</td>
							</tr>
							<tr>
								<td class="WebUISetting">Debug</td>
								<td><i class="fa-solid fa-bug"></i></td>
								<td>Displays the debug data for modules.
									This icon is only visible if it's been
									enabled in the Module Options.</td>
							</tr>
							<tr>
								<td class="WebUISetting">Reset</td>
								<td><i class="fa-solid fa-rotate-right"></i></td>
								<td>Resets the selected flow to the installation default.</td>
							</tr>
							<tr>
								<td class="WebUISetting">Restore</td>
								<td><i class="fa-solid fa-upload"></i></td>
								<td>Restores the flow to the last backup.
									This option is only be visible if there is a
									restore point available.</td>
							</tr>


						</tbody>
					</table>

					<h2>Selecting a flow</h2>
					<div>
						<p>From the drop down list select the flow that you wish to amend.
							If there are unsaved changes for the current flow then
							you will be prompted to save them before switching to a new flow.
							The current day/night flow will automatically be selected depending
							upon the current time of day.
						</p>
					</div>

					<h2>Uploading a module</h2>
					<blockquote class="warning">Please only upload modules from trusted sources.
						All modules uploaded are done so at your own risk.</blockquote>
					<p>To upload a module it must be in a zip file with the same name as the module.
						For example, if you have a module called
						<span class="fileName">allsk_test.py</span> the zip file must
						be called <span class="fileName">allsky_test.zip</span>.
					</p>

					<h2>Enabling a module</h2>
					<div>
						<p>To enable a module drag it from the <strong>Available Modules</strong>
							column to the <strong>Selected Modules</strong> column
							and select the "Enabled" checkbox.
							The module will become active after the flow has been saved.
							You can set modules to be automatically enabled when dragging
							them to the <strong>Selected Modules</strong> column in the
							<span class="editorName">Module Editor</span> Module Options.</p>
						<p>Most modules require some configuration after they have
							been moved to the <strong>Selected Modules</strong> column.
							Clicking the
							<span class="btn btn-primary btn-not-real btn-small">Settings</span>
							button will display any configuration options for the module.</p>
					</div>

					<h2>Disabling a Module</h2>
					<div>
						<p>There are two ways to disable a module:</p>
						<ul class="minimalPadding">
							<li>Drag the module to the <strong>Available Modules</strong> column -
								this will disable the module and lose any settings for it.</li>
							<li>Uncheck the "Enabled" checkbox -
								this will disable the module but retain any settings.
								This is the preferred method if you just wish
								to temporarily disable a module.</li>
						</ul>

						<h3>Setting the Module execution order</h3>
						<p>The modules are run in the order they appear in the
							<strong>Selected Modules</strong> column.
							To change the order simply drag the modules up or down the list.
							Modules
							<span style="color: white; background-color: #DF0000;">
								highlighted in red</span>
							can not be moved.</p>
					</div>

					<h2><span class="managerName">Module Manager</span> Settings</h2>
					<div>
						<table class="module-settings vtop">
							<tr>
								<td><img allsky="true" loading="lazy" alt="Module manager Settings"
										src="module-manager-settings.png" /></td>
							</tr>
							<tr>
								<td>
									<ul>
										<li><strong>Auto Enable</strong> -
											Automatically enables modules when added to the
											<strong>Selected Modules</strong> column.</li>
										<li><strong>Debug Mode</strong> -
											When enabled the debug option
											<i class="fa-solid fa-bug"></i>
											is available in the toolbar which will show
											the results and execution time for each module.</li>
										<li><strong>Periodic Timer</strong> -
											How frequently, in seconds,
											the <strong>Periodic jobs</strong> flow is run.</li>
									</ul>
								</td>
							</tr>
						</table>
					</div>
				</details>
			</div>


			<h1 id="Modules">Modules</h1>
			<div>
				<p>Modules form the heart of the module manager and there is a
				wide variety available.
				In this section each module is described in details along with all
				of the available settings.</p>

				<h2>Allsky Modules</h2>
				<details>
					<summary></summary>
					<p>The Allsky Modules are installed along with the main Allsky installer.
						The available modules are:</p>

					<h3>Load Image module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Loads the last image taken by Allsky.
										This is always the first module that is run during
										the Daytime and Nighttime Capture flows to ensure that
										the image is available to all subsequent modules.
										It is therefore not possible to move or remove it.</p>
									<p>This module is enabled by default so there
										is no need to install it.</p>
								</td>
							</tr>
						</tbody>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Save Image module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Saves the final image after all of the modules have run.
										This is always the last module run
										so it is not possible to move or remove it.</p>
									<p>This module is enabled by default so there
										is no need to install it.</p>
								</td>
							</tr>
						</tbody>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Mask Image module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This applies a mask to the image.
										This can be useful if there are artefacts outside
										of the image created by the lens that you wish to remove.
										Create a mask with pure white in the areas
										you wish to <strong>keep</strong> and black in
										the areas you wish to be black.
										See the section on creating and using masks below.</p>
								</td>
							</tr>
						</tbody>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Clear Sky module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This attempts to determine if the sky is clear.
										It does this by counting the stars in a
										Region of Interest (ROI) and if this is
										above a threshold the sky is assumed to be clear.
										The module's settings allow you to specify the
										ROI on the image and the
										parameters for detecting stars.
										If required the current calculated
										sky state can be sent to an MQTT broker.
										Certain other modules can
										also use the results of this module.
										For example the <span class="moduleName">Star Count</span>
										module can be set to only run if the sky is clear,
										as determined by this module.
										It is recommended to run this module early in the flow,
										generally after the
										<span class="moduleName">Mask Image</span> module.</p>
								</td>
							</tr>
						</tbody>
					</table>

					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Clearksy Settings"
								src="module-clearksy-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Region Of Interest</strong> -
										The ROI of the image to use for clear sky detection.</li>
									<li><strong>Fallback %</strong> -
										If no ROI is specified then this %
										around the center of the image will be used.</li>
									<li><strong>Clear Sky</strong> -
										The sky is assumed clear if more
										than this number of stars are found within the ROI.</li>
									<li><strong>Detection Threshold</strong> -
										Lowering this value will detect more stars
										and possibly false positives.
										Increasing it will detect fewer stars.</li>
									<li><strong>Distance Threshold</strong> -
										Any stars fond within this number of pixels
										of another star will only count as a single star.
										Reducing this value will increase the number
										of detected stars but
										also increase the number of false positives found.</li>
									<li><strong>Star Template Size</strong> -
										The size of a "standard" star.
										Reducing this value will detect more stars
										and false positives.</li>
									<li><strong>Mask Path</strong> -
										The path name to the mask that is applied to the image
										before any star detection.
										This is useful to exclude areas of the
										image that you do not want examined for stars.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Clearksy Settings"
								src="module-clearksy-settings-debug.png" /></td>
						</tr>
						<tr>
							<td>
								<p>These options are for debugging and should not be used
									for normal operation:</p>
								<ul>
									<li><strong>Annotate Stars</strong> -
										Draws a circle around each detected star.
										This is useful when tuning the detection values
										to see what is considered a star.</li>
									<li><strong>Enable Debug Mode</strong> -
										When selected an image is saved into the
										<span class="fileName">~allsky/tmp/debug</span>
										folder after each stage of the detection process.</li>
									<li><strong>Debug Image</strong> -
										If an image is specified then this is used
										rather than the last image taken by Allsky.
										This is useful for configuring
										the star detection during the day by using
										a previously captured image.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Clearksy Settings"
								src="module-clearksy-settings-mqtt.png" /></td>
						</tr>
						<tr>
							<td>
								<blockquote>This is an advanced option and requires an MQTT broker.
									The setup and operation of
									a broker is beyond the scope of this document.</blockquote>
								<ul>
									<li><strong>Enable MQTT</strong> -
										Enables publishing the Sky State to the MQTT Broker.</li>
									<li><strong>MQTT Broker address</strong> -
										The FQDN or IP address of the broker.</li>
									<li><strong>MQTT Broker port</strong> -
										The port number of the Broker.</li>
									<li><strong>MQTT Username</strong> -
										The username to login to the Broker.</li>
									<li><strong>MQTT Password</strong> -
										The password to login to the Broker.</li>
									<li><strong>MQTT Topic</strong> -
										The topic to post the Sky State to.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Star Count module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This counts stars in the captured Allsky Image.</p>
									<p>Stars are counted by using a template that looks
										like a star and attempts to locate anything in the image
										that looks like it.
										This works well when the image is well exposed and
										masked to remove any areas that do not contain
										stars (e.g., buildings, trees, etc.)</p>
									<p>You will need to experiment with the detection
										values to get the best results.
										Annotating the stars in the image can be very helpful.
										The Moon can also cause issues.
<!-- Uncomment and modify when these changes are implemented:
										A future version of this module will automatically
										mask the Moon or any other bright areas and also
										allow you to disable the module when the Moon
										meets certain critera
										such as over a certain % brightness and elevation.
-->
										</p>
									<blockquote>This module is experimental and as such
										may produce erroneous results.</blockquote>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Starcount Settings"
								src="module-starcount-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Detection Threshold</strong> -
										Lowering this value will
										detect more stars, possibly false positives.
										Increasing it will detect fewer stars.</li>
									<li><strong>Distance Threshold</strong> -
										Any stars fond within this number of pixels of
										another star will only count as a single star.
										Reducing this value will increase the number
										of detected stars but
										also increase the number of false positives found.</li>
									<li><strong>Star Template size</strong> -
										The size of a "standard" star.
										reducing this value will detect more stars
										and false positives.</li>
									<li><strong>Mask Path</strong> -
										The path name to the mask that is applied to the image
										before any star detection.
										This is useful to exclude areas of the
										image that you do not want examined for stars.</li>
									<li><strong>Use Clear Sky</strong> -
										If the 'Clear Sky' module is
										running then its results will be used to
										determine if stars should be counted.
										If the sky is not clear then no attempt will be made to
										count stars.</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" alt="Starcount Settings"
								src="module-starcount-settings-debug.png" /></td>
						</tr>
						<tr>
							<td>
								<p>These options are for debugging and should not be used
									for normal operation:</p>
								<ul>
									<li><strong>Annotate Stars</strong> -
										Draws a circle around each detected star.
										This is useful when tuning the detection values.</li>
									<li><strong>Enable debug mode</strong> -
										When selected an image is saved into the
										<span class="fileName">~/allsky/tmp/debug</span>
										folder after each stage of the detection process.</li>
									<li><strong>Debug Image</strong> -
										If an image is specified then this is
										used rather than the last image taken by Allsky.
										This is useful for configuring the star detection
										during the day by using a previosuly captured image.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Meteor Detection module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This attempts to detect any meteors in the image.
										The detection method looks for hard edges in
										an image and thus is susceptible to
										false positives if the image is not masked
										to hide anything that isn't sky.</p>
									<p>You will need to experiment with the detection
										values to get the best results.
										Annotating the meteors in the image can be very helpful.
										The Moon can also cause issues.
<!-- Uncomment and modify when these changes are implemented:
										A future version of this module will automatically
										mask the Moon or any other bright areas and also
										allow you to disable the module when the Moon
										meets certain critera
										such as over a certain % brightness and elevation.
-->
									<blockquote>This module is experimental and as such
										may produce erroneous results.</blockquote>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Meteorcount Settings"
								src="module-meteor-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Mask Path</strong> -
										The path name to the mask that is applied to the image
										before any star detection.
										This is useful to exclude areas of the
										image that you do not want examined for stars.</li>
									<li><strong>Minimum Length</strong> -
										Any streaks longer than this number of
										pixels will be considered a meteor.</li>
									<li><strong>Use Clear Sky</strong> -
										If the <strong>Clear Sky</strong> module is
										running then its results will be used to
										determine if meteors should be detected.
										If the sky is not clear then no meteor detection will
										be attempted.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Meteorcount Settings"
								src="module-meteor-settings-debug.png" /></td>
						</tr>
						<tr>
							<td>
								<p>These options are for debugging and should not be used
									for normal operation:</p>
								<ul>
									<li><strong>Annotate Meteors</strong> -
										Any detected meteors will be
										highlighted in the image.</li>
									<li><strong>Enable debug mode</strong> -
										When selected an image is saved into the
										<span class="fileName">~/allsky/tmp/debug</span>
										folder after each stage of the detection process.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Export module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Exports all Allsky variables to a json file.
										By default all environment variables prefixed with
										<code>AS_</code> are exported but via the
										Module Options other Allsky variables
										can also be made available.
										This can be used by external programs.</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Export Settings"
								src="module-export-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>File Location</strong> -
										The location to save the file.
										Certain Allsky variables can be used to construct the path
										- see the variables section below for more details.</li>
									<li><strong>Extra data to export</strong> -
										A comma separated list of
										additional variables to save.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Overlay module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Overlays data on the captured image.
										This module applies the fields defined in the
										<a allsky="true" external="true"
											href="/documentation/overlays/overlays.html">
											<span class="editorName">Overlay Editor</span></a>.</p>
									<blockquote>Typically the overlay module will run
										towards if not at the end of the flow.
										This will allow it access to other variables
										created by modules.</blockquote>
								</td>
							</tr>
						</tbody>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Script module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This allows a script to be run.
										This should only be used by users
										that understand how scripts are developed/run on Linux.
										<strong>Extreme</strong> care must be taken when
										using this module as it could cause
										Allsky to stop operating.
									</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Script Settings"
								src="module-script-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>File Location</strong> -
										The full path name to the script to execute.
										The module will check to ensure the script exists and
										is executable before any attempt is made to run it.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Save Image Data module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This module writes image related data to a
										database allowing it to be graphed in the WebUI.</p>
								</td>
							</tr>
						</tbody>
					</table>
					</details>

				</details>


				<h2>User Modules</h2>
				<details>
					<summary></summary>
					<p>You must manually install User Modules from a
						<a external="true" href="https://github.com/AllskyTeam/allsky-modules">
							separate GitHub repository</a>.</p>

					<h3>Cloud Cover module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<blockquote>This module requires
											external hardware for its operation.</blockquote>
									<p>This module uses an
										<a external="true"
											href="https://www.sparkfun.com/datasheets/Sensors/Temperature/MLX90614_rev001.pdf">MLX90614</a>
										to determine the amount of cloud cover.
										The MLX90614 is a non-contact Infra Red thermometer.
										It is used to measure the temperature of the sky and
										compare it to the ambient temperature.
										Generally the difference between the Sky temperature
										and ambient can be used to determine the amount of clouds.
										The exact theory for the calculations is beyond
										the scope of this documentation.</p>
									<p>Two different methods are available for
										determining the cloud cover:</p>
									<ol>
										<li><strong>Simple</strong> -
											The difference between Sky and ambient
											temperature is used to determine the cloud cover.</li>
										<li><strong>Advanced</strong> -
											Uses a polynomial model to correct
											the sky temperature reading.
											The forumale used in this method are derived from
											<a href="https://indiduino.wordpress.com/2013/02/02/meteostation/"
												external="true">
												https://indiduino.wordpress.com/2013/02/02/meteostation/</a>
											and
											<a href="https://lunaticoastro.com/aagcw/TechInfo/SkyTemperatureModel.pdf"
												external="true">
												https://lunaticoastro.com/aagcw/TechInfo/SkyTemperatureModel.pdf</a>
										</li>
									</ol>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Cloud Cover Settings"
								src="module-cloudcover-settings-sensor.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>i2C Address</strong> -
										The default i2C address for the MLX90614 is 0x5A.
										If you need a different address specify it here in Hex.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Cloud Cover Settings"
								src="module-cloudcover-settings-settings.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Clear Below &deg;C</strong> -
										Below this sky temperature it is assumed to be clear.</li>
									<li><strong>Cloudy Above &deg;C</strong> -
										Above this sky temperature it is assumed to be cloudy.</li>
								</ul>
								<p>Between the two above temperatures the sky is
									assumed to be partially cloudy.</p>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Cloud Cover Settings"
								src="module-cloudcover-settings-advanced.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Use advanced mode</strong> -
										If enabled the polynomial model will be used.</li>
								</ul>
								<ul class="minimalPadding">
									<li><strong>k1</strong> - TBC</li>
									<li><strong>k2</strong> - TBC</li>
									<li><strong>k3</strong> - TBC</li>
									<li><strong>k4</strong> - TBC</li>
									<li><strong>k5</strong> - TBC</li>
									<li><strong>k6</strong> - TBC</li>
									<li><strong>k7</strong> - TBC</li>
								</ul>
								<p>Details of the formulae used can be found on the
									<a external="true"
										href="https://lunaticoastro.com/aagcw/TechInfo/SkyTemperatureModel.pdf">
										lunaticoastro website</a>.</p>
								<blockquote>Setting these values requires a lot of experimentation.
								</blockquote>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Cloud Cover Circuit"
								src="cloud-cover.png" width="500px" /></td>
						</tr>
						<tr>
							<td>
								<p>A typical connection diagram for a Cloud Cover sensor.
									As mentioned above the
									process of detecting clouds is not simple.
									The basic principle is to measure the difference
									between the ambient temperature and the sky temperature.
									The ambient is fairly easy to measure but the sky temperature
									presents some problems:</p>
								<ol>
									<li>Field of View (FOV) -
										A narrow FOV will lead to results just above the
										sensor whereas a wide FOV will have less sensitivity.
										The narrow FOV versions provide a more
										accurate reading albeit with a much narrower FOV.</li>
									<li>Moisture -
										Since the sensor needs to be pointed vertically,
										if any moisture from rain/snow sits on it then the
										reading will be inaccurate.</li>
								</ol>
								<p>The moisture problem is a little more difficult to
									solve and the best solution is to mount
									the sensor horizontally and use a reflective
									surface to reflect the sky onto the sensor.
									This allows the sensor to stay dry.</p>
								<p>Several environment variables are created that can be used
									in the <span class="managerName">Overlay Manager</span>:</p>
								<ul class="minimalPadding">
									<li><strong>CLOUDAMBIENT</strong> -
										The ambient temperature.</li>
									<li><strong>CLOUDSKY</strong> -
										The sky temperature.</li>
									<li><strong>CLOUDCOVER</strong> -
										A string, either "Clear", "Partial" or "Coudy".</li>
									<li><strong>CLOUDCOVERPERCENT</strong> -
										The percentage of cloud cover, only
										available when using the Advanced method.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Dew Heater module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
										<li>Periodic jobs</li>
									</ul>
								</td>
								<td>
									<blockquote>
										This module requires external
										hardware for its operation.</blockquote>
									<p>This module allows you to control a digital GPIO
										pin that can in turn be used to drive a dew heater.
										The GPIO pin cannot directly drive the heater,
										instead it must be used to drive some form of switch or
										relay / transistor etc. to control the heater.
										The electronics to do
										this are beyond the scope of this documentation.</p>
									<p>Some form of sensor is required to obtain
										the current temperature and humidity.
										The module supports the most common form of sensors
										available on the market as of 2024.</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Dew Heater Settings"
								src="module-dew-settings-sensor.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Sensor Type</strong> -
										The type of sensor to use:
										<ul>
											<li><strong>SHT31</strong> -
												Uses an SHT31 on i2c address 0x44.
												The alert mode on the SHT31 is not supported.</li>
											<li><strong>DHT22</strong> -
												Uses a DHT22 sensor connected to a GPIO pin.
												The pin is selected in the "Input Pin" option.</li>
											<li><strong>DHT11</strong> -
												Uses a DHT11 sensor connected to a GPIO pin.
												The pin is selected in the "Input Pin" option.</li>
											<li><strong>BME280-I2C</strong> -
												Uses a BME280 in i2c mode on address 0x77.</li>
										</ul>
									</li>
									<li><strong>Input Pin</strong> -
										The GPIO pin for the DHT11/22 sensors.</li>
									<li><strong>i2C Address</strong> -
										If your sensor uses i2c and has a different address
										to the standard one for the sensor,
										enter the HEX address here.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Dew Heater Settings"
								src="module-dew-settings-heater.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Heater Pin</strong> -
										The GPIO pin for the heater control.
									</li>
									<li><strong>Startup Mode</strong> -
										Determines if the heater should be
										on when allsky starts or off.</li>
									<li><strong>Invert Relay</strong> -
										Normally the GPIO pin will go high to enable a relay.
										Selecting this option if the relay is wired to
										activate on the GPIO pin going Low.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Dew Heater Settings"
								src="module-dew-settings-control.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Delay</strong> -
										The delay in seconds between sensor readings.
										If running in Daytime or Nightime Capture
										flows then the frame exposure
										time needs to be taken into account.</li>
									<li><strong>Limit</strong> -
										If the temperature is within this many degrees of
										the dew point the heater will be enabled or disabled.</li>
									<li><strong>Forced Temperature</strong> -
										If the temperature is below
										this value the heater will always be enabled.</li>
									<li><strong>Max Heater Time</strong> -
										Not yet implemented.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td>
								<img allsky="true" loading="lazy" alt="Dew Heater Circuit"
									src="dew-heater.png" width="800px" /></td>
						</tr>
						<tr>
							<td>
								<p>A typical connection diagram for a dew heater.
									In this example an SHT31 sensor is
									being used to provide the temperature and humidity data.
									The module will then determine if the heater is
									required and enable the relevant GPIO pin -
									20 in this case.</p>
								<blockquote class="warning">
									Driving relays directly from the Pi's GPIO
									pins can be problematic and cause damage to your Pi.
									If you are using a module then please ensure it has a
									<a external="true"
										href="https://en.wikipedia.org/wiki/Snubber">snubber</a>
									and is optically isolated.
									Please check the <a external="true"
										href="https://forums.raspberrypi.com/viewtopic.php?f=91&t=83372&p=1225448#p1225448">
										Raspberry Pi FAQ</a> for more details.</blockquote>

								<p>Several environment variables are created that can be used
									in the <span class="managerName">Overlay Manager</span>:</p>
								<ul class="minimalPadding">
									<li><strong>DEWCONTROLAMBIENT</strong> -
										The ambient temperature.</li>
									<li><strong>DEWCONTROLDEW</strong> -
										The calculated dew point.</li>
									<li><strong>DEWCONTROLHUMIDITY</strong> -
										The Humidity.</li>
									<li><strong>DEWCONTROLHEATER</strong> -
										Either "on" or "off" indicating the
										status of the dew heater.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>GPIO module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Night/Day Transition</li>
										<li>Day/Night Transition</li>
									</ul>
								</td>
								<td>
									<blockquote>
										This module requires external
										hardware for its operation.</blockquote>
									<p>This module allows a GPIO pin's state to
										be set on the transitions between day/night and night/day.
										This could for example be used to
										trigger some external electronics to cover and
										uncover the camera to protect it from direct
										sunlight in very warm climates.</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="GPIO Settings"
									src="module-gpio-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>GPIO Pin</strong> -
										The GPIO pin to set.</li>
									<li><strong>Pin State</strong> -
										The state to set the pin to - 0 for off, 1 for on.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Discord module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
										<li>Daytime Capture</li>
										<li>Night to Day Transition</li>
									</ul>
								</td>
								<td>
									<blockquote>
										This module requires
										configuration in Discord.
										<br>It also requires Python 3.9.0 or greater.
										The module installer will not allow the module to be
										installed if you do not have the correct version
										of Python installed.</blockquote>
									<p>This module allows images to be sent to Discord channels.
										The following images can be sent to Discord:</p>
									<ul class="minimalPadding">
										<li>Daytime images -
											To post these include the module in the
											<strong>Daytime Capture</strong> flow.</li>
										<li>Nightime images -
											To post these include the module in the
											<strong>Nighttime Capture</strong> flow.</li>
										<li>Startrails, Keograms, Daily Timelapse videos -
											To post these files include the module in the
											<strong>Night to Day Transition</strong> flow.</li>
									</ul>

									<blockquote>
										Discord implements a <a external="true"
											href="https://discord.com/developers/docs/topics/rate-limits">
											rate limit</a>
										on the API but it is very unlikely that
										you will hit any of the limits.
										<br>
										Discord also implements a limit of 8 MB for any posted item.
										The timelapse videos may exceed this
										rate so if you wish to send them to Discord you will have to
										configure Allsky to limit video to less than 8 MB.
										The module checks before sending a file and
										if it exceeds the Discord limit the file is not sent
										and an error is logged in the allsky log file.</blockquote>
									<p>You will need to create Webhooks in your Discord server.
										These can be created from the server settings
										as shown below:</p>
									<img allsky="true" loading="lazy" src="discord-webhooks.png"
										alt="Discord Webhook" />
								</td>
							</tr>
						</tbody>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Discord Settings"
								src="module-discord-settings-day.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Post Daytime Images</strong> -
										Select this option to post
										daytime images to the Discord Server.</li>
									<li><strong>Daytime Count</strong> -
										Every x images send the current
										image to the Discord server.</li>
									<li><strong>Webhook URL</strong> -
										The webhook for the daytime images.
										The value for this field is created in the Discord
										server's settings under "integration".</li>
								</ul>
							</td>
						</tr>
					</table>

					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Discord Settings"
								src="module-discord-settings-night.png" /></td>
						</tr>
						<tr>
							<td>
								These settings are the same as for Day Time.</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Discord Settings"
								src="module-discord-settings-startrails.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Post Startrails Images</strong> -
										Select this option to post
										startrails images to the Discord Server.</li>
									<li><strong>Webhook URL</strong> -
										The webhook for the startrails images.
										The value for this field is created in the Discord
										server's settings under integration.</li>
								</ul>
							</td>
						</tr>
					</table>

					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Discord Settings"
								src="module-discord-settings-keograms.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Post Keograms Images</strong> -
										Select this option to post
										keogram images to the Discord Server.</li>
									<li><strong>Webhook URL</strong> 
										The webhook for the keogram images.
										The value for this field is created in the Discord
										server's settings under integration.</li>
								</ul>
							</td>
						</tr>
					</table>

					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Discord Settings"
								src="module-discord-settings-timelapse.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Post Timelapse videos</strong> -
										Select this option to post
										timelapse videos to the Discord Server.</li>
									<li><strong>Webhook URL</strong> -
										The webhook for the timelapse videos.
										The value for this field is created in the Discord
										server's settings under "integration".</li>
								</ul>
								<blockquote>
									Discord implements a limit of 8 MB for any posted item.
									It's possible that the timelapse videos may exceed this rate
									so if you wish to send them to Discord you will have
									to configure Allsky to ensure that the video is less than 8 MB.
									The module will check before sending the file
									and if it exceeds the Discord limit it will not be sent
									and an error logged in the allsky log file.</blockquote>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Rain module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
										<li>Daytime Capture</li>
									</ul>
								</td>
								<td>
									<blockquote>This module requires external hardware.</blockquote>
									<p>This module uses an external sensor to detect rain.
										There are various cheap sensors available to detect
										rain that either provide an analog or digital output.
										This module only supports sensors with a
										<strong>digital</strong> output.</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Rain Settings"
								src="module-rain-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Input Pin</strong> -
										The GPIO pin the rain sensor is connected to.</li>
									<li><strong>Invert Sensor</strong> -
										Normally the sensor will be high
										for clear and low for rain.
										This setting will reverse this.</li>
								</ul>
							</td>
						</tr>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Cloud Cover Circuit"
								src="rain-detection.png" width="500px" /></td>
						</tr>
						<tr>
							<td>
								<p>A typical connection diagram for rain detection using
									a cheap rain detection module.</p>
								<p>These cheap sensors work but
									the contact boards suffer badly from corrosion.
									A much better module is described
									<a href="https://www.kemo-electronic.de/en/House/Garden/M152-Rain-Sensor-12-V-DC.php"
										external="true">here</a>.
									Whilst more expensive and requiring a 12 volt supply,
									this is a far superior rain and snow detector.</p>
								<p>Two environment variables are created that can be used
									in other modules or the
									<span class="managerName">Overlay Manager</span>:</p>
								<ol class="minimalPadding">
									<li><strong>RAINSTATE</strong> -
										A text string either "Not Raining" or "Raining".</li>
									<li><strong>ALLSKYRAINFLAG</strong> -
										 A text string either "False" or "True".</li>
								</ol>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>Open Weather Map module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Periodic jobs</li>
									</ul>
								</td>
								<td>
									<p>This module reads weather data from the
										free Open Weather Map API.
										To use this module you need to signup for
										a free API key on the
										<a href="https://openweathermap.org/" external="true">
											openweathermap</a>
										website.
										The location used for the weather is your
										<span class="WebUISetting">Latitude</span>
										and
										<span class="WebUISetting">Longitude</span>.</p>
									<blockquote>The free tier of the API is limited to 1000
										calls per day so you will need to configure
										the settings appropriately.
										Reading the data every 10 minutes is more than
										frequent enough and will
										ensure you do not exceed the API limit.</blockquote>
									<p>Several environment variables are created
										that can be used in the
										<span class="managerName">Overlay Manager</span>:</p>
									<ul class="minimalPadding">
										<li><strong>OWWEATHER</strong> -
											A text string representing the weather.</li>
										<li><strong>OWWEATHERDESCRIPTION</strong> -
											A text string representing the weather.</li>
										<li><strong>OWTEMP</strong> -
											The temperature.</li>
										<li><strong>OWTEMPFEELSLIKE</strong> -
											What the temperature feels like.</li>
										<li><strong>OWTEMPMIN</strong> -
											The minimum temperature.</li>
										<li><strong>OWTEMPMAX</strong> -
											The maximum temperature.</li>
										<li><strong>OWPRESSURE</strong> -
											The pressure.</li>
										<li><strong>OWHUMIDITY</strong> -
											The humidity.</li>
										<li><strong>OWWINDSPEED</strong> -
											The wind speed.</li>
										<li><strong>OWWINDDIRECTION</strong> -
											The wind direction.</li>
										<li><strong>OWWINDGUST</strong> -
											The wind gust speed.</li>
										<li><strong>OWCLOUDS</strong> -
											The cloud cover.</li>
										<li><strong>OWRAIN1HR</strong> -
											Rainfall within the last hour.</li>
										<li><strong>OWRAIN3HR</strong> -
											Rainfall within the last three hours.</li>
										<li><strong>OWSUNRISE</strong> -
											Time the Sun rises.</li>
										<li><strong>OWSUNSET</strong> -
											Time the Sun sets.</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Open Weather Map Settings"
								src="module-openweathermap-settings-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>API Key</strong> -
										The API key you generated after signing
										up to Open Weather Map.</li>
									<li><strong>Filename</strong> -
										The name of the "extra data" file the
										Open Weather Map data is saved in.
										Normally you should not need to change this.</li>
									<li><strong>Read Every</strong> -
										Call the API every x seconds.
										Be mindful of the 1000 API limit per
										day when setting this value.</li>
									<li><strong>Units</strong> -
										The units to express the data in, either
										"Standard" (SI Units), "Metric" or "Imperial".</li>
									<li><strong>Expiry Time</strong> -
										The number of seconds the data is valid for.
										See the
										<a allsky="true" external="true"
											href="/documentation/overlays/overlays.html">
											<span class="editorName">Overlay Editor</span></a>
										documentation for details.</li>
								</ul>
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>

					<h3>GPS module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Periodic jobs</li>
									</ul>
								</td>
								<td>
									<p>This module was developed for those that
										use their allsky cameras in mobile locations.
										It was developed to allow the Pi's location and
										clock to be set from the GPS data.</p>
									<p>This module requires a GPS connected to the Pi
										that can be managed by gpsd.</p>
									<blockquote><strong>NOTE:</strong>
										The HDMI and Wifi on the Pi 4 is VERY noisy and
										will interfere with most GPS modules.
										To get around this please ensure
										that the GPS receiver and antenna is mounted
										at least one meter (three feet)
										away from the Pi.</blockquote>

									<h4>Time synchronisation</h4>
									<p>Even if you set the time sync options in the
										GPS module the time will only be synchronised if the
										Pi is NOT having its time updated from the Internet.
										To test if the time is currently being synchronised
										fom the Internet enter the following command:
										<br><code>timedatectl status</code></p>

									<p>Output similar to the following will be produced:</p>
									<div class="modulecode">
										<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
												Local time: Fri 2023-02-03 23:18:36 GMT</tt>
										<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
												Universal time: Fri 2023-02-03 23:18:36 UTC</tt>
										<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
												RTC time: n/a</tt>
										<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
												Time zone: Europe/London (GMT, +0000)</tt>
										<br><tt>System clock synchronized: <span class="red">no</span></tt>
										<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
												NTP service: <span class="red">inactive</span></tt>
										<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
												RTC in local TZ: <span class="red">no</span></tt>
									</div>

									<p>Note that the "System clock synchronized" value is "no"
										which means the GPS module will
										be allowed to set the time.</p>
									<p>Several environment variables are created that
										can be used in the
										<span class="managerName">Overlay Manager</span>:</p>
									</p>
									<ul class="minimalPadding">
										<li><strong>PIGPSFIX</strong> -
											A text string, either "Yes" or "No",
											indicating if the GPS has a fix or not.</li>
										<li><strong>PIGPSUTC</strong> -
											The UTC time from the GPS.</li>
										<li><strong>PIGPSLOCAL</strong> -
											The local time from the GPS.</li>
										<li><strong>PIGPSOFFSET</strong> -
											The time offset from UTC in hours.</li>
										<li><strong>PIGPSLAT</strong> -
											The GPS latitude in degrees, minutes, and seconds.</li>
										<li><strong>PIGPSLON</strong> -
											The GPS longitude in degrees, minutes, and seconds.</li>
										<li><strong>PIGPSLATDEC</strong> -
											The GPS latitude in decimal degrees, minutes,
											and seconds.</li>
										<li><strong>PIGPSLONDEC</strong> -
											The GPS longitude in decimal degrees, minutes,
											and seconds.</li>
										<li><strong>PIGPSFIXDISC</strong> 
											The latitude and longitude discrepancy string,
											if there is a decrepancy found.</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>

					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="GPS Settings"
								src="module-gps-home.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>LAT/LON Warning</strong> -
										If enabled a warning will be generated, both
										in the log files and as an Allsky variable
										if the GPS position does not match
										your
										<span class="WebUISetting">Latitude</span>
										and
										<span class="WebUISetting">Longitude</span>.
										The comparison is done to 2 decimal places to allow for
										GPS fluctuation.</li>
									<li><strong>Set LAT/LON</strong> -
										If enabled your
										<span class="WebUISetting">Latitude</span>
										and
										<span class="WebUISetting">Longitude</span>
										will be set from the GPS.</li>
									<li><strong>Set Time</strong> -
										If enabled the time on the Pi will be set from the GPS.</li>
									<li><strong>Set Every</strong> -
										If the "Set Time" option is enabled the time on the
										Pi will be set every this number of seconds.</li>
									<li><strong>Extra Data Filename</strong> -
										The name of the file to create the GPS data in for the
										<span class="managerName">Overlay Manager</span>.
										Normally you will not need to change this.</li>
									<li><strong>Discrepancy Warning</strong> -
										if the "Lat/Lon Warning" is enabled and a
										discrepancy is found this text will be set
										in the variable for the
										<span class="managerName">Overlay Manager</span>.</li>
								</ul>
							</td>
						</tr>
					</table>

					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="GPS Obfuscation Settings"
								src="module-gps-obfuscate.png" /></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Obfuscate Position</strong> -
										If enabled the values below will be used
										to modify the GPS position.
										This is designed to allow you to display the GPS
										position on an overlay without giving away
										your exact position.</li>
									<li><strong>Latitude Metres</strong> -
										The number of metres to offset the latitude by.
										Can be a positive or negative number.</li>
									<li><strong>Longitude Metres</strong> -
										The number of metres to offset the longitude by.
										Can be a positive or negative number.</li>
								</ul>
							</td>
						</tr>
					</table>

					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="GPS connection"
								src="gps.png" /></td>
						</tr>
						<tr>
							<td>
								A typical setup with a GPS connected to a Pi.
							</td>
						</tr>
					</table>
					<hr class="separatorSmall">
					</details>


					<h3>PI Status module</h3>
					<details sub><summary></summary>
					<table class="module-info vtop">
						<thead>
							<tr class="tableHeader">
								<th class="nowrap">Available in Flows</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Periodic jobs</li>
									</ul>
								</td>
								<td>
									<p>This module reads information about the Pi
										and makes it availbale for use in the
										<span class="managerName">Overlay Manager</span>.</p>
									<p>Several environment variables are created that
										can be used in the
										<span class="managerName">Overlay Manager</span>:</p>
									</p>
									<ul>
										<li><strong>DISKSIZE</strong> -
											The size of the main disk in the Pi.</li>
										<li><strong>DISKUSAGE</strong> -
											Amount of space used on the disk.</li>
										<li><strong>DISKFREE</strong> -
											Amount of free space on the disk.</li>
										<li><strong>CPUTEMP</strong> -
											CPU temp in C/F Only available if the Allsky temp
											settings is Celcius or Fahrenheit.</li>
										<li><strong>CPUTEMP_C</strong> -
											CPU temp in C Only available if the Allsky temp
											settings is set to Celcius.</li>
										<li><strong>CPUTEMP_F</strong> -
											CPU temp in F Only available if the Allsky temp
											settings is set to Fahrenheit.</li>
										<li><strong>THROTTLEDBINARY</strong> -
											Output of vcgencmd get_throttled.</li>
										<li><strong>TSTAT{X}</strong> -
											Throttled bits, see table below.</li>
										<li><strong>TSTATSUMARYTEXT</strong> -
											Textual summary of all of the tstats bits.</li>
									</ul>
									<blockquote>Several other variables are also available
										and are mainly related to
										clock frequencies and voltages.</blockquote>
									<h4>Tstat bits</h4>
									<p>These values are text and either "true" or "false":</p>
									<table style="width: 50%">
										<thead>
										<tr class="tableHeader">
											<th>Variable</th>
											<th>Meaning</th>
										</tr>
										</thead>
										<tr>
											<td>TSTAT0</td>
											<td>Under-voltage detected.</td>
										</tr>
										<tr>
											<td>TSTAT1</td>
											<td>Arm frequency capped.</td>
										</tr>
										<tr>
											<td>TSTAT2</td>
											<td>Currently throttled.</td>
										</tr>
										<tr>
											<td>TSTAT2</td>
											<td>Currently throttled.</td>
										</tr>
										<tr>
											<td>TSTAT3</td>
											<td>Soft temperature limit active.</td>
										</tr>
										<tr>
											<td>TSTAT16</td>
											<td>Under-voltage has occurred.</td>
										</tr>
										<tr>
											<td>TSTAT17</td>
											<td>Arm frequency capping has occurred.</td>
										</tr>
										<tr>
											<td>TSTAT18</td>
											<td>Throttling has occurred.</td>
										</tr>
										<tr>
											<td>TSTAT19</td>
											<td>Soft temperature limit has occurred.</td>
										</tr>
									</table>

								</td>
							</tr>
						</tbody>
					</table>
					<br>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="PI Status Settings"
								src="module-pi-status.png"/></td>
						</tr>
						<tr>
							<td>
								<ul>
									<li><strong>Read Every</strong> -
										Reads the pi status every this number of seconds.</li>
								</ul>
							</td>
						</tr>
					</table>
					</details>

				</details>
			</div>


			<h1 id="masks">Creating and Using Masks</h1>
			<div>
				<p>Several modules can make use of masks, which are used to "hide"
					areas of the image to improve the final image.
					For example, the <span class="moduleName">Star Count</span> module can use a
					mask to hide all areas of the image that may contain things that
					will confuse the star detection algorithm, such as local light pollution
					like a far away street light.</p>
				<blockquote>Masks must be created in image editing software such as
					Gimp or Photoshop.
					There are no tools available within Allsky to create masks.</blockquote>
				<details>
					<summary></summary>
					<p>Masks can also be used to clean up or hide parts of the image
						like buildings, trees, or anything not created by the lens.</p>
					<table class="module-settings vtop">
						<tr>
							<td>
								<p>Consider the following raw image from the camera.
									The areas outside of the image created by the lens
									contain a lot of noise.</p>
							</td>
							<td width="33%"><a href="mask-raw.png" title="Click to enlarge">
								<img allsky="true" loading="lazy" alt="Raw Mask Image"
									src="mask-raw.png" /></a></td>
						</tr>
						<tr>
							<td>
								<p>To clean this up we create a mask which is an
									image that only contains pure white and pure black -
									no gray.
									Any areas in white will be kept and any areas in
									black will be masked.</p>
							</td>
							<td><img allsky="true" loading="lazy" alt="Mask"
								src="mask-raw-mask.png" /></td>
						</tr>
						<tr>
							<td>
								<p>After the mask has been applied the resulting
									image looks a lot cleaner.</p>
							</td>
							<td><a href="mask-raw-final.png" title="Click to enlarge">
								<img allsky="true" loading="lazy" alt="Masked Image"
									src="mask-raw-final.png" /></a></td>
						</tr>
					</table>

					<br>
					<p>Masks are also used to hide areas of the image for some modules
						like <span class="moduleName">Star Count</span>.
						This prevents false positives.
						Consider the following example of another raw image from the camera.</p>
					<table class="module-settings vtop">
						<tr>
							<td>
								<p>There is a lot of non-sky in the image like houses, trees, etc.
									These items can cause some detection modules
									to get confused so by masking them they will not
									be included in any of the calculations.</p>
							</td>
							<td width="33%"><a href="mask-stars-raw.png" title="Click to enlarge">
								<img allsky="true" loading="lazy" alt="Raw Mask Image"
									src="mask-stars-raw.png" /></a></td>
						</tr>
						<tr>
							<td>
								<p>This mask hides areas of the image that are not sky.</p>
								<blockquote>Since this mask is being used to
									mask specific areas of the image, if the camera is
									moved then the mask may have to be recreated.</blockquote>
							</td>
							<td><a href="mask-stars-mask.png" title="Click to enlarge">
								<img allsky="true" loading="lazy" alt="Mask"
									src="mask-stars-mask.png" /></a></td>
						</tr>
						<tr>
							<td>
								<p>After the mask has been applied the resulting image
									will allow the various modules to process the image
									more effectively.</p>
							</td>
							<td><a href="mask-stars-result.png" title="Click to enlarge">
								<img allsky="true" loading="lazy" alt="Masked Image"
									src="mask-stars-result.png" /></a></td>
						</tr>
					</table>


					<blockquote>
						Some modules will apply the mask but it will not be used
						for the final image.
						Examples of this are masks used to mask the image for
						star/meteor detection.</blockquote>
					<blockquote>
						Masks do not have to be circular, they can be any shape you like.
						In fact the masks used for star and meteor detection are
						very likely to be a strange shape.</blockquote>
				</details>
			</div>


			<h1>GPIO</h1>
			<div>
				<p>Several of the modules require the selection of a GPIO pin on the pi.
					The module editor has an inbuilt GPIO selector to help ease
					the process of selecting the required pin.</p>
				<details>
					<summary></summary>
					<table class="module-settings vtop">
						<tr>
							<td>
								<p>When clicking on the GPIO selection the GPIO selector
									is displayed allowing you to select the required pin.
									In this example GPIO27 is currently selected.</p>
								<blockquote>Currently only the PI 3/4/5 GPIO
									pins are implemented.</blockquote></td>
							<td><a href="gpio.png" title="Click to enlarge">
								<img allsky="true" loading="lazy" alt="GPIO Selector"
									src="gpio.png" /></a></td>
						</tr>
					</table>
				</details>
			</div>


			<h1>Module Performance / Debugging</h1>
			<div>
				<p>It's important that modules do not take too much time to run as this
					will cause load issues on the Pi.</p>
				<details>
					<summary></summary>
					<p>After Allsky has taken an image an initial copy is saved
						and processed in the background,
						including running the relevant module flow.
						It's important that this process finishes before the
						next image is saved.
						If the module flow takes too long multiple save image processes
						will be running, and will start to cause performance issues on the Pi.</p>
					<blockquote><strong>TIP</strong> - When installing a new module
						ensure debug mode is enabled in the
						<span class="managerName">Module Manager</span> Module Options
						 and monitor how long the new module is taking and what
						effect it's having on the overall flow time.</blockquote>
					<h2>The <span class="managerName">Module Manager</span> Debug Window</h2>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" alt="Module Debug Window"
								src="Module-Manager-Debug.png" /></td>
						</tr>
						<tr>
							<td>
								<p>The debug dialog box shows each of the enabled modules,
									how long they took to run,
									the result of the last run, and the total execution
									time for all modules.</p>
								<p>This information is useful if you find there are too
									many save image processes running or for determining
									if any particular module is causing an issue.</p>
							</td>
						</tr>
					</table>
					<h2>The Allsky debug log</h2>
					<p>The main Allsky debug log will contain information from
						the module processor.
						The amount of information logged depends upon the main Allsky
						<span class="WebUISetting">Debug Level</span> setting -
						when <span class="WebUIValue">0</span>
						only critical module errors are logged.
						Any other log level will display verbose information as shown below.</p>
					<blockquote>Periodic module output is logged to the
						<span class="fileName">allskyperiodic.log</span> file.
						This file will be in the same location as the main Allsky log file,
						typically <span class="fileName">/var/log</span>.</blockquote>
					<br><pre>
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Loading config...
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Loading recipe...
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_loadimage.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_loadimage
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Image
/home/alex/allsky/tmp/image-20221023210636.jpg Loaded
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_loadimage.py ran ok in 0.493601s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_pistatus.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_pistatus
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_pistatus.py ran ok in 0.041586s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_saveintermediateimage.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_saveintermediateimage
Oct 23 21:08:15 allsky allsky.sh[24948]: /home/alex/allsky/images/20221023-clean
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Image
/home/alex/allsky/images/20221023-clean/image-20221023210636.jpg Saved
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module
allsky_saveintermediateimage.py ran ok in 0.442361s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_clearsky.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_clearsky
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Created star template. Radius - 6
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Sky is NOT clear. 5 Stars found, clear limit is 40
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: MQTT disabled
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_clearsky.py ran ok in 0.677157s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_starcount.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_starcount
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Sky is not clear so ignoring starcount
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_starcount.py ran ok in 9.8e-05s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_meteor.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_meteor
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Sky is not clear so ignoring meteor detection
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_meteor.py ran ok in 6.8e-05sv
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_dewheater.py ---
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_dewheater
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Turning Heater on
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Temperature within limit temperature
11.13, limit 10, dewPoint 8.74
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Sensor SHT31 read. Temperature 11.13
Humidity 85.19 Dew Point 8.74 Heat Index -14.47
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_dewheater.py ran ok in 0.040973s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_maskimage.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_maskimage
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_maskimage.py ran ok in 0.516113s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_cloud.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_cloud
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Cloud state - Cloudy 100.0. Sky Temp
10.370000000000005, Ambient 10.450000000000045
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_cloud.py ran ok in 0.002392s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_export.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_export
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Allsky data exported to
/home/alex/allsky/tmp/allskydata.json
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Module allsky_export.py ran ok in 0.001127s
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_overlay.py --------
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Attempting to load allsky_overlay
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Config file set to
/home/alex/allsky/config/overlay.json
Oct 23 21:08:15 allsky allsky.sh[24948]: INFO: Loading Config took 0.00063 Seconds.
Elapsed Time 0.000662 Seconds.
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Adding Text Fields took 0.255803
Seconds. Elapsed Time 0.685933 Seconds.
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Adding Image Fields took 0.248668
Seconds. Elapsed Time 0.934638 Seconds.
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Saving Final Image took 0.006398
Seconds. Elapsed Time 0.941075 Seconds.
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Writing debug data took 4.5e-05
Seconds. Elapsed Time 0.941138 Seconds.
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Debug information written to
/home/alex/allsky/tmp/overlaydebug.txt
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Annotation Complete Elapsed Time 0.942793 Seconds.
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Module allsky_overlay.py ran ok in 0.951637s
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_savedetails.py --------
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Attempting to load allsky_savedetails
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Module allsky_savedetails.py ran ok in 0.128938s
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: -------- Running Module allsky_saveimage.py --------
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Attempting to load allsky_saveimage
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Image
/home/alex/allsky/tmp/image-20221023210636.jpg Saved, quality 100
Oct 23 21:08:16 allsky allsky.sh[24948]: INFO: Module allsky_saveimage.py ran ok in 0.388242s
</pre>
				</details>
			</div>


			<h1>Developing Custom Modules</h1>
			<div>
				<p>The module system is designed to be extended by developing custom modules.</p>
				<details>
					<summary></summary>
					<h2>Python Versions</h2>
					<p>Modules are developed in
						<a external="true" href="https://www.python.org/">Python</a>
						and should use the latest version available for the Pi.
						It should be noted that whilst multiple versions of
						Python can be installed on a Pi it's best
						just to use the version that ships with the OS.
						Generally that may mean reinstalling your Allsky installation to
						get the latest version of python.
						Running multiple versions of python is beyond the
						scope of this documentation.</p>

					<h2>Contributing a module</h2>
					<p>There is a central GitHub repository that you can contribute
						your modules to.
						You do not have to do this but over time we would like to
						build this into a comprehensive library of available modules.</p>
					<p>If you wish to contribute your module then please:
					<ul>
						<li>Create a fork of the <strong>User Modules</strong> repository from
							<a href="https://github.com/AllskyTeam/allsky-modules"
								external="true">
								https://github.com/AllskyTeam/allsky-modules</a>.</li>
						<li>Create a new branch in your forked repository,
							calling the branch the name of your module.</li>
						<li>Develop your module and commit it to the branch.</li>
						<li>Create a pull request into the allsky-modules
							repo from your branch.</li>
						<li>The module will be checked and if all is ok will
							be merged into the main repository.</li>
						<li>If you need to make changes to the module after it's
							been merged then refork the main repo,
							create a branch from the master branch named as your module,
							then commit a PR to main master.</li>
					</ul>
					</p>
					<p>The structure of a module is important so please use the
						following folder/file structure.</p>
					<p><span class="fileName">allsky_MODULENAME</span></p>
					<ul>
						<li><span class="fileName">allsky_MODULENAME.py</span> -
							The main modules code.</li>
						<li><span class="fileName">requirements.txt</span> -
							Any python packages required by the plugin,
							will be installed with <code>pip3</code>.
							If you don't need any additional packages don't include this file.</li>
						<li><span class="fileName">packages.txt</span> -
							Any aditional libraries required by the module,
							will be installed using <code>apt</code>.
							If you don't need any additional packages don't include this file.</li>
						<li><span class="fileName">README.md</span> -
							Markdown file with any special instructions required for the module.
							If there are none do not include this file.</li>
					</ul>
					<blockquote>When specifying python libraries DO NOT include numpy
						in ANY <span class="fileName">requirements.txt</span> file as
						changing the version could cause issues with Allsky.</blockquote>


					<h2>Anatomy Of A Module</h2>
					<p>A module consists of two key parts:</p>
					<ol>
						<li><strong>The metadata variable</strong>
							defines everything the
							<span class="managerName">Module Manager</span>
							needs to run the module.
							This includes basic information about the module
							and the configuration options it requires.</li>
						<li><strong>The module entry point</strong>
							is the main function that is called by the
							<span class="managerName">Module Manager</span>.</li>
					</ol>
					<p>Every module MUST import the <strong>allsky_shared</strong> module.
						This module is used to pass data from
						the flow processor to each module.</p>

					<h3>The Meta Data Variable</h3>
					<blockquote>Please refer to the Boiler Plate example module for
						more details on this variable.
						The Boiler Plate example includes all of the available options.</blockquote>

					<table class="vtop">
						<thead>
							<tr class="tableHeader">
								<th>Field</th>
								<th>Type</th>
								<th>Mandatory</th>
								<th>Description</th>
							</tr>
						</thead>
						<tr>
							<td>name</td>
							<td>String</td>
							<td>Yes</td>
							<td>The name of the module.
								This field is displayed as the heading for a module when
								it's displayed in the
								<span class="managerName">Module Manager</span>.</td>
						</tr>
						<tr>
							<td>description</td>
							<td>String</td>
							<td>Yes</td>
							<td>The description of the module.
								This field is displayed in the
								<span class="managerName">Module Manager</span>.</td>
						</tr>
						<tr>
							<td>module</td>
							<td>String</td>
							<td>Yes</td>
							<td>The module name.
								<strong>MUST</strong> be in the format
								<strong>allsky_{module name}</strong>
								i.e. allsky_boilerplate.</td>
						</tr>
						<tr>
							<td>version</td>
							<td>String</td>
							<td>No</td>
							<td>The version of the module.
								If this field is not present then the version of the
								main Allsky software will be used.</td>
						</tr>
						<tr>
							<td>enabled</td>
							<td>String</td>
							<td>No</td>
							<td>"true" or "false".
								If set to true the module is enabled, handy for setting its
								initial state.
								<strong>NOTE:</strong> If the option to auto enable modules is
								enabled in the
								<span class="managerName">Module Manager</span>
								then this will take priority over that value.</td>
						</tr>
						<tr>
							<td>events</td>
							<td>Dictionary</td>
							<td>Yes</td>
							<td>A list of the flows the module should be displayed in,
								one or more of:
								<p><ul class="minimalPadding">
									<li><strong>Daytime Capture</strong></li>
									<li><strong>Nighttime Capture</strong></li>
									<li><strong>Night to Day Transition</strong></li>
									<li><strong>Day to Night Transition</strong></li>
									<li><strong>Periodic jobs</strong></li>
								</ul></p>
							</td>
						</tr>
						<tr>
							<td>experimental</td>
							<td>String</td>
							<td>No</td>
							<td>"true" or "false".
								If set to true a warning is displayed in the
								<span class="managerName">Module Manager</span>
								indicating the module is experimental.</td>
						</tr>
						<tr>
							<td>arguments</td>
							<td>Dictionary</td>
							<td>No</td>
							<td>A list of the values that will be passed to the main
								processing method of the module in the params array.
								This exists to allow you to specify defaults for the fields.
								Definitions for the fields are defined in the
								argumentdetails field below.</td>
						</tr>
						<tr>
							<td>argumentdetails</td>
							<td>Dictionary</td>
							<td>No</td>
							<td>Dictionary of definitions for each of the arguments.</td>
						</tr>
						<tr>
							<td>businfo</td>
							<td>string</td>
							<td>No</td>
							<td>Set to i2c if the module uses the i2c bus.</td>
						</tr>
						<tr>
							<td>changelog</td>
							<td>Dictionary</td>
							<td>Yes</td>
							<td>Changelog information for the module, see below.</td>
						</tr>
					</table>

					<h4>The argumentdetails Dictionary</h4>
					<p>A module may require that the user can set values for its paramaters.
						This is implemented via the "arguments" and "argumentdetails" sections.
						If there are any argumentdetails present
						then a settings option will be displayed in the
						<span class="managerName">Module Manager</span>.
						Clicking on the setting's option displays a dialog
						allowing the module's settings to be changed.
						The dialog is created automatically from the options defined
						in the "argumentdetails" section.</p>
					<table class="vtop">
						<thead>
							<tr class="tableHeader">
								<th>Field</th>
								<th>Type</th>
								<th>Mandatory</th>
								<th>Description</th>
							</tr>
						</thead>
						<tr>
							<td>required</td>
							<td>String</td>
							<td>Yes</td>
							<td>"true" or "false".
								If set to true the field is required.
								<strong>NOTE:</strong>
								This will be implemented in a future release.</td>
						</tr>
						<tr>
							<td>description</td>
							<td>String</td>
							<td>Yes</td>
							<td>This is the label for the field in the module settings dialog.</td>
						</tr>
						<tr>
							<td>help</td>
							<td>String</td>
							<td>No</td>
							<td>This is the help text for the field in the
								module settings dialog.</td>
						</tr>
						<tr>
							<td>tab</td>
							<td>String</td>
							<td>No</td>
							<td>The tab to display the field in.
								If left blank the field will be displayed on the 'Home' tab.
								This is handy for grouping fields into seperate tabs.</td>
						</tr>
						<tr>
							<td>type</td>
							<td>Dictionary</td>
							<td>No</td>
							<td>A Dictionary defining the type of field.
								The key is the name of the field, the
								same name as used in the arguments section.
								If no type is defined the field is
								assumed to be a text field.</td>
						</tr>
					</table>

					<h4>Available field types</h4>
					<p>If blank the field is assumed to be a text entry field.</p>
					<table class="vtop">
						<thead>
							<tr class="tableHeader">
								<th>fieldtype</th>
								<th>Description</th>
								<th>Additional paramaters</th>
							</tr>
						</thead>
						<tr>
							<td>select</td>
							<td>A drop down list from which the user can select an option.</td>
							<td>
								<ul>
									<li><strong>values</strong> -
										A comma separated list of values for the drop down.
										The default value for the drop down list is specified in the
										arguments section.</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td>checkbox</td>
							<td>A checkbox allowing the entry of a true or false value.</td>
							<td>None</td>
						</tr>
						<tr>
							<td>spinner</td>
							<td>A numerical entry field with up and down controls
								to alter the value.</td>
							<td>
								<p><ul class="minimalPadding">
									<li><strong>min</strong> -
										The minimum value for the field.</li>
									<li><strong>max</strong> -
										The maximum value for the field.</li>
									<li><strong>step</strong> -
										The step for the field.</li>
								</ul></p>
							</td>
						</tr>
						<tr>
							<td>gpio</td>
							<td>Displays a dialog allowing the user to select a GPIO pin on the Pi.
								This field type is useful when developing a module that requries
								a user to select a GPIO pin.</td>
							<td>None</td>
						</tr>
						<tr>
							<td>image</td>
							<td>Displays a dialog allowing the user to select/upload an image.
								This is useful where a module may require the user
								to select a mask.</td>
							<td>None</td>
						</tr>
						<tr>
							<td>roi</td>
							<td>Displays a dialog allowing the user to select a
								Region Of Interest (ROI) from the captured image.</td>
							<td>None</td>
						</tr>
					</table>

					<h4>The changelog Dictionary</h4>
					<p>A simple example with a single change, one change for the revision:</p>
<pre>
"v1.0.0" : [
	{
		"author": "Alex Greenland",
		"authorurl": "https://github.com/allskyteam",
		"changes": "Initial Release"
	}
],
</pre>

					<p>A slightly more complex change, multiple changes for a single revision:</p>
<pre>
"v1.0.1" : [
	{
		"author": "Damian Grocholski (Mr-Groch)",
		"authorurl": "https://github.com/Mr-Groch",
		"changes": [
			"Added extra pin that is triggered with heater pin",
			"Fixed dhtxxdelay (was not implemented)",
			"Fixed max heater time (was not implemented)"
		]
	}
],
</pre>

					<p>A chnage with multiple authors,
						not the change can be an array as in the above example:</p>

<pre>
"v1.0.4" : [
	{
		"author": "Alex Greenland",
		"authorurl": "https://github.com/allskyteam",
		"changes": "Add AHTx0 i2c sensor"
	},
	{
		"author": "Andreas Schminder",
		"authorurl": "https://github.com/Adler6907",
		"changes": "Added Solo Cloudwatcher"
	}
],
</pre>
					<h4>Complete metadata example</h4>
					<p>This is a full example of all of the possible
						options available in the metaData dictionary.
						This example can be found in the boilerplate module
						in the additional modules repository on GitHub.</p>

					<table class="vtop">
						<tr>
							<td>
<pre>
metaData = {
    "name": "All Sky Boilerplate",
    "description": "Example module for AllSky",
    "module": "allsky_boilerplate",
    "version": "v1.0.0",
    "events": [
        "day",
        "night",
        "endofnight",
        "daynight",
        "nightday",
        "periodic"
    ],
    "experimental": "false",
    "arguments":{
        "textfield": "",
        "select": "value1",
        "checkbox": "",
        "number": "10",
        "gpio": "",
        "image": "",
        "roi": ""
    },
    "argumentdetails": {
        "textfield": {
            "required": "true",
            "description": "Text Field",
            "help": "Example help for the text field",
            "tab": "Field Types"
        },
        "select" : {
            "required": "false",
            "description": "Select Field",
            "help": "Example help for a select field",
            "tab": "Field Types",
            "type": {
                "fieldtype": "select",
                "values": "None,value1,value2,value3"
            }
        },
        "checkbox" : {
            "required": "false",
            "description": "Checkbox Field",
            "help": "Example help for the checkbox field",
            "tab": "Field Types",
            "type": {
                "fieldtype": "checkbox"
            }
        },
        "number" : {
            "required": "true",
            "description": "Number Field",
            "help": "Example help for the number field",
            "tab": "Field Types",
            "type": {
                "fieldtype": "spinner",
                "min": 0,
                "max": 1000,
                "step": 1
            }
        },
        "gpio": {
            "required": "true",
            "description": "GPIO Field",
            "help": "Example help for the GPIO field",
            "tab": "Field Types",
            "type": {
                "fieldtype": "gpio"
            }
        },
        "image" : {
            "required": "false",
            "description": "Image Field",
            "help": "Example help for the image field",
            "tab": "Field Types",
            "type": {
                "fieldtype": "image"
            }
        },
        "roi": {
            "required": "true",
            "description": "Region of Interest field",
            "help": "Help for the region of interest field",
            "tab": "Field Types",
            "type": {
                "fieldtype": "roi"
            }
        },
        "textfield1": {
            "required": "true",
            "description": "Text Field1",
            "help": "Example help for the text field in a new tab",
            "tab": "Another Tab"
        }
    },
    "enabled": "false",
    "changelog": {
        "v1.0.0" : [
            {
                "author": "Alex Greenland",
                "authorurl": "https://github.com/allskyteam",
                "changes": "Initial Release"
            }
        ],
        "v1.0.1" : [
            {
                "author": "Alex Greenland",
                "authorurl": "https://github.com/Mr-Groch",
                "changes": [
                    "Change 1",
                    "Change 2"
                ]
            }
        ],
        "v1.0.2" : [
            {
                "author": "Alex Greenland",
                "authorurl": "https://github.com/allskyteam",
                "changes": [
                    "Change 1",
                    "Change 2"
                ]
            },
            {
                "author": "Andreas Schminder",
                "authorurl": "https://github.com/Adler6907",
                "changes": "Change 1"
            }
        ]
    },
    "businfo": [
        "i2c"

    ],
    "changelog": {
        "v1.0.0" : [
            {
                "author": "Alex Greenland",
                "authorurl": "https://github.com/allskyteam",
                "changes": "Initial Release"
            }
        ],
        "v1.0.1" : [
            {
                "author": "Alex Greenland",
                "authorurl": "https://github.com/allskyteam",
                "changes": [
                    "Change 1",
                    "Change 2",
                    "Change 3"
                ]
            }
        ],
        "v1.0.2" : [
            {
                "author": "Alex Greenland",
                "authorurl": "https://github.com/allskyteam",
                "changes": "Change 1"
            },
            {
                "author": "John Doe",
                "authorurl": "https://github.com/allskyteam",
                "changes": [
                    "Change 1",
                    "Change 2",
                    "Change 3"
                ]
            }
        ]
    }
}
</pre>
							</td>
						</tr>
					</table>

					<h3>The Allsky Shared module</h3>
					<p>To improve the performance of modules a common shared module
						called <strong>allsky_shared</strong> is used.
						It contains both helper functions and data from the main capture process.
						The module exists so that each individual module does not
						have to perform tasks like loading an image.</p>

					<h4>Allsky Shared module data</h4>
					<table>
						<thead>
							<tr class="tableHeader">
								<th>Variable</th>
								<th>Description</th>
							</tr>
						</thead>
						<tr>
							<td>args</td>
							<td>The arguments passed to the module processor
								(not normally needed).</td>
						</tr>
						<tr>
							<td>LOGLEVEL</td>
							<td>The allsky debug level (not normally ndded).</td>
						</tr>
						<tr>
							<td>CURRENTIMAGEPATH</td>
							<td>The full path to the current image (not normally needed,
								not available in daynight, nightday or periodic).</td>
						</tr>
						<tr>
							<td>TOD</td>
							<td>The time of day not available in daynight,
								nightday or periodic).</td>
						</tr>
						<tr>
							<td>fullFilename</td>
							<td>The final image filename i.e. image.jpg not available in daynight,
								nightday or periodic).</td>
						</tr>
						<tr>
							<td>image</td>
							<td>a numpy array of the current image -
								use this for any processing of the captured image.
								<strong>DO NOT</strong>
								attempt to load the image from disk within a module as
								this will have a severe performance impact on the module.
								Not available in daynight, nightday or periodic).</td>
						</tr>
					</table>

					<h4>Allsky Shared module helpers</h4>
					<table class="vtop">
						<thead>
							<tr class="tableHeader">
								<th>Function</th>
								<th>Description</th>
							</tr>
						</thead>
						<tr>
							<td>log(level, message)</td>
							<td>Logs an entry to the allsky log file if the
								<span class="WebUISetting">Debug Level</span>
								is above "level".
								Errors are always logged.
								When a module needs to write to a log it should use this
								function rather than write to any log files directly.
								This function will ensure
								that the log message appears in the main Allsky log file.</td>
						</tr>
						<tr>
							<td>getEnvironmentVariable(name, fatal=False, error='')</td>
							<td>Gets an environment variable,
								can terminate if needed by setting the fatal
								variable and an error code.</td>
						</tr>
						<tr>
							<td>var_dump(variable)</td>
							<td>Pretty dump of a variable.
								This is handy for debugging modules.
								The output will appear in the main Allsky log file.</td>
						</tr>
						<tr>
							<td>getSetting(settingName)</td>
							<td>Gets a setting from the camera settings file.</td>
						</tr>
						<tr>
							<td>writeDebugImage(module, fileName, image)</td>
							<td>Writes a debug image to the
								<span class="fileName">${ALLSKY}/tmp/debug/{module}</span> folder.
								This can be useful when debugging a module to check the output
								at various stages.</td>
						</tr>
						<tr>
							<td>startModuleDebug(module)</td>
							<td>Creates the debug directories for a module.</td>
						</tr>
						<tr>
							<td>convertPath(path)</td>
							<td>Replaces Allsky variables in a string and is useful if a
								module enters a directory based upon any of the Allsky variables.
								For example,
								<span class="fileName">${ALLSKY_TMP}/allskydata.json</span>
								will have the ${ALLSKY_TMP} variable replaced with its real path.
								This function can be used to replace any of the Allsky variables
								in a string.</td>
						</tr>
						<tr>
							<td>checkAndCreatePath(filePath)</td>
							<td>Checks if the passed file exists and if not creates it.</td>
						</tr>
						<tr>
							<td>checkAndCreateDirectory(filePath)</td>
							<td>Checks if the passed directory exists and if not creates it.</td>
						</tr>
						<tr>
							<td>raining()</td>
							<td>Only available if the <span class="moduleName">Rain</span>
								module is being used -
								returns a boolean flags to indicate the rain state.</td>
						</tr>
						<tr>
							<td>convertLatLon(input)</td>
							<td>Converts 52.2N to 52.2 i.e, converts to decimal.</td>
						</tr>
						<tr>
							<td>setLastRun(module)</td>
							<td>Sets the last run time for a module.
								Useful for where a module only needs to run periodically.</td>
						</tr>
						<tr>
							<td>shouldRun(module, period)</td>
							<td>Determines if a module should run based on the period.</td>
						</tr>
						<tr>
							<td>dbAdd(key, value)</td>
							<td>Adds the key/value pair to the internal database.</td>
						</tr>
						<tr>
							<td>dbUpdate(key, value)</td>
							<td>Updates the key/value pair in the internal database.</td>
						</tr>
						<tr>
							<td>isFileWriteable(fileName)</td>
							<td>Determines if the file is writeable.</td>
						</tr>
						<tr>
							<td>isFileReadable(fileName)</td>
							<td>Determines if the file is readable.</td>
						</tr>
						<tr>
							<td>saveExtraData(fileName, extraData)</td>
							<td>Saves the extraData in fileName.</td>
						</tr>
						<tr>
							<td>deleteExtraData(fileName)</td>
							<td>Deletes the extra data fileName.</td>
						</tr>
						<tr>
							<td>getGPIOPin(pin)</td>
							<td>Returns the board.Pin from the passed in pin (int).</td>
						</tr>
						<tr>
							<td>createTempDir(path)</td>
							<td>Creates a temporary directory.</td>
						</tr>
						<tr>
							<td>cleanupModule(moduleData)</td>
							<td>Removes any files or environment variables for a module.</td>
						</tr>
					</table>
				</details>
			</div>



		</div><!-- Layout-main -->
	</div><!-- Layout ... -->
</body>

</html>
<script> includeHTML(); </script>
