<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="../documentation.js" type="application/javascript"></script>
	<link href="../css/light.css" rel="stylesheet">
	<link href="../css/documentation.css" rel="stylesheet">
	<link href="../documentation-favicon.ico" rel="shortcut icon" type="image/png">
	<title>Installing and upgrading Allsky</title>
</head>
<body>
<div class="d-flex flex-column flex-md-row gh-header">
	<h1 class="flex-auto min-width-0 mb-2 mb-md-0 mr-0 mr-md-2 gh-header-title" id="onPage">Installing and upgrading Allsky</h1>
</div>
<div class="xcontainer-xl px-3 px-md-4 px-lg-5 mt-4">
<div data-view-component="true" class="Layout Layout--flowRow-until-md Layout--sidebarPosition-end Layout--sidebarPosition-flowRow-end">
<div data-view-component="true" class="Layout-sidebar wiki-rightbar">
	<div w3-include-html="/documentation/sidebar.html" id="sidebar"></div>
</div>
<div data-view-component="true" class="Layout-main"><div class="markdown-body" id="mainContents">

<p>This page describes how to install and upgrade Allsky.
<br>
After Allsky is running and you've configured it to your satisfaction,
you may want to install the Allsky Website on the Pi or on a remote server.
See the <a allsky="true" href="AllskyWebsite.html">Allsky Website Installation</a> page for details.
</p>

<h2>Install AllSky in a different location (advanced)</h2>
<details><summary></summary>

<blockquote>
Only advanced users should consider installing Allsky in a different location.
All the documentation assumes it's installed in the default location,
so it may be more difficult to troubleshoot if it's elsewhere.
</blockquote>
<p>
By default, Allsky is installed as the login "pi" in <code>/home/pi/allsky</code>.
The name <b>allsky</b> should not be changed,
but you can install Allsky in a different sub-directory
(which usually means it'll run as a different login).
For example to install in <code>/home/mylogin</code> and run as the "mylogin" user,
do the following before installing Allsky:
<pre>
sudo mkdir /home/mylogin      <span class="pl-c"># if not already there</span>
sudo addgroup mylogin sudo    <span class="pl-c"># allows Allsky to execute system commands</span>
cd /home/mylogin
</pre>
After the above, continue with the steps below.
<hr class="separator">
</details>


<br><h2>Pre installation</h2>
<details><summary></summary>
<p>
If you have an <b>existing</b> version of Allsky,
perform one of the steps below, then continue to the <a href="#Installation">installation</a> section.
</p>
<ol class="minimalPadding">
	<li>Upgrade the old version.
	<pre>
sudo systemctl stop allsky   <span class="pl-c"># Stop the Allsky service</span>
cd
mv allsky allsky-OLD         <span class="pl-c"># The installation looks for this directory</span>
</pre>

	<li>Save the old version but don't use it.
	<br>
	<pre>
cd
mv allsky allsky-SAVED</pre>
	At some point you'll want to delete the SAVED version so it doesn't take disk space.

	<li>Delete the old version.  Only select this option if you're sure you don't want any saved
	images, darks, and configuration settings.
	If <code>allsky/tmp</code> is a memory-based filesystem you need to unmount it before
	it can be removed:
	<pre>
sudo umount ~/allsky/tmp</pre>
	Either way, execute:
	<pre>
sudo systemctl stop allsky     <span class="pl-c"># Stop the Allsky service</span>
cd
rm -fr allsky</pre>
</ol>
<hr class="separator">
</details>


<br><h2 id="Installation">Installation</h2>
<details><summary></summary>
<p>
The following commands will put the new release of Allsky in <code>~/allsky</code>.
Except for some system files, all Allsky-related files reside in this directory.
If you later install the Allsky Website on the Pi, its files will also go in this directory.
</p>

<pre>
cd
git clone --recursive https://github.com/thomasjacquin/allsky.git
cd allsky
./install.sh</pre>

<p>
The installation prompts for several items that allow it to configure the Pi so
Allsky runs most efficiently given your Pi's configuration.
These prompts include:
<ul>
	<li>New host name, if not the default of <b>allsky</b>.
		If you have more than one Pi on the same network they must all have unique names.
		For example, if you have a test Pi you may want to call it <code>allsky-test</code>.
	<li>Adding swap space if needed.
		Swap space effectively increases the amount of memory your Pi has.
		Insufficient swap space is one of the leading causes of timelapse video creations problems.
	<li>Putting the <code>~/allsky/tmp</code> directory in memory instead of on the disk.
		This directory holds temporary Allsky files and is where most Allsky files are written to.
		Putting the directory in memory <b>significantly</b> reduces the number of writes
		to the SD card, which increases its life.
</ul>
It's highly recommended to accept the defaults.
</p>
<p>
During installation you'll be notified of any actions you need
to take when the installation completes.
If there are any such actions, the first time Allsky runs after the reboot it will stop and:
<ul>
	<li>add those actions to the log file
	<li>display an image telling you to see the log file
	<li>display a message in the WebUI (which you should clear when done performing the actions)
</ul>
</p>
<hr class="separator">
</details>


<br><h2>Post installation</h2>
<details><summary></summary>
<p>
After installation, perform any actions the installation script identified, then reboot.
</p>
<blockquote>
If instructed to copy the contents of a prior configuration file to the new release,
it's important to manually copy the <b>values</b>
from the old file to the new file and <b>not</b> copy the entire file.
</blockquote>

After the reboot, enter the WebUI and configure the
<a allsky="true" href="/documentation/settings/allsky.html">Allsky settings</a>.

<blockquote>
The <code>config.sh</code> and <code>ftp-settings.sh</code> configuration files should
<b>only</b> be edited via the
WebUI's <b>Editor</b> link since it performs sanity checks and behind-the-scenes
actions during updates.
</blockquote>
</details>


</div><!-- markdown-body --></div><!-- Layout-main ... -->
</div><!-- Layout -->
</div><!-- xcontainer-x1 ... -->
</body>
</html>
<script> includeHTML(); </script>
