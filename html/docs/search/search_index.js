var __index = {"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"Home","text":"<p>Allsky transforms a camera into a tireless, intelligent observer of the night sky \u2014 an automated system that watches, records, and analyses everything that happens above you.</p> <p>Using a high-sensitivity camera, powerful Raspberry Pi-based software, and modular extensions, Allsky captures meteors, satellites, aurora, and passing cloud, 24 hours a day. Each frame is processed in real time to reveal events invisible to the naked eye \u2014 and every night becomes its own story told through data, images, and motion.</p> <p>But Allsky is more than just a camera \u2014 it\u2019s an ecosystem. The web-based interface lets you monitor your system live, review captured events, design custom overlays, visualise sensor data, and automate your setup with a flexible module system. From temperature and dew heater control to star detection and meteor analytics, every feature works together in a single, polished dashboard.</p> <p>Built by enthusiasts for enthusiasts, Allsky is open, extensible, and endlessly curious \u2014 a fusion of astrophotography, automation, and discovery.</p> <p>Allsky Developers</p> <p>The Allsky Camera software was originally created by Thomas Jacquin, a developer and astrophotography  enthusiast based in Canada.</p> <p>Thomas released the first version of Allsky around 2018, designed to run on a Raspberry Pi with a ZWO ASI or Raspberry Pi HQ camera to capture images of the entire sky \u2014 automatically creating timelapses, keograms, and detecting meteors.</p> <p>Since then, the project has grown into a large open-source community effort on GitHub under the Allsky Team\ufffc organisation, with contributions from many developers and users:</p> <p>Thomas continues to be recognised as the founder and original author, while the Allsky Team now maintains and evolves the software collaboratively.</p> <p>The current maintainers are - Eric Claeys - @EricClaeys - Alex Greenland - @Alex-developer </p> <p>There are several sections to the documentation</p> <ul> <li>Allsky Guide Information for installing, configuring, and running the Allsky software, including describing what various features like overlays and keograms are, and how to troubleshoot and fix problems.</li> <li>Overlays Information on how the overlay system works and how to configure it</li> <li>Modules Details all of the modules both core and extra available for Allsky</li> <li>Developer Guide Information for developers on howto extend Allsky by creating custom modules</li> <li>SDK Reference Information for developers on the available libraries within Allsky</li> </ul>"},{"location":"index.html#installing-allsky","title":"Installing Allsky","text":"<p>To install Allsky please refer the the Installation Guide.</p>"},{"location":"index.html#getting-help","title":"Getting Help","text":"<p>If you have a QUESTION or want to REQUEST A NEW FEATURE create a new Discussions on the GitHub page. </p> <p>Discussions vs Issues</p> <p>Please do NOT create an Issue in Github, these are reserved for the Allsky development team. YOur discussion may be converted to an issue by the team if required</p> <p>If you have a problem first look in the \"Allsky Guide -&gt; Troubleshooting\" pages for a solution - most known problems are listed there. If you can't find a similar problem look in the Discussions (it may be a closed discussion). If you still can't find your problem, read the Reporting Problems page and then create a new Issue.</p>"},{"location":"index.html#contributing","title":"Contributing","text":"<p>If you would like to contribute code to Allsky then please see the Contributing Guide</p> <p>Thanks - the Allsky Team</p>"},{"location":"allsky_api.html","title":"Allsky Server API","text":""},{"location":"allsky_api.html#allsky-server-api","title":"Allsky Server API","text":"<p>The Allsky Server is a separate process that runs alongside Allsky its primary job is to handle longer running processes and to manage GPIO Coontrol. Its core functions are</p> <ul> <li>The Allsky dashboard whcich displays information about Allsky - currently under development</li> <li>The Allsky focuser which allows a camera with a focus motor to be focused - currently under development</li> <li>The Pi's GPIO pins, both digital and PWM</li> </ul>"},{"location":"allsky_api.html#authentication","title":"Authentication","text":"<p>The API requires authentication under the following circumstances</p> <ul> <li>You are unsing the inbuilt Dashboard, in this case the authentication will be via a login screen using the same login and password as Allaky</li> <li>You are using the api from an external machine. In this case you will need to request a JWT token from the API</li> </ul> <p>If you are using the API from the local machine then no authentication is required for any API</p>"},{"location":"allsky_api.html#requesting-a-jwt-token","title":"Requesting a JWT token","text":"<p>To get a JWT token use the following API endpoint</p> <p>POST /login</p> <p>This expects a username and password and returns a JWT token</p> <p>TODO: Add Hoppscotch examples TODO: Creating users</p>"},{"location":"allsky_api.html#the-available-apis","title":"The Available API's","text":""},{"location":"allsky_api.html#modules.allsky","title":"<code>allsky</code>","text":""},{"location":"allsky_api.html#modules.allsky.allsky_status","title":"<code>allsky_status()</code>","text":"<p>GET /allsky/status</p> <p>Retrieve the current Allsky system status.</p> <p>This endpoint queries backend logic (get_allsky_status) and returns a full status dictionary, plus a rendered HTML fragment used by the web frontend.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"read\")</code></p> <p>Returns:</p> Name Type Description <code>dict</code> <p>A JSON object containing: - All fields provided by <code>get_allsky_status()</code> - <code>status_html</code>: Rendered HTML snippet for UI display</p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/status', methods=['GET'])\n@api_auth_required(\"allsky\", \"read\")\ndef allsky_status():\n    \"\"\"\n    GET /allsky/status\n\n    Retrieve the current Allsky system status.\n\n    This endpoint queries backend logic (get_allsky_status) and returns a full\n    status dictionary, plus a rendered HTML fragment used by the web frontend.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"read\")``\n\n    Returns:\n        dict: A JSON object containing:\n            - All fields provided by ``get_allsky_status()``\n            - ``status_html``: Rendered HTML snippet for UI display\n    \"\"\"\n    status = get_allsky_status()\n    status_html = render_template(\"_partials/_allskyStatus.html\", status=status)\n    status['status_html'] = status_html\n    return status\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.restart_allsky","title":"<code>restart_allsky()</code>","text":"<p>GET /allsky/restart</p> <p>Restart the Allsky service.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky started\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/restart', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef restart_allsky():\n    \"\"\"\n    GET /allsky/restart\n\n    Restart the Allsky service.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky started\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'restart', 'allsky'])\n    return jsonify({'status': 'Allsky started'})\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.start_allsky","title":"<code>start_allsky()</code>","text":"<p>GET /allsky/start</p> <p>Start the Allsky service.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky started\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/start', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef start_allsky():\n    \"\"\"\n    GET /allsky/start\n\n    Start the Allsky service.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky started\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'start', 'allsky'])\n    return jsonify({'status': 'Allsky started'})\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.stop_allsky","title":"<code>stop_allsky()</code>","text":"<p>GET /allsky/stopallsky</p> <p>Stop the Allsky service and immediately start the AllskyServer service.</p> <p>This is commonly used during debugging or maintenance when the capture component needs to be restarted but the web interface should remain active.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky stopped\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/stopallsky', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef stop_allsky():\n    \"\"\"\n    GET /allsky/stopallsky\n\n    Stop the Allsky service and immediately start the AllskyServer service.\n\n    This is commonly used during debugging or maintenance when the capture\n    component needs to be restarted but the web interface should remain active.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky stopped\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'stop', 'allsky'])\n    subprocess.run(['sudo', 'systemctl', 'start', 'allskyserver'])\n    return jsonify({'status': 'Allsky stopped'})\n</code></pre>"},{"location":"allsky_api.html#modules.allsky.stop_allsky_all","title":"<code>stop_allsky_all()</code>","text":"<p>GET /allsky/stopall</p> <p>Stop the Allsky service.</p> <p>This fully stops the \"allsky\" systemd service.</p> Authentication <p>Requires: <code>api_auth_required(\"allsky\", \"update\")</code></p> <p>Returns:</p> Name Type Description <code>JSON</code> <p><code>{\"status\": \"Allsky stopped\"}</code></p> Source code in <code>server/modules/allsky/__init__.py</code> <pre><code>@allsky_bp.route('/stopall', methods=['GET'])\n@api_auth_required(\"allsky\", \"update\")\ndef stop_allsky_all():\n    \"\"\"\n    GET /allsky/stopall\n\n    Stop the Allsky service.\n\n    This fully stops the \"allsky\" systemd service.\n\n    Authentication:\n        Requires: ``api_auth_required(\"allsky\", \"update\")``\n\n    Returns:\n        JSON: ``{\"status\": \"Allsky stopped\"}``\n    \"\"\"\n    subprocess.run(['sudo', 'systemctl', 'stop', 'allsky'])\n    return jsonify({'status': 'Allsky stopped'})\n</code></pre>"},{"location":"allsky_api.html#modules.gpio","title":"<code>gpio</code>","text":""},{"location":"allsky_api.html#modules.gpio.all_gpio_status","title":"<code>all_gpio_status()</code>","text":"<p>GET /gpio/all</p> <p>Return the status of every board GPIO pin.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>A dictionary of all pins (D0, D1, D2...) with details on   whether they are unused, digital I/O, or PWM.</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/all\", methods=[\"GET\"])\n@api_auth_required(\"gpio\", \"update\")\ndef all_gpio_status() -&gt; Response:\n    \"\"\"\n    GET /gpio/all\n\n    Return the status of every board GPIO pin.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: A dictionary of all pins (D0, D1, D2...) with details on\n              whether they are unused, digital I/O, or PWM.\n    \"\"\"\n    try:\n        with gpio_lock:\n            all_status = get_gpio_status()\n\n        return jsonify(all_status)\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to retrieve all GPIO status\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.get_board_pin","title":"<code>get_board_pin(gpio_str)</code>","text":"<p>Convert a GPIO pin number into a board-specific pin object.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_str</code> <code>str | int</code> <p>Pin number, e.g. \"18\".</p> required <p>Returns:</p> Type Description <p>object | None: board.Dxx pin object, or None if invalid.</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>def get_board_pin(gpio_str):\n    \"\"\"\n    Convert a GPIO pin number into a board-specific pin object.\n\n    Args:\n        gpio_str (str | int): Pin number, e.g. \"18\".\n\n    Returns:\n        object | None: board.Dxx pin object, or None if invalid.\n    \"\"\"\n    try:\n        return getattr(board, f\"D{int(gpio_str)}\")\n    except (AttributeError, ValueError):\n        return None\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.get_gpio_status","title":"<code>get_gpio_status()</code>","text":"<p>Inspect all available board pins and return their current usage.</p> This includes <ul> <li>Unused pins</li> <li>Digital pins (input/output, on/off)</li> <li>PWM pins (frequency, duty cycle)</li> </ul> <p>Returns:</p> Name Type Description <code>dict</code> <code>dict</code> <p>Status for each Dxx pin on the board.</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>def get_gpio_status() -&gt; dict:\n    \"\"\"\n    Inspect all available board pins and return their current usage.\n\n    This includes:\n      - Unused pins\n      - Digital pins (input/output, on/off)\n      - PWM pins (frequency, duty cycle)\n\n    Returns:\n        dict: Status for each Dxx pin on the board.\n    \"\"\"\n    all_status = {}\n    for attr in dir(board):\n        if not attr.startswith(\"D\"):\n            continue\n\n        hr_pin = attr        # e.g. \"D18\"\n        pin_num = hr_pin[1:] # e.g. \"18\"\n        board_pin = getattr(board, attr)\n\n        status = {\"mode\": \"unused\"}\n\n        if pin_num in digital_pins:\n            dio = digital_pins[pin_num]\n            direction = (\n                \"output\" if dio.direction == digitalio.Direction.OUTPUT else \"input\"\n            )\n            status[\"mode\"] = f\"digital-{direction}\"\n            status[\"value\"] = \"on\" if dio.value else \"off\"\n\n        elif pin_num in pwm_pins:\n            pwm = pwm_pins[pin_num]\n            status[\"mode\"] = \"pwm\"\n            status[\"frequency\"] = pwm.frequency\n            status[\"duty\"] = pwm.duty_cycle\n\n        all_status[hr_pin] = status\n\n    return all_status\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.read_digital","title":"<code>read_digital(pin)</code>","text":"<p>GET /gpio/digital/</p> <p>Read a digital GPIO pin.</p> <p>If the pin has not previously been configured, the API automatically initialises it as a digital input.</p> <p>Parameters:</p> Name Type Description Default <code>pin</code> <code>str</code> <p>Pin number, e.g. \"18\".</p> required Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"pin\": \"\", \"value\": \"on\" | \"off\" }</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/digital/&lt;pin&gt;\", methods=[\"GET\"])\n@api_auth_required(\"gpio\", \"update\")\ndef read_digital(pin) -&gt; Response:\n    \"\"\"\n    GET /gpio/digital/&lt;pin&gt;\n\n    Read a digital GPIO pin.\n\n    If the pin has not previously been configured, the API automatically\n    initialises it as a digital input.\n\n    Args:\n        pin (str): Pin number, e.g. \"18\".\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: { \"pin\": \"&lt;number&gt;\", \"value\": \"on\" | \"off\" }\n    \"\"\"\n    pin = str(pin).strip()\n    board_pin = get_board_pin(pin)\n\n    if board_pin is None:\n        return jsonify({\"error\": f\"Invalid GPIO pin {pin}\"}), 400\n\n    try:\n        with gpio_lock:\n            if pin in digital_pins:\n                digital_io = digital_pins[pin]\n            else:\n                digital_io = digitalio.DigitalInOut(board_pin)\n                digital_io.direction = digitalio.Direction.INPUT\n                digital_pins[pin] = digital_io\n\n            value = digital_io.value\n\n        return jsonify({\"pin\": pin, \"value\": \"on\" if value else \"off\"})\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to read digital pin\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.set_digital","title":"<code>set_digital()</code>","text":"<p>POST /gpio/digital</p> <p>Set a digital GPIO pin ON or OFF.</p> JSON Body <p>pin   (str/int): GPIO pin number. state (str):     \"on\" or \"off\". Defaults to \"off\".</p> Behaviour <p>\u2022 If the pin is currently configured for PWM, PWM is deinitialised. \u2022 Pin is configured as a digital output if not already.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"pin\": , \"state\": \"on\" | \"off\" }</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/digital\", methods=[\"POST\"])\n@api_auth_required(\"gpio\", \"update\")\ndef set_digital() -&gt; Response:\n    \"\"\"\n    POST /gpio/digital\n\n    Set a digital GPIO pin ON or OFF.\n\n    JSON Body:\n        pin   (str/int): GPIO pin number.\n        state (str):     \"on\" or \"off\". Defaults to \"off\".\n\n    Behaviour:\n        \u2022 If the pin is currently configured for PWM, PWM is deinitialised.\n        \u2022 Pin is configured as a digital output if not already.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: { \"pin\": &lt;pin&gt;, \"state\": \"on\" | \"off\" }\n    \"\"\"\n    try:\n        pin = str(request.json.get(\"pin\")).strip()\n        state = str(request.json.get(\"state\", \"off\")).lower()\n\n        board_pin = get_board_pin(pin)\n        if board_pin is None:\n            return jsonify({\"error\": f\"Invalid GPIO pin {pin}\"}), 400\n\n        with gpio_lock:\n            if pin in pwm_pins:\n                pwm_pins[pin].deinit()\n                del pwm_pins[pin]\n\n            if pin not in digital_pins:\n                digital_io = digitalio.DigitalInOut(board_pin)\n                digital_io.direction = digitalio.Direction.OUTPUT\n                digital_pins[pin] = digital_io\n\n            digital_pins[pin].value = state == \"on\"\n\n        return jsonify({\"pin\": pin, \"state\": \"on\" if digital_pins[pin].value else \"off\"})\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to set digital pin\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.set_pwm","title":"<code>set_pwm()</code>","text":"<p>POST /gpio/pwm</p> <p>Configure or update PWM on a GPIO pin.</p> JSON Body <p>pin        (str/int): GPIO number. frequency  (int):     PWM frequency in Hz. Defaults to 1000. duty       (int):     Duty cycle 0\u201365535. Defaults to 0.</p> Behaviour <p>\u2022 If the pin was digital, digital mode is removed. \u2022 Creates PWMOut if necessary, otherwise updates existing PWMOut.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"pin\": , \"frequency\": , \"duty\": , \"duty_percent\": &lt;0-100&gt;,</p> <code>Response</code> <p>}</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/pwm\", methods=[\"POST\"])\n@api_auth_required(\"gpio\", \"update\")\ndef set_pwm() -&gt; Response:\n    \"\"\"\n    POST /gpio/pwm\n\n    Configure or update PWM on a GPIO pin.\n\n    JSON Body:\n        pin        (str/int): GPIO number.\n        frequency  (int):     PWM frequency in Hz. Defaults to 1000.\n        duty       (int):     Duty cycle 0\u201365535. Defaults to 0.\n\n    Behaviour:\n        \u2022 If the pin was digital, digital mode is removed.\n        \u2022 Creates PWMOut if necessary, otherwise updates existing PWMOut.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: {\n            \"pin\": &lt;pin&gt;,\n            \"frequency\": &lt;hz&gt;,\n            \"duty\": &lt;value&gt;,\n            \"duty_percent\": &lt;0-100&gt;,\n        }\n    \"\"\"\n    try:\n        pin = str(request.json.get(\"pin\")).strip()\n        frequency = int(request.json.get(\"frequency\", 1000))\n        duty = int(request.json.get(\"duty\", 0))\n\n        if not (0 &lt;= duty &lt;= 65535):\n            return jsonify({\"error\": \"Duty must be between 0 and 65535\"}), 400\n\n        board_pin = get_board_pin(pin)\n        if board_pin is None:\n            return jsonify({\"error\": f\"Invalid GPIO pin {pin}\"}), 400\n\n        with gpio_lock:\n            if pin in digital_pins:\n                digital_pins[pin].deinit()\n                del digital_pins[pin]\n\n            if pin not in pwm_pins:\n                pwm = pwmio.PWMOut(board_pin, frequency=frequency, duty_cycle=duty)\n                pwm_pins[pin] = pwm\n            else:\n                pwm = pwm_pins[pin]\n                pwm.frequency = frequency\n                pwm.duty_cycle = duty\n\n        return jsonify({\n            \"pin\": pin,\n            \"frequency\": frequency,\n            \"duty\": duty,\n            \"duty_percent\": round((duty / 65535) * 100, 2),\n        })\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to set PWM\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_api.html#modules.gpio.status","title":"<code>status()</code>","text":"<p>GET /gpio/status</p> <p>Return a compact summary of active digital and PWM pins.</p> <p>Unlike <code>/gpio/all</code>, this endpoint only reports pins currently in use.</p> Authentication <p>Requires @api_auth_required(\"gpio\", \"update\")</p> <p>Returns:</p> Name Type Description <code>JSON</code> <code>Response</code> <p>{ \"digital\": { pin: \"on\" | \"off\" }, \"pwm\": { pin: { frequency, duty } }</p> <code>Response</code> <p>}</p> Source code in <code>server/modules/gpio/__init__.py</code> <pre><code>@gpio_bp.route(\"/status\", methods=[\"GET\"])\n@api_auth_required(\"gpio\", \"update\")\ndef status() -&gt; Response:\n    \"\"\"\n    GET /gpio/status\n\n    Return a compact summary of active digital and PWM pins.\n\n    Unlike `/gpio/all`, this endpoint only reports pins currently in use.\n\n    Authentication:\n        Requires @api_auth_required(\"gpio\", \"update\")\n\n    Returns:\n        JSON: {\n            \"digital\": { pin: \"on\" | \"off\" },\n            \"pwm\": { pin: { frequency, duty } }\n        }\n    \"\"\"\n    try:\n        with gpio_lock:\n            digital_status = {\n                pin: \"on\" if dio.value else \"off\"\n                for pin, dio in digital_pins.items()\n            }\n            pwm_status = {\n                pin: {\"frequency\": pwm.frequency, \"duty\": pwm.duty_cycle}\n                for pin, pwm in pwm_pins.items()\n            }\n\n        return jsonify({\"digital\": digital_status, \"pwm\": pwm_status})\n\n    except Exception as e:\n        return (\n            jsonify({\n                \"error\": \"Failed to retrieve status\",\n                \"type\": type(e).__name__,\n                \"message\": str(e),\n            }),\n            500,\n        )\n</code></pre>"},{"location":"allsky_base.html","title":"Base Class","text":""},{"location":"allsky_base.html#scripts.modules.allsky_base","title":"<code>allsky_base</code>","text":""},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE","title":"<code>ALLSKYMODULEBASE(params, event)</code>","text":"<p>Base class for Allsky processing modules.</p> <p>This class provides a common interface and helper methods that Allsky modules can inherit from. It handles:</p> <ul> <li>Storing the raw <code>params</code> dictionary passed in from the flow.</li> <li>Storing the <code>event</code> that triggered the module (e.g. postcapture, periodic).</li> <li>A simple debug mode that prints directly to stdout instead of using the   shared logger.</li> <li>Unified parameter retrieval via :meth:<code>get_param</code>, including support for   \"secret\" parameters stored in <code>env.json</code> (rather than in plain text   module configuration).</li> <li>A small compatibility layer around the historical <code>metaData</code> global,   via the <code>meta_data</code> instance attribute.</li> </ul> <p>Initialize the module base with parameters and the triggering event.</p> <p>Parameters:</p> Name Type Description Default <code>params</code> <code>dict</code> <p>Dictionary of parameters passed to the module from the flow configuration. Typically this comes from the JSON module config.</p> required <code>event</code> <code>str</code> <p>Name of the event that triggered this module (for example, <code>\"postcapture\"</code>, <code>\"daynight\"</code>, <code>\"periodic\"</code> etc.).</p> required Side Effects <ul> <li>Sets <code>self.params</code> and <code>self.event</code> from the arguments.</li> <li>Sets <code>self.debugmode</code> / <code>self.debug_mode</code> based on the   <code>ALLSKYTESTMODE</code> parameter. When True, messages are printed   directly rather than sent to the Allsky logger.</li> <li>Provides a compatibility bridge from the legacy global   <code>metaData</code> to the instance attribute <code>meta_data</code> if the   latter has not been set on the subclass.</li> </ul> Notes <p>Subclasses are expected to define a <code>meta_data</code> attribute that describes the module (arguments, defaults, secrets etc.). If that is not present, this initializer will attempt to fall back to an older global variable named <code>metaData</code> if it exists.</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def __init__(self, params, event):\n\t\"\"\"\n\tInitialize the module base with parameters and the triggering event.\n\n\tArgs:\n\t\tparams (dict):\n\t\t\tDictionary of parameters passed to the module from the flow\n\t\t\tconfiguration. Typically this comes from the JSON module config.\n\t\tevent (str):\n\t\t\tName of the event that triggered this module (for example,\n\t\t\t``\"postcapture\"``, ``\"daynight\"``, ``\"periodic\"`` etc.).\n\n\tSide Effects:\n\t\t- Sets ``self.params`` and ``self.event`` from the arguments.\n\t\t- Sets ``self.debugmode`` / ``self.debug_mode`` based on the\n\t\t  ``ALLSKYTESTMODE`` parameter. When True, messages are printed\n\t\t  directly rather than sent to the Allsky logger.\n\t\t- Provides a compatibility bridge from the legacy global\n\t\t  ``metaData`` to the instance attribute ``meta_data`` if the\n\t\t  latter has not been set on the subclass.\n\n\tNotes:\n\t\tSubclasses are expected to define a ``meta_data`` attribute that\n\t\tdescribes the module (arguments, defaults, secrets etc.). If that\n\t\tis not present, this initializer will attempt to fall back to an\n\t\tolder global variable named ``metaData`` if it exists.\n\t\"\"\"\n\tself.params = params\n\tself.event = event\n\tself.debugmode = self.get_param('ALLSKYTESTMODE', False, bool)\n\tself.debug_mode = self.debugmode\n\n\t'''\n\tOriginally metaData was a global variable but has since been replaced by meta_data as \n\ta class variable. This code will set hte class variable if its not been defined from\n\tthe global variable if it is defined.\n\t'''\n\tif not hasattr(self, 'meta_data'):\n\t\tif 'metaData' in globals():\n\t\t\tself.meta_data = globals('metaData')\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.debug_mode","title":"<code>debug_mode = self.debugmode</code>  <code>instance-attribute</code>","text":"<p>Originally metaData was a global variable but has since been replaced by meta_data as  a class variable. This code will set hte class variable if its not been defined from the global variable if it is defined.</p>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.debug_log","title":"<code>debug_log(message)</code>","text":"<p>Write a debug message only when debug mode is enabled.</p> <p>This helper is intended for very chatty or development-only messages that should never reach the normal Allsky logging system. It simply prints the message to stdout if <code>self.debug_mode</code> is True.</p> <p>Parameters:</p> Name Type Description Default <code>message</code> <code>str</code> <p>Message to print when debug mode is active.</p> required <p>Returns:</p> Type Description <p>None</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def debug_log(self, message):\n\t\"\"\"\n\tWrite a debug message only when debug mode is enabled.\n\n\tThis helper is intended for very chatty or development-only messages\n\tthat should never reach the normal Allsky logging system. It simply\n\tprints the message to stdout if ``self.debug_mode`` is True.\n\n\tArgs:\n\t\tmessage (str):\n\t\t\tMessage to print when debug mode is active.\n\n\tReturns:\n\t\tNone\n\t\"\"\"\n\tif self.debug_mode:\n\t\tprint(message)\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.get_database_config","title":"<code>get_database_config()</code>","text":"<p>Return the resolved database configuration for the current Allsky setup.</p> <p>This is a convenience wrapper around :func:<code>allsky_shared.get_database_config</code>, which merges secrets from <code>env.json</code> with settings from the Allsky configuration file.</p> <p>Returns:</p> Name Type Description <code>dict</code> <p>A dictionary containing at least:</p> <ul> <li><code>databasehost</code> (str)</li> <li><code>databaseuser</code> (str)</li> <li><code>databasepassword</code> (str)</li> <li><code>databasedatabase</code> (str)</li> <li><code>databasetype</code> (str) - e.g. <code>\"mysql\"</code> or <code>\"sqlite\"</code></li> <li><code>databaseenabled</code> (bool or truthy value)</li> </ul> Notes <p>This method does not open any connections itself; it only reads configuration that can be passed on to the database manager.</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def get_database_config(self):\n\t\"\"\"\n\tReturn the resolved database configuration for the current Allsky setup.\n\n\tThis is a convenience wrapper around\n\t:func:`allsky_shared.get_database_config`, which merges secrets from\n\t``env.json`` with settings from the Allsky configuration file.\n\n\tReturns:\n\t\tdict:\n\t\t\tA dictionary containing at least:\n\n\t\t\t- ``databasehost`` (str)\n\t\t\t- ``databaseuser`` (str)\n\t\t\t- ``databasepassword`` (str)\n\t\t\t- ``databasedatabase`` (str)\n\t\t\t- ``databasetype`` (str) - e.g. ``\"mysql\"`` or ``\"sqlite\"``\n\t\t\t- ``databaseenabled`` (bool or truthy value)\n\n\tNotes:\n\t\tThis method does not open any connections itself; it only reads\n\t\tconfiguration that can be passed on to the database manager.\n\t\"\"\"\n\tdatabase_config = allsky_shared.get_database_config()\n\n\treturn database_config\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.get_param","title":"<code>get_param(param, default, target_type=str, use_default_if_blank=False)</code>","text":"<p>Retrieve a module parameter with optional type conversion and secret handling.</p> <p>This method is the preferred way for modules to read configuration values. It looks up the parameter in <code>self.params</code>, optionally overrides it from <code>env.json</code> if the parameter is marked as a secret, and then attempts to cast it to the requested type.</p> <p>Parameters:</p> Name Type Description Default <code>param</code> <code>str</code> <p>The parameter name to look up.</p> required <code>default</code> <code>Any</code> <p>Default value to return if the parameter is missing or cannot be cast to <code>target_type</code>.</p> required <code>target_type</code> <code>type</code> <p>Type to cast the parameter value to (for example <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>). Defaults to <code>str</code>.</p> <code>str</code> <code>use_default_if_blank</code> <code>bool</code> <p>If True and the target type is <code>str</code>, an empty string will be treated as \"no value\" and the default will be returned instead. Defaults to False.</p> <code>False</code> Secret handling <p>If the module defines <code>self.meta_data</code> and it contains an <code>\"argumentdetails\"</code> section, any parameter marked with <code>\"secret\": true</code> will be read from Allsky's <code>env.json</code> using the key <code>&lt;MODULE&gt;_&lt;PARAM&gt;</code> (both upper-cased). If the key is not found in the env file, an error is logged via <code>allsky_shared.log</code>.</p> <p>Returns:</p> Name Type Description <code>Any</code> <p>The parameter value converted to <code>target_type</code> if possible, or the supplied <code>default</code> if the lookup fails, casting fails, or the value is considered blank and <code>use_default_if_blank</code> is True.</p> Notes <ul> <li>No exception is raised if casting fails; the default is silently   used instead.</li> <li>This helper is designed to be resilient and safe to call from   within modules without needing try/except at every call site.</li> </ul> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def get_param(self, param, default, target_type=str, use_default_if_blank=False):\n\t\"\"\"\n\tRetrieve a module parameter with optional type conversion and secret handling.\n\n\tThis method is the preferred way for modules to read configuration\n\tvalues. It looks up the parameter in ``self.params``, optionally\n\toverrides it from ``env.json`` if the parameter is marked as a secret,\n\tand then attempts to cast it to the requested type.\n\n\tArgs:\n\t\tparam (str):\n\t\t\tThe parameter name to look up.\n\t\tdefault (Any):\n\t\t\tDefault value to return if the parameter is missing or cannot\n\t\t\tbe cast to ``target_type``.\n\t\ttarget_type (type, optional):\n\t\t\tType to cast the parameter value to (for example ``str``,\n\t\t\t``int``, ``float``, ``bool``). Defaults to ``str``.\n\t\tuse_default_if_blank (bool, optional):\n\t\t\tIf True and the target type is ``str``, an empty string will\n\t\t\tbe treated as \"no value\" and the default will be returned\n\t\t\tinstead. Defaults to False.\n\n\tSecret handling:\n\t\tIf the module defines ``self.meta_data`` and it contains an\n\t\t``\"argumentdetails\"`` section, any parameter marked with\n\t\t``\"secret\": true`` will be read from Allsky's ``env.json`` using\n\t\tthe key ``&lt;MODULE&gt;_&lt;PARAM&gt;`` (both upper-cased). If the key is not\n\t\tfound in the env file, an error is logged via ``allsky_shared.log``.\n\n\tReturns:\n\t\tAny:\n\t\t\tThe parameter value converted to ``target_type`` if possible,\n\t\t\tor the supplied ``default`` if the lookup fails, casting\n\t\t\tfails, or the value is considered blank and\n\t\t\t``use_default_if_blank`` is True.\n\n\tNotes:\n\t\t- No exception is raised if casting fails; the default is silently\n\t\t  used instead.\n\t\t- This helper is designed to be resilient and safe to call from\n\t\t  within modules without needing try/except at every call site.\n\t\"\"\"\n\tresult = default\n\n\ttry:\n\t\tresult = self.params[param]\n\texcept (ValueError, KeyError):\n\t\tpass\n\n\tif hasattr(self, 'meta_data'):\n\t\tif 'argumentdetails' in self.meta_data:\n\t\t\tif param in self.meta_data['argumentdetails']:\n\t\t\t\tif 'secret' in self.meta_data['argumentdetails'][param]:\n\t\t\t\t\tenv_file = os.path.join(allsky_shared.ALLSKYPATH, 'env.json')\n\t\t\t\t\twith open(env_file, 'r', encoding='utf-8') as file:\n\t\t\t\t\t\tenv_data = json.load(file)\n\t\t\t\t\t\tenv_key = f\"{self.meta_data['module'].upper()}_{param.upper()}\"\n\t\t\t\t\t\tif env_key in env_data:\n\t\t\t\t\t\t\tresult = env_data[env_key]\n\t\t\t\t\t\telse:\n\t\t\t\t\t\t\tallsky_shared.log(0, f'ERROR: Variable {param} not found in env file. Tried key {env_key}')\n\n\ttry:\n\t\tresult = target_type(result)\n\texcept (ValueError, TypeError):\n\t\t#have_debug_mode = hasattr(allsky_shared, 'LOGLEVEL')\n\t\t#if have_debug_mode and allsky_shared.LOGLEVEL == 4:\n\t\t#\tallsky_shared.log(4, f'INFO: Cannot cast \"{param}\" to {target_type.__name__}, value [{result}]. Using default \"{default}\"')\n\t\tresult = default\n\n\tif target_type == str and use_default_if_blank:\n\t\tif result == '':\n\t\t\tresult = default\n\n\treturn result\n</code></pre>"},{"location":"allsky_base.html#scripts.modules.allsky_base.ALLSKYMODULEBASE.log","title":"<code>log(level, message, preventNewline=False, exitCode=None, sendToAllsky=False)</code>","text":"<p>Log a message via the shared Allsky logger or print in debug mode.</p> <p>This is a thin wrapper around :func:<code>allsky_shared.log</code> that respects the module's debug mode:</p> <ul> <li>If <code>self.debug_mode</code> is True, the message is printed directly to   stdout.</li> <li>Otherwise, the call is forwarded to <code>allsky_shared.log</code> with the   same arguments.</li> </ul> <p>Parameters:</p> Name Type Description Default <code>level</code> <code>int</code> <p>Log level as used by the Allsky logging system (for example, 0 for errors, higher numbers for more verbose output).</p> required <code>message</code> <code>str</code> <p>The message to log.</p> required <code>preventNewline</code> <code>bool</code> <p>If True, do not end the log line with a newline. Defaults to False.</p> <code>False</code> <code>exitCode</code> <code>int | None</code> <p>If not None, the underlying logger may terminate the process with this exit code. Defaults to None.</p> <code>None</code> <code>sendToAllsky</code> <code>bool</code> <p>When True, forwards the message into Allsky's Web UI message system as well as standard output, depending on logging level. Defaults to False.</p> <code>False</code> <p>Returns:</p> Type Description <p>None</p> Source code in <code>scripts/modules/allsky_base.py</code> <pre><code>def log(self, level, message, preventNewline = False, exitCode=None, sendToAllsky=False):\n\t\"\"\"\n\tLog a message via the shared Allsky logger or print in debug mode.\n\n\tThis is a thin wrapper around :func:`allsky_shared.log` that respects\n\tthe module's debug mode:\n\n\t- If ``self.debug_mode`` is True, the message is printed directly to\n\t  stdout.\n\t- Otherwise, the call is forwarded to ``allsky_shared.log`` with the\n\t  same arguments.\n\n\tArgs:\n\t\tlevel (int):\n\t\t\tLog level as used by the Allsky logging system (for example,\n\t\t\t0 for errors, higher numbers for more verbose output).\n\t\tmessage (str):\n\t\t\tThe message to log.\n\t\tpreventNewline (bool, optional):\n\t\t\tIf True, do not end the log line with a newline. Defaults to False.\n\t\texitCode (int | None, optional):\n\t\t\tIf not None, the underlying logger may terminate the process\n\t\t\twith this exit code. Defaults to None.\n\t\tsendToAllsky (bool, optional):\n\t\t\tWhen True, forwards the message into Allsky's Web UI message\n\t\t\tsystem as well as standard output, depending on logging level.\n\t\t\tDefaults to False.\n\n\tReturns:\n\t\tNone\n\t\"\"\"\n\tif self.debug_mode:\n\t\tprint(message)\n\telse:\n\t\tallsky_shared.log(level, message, preventNewline = preventNewline, exitCode=exitCode, sendToAllsky=sendToAllsky)\n</code></pre>"},{"location":"allsky_shared.html","title":"Shared Module","text":""},{"location":"allsky_shared.html#scripts.modules.allsky_shared","title":"<code>allsky_shared</code>","text":"<p>allsky_shared.py</p> <p>Part of allsky postprocess.py modules. https://github.com/AllskyTeam/allsky</p> <p>This module is a common dumping ground for shared variables and functions used by various Allsky components.</p> <p>It provides helpers for:</p> <ul> <li>Reading environment variables and Allsky configuration</li> <li>Managing small on-disk \"databases\" used as debug stores</li> <li>Filesystem utilities (paths, permissions, extra-data files)</li> <li>Database connection helpers and automatic purge routines</li> <li>Overlay \"extra data\" JSON formatting and persistence</li> </ul>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.convert_lat_lon","title":"<code>convert_lat_lon(input)</code>","text":"<p>Helper for converting latitude/longitude strings.</p> <p>This wrapper calls the legacy :func:<code>convertLatLon</code>. New code should use this snake_case name; the camelCase function is kept so existing callers continue to work.</p> <p>See :func:<code>convertLatLon</code> for details.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def convert_lat_lon(input):\n    \"\"\"\n    Helper for converting latitude/longitude strings.\n\n    This wrapper calls the legacy :func:`convertLatLon`. New code should\n    use this snake_case name; the camelCase function is kept so existing\n    callers continue to work.\n\n    See :func:`convertLatLon` for details.\n    \"\"\"\n    return convertLatLon(input)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.count_starts_in_image","title":"<code>count_starts_in_image(image, mask_file_name=None)</code>","text":"<p>Detect stars in an image using Photutils' DAOStarFinder.</p> <p>The image is converted to grayscale if needed, optionally masked with :func:<code>mask_image</code>, and then processed with sigma-clipped statistics and DAOStarFinder to locate star centroids.</p> <p>Parameters:</p> Name Type Description Default <code>image</code> <code>ndarray</code> <p>Input image (grayscale or BGR).</p> required <code>mask_file_name</code> <code>str | None</code> <p>Optional mask file name to apply before detection.</p> <code>None</code> <p>Returns:</p> Type Description <p>tuple[list[tuple[float, float]], numpy.ndarray]: A tuple containing:</p> <ul> <li>A list of <code>(x, y)</code> star coordinates.</li> <li>The (possibly masked) image used for detection.</li> </ul> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def count_starts_in_image(image, mask_file_name=None):\n    \"\"\"\n    Detect stars in an image using Photutils' DAOStarFinder.\n\n    The image is converted to grayscale if needed, optionally masked with\n    :func:`mask_image`, and then processed with sigma-clipped statistics\n    and DAOStarFinder to locate star centroids.\n\n    Args:\n        image (numpy.ndarray):\n            Input image (grayscale or BGR).\n        mask_file_name (str | None, optional):\n            Optional mask file name to apply before detection.\n\n    Returns:\n        tuple[list[tuple[float, float]], numpy.ndarray]:\n            A tuple containing:\n\n              * A list of ``(x, y)`` star coordinates.\n              * The (possibly masked) image used for detection.\n    \"\"\"\n    from photutils.detection import DAOStarFinder\n    from astropy.stats import sigma_clipped_stats\n    import cv2\n\n    # Convert to grayscale if it's RGB\n    if image.ndim == 3:\n        gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)\n    else:\n        gray = image\n\n    if mask_file_name is not None and mask_file_name != '':\n        gray = mask_image(gray, mask_file_name)\n\n    # Convert to float for processing\n    image_data = gray.astype(float)\n\n    # Estimate background stats\n    mean, median, std = sigma_clipped_stats(image_data, sigma=3.0)\n\n    # Detect stars\n    daofind = DAOStarFinder(fwhm=3.0, threshold=5.0 * std)\n    sources = daofind(image_data - median)\n\n    # Convert to list of (x, y) tuples if sources were found\n    coords = []\n    if sources is not None and len(sources) &gt; 0:\n        x = sources['xcentroid'].tolist()\n        y = sources['ycentroid'].tolist()\n        coords = list(zip(x, y))\n\n    return coords, image\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.create_cardinal","title":"<code>create_cardinal(degrees)</code>","text":"<p>Convert a wind direction in degrees into a cardinal point.</p> <p>Parameters:</p> Name Type Description Default <code>degrees</code> <p>Direction in degrees (0\u2013360). North is 0\u00b0/360\u00b0, east is 90\u00b0, and so on.</p> required <p>Returns:</p> Type Description <p>A string containing one of the 16-point compass directions</p> <p>(e.g., <code>'N'</code>, <code>'NE'</code>, <code>'SW'</code>), or <code>'N/A'</code> if the input</p> <p>cannot be interpreted.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def create_cardinal(degrees):\n    \"\"\"\n    Convert a wind direction in degrees into a cardinal point.\n\n    Args:\n        degrees: Direction in degrees (0\u2013360). North is 0\u00b0/360\u00b0, east is\n            90\u00b0, and so on.\n\n    Returns:\n        A string containing one of the 16-point compass directions\n        (e.g., ``'N'``, ``'NE'``, ``'SW'``), or ``'N/A'`` if the input\n        cannot be interpreted.\n    \"\"\"\n    try:\n        cardinals = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW','W', 'WNW', 'NW', 'NNW', 'N']\n        cardinal = cardinals[round(degrees / 22.5)]\n    except Exception:\n        cardinal = 'N/A'\n\n    return cardinal\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.create_device","title":"<code>create_device(import_name, class_name, bus_number, i2c_address='')</code>","text":"<p>Instantiate an I2C device class on a given bus.</p> <p>The device class is imported dynamically and initialised with an Adafruit Blinka <code>busio.I2C</code> object constructed from a known set of SCL/SDA pins for the requested bus number.</p> <p>Parameters:</p> Name Type Description Default <code>import_name</code> <code>str</code> <p>Module path to import (e.g. <code>\"adafruit_bme280\"</code>).</p> required <code>class_name</code> <code>str</code> <p>Name of the device class in that module.</p> required <code>bus_number</code> <code>int</code> <p>I2C bus number (e.g. 1, 3, 4, 5, 6).</p> required <code>i2c_address</code> <code>str</code> <p>Optional I2C address string (e.g. <code>\"0x76\"</code>). If omitted, the device class is constructed without an explicit address.</p> <code>''</code> <p>Returns:</p> Name Type Description <code>Any</code> <p>An instance of the requested device class.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the module or class cannot be imported.</p> <code>ValueError</code> <p>If no pin mapping exists for the given bus number.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def create_device(import_name: str, class_name: str, bus_number: int, i2c_address: str = \"\"):\n    \"\"\"\n    Instantiate an I2C device class on a given bus.\n\n    The device class is imported dynamically and initialised with an\n    Adafruit Blinka ``busio.I2C`` object constructed from a known set of\n    SCL/SDA pins for the requested bus number.\n\n    Args:\n        import_name (str):\n            Module path to import (e.g. ``\"adafruit_bme280\"``).\n        class_name (str):\n            Name of the device class in that module.\n        bus_number (int):\n            I2C bus number (e.g. 1, 3, 4, 5, 6).\n        i2c_address (str, optional):\n            Optional I2C address string (e.g. ``\"0x76\"``). If omitted, the\n            device class is constructed without an explicit address.\n\n    Returns:\n        Any:\n            An instance of the requested device class.\n\n    Raises:\n        ImportError:\n            If the module or class cannot be imported.\n        ValueError:\n            If no pin mapping exists for the given bus number.\n    \"\"\"\n    bus_number = int(bus_number)\n\n    # Define SCL/SDA pins for each bus\n    I2C_BUS_PINS = {\n        1: (board.SCL, board.SDA),\n        3: (board.D5, board.D4),\n        4: (board.D9, board.D8),\n        5: (board.D13, board.D12),\n        6: (board.D23, board.D22)\n    }\n\n    # Dynamically import the module and get the class\n    try:\n        module = importlib.import_module(import_name)\n        cls = getattr(module, class_name)\n    except (ImportError, AttributeError) as e:\n        raise ImportError(f\"Could not import '{class_name}' from '{import_name}': {e}\")\n\n    try:\n        scl, sda = I2C_BUS_PINS[bus_number]\n    except KeyError:\n        raise ValueError(f\"No pin mapping defined for I2C bus {bus_number}\")\n\n    i2c = busio.I2C(scl, sda)\n\n    # Instantiate device\n    if i2c_address:\n        return cls(i2c, int(i2c_address, 0))\n    else:\n        return cls(i2c)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.delete_extra_data","title":"<code>delete_extra_data(fileName)</code>","text":"<p>Preferred wrapper for removing extra data files.</p> <p>This is the underscore version and should be used in new code. It simply delegates to :func:<code>deleteExtraData</code>, which contains the legacy implementation.</p> <p>Parameters:</p> Name Type Description Default <code>fileName</code> <code>str</code> <p>File name to remove from all configured extra data directories.</p> required Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def delete_extra_data(fileName):\n    \"\"\"\n    Preferred wrapper for removing extra data files.\n\n    This is the underscore version and should be used in new code. It simply\n    delegates to :func:`deleteExtraData`, which contains the legacy\n    implementation.\n\n    Args:\n        fileName (str):\n            File name to remove from all configured extra data directories.\n    \"\"\"\n    deleteExtraData(fileName)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_all_allsky_variables","title":"<code>get_all_allsky_variables(show_empty=True, module='', indexed=False, raw=False)</code>","text":"<p>Retrieve all known Allsky variables via the ALLSKYVARIABLES helper.</p> <p>Parameters:</p> Name Type Description Default <code>show_empty</code> <code>bool</code> <p>Whether to include variables that have no value. Defaults to True.</p> <code>True</code> <code>module</code> <code>str</code> <p>Optional module filter, depending on the ALLSKYVARIABLES implementation.</p> <code>''</code> <code>indexed</code> <code>bool</code> <p>If True, variables may be returned in an indexed form.</p> <code>False</code> <code>raw</code> <code>bool</code> <p>If True, return raw data structures from ALLSKYVARIABLES.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>Any</code> <p>Whatever is returned by <code>ALLSKYVARIABLES().get_variables(...)</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_all_allsky_variables(show_empty=True, module='', indexed=False, raw=False):\n    \"\"\"\n    Retrieve all known Allsky variables via the ALLSKYVARIABLES helper.\n\n    Args:\n        show_empty (bool, optional):\n            Whether to include variables that have no value. Defaults to True.\n        module (str, optional):\n            Optional module filter, depending on the ALLSKYVARIABLES\n            implementation.\n        indexed (bool, optional):\n            If True, variables may be returned in an indexed form.\n        raw (bool, optional):\n            If True, return raw data structures from ALLSKYVARIABLES.\n\n    Returns:\n        Any:\n            Whatever is returned by ``ALLSKYVARIABLES().get_variables(...)``.\n    \"\"\"\n    allskyvariables = ALLSKYVARIABLES()\n    return allskyvariables.get_variables(show_empty, module, indexed, raw)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_allsky_variable","title":"<code>get_allsky_variable(variable)</code>","text":"<p>Look up a single Allsky variable from environment or extra-data files.</p> <p>The lookup order is:</p> <ol> <li>Environment via :func:<code>getEnvironmentVariable</code>.</li> <li>JSON extra-data files in all extra-data directories.</li> <li>Text extra-data files in all extra-data directories.</li> </ol> <p>Parameters:</p> Name Type Description Default <code>variable</code> <code>str</code> <p>The variable name to retrieve.</p> required <p>Returns:</p> Name Type Description <code>Any</code> <p>The variable value if found, otherwise None.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_allsky_variable(variable):\n    \"\"\"\n    Look up a single Allsky variable from environment or extra-data files.\n\n    The lookup order is:\n\n      1. Environment via :func:`getEnvironmentVariable`.\n      2. JSON extra-data files in all extra-data directories.\n      3. Text extra-data files in all extra-data directories.\n\n    Args:\n        variable (str):\n            The variable name to retrieve.\n\n    Returns:\n        Any:\n            The variable value if found, otherwise None.\n    \"\"\"\n    result = getEnvironmentVariable(variable)\n    if result is None:\n\n        extra_data_paths = get_extra_dir()\n        for extra_data_path in extra_data_paths:\n            directory = Path(extra_data_path)\n\n            for file_path in directory.iterdir():\n                if file_path.is_file() and isFileReadable(file_path):\n\n                    file_extension = Path(file_path).suffix\n\n                    if file_extension == '.json':\n                        result = _get_value_from_json_file(file_path, variable)\n\n                    if file_extension == '.txt':\n                        result = _get_value_from_text_file(file_path, variable)\n\n                if result is not None:\n                    break\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_allsky_version","title":"<code>get_allsky_version()</code>","text":"<p>Convenience helper to retrieve and parse the Allsky version.</p> <p>The version file path is taken from the <code>ALLSKY_VERSION_FILE</code> environment variable and passed to :func:<code>parse_version</code>.</p> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed version info as returned by :func:<code>parse_version</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_allsky_version():\n    \"\"\"\n    Convenience helper to retrieve and parse the Allsky version.\n\n    The version file path is taken from the ``ALLSKY_VERSION_FILE``\n    environment variable and passed to :func:`parse_version`.\n\n    Returns:\n        dict:\n            Parsed version info as returned by :func:`parse_version`.\n    \"\"\"\n    version_file = os.environ['ALLSKY_VERSION_FILE']\n    version_info = parse_version(version_file)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_api_url","title":"<code>get_api_url()</code>","text":"<p>Resolve the Allsky API base URL from the environment.</p> <p>If <code>ALLSKY_API_URL</code> is not present in the current environment, this helper calls :func:<code>setupForCommandLine</code> to load variables from the usual <code>variables.json</code> file, and then re-reads the environment.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>The API base URL from <code>ALLSKY_API_URL</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_api_url():\n    \"\"\"\n    Resolve the Allsky API base URL from the environment.\n\n    If ``ALLSKY_API_URL`` is not present in the current environment, this\n    helper calls :func:`setupForCommandLine` to load variables from the\n    usual ``variables.json`` file, and then re-reads the environment.\n\n    Returns:\n        str:\n            The API base URL from ``ALLSKY_API_URL``.\n    \"\"\"\n    try:\n        api_url = os.environ['ALLSKY_API_URL']\n    except KeyError:\n        setupForCommandLine()\n        api_url = os.environ['ALLSKY_API_URL']\n\n    return api_url\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_camera_gain","title":"<code>get_camera_gain()</code>","text":"<p>Get the current camera gain.</p> <p>For Raspberry Pi cameras, this reads the <code>AnalogueGain</code> value from the Pi metadata. For other camera types it uses the <code>AS_GAIN</code> environment variable.</p> <p>If no gain can be determined, 0.0 is returned.</p> <p>Returns:</p> Name Type Description <code>float</code> <p>Camera gain value.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_camera_gain():\n    \"\"\"\n    Get the current camera gain.\n\n    For Raspberry Pi cameras, this reads the ``AnalogueGain`` value from the\n    Pi metadata. For other camera types it uses the ``AS_GAIN`` environment\n    variable.\n\n    If no gain can be determined, 0.0 is returned.\n\n    Returns:\n        float:\n            Camera gain value.\n    \"\"\"\n    gain = 0\n    camera_type = get_camera_type()\n\n    if camera_type == 'rpi':\n        gain = get_rpi_meta_value('AnalogueGain')\n    else:\n        gain = get_environment_variable('AS_GAIN')\n\n    if gain == None:\n        gain = 0\n\n    return float(gain)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_camera_type","title":"<code>get_camera_type()</code>","text":"<p>Get the configured camera type from the environment.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Lowercase camera type string (e.g. <code>\"rpi\"</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_camera_type():\n    \"\"\"\n    Get the configured camera type from the environment.\n\n    Returns:\n        str:\n            Lowercase camera type string (e.g. ``\"rpi\"``).\n    \"\"\"\n    camera_type = get_environment_variable('CAMERA_TYPE')\n    return camera_type.lower()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_ecowitt_data","title":"<code>get_ecowitt_data(api_key, app_key, mac_address, temp_unitid=1, pressure_unitid=3)</code>","text":"<p>Fetch live weather data from the remote Ecowitt cloud API.</p> <p>If all of the required credentials are non-empty, the function builds an API URL and attempts to parse a range of fields such as outdoor and indoor temperatures, humidity, rainfall, wind, pressure, and lightning.</p> <p>All fields are returned in a nested dict with sensible defaults of None.</p> <p>Parameters:</p> Name Type Description Default <code>api_key</code> <code>str</code> <p>Ecowitt API key.</p> required <code>app_key</code> <code>str</code> <p>Ecowitt application key.</p> required <code>mac_address</code> <code>str</code> <p>Device MAC address registered with Ecowitt.</p> required <code>temp_unitid</code> <code>int</code> <p>Temperature unit ID expected by the API. Defaults to 1.</p> <code>1</code> <code>pressure_unitid</code> <code>int</code> <p>Pressure unit ID expected by the API. Defaults to 3.</p> <code>3</code> <p>Returns:</p> Type Description <p>dict | str: On success, a nested dictionary of parsed values. On HTTP error, a descriptive error string may be returned instead.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_ecowitt_data(api_key, app_key, mac_address, temp_unitid=1, pressure_unitid=3):\n    \"\"\"\n    Fetch live weather data from the remote Ecowitt cloud API.\n\n    If all of the required credentials are non-empty, the function builds\n    an API URL and attempts to parse a range of fields such as outdoor and\n    indoor temperatures, humidity, rainfall, wind, pressure, and lightning.\n\n    All fields are returned in a nested dict with sensible defaults of None.\n\n    Args:\n        api_key (str):\n            Ecowitt API key.\n        app_key (str):\n            Ecowitt application key.\n        mac_address (str):\n            Device MAC address registered with Ecowitt.\n        temp_unitid (int, optional):\n            Temperature unit ID expected by the API. Defaults to 1.\n        pressure_unitid (int, optional):\n            Pressure unit ID expected by the API. Defaults to 3.\n\n    Returns:\n        dict | str:\n            On success, a nested dictionary of parsed values. On HTTP error,\n            a descriptive error string may be returned instead.\n    \"\"\"\n    result = {\n        'outdoor': {\n            'temperature': None,\n            'feels_like': None,\n            'humidity': None,\n            'app_temp': None,\n            'dew_point': None\n        },\n        'indoor': {\n            'temperature': None,\n            'humidity': None\n        },\n        'solar_and_uvi': {\n            'solar': None,\n            'uvi': None\n        },\n        'rainfall': {\n            'rain_rate': None,\n            'daily': None,\n            'event': None,\n            'hourly': None,\n            'weekly': None,\n            'monthly': None,\n            'yearly': None\n        },\n        'wind': {\n            'wind_speed': None,\n            'wind_gust': None,\n            'wind_direction': None\n        },\n        'pressure': {\n            'relative': None,\n            'absolute': None\n        },\n        'lightning': {\n            'distance': None,\n            'count': None\n        }\n    }\n    if all(var.strip() for var in (app_key, api_key, mac_address)):\n        ECOWITT_API_URL = f'https://api.ecowitt.net/api/v3/device/real_time?application_key={app_key}&amp;api_key={api_key}&amp;mac={mac_address}&amp;call_back=all&amp;temp_unitid={temp_unitid}&amp;pressure_unitid={pressure_unitid}'\n\n        log(4, f\"INFO: Reading Ecowitt API from - {ECOWITT_API_URL}\")\n        try:\n            response = requests.get(ECOWITT_API_URL)\n            if response.status_code == 200:\n                raw_data = response.json()\n\n                result['outdoor']['temperature'] = _get_nested_value(raw_data, 'data.outdoor.temperature.value', float)\n                result['outdoor']['feels_like'] = _get_nested_value(raw_data, 'data.outdoor.feels_like.value', float)\n                result['outdoor']['humidity'] = _get_nested_value(raw_data, 'data.outdoor.humidity.value', float)\n                result['outdoor']['app_temp'] = _get_nested_value(raw_data, 'data.outdoor.app_temp.value', float)\n                result['outdoor']['dew_point'] = _get_nested_value(raw_data, 'data.outdoor.dew_point.value', float)\n\n                result['indoor']['temperature'] = _get_nested_value(raw_data, 'data.indoor.temperature.value', float)\n                result['indoor']['humidity'] = _get_nested_value(raw_data, 'data.indoor.humidity.value', float)\n\n                result['solar_and_uvi']['solar'] = _get_nested_value(raw_data, 'data.solar_and_uvi.solar.value', float)\n                result['solar_and_uvi']['uvi'] = _get_nested_value(raw_data, 'data.solar_and_uvi.uvi.value', float)\n\n                result['rainfall']['rain_rate'] = _get_nested_value(raw_data, 'data.rainfall.rain_rate.value', float)\n                result['rainfall']['daily'] = _get_nested_value(raw_data, 'data.rainfall.daily.value', float)\n                result['rainfall']['event'] = _get_nested_value(raw_data, 'data.rainfall.event.value', float)\n                result['rainfall']['hourly'] = _get_nested_value(raw_data, 'data.rainfall.hourly.value', float)\n                result['rainfall']['weekly'] = _get_nested_value(raw_data, 'data.rainfall.weekly.value', float)\n                result['rainfall']['monthly'] = _get_nested_value(raw_data, 'data.rainfall.monthly.value', float)\n                result['rainfall']['yearly'] = _get_nested_value(raw_data, 'data.rainfall.yearly.value', float)\n\n                result['wind']['wind_speed'] = _get_nested_value(raw_data, 'data.wind.wind_speed.value', float)\n                result['wind']['wind_gust'] = _get_nested_value(raw_data, 'data.wind.wind_gust.value', float)\n                result['wind']['wind_direction'] = _get_nested_value(raw_data, 'data.wind.wind_direction.value', int)\n\n                result['pressure']['relative'] = _get_nested_value(raw_data, 'data.pressure.relative.value', float)\n                result['pressure']['absolute'] = _get_nested_value(raw_data, 'data.pressure.absolute.value', float)\n\n                result['lightning']['distance'] = _get_nested_value(raw_data, 'data.lightning.distance.value', float)\n                result['lightning']['count'] = _get_nested_value(raw_data, 'data.lightning.count.value', int)\n\n                log(1, f'INFO: Data read from Ecowitt API')\n            else:\n                result = f'Got error from the Ecowitt API. Response code {response.status_code}'\n                log(0, f'ERROR: {result}')\n        except Exception as e:\n            me = os.path.basename(__file__)\n            eType, eObject, eTraceback = sys.exc_info()\n            log(0, f'ERROR: Failed to read data from Ecowitt on line {eTraceback.tb_lineno} in {me} - {e}')\n    else:\n        log(0, 'ERROR: Missing Ecowitt Application Key, API Key or MAC Address')\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_ecowitt_local_data","title":"<code>get_ecowitt_local_data(address, password=None)</code>","text":"<p>Fetch live weather data directly from a local Ecowitt gateway.</p> <p>This variant talks to the gateway's local HTTP API and parses a variety of metrics such as temperatures, humidity, rainfall, wind, pressure and lightning. Values are returned in a nested dict with None defaults.</p> <p>Units are parsed from the API response and temperature values are converted to Celsius when needed.</p> <p>Parameters:</p> Name Type Description Default <code>address</code> <code>str</code> <p>Base URL or IP address of the Ecowitt gateway.</p> required <code>password</code> <code>str</code> <p>Reserved for password-protected gateways (currently unused).</p> <code>None</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Nested dictionary of parsed values.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_ecowitt_local_data(address, password=None):\n    \"\"\"\n    Fetch live weather data directly from a local Ecowitt gateway.\n\n    This variant talks to the gateway's local HTTP API and parses a variety\n    of metrics such as temperatures, humidity, rainfall, wind, pressure and\n    lightning. Values are returned in a nested dict with None defaults.\n\n    Units are parsed from the API response and temperature values are\n    converted to Celsius when needed.\n\n    Args:\n        address (str):\n            Base URL or IP address of the Ecowitt gateway.\n        password (str, optional):\n            Reserved for password-protected gateways (currently unused).\n\n    Returns:\n        dict:\n            Nested dictionary of parsed values.\n    \"\"\"\n    '''\n    Temp 0 - C, 1 - F\n    Pressure 0 - hPA, 1 - inHg, 2 - mmHg\n    Wind 0 - m/s, 1 - km/h, 2 - mph, 3 - knots, 5 - Beaufort\n    Rain 0 - mm, 1 - in\n    Irradiance 0 - Klux, 1 - W/m2, 2 - Kfc\n    Capacity 0 - L, 1 - m3, 2 - Gal\n    '''\n\n    result = {\n        'outdoor': {\n            'temperature': None,\n            'feels_like': None,\n            'humidity': None,\n            'app_temp': None,\n            'dew_point': None\n        },\n        'indoor': {\n            'temperature': None,\n            'humidity': None\n        },\n        'solar_and_uvi': {\n            'solar': None,\n            'uvi': None\n        },\n        'rainfall': {\n            'rain_rate': None,\n            'daily': None,\n            'event': None,\n            'hourly': None,\n            'weekly': None,\n            'monthly': None,\n            'yearly': None\n        },\n        'wind': {\n            'wind_speed': None,\n            'wind_gust': None,\n            'wind_direction': None\n        },\n        'pressure': {\n            'relative': None,\n            'absolute': None\n        },\n        'lightning': {\n            'distance': None,\n            'count': None\n        }\n    }\n\n    def parse_val(val, as_type=float, unit=None):\n        \"\"\"\n        Extract numeric part from a value string and optionally convert \u00b0F to \u00b0C.\n\n        Args:\n            val (Any):\n                Raw value from the Ecowitt JSON (may contain unit text).\n            as_type (callable):\n                Type to cast the numeric part to (e.g. float, int).\n            unit (str | None):\n                Optional unit string; when reported as Fahrenheit, values are\n                converted to Celsius.\n\n        Returns:\n            Any | None:\n                Parsed and optionally converted value, or None on failure.\n        \"\"\"\n        if val is None:\n            return None\n        try:\n            num_str = str(val).strip().split()[0].strip('%')\n            value = as_type(num_str)\n            if unit:\n                unit = unit.lower()\n                if unit in ['f', '\u00c2\u00b0f']:\n                    value = round((value - 32) * 5 / 9, 2)\n            return value\n        except (ValueError, TypeError):\n            return None\n\n    def get_val_and_unit(data_list, target_id):\n        \"\"\"\n        Helper to locate a record in an Ecowitt list and extract (value, unit).\n\n        Args:\n            data_list (list[dict]):\n                List of readings as returned by the Ecowitt gateway.\n            target_id (str):\n                Identifier to match in each dict's ``\"id\"`` field.\n\n        Returns:\n            tuple:\n                ``(value, unit)`` where both may be None if the ID is not found.\n        \"\"\"\n        for item in data_list:\n            if item.get(\"id\") == target_id:\n                return item.get(\"val\"), item.get(\"unit\", None)\n        return None, None\n\n    LIVE_URL = f'{address}/get_livedata_info?'\n\n    try:\n        response = requests.get(LIVE_URL)\n        if response.status_code == 200:\n            live_data = response.json()\n\n            common = live_data.get(\"common_list\", [])\n            val, unit = get_val_and_unit(common, \"0x02\")\n            result['outdoor']['temperature'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x07\")\n            result['outdoor']['humidity'] = parse_val(val, int, unit)\n\n            val, unit = get_val_and_unit(common, \"3\")\n            result['outdoor']['feels_like'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x03\")\n            result['outdoor']['dew_point'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x0B\")\n            result['wind']['wind_speed'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x0C\")\n            result['wind']['wind_gust'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x0A\")\n            result['wind']['wind_direction'] = parse_val(val, int, unit)\n\n            val, unit = get_val_and_unit(common, \"0x15\")\n            result['solar_and_uvi']['solar'] = parse_val(val, float, unit)\n\n            val, unit = get_val_and_unit(common, \"0x17\")\n            result['solar_and_uvi']['uvi'] = parse_val(val, int, unit)\n\n            # --- Rain ---\n            rain = live_data.get(\"rain\", [])\n            for rid, key in {\n                \"0x0D\": \"event\",\n                \"0x0E\": \"rain_rate\",\n                \"0x10\": \"hourly\",\n                \"0x11\": \"daily\",\n                \"0x12\": \"weekly\",\n                \"0x13\": \"yearly\"\n            }.items():\n                val, unit = get_val_and_unit(rain, rid)\n                result['rainfall'][key] = parse_val(val, float, unit)\n\n            # --- WH25 Indoor Sensor ---\n            wh25 = live_data.get(\"wh25\", [{}])[0]\n            result['indoor']['temperature'] = parse_val(wh25.get(\"intemp\"), float, wh25.get(\"unit\"))\n            result['indoor']['humidity'] = parse_val(wh25.get(\"inhumi\"), int)\n\n            result['pressure']['absolute'] = parse_val(wh25.get(\"abs\"), float)\n            result['pressure']['relative'] = parse_val(wh25.get(\"rel\"), float)\n\n            # --- Lightning ---\n            lightning = live_data.get(\"lightning\", [{}])[0]\n            result['lightning']['distance'] = parse_val(lightning.get(\"distance\"), float)\n            result['lightning']['count'] = parse_val(lightning.get(\"count\"), int)\n\n    except Exception as e:\n        me = os.path.basename(__file__)\n        eType, eObject, eTraceback = sys.exc_info()\n        log(0, f'ERROR: Failed to read live data from the local Ecowitt gateway on line {eTraceback.tb_lineno} in {me} - {e}')\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_environment_variable","title":"<code>get_environment_variable(name, fatal=False, debug=False, try_allsky_debug_file=False)</code>","text":"<p>Helper for reading an environment variable.</p> <p>This is the modern, snake_case wrapper around the legacy :func:<code>getEnvironmentVariable</code> implementation. New code should call this function rather than the camelCase version.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <p>Name of the environment variable to read.</p> required <code>fatal</code> <p>If True and the variable cannot be resolved, the process will terminate with an error.</p> <code>False</code> <code>debug</code> <p>If True, values are read from the debug database instead of the real environment.</p> <code>False</code> <code>try_allsky_debug_file</code> <p>When False (default), the function will fall back to loading variables from <code>variables.json</code>. When True, it will instead try to look up the value in the overlay debug data file.</p> <code>False</code> <p>Returns:</p> Type Description <p>The resolved value as a string, or None if not found (and <code>fatal</code></p> <p>is False).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_environment_variable(name, fatal=False, debug=False, try_allsky_debug_file=False):\n    \"\"\"\n    Helper for reading an environment variable.\n\n    This is the modern, snake_case wrapper around the legacy\n    :func:`getEnvironmentVariable` implementation. New code should call this\n    function rather than the camelCase version.\n\n    Args:\n        name: Name of the environment variable to read.\n        fatal: If True and the variable cannot be resolved, the process will\n            terminate with an error.\n        debug: If True, values are read from the debug database instead of\n            the real environment.\n        try_allsky_debug_file: When False (default), the function will fall\n            back to loading variables from ``variables.json``. When True,\n            it will instead try to look up the value in the overlay debug\n            data file.\n\n    Returns:\n        The resolved value as a string, or None if not found (and ``fatal``\n        is False).\n    \"\"\"\n    return getEnvironmentVariable(name, fatal, debug)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_extra_dir","title":"<code>get_extra_dir(current_only=False)</code>","text":"<p>Helper to get the \"extra data\" directory or directories.</p> <p>This simply calls :func:<code>getExtraDir</code>. New code should use this snake_case name.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_extra_dir(current_only:bool = False) -&gt; list[str] | str:\n    \"\"\"\n    Helper to get the \"extra data\" directory or directories.\n\n    This simply calls :func:`getExtraDir`. New code should use this\n    snake_case name.\n    \"\"\"\n    return getExtraDir(current_only)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_flows_with_module","title":"<code>get_flows_with_module(module_name)</code>","text":"<p>Scan module flow files and return those containing a given module.</p> <p>Only <code>postprocessing_*.json</code> files that are not debug variants are considered. Files that fail to parse are quietly ignored.</p> <p>Parameters:</p> Name Type Description Default <code>module_name</code> <code>str</code> <p>Name of the module to search for in the flow definitions.</p> required <p>Returns:</p> Name Type Description <code>dict</code> <p>Mapping of filename to parsed JSON content for flows that contain the given module.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_flows_with_module(module_name):\n    \"\"\"\n    Scan module flow files and return those containing a given module.\n\n    Only ``postprocessing_*.json`` files that are not debug variants are\n    considered. Files that fail to parse are quietly ignored.\n\n    Args:\n        module_name (str):\n            Name of the module to search for in the flow definitions.\n\n    Returns:\n        dict:\n            Mapping of filename to parsed JSON content for flows that contain\n            the given module.\n    \"\"\"\n    folder = Path(ALLSKY_MODULES)\n    found: Dict[str, Any] = {}\n\n    for file in folder.glob(\"*.json\"):\n        if not file.name.endswith(\"-debug.json\"):\n            if file.name.startswith(\"postprocessing_\"):\n                try:\n                    with file.open(\"r\", encoding=\"utf-8\") as f:\n                        data = json.load(f)\n\n                    if module_name in data:\n                        found[file.name] = data\n\n                except (json.JSONDecodeError, OSError) as e:\n                    pass\n\n    return found\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_gpio_pin","title":"<code>get_gpio_pin(gpio_pin, pi=None, show_errors=False)</code>","text":"<p>Read the logical state of a GPIO pin via the Allsky API (legacy alias).</p> <p>This definition simply calls :func:<code>read_gpio_pin</code>. It is kept for backward compatibility with existing code that expects <code>get_gpio_pin</code> to return a pin value rather than a board pin object.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder kept for interface compatibility.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; kept for interface compatibility.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>bool</code> <p>True if the GPIO is reported as <code>\"on\"</code>, False otherwise.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_gpio_pin(gpio_pin, pi=None, show_errors=False):\n    \"\"\"\n    Read the logical state of a GPIO pin via the Allsky API (legacy alias).\n\n    This definition simply calls :func:`read_gpio_pin`. It is kept for\n    backward compatibility with existing code that expects ``get_gpio_pin``\n    to return a pin value rather than a board pin object.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        pi (Any, optional):\n            Unused placeholder kept for interface compatibility.\n        show_errors (bool, optional):\n            Currently unused; kept for interface compatibility.\n\n    Returns:\n        bool:\n            True if the GPIO is reported as ``\"on\"``, False otherwise.\n    \"\"\"\n    return read_gpio_pin(gpio_pin, pi=None, show_errors=False)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_gpio_pin_details","title":"<code>get_gpio_pin_details(pin)</code>","text":"<p>Get the CircuitPython <code>board</code> pin object for a given numeric pin.</p> <p>This is a convenience wrapper around :func:<code>getGPIOPin</code> and should be used by new code.</p> <p>Parameters:</p> Name Type Description Default <code>pin</code> <code>int</code> <p>Numeric pin index (0\u201327) corresponding to a board pin.</p> required <p>Returns:</p> Name Type Description <code>Any</code> <p>The matching <code>board.Dx</code> constant, or None if the pin is unknown.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_gpio_pin_details(pin):\n    \"\"\"\n    Get the CircuitPython ``board`` pin object for a given numeric pin.\n\n    This is a convenience wrapper around :func:`getGPIOPin` and should be\n    used by new code.\n\n    Args:\n        pin (int):\n            Numeric pin index (0\u201327) corresponding to a board pin.\n\n    Returns:\n        Any:\n            The matching ``board.Dx`` constant, or None if the pin is unknown.\n    \"\"\"\n    return getGPIOPin(pin)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_hass_sensor_value","title":"<code>get_hass_sensor_value(ha_url, ha_ltt, ha_sensor)</code>","text":"<p>Query a Home Assistant sensor and return its numeric state.</p> <p>A GET request is sent to the Home Assistant REST API using the supplied long-lived token. The sensor's state is parsed as a float on success.</p> <p>Parameters:</p> Name Type Description Default <code>ha_url</code> <code>str</code> <p>Base URL of the Home Assistant instance (e.g. <code>\"http://host:8123\"</code>).</p> required <code>ha_ltt</code> <code>str</code> <p>Long-lived access token for Home Assistant.</p> required <code>ha_sensor</code> <code>str</code> <p>Entity ID of the sensor (e.g. <code>\"sensor.outdoor_temp\"</code>).</p> required <p>Returns:</p> Type Description <p>float | None: The sensor state as a float, or None if the sensor cannot be read.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_hass_sensor_value(ha_url, ha_ltt, ha_sensor):\n    \"\"\"\n    Query a Home Assistant sensor and return its numeric state.\n\n    A GET request is sent to the Home Assistant REST API using the supplied\n    long-lived token. The sensor's state is parsed as a float on success.\n\n    Args:\n        ha_url (str):\n            Base URL of the Home Assistant instance (e.g. ``\"http://host:8123\"``).\n        ha_ltt (str):\n            Long-lived access token for Home Assistant.\n        ha_sensor (str):\n            Entity ID of the sensor (e.g. ``\"sensor.outdoor_temp\"``).\n\n    Returns:\n        float | None:\n            The sensor state as a float, or None if the sensor cannot be read.\n    \"\"\"\n    result = None\n\n    headers = {\n        'Authorization': f'Bearer {ha_ltt}',\n        'Content-Type': 'application/json',\n    }\n\n    try:\n        response = requests.get(f'{ha_url}/api/states/{ha_sensor}', headers=headers)\n\n        if response.status_code == 200:\n            result = float(response.json().get('state'))\n        else:\n            if response.status_code == 404:\n                log(0, f'ERROR: Unable to read {ha_sensor} from {ha_url}. homeassistant reports the sensor does not exist')\n            else:\n                if response.status_code == 401:\n                    log(0, f'ERROR: Unable to read {ha_sensor} from {ha_url}. homeassistant reports the token is unauthorised')\n                else:\n                    log(0, f'ERROR: Unable to read {ha_sensor} from {ha_url}. Error code {response.status_code}')\n\n    except Exception as e:\n        me = os.path.basename(__file__)\n        eType, eObject, eTraceback = sys.exc_info()\n        log(0, f'ERROR: Failed to read data from Homeassistant {eTraceback.tb_lineno} in {me} - {e}')\n        result = None\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_lat_lon","title":"<code>get_lat_lon()</code>","text":"<p>Read latitude and longitude from settings and return them as floats.</p> <p>The settings <code>latitude</code> and <code>longitude</code> may be stored in a variety of formats supported by :func:<code>convert_lat_lon</code> (for example, <code>51.5N</code> or <code>-0.13</code>). If a value is empty, the corresponding return value is <code>None</code>.</p> <p>Returns:</p> Type Description <p>Tuple of <code>(lat, lon)</code> where each element is either a float or</p> <p>None if not defined.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_lat_lon():\n    \"\"\"\n    Read latitude and longitude from settings and return them as floats.\n\n    The settings ``latitude`` and ``longitude`` may be stored in a variety\n    of formats supported by :func:`convert_lat_lon` (for example,\n    ``51.5N`` or ``-0.13``). If a value is empty, the corresponding\n    return value is ``None``.\n\n    Returns:\n        Tuple of ``(lat, lon)`` where each element is either a float or\n        None if not defined.\n    \"\"\"\n    lat = None\n    lon = None\n\n    temp_lat = get_setting('latitude')\n    if temp_lat != '':\n        lat = convert_lat_lon(temp_lat)\n    temp_lon = get_setting('longitude')\n    if temp_lon != '':\n        lon = convert_lat_lon(temp_lon)\n\n    return lat, lon\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_pi_info","title":"<code>get_pi_info(info)</code>","text":"<p>Query simple hardware details about the Raspberry Pi.</p> <p>Parameters:</p> Name Type Description Default <code>info</code> <p>One of the predefined constants:</p> <ul> <li><code>PI_INFO_MODEL</code> \u2013 return the board model string.</li> <li><code>Pi_INFO_CPU_TEMPERATURE</code> \u2013 return the CPU temperature in \u00b0C.</li> </ul> required <p>Returns:</p> Type Description <p>The requested value, or None if <code>info</code> does not match a</p> <p>supported constant.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_pi_info(info):\n    \"\"\"\n    Query simple hardware details about the Raspberry Pi.\n\n    Args:\n        info:\n            One of the predefined constants:\n\n            - ``PI_INFO_MODEL`` \u2013 return the board model string.\n            - ``Pi_INFO_CPU_TEMPERATURE`` \u2013 return the CPU temperature in \u00b0C.\n\n    Returns:\n        The requested value, or None if ``info`` does not match a\n        supported constant.\n    \"\"\"\n    from gpiozero import Device, CPUTemperature\n    resukt = None\n\n    if info == PI_INFO_MODEL:\n        Device.ensure_pin_factory()\n        pi_info = Device.pin_factory.board_info\n        result = pi_info.model\n\n    if info == Pi_INFO_CPU_TEMPERATURE:\n        result = CPUTemperature().temperature\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_rpi_meta_value","title":"<code>get_rpi_meta_value(key)</code>","text":"<p>Read a single value from the Raspberry Pi camera metadata file.</p> <p>The metadata file format can be either JSON or simple <code>key=value</code> text. This helper tries JSON first and falls back to line-based parsing.</p> <p>Parameters:</p> Name Type Description Default <code>key</code> <code>str</code> <p>Metadata key to retrieve.</p> required <p>Returns:</p> Name Type Description <code>Any</code> <p>The value if found, or 0 if the file is missing, unreadable, or the key is not present.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_rpi_meta_value(key):\n    \"\"\"\n    Read a single value from the Raspberry Pi camera metadata file.\n\n    The metadata file format can be either JSON or simple ``key=value`` text.\n    This helper tries JSON first and falls back to line-based parsing.\n\n    Args:\n        key (str):\n            Metadata key to retrieve.\n\n    Returns:\n        Any:\n            The value if found, or 0 if the file is missing, unreadable, or the\n            key is not present.\n    \"\"\"\n    result = None\n    metadata_path = get_rpi_metadata()\n\n    if metadata_path is not None:\n        try:\n            with open(metadata_path, 'r') as file:\n                metadata = json.load(file)\n                if key in metadata:\n                    result = metadata[key]\n        except json.JSONDecodeError as e:\n            with open(metadata_path, 'r') as f:\n                for line in f:\n                    if line.startswith(key + \"=\"):\n                        result = line.split(\"=\", 1)[1].strip()\n        except FileNotFoundError as e:\n            result = 0\n        except Exception as e:\n            result = 0\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_rpi_metadata","title":"<code>get_rpi_metadata()</code>","text":"<p>Determine the path to the Raspberry Pi camera metadata file.</p> <p>The metadata path is extracted from the <code>extraargs</code> in the main settings file if a <code>--metadata</code> argument is present. If no explicit path is found, a default of <code>metadata.txt</code> in the current directory is used.</p> <p>Returns:</p> Name Type Description <code>str</code> <p>Path to the metadata file.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_rpi_metadata():\n    \"\"\"\n    Determine the path to the Raspberry Pi camera metadata file.\n\n    The metadata path is extracted from the ``extraargs`` in the main\n    settings file if a ``--metadata`` argument is present. If no explicit\n    path is found, a default of ``metadata.txt`` in the current directory\n    is used.\n\n    Returns:\n        str:\n            Path to the metadata file.\n    \"\"\"\n    with open(ALLSKY_SETTINGS_FILE) as file:\n        config = json.load(file)\n\n    extraargs = config.get('extraargs', '')\n    args = shlex.split(extraargs)\n\n    metadata_path = None\n    for i, arg in enumerate(args):\n        if arg == '--metadata' and i + 1 &lt; len(args):\n            metadata_path = args[i + 1]\n            break\n    if metadata_path is None:\n        metadata_path = os.path.join(ALLSKY_CURRENT_DIR, 'metadata.txt')\n\n    return metadata_path\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_secrets","title":"<code>get_secrets(keys)</code>","text":"<p>Load one or more secrets from <code>env.json</code> in <code>ALLSKYPATH</code>.</p> <p>The file is expected to contain a flat JSON object mapping key names to secret values. Only the requested keys are returned; missing keys are silently ignored.</p> <p>Parameters:</p> Name Type Description Default <code>keys</code> <code>Union[str, List[str]]</code> <p>Either a single key (string) or a list of key names to fetch.</p> required <p>Returns:</p> Type Description <code>Union[str, Dict[str, str], None]</code> <p>If a single key was requested, the value as a string (or None if</p> <code>Union[str, Dict[str, str], None]</code> <p>it is not present).</p> <code>Union[str, Dict[str, str], None]</code> <p>If multiple keys were requested, a <code>dict</code> mapping each key to</p> <code>Union[str, Dict[str, str], None]</code> <p>its value. Keys that are not found are omitted from the mapping.</p> <code>Union[str, Dict[str, str], None]</code> <p>If the file cannot be read or parsed, returns None (single key) or</p> <code>Union[str, Dict[str, str], None]</code> <p>an empty dict (multiple keys).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_secrets(keys: Union[str, List[str]]) -&gt; Union[str, Dict[str, str], None]:\n    \"\"\"\n    Load one or more secrets from ``env.json`` in ``ALLSKYPATH``.\n\n    The file is expected to contain a flat JSON object mapping key names\n    to secret values. Only the requested keys are returned; missing keys\n    are silently ignored.\n\n    Args:\n        keys:\n            Either a single key (string) or a list of key names to fetch.\n\n    Returns:\n        If a single key was requested, the value as a string (or None if\n        it is not present).\n\n        If multiple keys were requested, a ``dict`` mapping each key to\n        its value. Keys that are not found are omitted from the mapping.\n\n        If the file cannot be read or parsed, returns None (single key) or\n        an empty dict (multiple keys).\n    \"\"\"\n    single = isinstance(keys, str)\n    if single:\n        keys = [keys]\n\n    try:\n        file_path = os.path.join(ALLSKYPATH, 'env.json')\n        with open(file_path, 'r') as f:\n            secrets = json.load(f)\n\n        results = {k: secrets[k] for k in keys if k in secrets}\n\n        if single:\n            return results.get(keys[0])\n        return results\n\n    except (IOError, json.JSONDecodeError) as e:\n        print(f\"Error reading secrets file: {e}\")\n        return None if single else {}\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_sensor_temperature","title":"<code>get_sensor_temperature()</code>","text":"<p>Get the current sensor temperature for the active camera.</p> <p>For Raspberry Pi cameras, this reads the <code>SensorTemperature</code> value from the Pi metadata. For other camera types it uses the <code>AS_TEMPERATURE_C</code> environment variable.</p> <p>If no temperature can be determined, 0.0 is returned.</p> <p>Returns:</p> Name Type Description <code>float</code> <p>Sensor temperature in \u00b0C.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_sensor_temperature():\n    \"\"\"\n    Get the current sensor temperature for the active camera.\n\n    For Raspberry Pi cameras, this reads the ``SensorTemperature`` value\n    from the Pi metadata. For other camera types it uses the\n    ``AS_TEMPERATURE_C`` environment variable.\n\n    If no temperature can be determined, 0.0 is returned.\n\n    Returns:\n        float:\n            Sensor temperature in \u00b0C.\n    \"\"\"\n    temperature = 0\n    camera_type = get_camera_type()\n\n    if camera_type == 'rpi':\n        temperature = get_rpi_meta_value('SensorTemperature')\n    else:\n        temperature = get_environment_variable('AS_TEMPERATURE_C')\n\n    if temperature == None:\n        temperature = 0\n\n    return float(temperature)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_setting","title":"<code>get_setting(settingName)</code>","text":"<p>Helper for reading a setting from the loaded settings JSON.</p> <p>This wraps the legacy :func:<code>getSetting</code> and should be used in new code. See :func:<code>getSetting</code> for details.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_setting(settingName):\n    \"\"\"\n    Helper for reading a setting from the loaded settings JSON.\n\n    This wraps the legacy :func:`getSetting` and should be used in new\n    code. See :func:`getSetting` for details.\n    \"\"\"\n    return getSetting(settingName)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.get_value_from_debug_data","title":"<code>get_value_from_debug_data(key)</code>","text":"<p>Look up a key in the overlay debug file.</p> <p>This function is used when running in debug mode to retrieve values that would normally be supplied via environment variables.</p> <p>Parameters:</p> Name Type Description Default <code>key</code> <code>str</code> <p>Name of the value to retrieve.</p> required <p>Returns:</p> Type Description <code>str | None</code> <p>The corresponding value as a string with whitespace removed, or</p> <code>str | None</code> <p>None if the file does not exist, cannot be read, or the key is</p> <code>str | None</code> <p>not present.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def get_value_from_debug_data(key: str) -&gt; str | None:\n    \"\"\"\n    Look up a key in the overlay debug file.\n\n    This function is used when running in debug mode to retrieve values\n    that would normally be supplied via environment variables.\n\n    Args:\n        key: Name of the value to retrieve.\n\n    Returns:\n        The corresponding value as a string with whitespace removed, or\n        None if the file does not exist, cannot be read, or the key is\n        not present.\n    \"\"\"\n    setup_for_command_line()\n\n    try:\n        allsky_tmp = os.environ[\"ALLSKY_TMP\"]\n        file_path = os.path.join(allsky_tmp, \"overlaydebug.txt\")\n\n        try:\n            with open(file_path, \"r\", encoding=\"utf-8\") as f:\n                for line in f:\n                    if not line.strip() or line.strip().startswith(\"#\"):\n                        continue\n\n                    parts = line.split(maxsplit=1)\n                    if len(parts) == 2 and parts[0] == key:\n                        return \"\".join(parts[1].split())\n        except FileNotFoundError:\n            return None\n    except:\n        return None\n    return None\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_extra_data_file","title":"<code>load_extra_data_file(file_name, type='')</code>","text":"<p>Load an extra data file from one or more ALLSKY_EXTRA directories.</p> <p>This helper looks for the given file name in all configured extra-data directories (via :func:<code>get_extra_dir</code>). If it finds a readable file, it will attempt to parse it according to its extension.</p> <p>Currently only JSON files are parsed. Text files are recognised but not yet processed (the block is a placeholder).</p> <p>Parameters:</p> Name Type Description Default <code>file_name</code> <code>str</code> <p>Name of the extra data file to load (e.g. <code>\"extra.json\"</code>).</p> required <code>type</code> <code>str</code> <p>Force the file type. If set to <code>\"json\"</code>, the file is parsed as JSON regardless of its extension.</p> <code>''</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON data if successful; otherwise an empty dict.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_extra_data_file(file_name, type=''):\n    \"\"\"\n    Load an extra data file from one or more ALLSKY_EXTRA directories.\n\n    This helper looks for the given file name in all configured extra-data\n    directories (via :func:`get_extra_dir`). If it finds a readable file,\n    it will attempt to parse it according to its extension.\n\n    Currently only JSON files are parsed. Text files are recognised but\n    not yet processed (the block is a placeholder).\n\n    Args:\n        file_name (str):\n            Name of the extra data file to load (e.g. ``\"extra.json\"``).\n        type (str, optional):\n            Force the file type. If set to ``\"json\"``, the file is parsed\n            as JSON regardless of its extension.\n\n    Returns:\n        dict:\n            Parsed JSON data if successful; otherwise an empty dict.\n    \"\"\"\n    result = {}\n    extra_data_paths = get_extra_dir()\n    for extra_data_path in extra_data_paths:\n        if extra_data_path is not None:               # it should never be None\n            extra_data_filename = os.path.join(extra_data_path, file_name)\n            file_path = Path(extra_data_filename)\n            if file_path.is_file() and isFileReadable(file_path):\n                file_extension = Path(file_path).suffix\n\n                if file_extension == '.json' or type == 'json':\n                    try:\n                        with open(extra_data_filename, 'r') as file:\n                            result = json.load(file)\n                    except json.JSONDecodeError:\n                        log(0, f'ERROR: cannot read {extra_data_filename}.')\n\n                if file_extension == '.txt':\n                    pass\n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_json_file","title":"<code>load_json_file(path)</code>","text":"<p>Load a JSON file and return its parsed contents.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>str | Path</code> <p>Path to the JSON file.</p> required <p>Returns:</p> Type Description <p>The parsed JSON data (dict or list). If the file does not exist,</p> <p>cannot be read, or contains invalid JSON, an empty dict is</p> <p>returned.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_json_file(path: str | Path):\n    \"\"\"\n    Load a JSON file and return its parsed contents.\n\n    Args:\n        path: Path to the JSON file.\n\n    Returns:\n        The parsed JSON data (dict or list). If the file does not exist,\n        cannot be read, or contains invalid JSON, an empty dict is\n        returned.\n    \"\"\"\n    try:\n        file_path = Path(path)\n        if not file_path.is_file():\n            return {}\n\n        with file_path.open(\"r\", encoding=\"utf-8\") as file:\n            return json.load(file)\n\n    except (OSError, json.JSONDecodeError):\n        return {}\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_mask","title":"<code>load_mask(mask_file_name, target_image)</code>","text":"<p>Load a grayscale mask image and resize it to match a target image.</p> <p>The mask is loaded from <code>ALLSKY_OVERLAY/images/&lt;mask_file_name&gt;</code> and converted to a float mask in the range [0, 1]. If the mask dimensions do not match the target image, it is resized accordingly.</p> <p>Parameters:</p> Name Type Description Default <code>mask_file_name</code> <code>str</code> <p>Name of the mask file to load.</p> required <code>target_image</code> <code>ndarray</code> <p>Target image whose shape is used for resizing.</p> required <p>Returns:</p> Type Description <p>numpy.ndarray | None: Float mask array in the range [0, 1], or None if the mask could not be loaded.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_mask(mask_file_name, target_image):\n    \"\"\"\n    Load a grayscale mask image and resize it to match a target image.\n\n    The mask is loaded from ``ALLSKY_OVERLAY/images/&lt;mask_file_name&gt;`` and\n    converted to a float mask in the range [0, 1]. If the mask dimensions do\n    not match the target image, it is resized accordingly.\n\n    Args:\n        mask_file_name (str):\n            Name of the mask file to load.\n        target_image (numpy.ndarray):\n            Target image whose shape is used for resizing.\n\n    Returns:\n        numpy.ndarray | None:\n            Float mask array in the range [0, 1], or None if the mask could\n            not be loaded.\n    \"\"\"\n    import cv2\n    mask = None\n\n    mask_path = os.path.join(ALLSKY_OVERLAY, 'images', mask_file_name)\n    target_shape = target_image.shape[:2]\n\n    mask = cv2.imread(mask_path, cv2.IMREAD_GRAYSCALE)\n    if mask is not None:\n        if (mask.shape[0] != target_shape[0]) or (mask.shape[1] != target_shape[1]):\n            mask = cv2.resize(mask, (target_shape[1], target_shape[0]))\n        mask = mask.astype(np.float32) / 255.0\n\n    return mask\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.load_secrets_file","title":"<code>load_secrets_file()</code>","text":"<p>Load environment-style secrets from <code>env.json</code> in the Allsky home directory.</p> <p>Any JSON decoding errors are treated as an empty file.</p> <p>Returns:</p> Name Type Description <code>dict</code> <code>Dict[str, Any]</code> <p>Parsed secrets dictionary, or an empty dict if missing/invalid.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def load_secrets_file() -&gt; Dict[str, Any]:\n    \"\"\"\n    Load environment-style secrets from ``env.json`` in the Allsky home directory.\n\n    Any JSON decoding errors are treated as an empty file.\n\n    Returns:\n        dict:\n            Parsed secrets dictionary, or an empty dict if missing/invalid.\n    \"\"\"\n    file_path = Path(os.path.join(ALLSKYPATH, 'env.json'))\n    env_data: Dict[str, Any] = {}\n    if file_path.is_file():\n        with file_path.open(\"r\", encoding=\"utf-8\") as f:\n            try:\n                env_data = json.load(f) or {}\n            except json.JSONDecodeError:\n                env_data = {}\n\n    return env_data\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.log","title":"<code>log(level, text, preventNewline=False, exitCode=None, sendToAllsky=False)</code>","text":"<p>Very simple method to log data if in verbose mode</p> <p>Log a message to stdout (depending on log level) and optionally forward it to the Allsky WebUI.</p> <p>Parameters:</p> Name Type Description Default <code>level</code> <p>Numeric log level. The message is printed if the global <code>LOGLEVEL</code> is greater than or equal to this value. Level 0 is treated as an error.</p> required <code>text</code> <p>The message to log.</p> required <code>preventNewline</code> <p>If True, the message is printed without a trailing newline.</p> <code>False</code> <code>exitCode</code> <p>If not None, the process exits with this code after logging the message.</p> <code>None</code> <code>sendToAllsky</code> <p>If True, the message is also passed to the Allsky WebUI via <code>addMessage.sh</code>. Level 0 messages are always sent as errors.</p> <code>False</code> Notes <p>The function does not raise exceptions. If the WebUI message script fails, the error is silently ignored.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def log(level, text, preventNewline = False, exitCode=None, sendToAllsky=False):\n    \"\"\" Very simple method to log data if in verbose mode\n\n    Log a message to stdout (depending on log level) and optionally\n    forward it to the Allsky WebUI.\n\n    Args:\n        level:\n            Numeric log level. The message is printed if the global\n            ``LOGLEVEL`` is greater than or equal to this value. Level 0\n            is treated as an error.\n        text:\n            The message to log.\n        preventNewline:\n            If True, the message is printed without a trailing newline.\n        exitCode:\n            If not None, the process exits with this code after logging\n            the message.\n        sendToAllsky:\n            If True, the message is also passed to the Allsky WebUI via\n            ``addMessage.sh``. Level 0 messages are always sent as\n            errors.\n\n    Notes:\n        The function does not raise exceptions. If the WebUI message\n        script fails, the error is silently ignored.\n    \"\"\"\n    global LOGLEVEL, ALLSKY_SCRIPTS\n\n    if LOGLEVEL &gt;= level:\n        if preventNewline:\n            print(text, end=\"\")\n        else:\n            print(text)\n\n    if sendToAllsky or level == 0:\n        if level == 0:\n            type = \"error\"\n        else:\n            type = \"warning\"\n        # Need to escape single quotes in {text}.\n        doubleQuote = '\"'\n        text = text.replace(\"'\", f\"'{doubleQuote}'{doubleQuote}'\")\n        command = os.path.join(ALLSKY_SCRIPTS, f\"addMessage.sh --type {type} --msg '{text}'\")\n        os.system(command)\n\n    if exitCode is not None:\n        sys.exit(exitCode)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.mask_image","title":"<code>mask_image(image, mask_file_name='', log_info=False)</code>","text":"<p>Apply a mask to an image, returning a masked copy.</p> <p>The mask is loaded via :func:<code>load_mask</code> and applied either directly (for grayscale images) or per-channel (for colour images). The result is clipped and converted back to <code>uint8</code>.</p> <p>Parameters:</p> Name Type Description Default <code>image</code> <code>ndarray</code> <p>Input image (grayscale or BGR).</p> required <code>mask_file_name</code> <code>str</code> <p>Name of the mask image file. If empty, no masking is performed and None is returned.</p> <code>''</code> <code>log_info</code> <code>bool</code> <p>If True, log a message at level 4 when a mask is applied.</p> <code>False</code> <p>Returns:</p> Type Description <p>numpy.ndarray | None: Masked image, or None if no mask is applied or an error occurs.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def mask_image(image, mask_file_name='', log_info=False):\n    \"\"\"\n    Apply a mask to an image, returning a masked copy.\n\n    The mask is loaded via :func:`load_mask` and applied either directly\n    (for grayscale images) or per-channel (for colour images). The result\n    is clipped and converted back to ``uint8``.\n\n    Args:\n        image (numpy.ndarray):\n            Input image (grayscale or BGR).\n        mask_file_name (str, optional):\n            Name of the mask image file. If empty, no masking is performed\n            and None is returned.\n        log_info (bool, optional):\n            If True, log a message at level 4 when a mask is applied.\n\n    Returns:\n        numpy.ndarray | None:\n            Masked image, or None if no mask is applied or an error occurs.\n    \"\"\"\n    output = None\n    try:\n        if mask_file_name != '':\n            mask = load_mask(mask_file_name, image)\n            if len(image.shape) == 2:\n                image = image.astype(np.float32)\n                output = image * mask\n            else:\n                image = image.astype(np.float32)\n                if mask.ndim == 2:\n                    mask = mask[..., np.newaxis]\n                output = image * mask\n\n            output = np.clip(output, 0, 255).astype(np.uint8)\n\n            if log_info:\n                log(4, f'INFO: Mask {mask_file_name} applied')\n\n    except Exception as e:\n        me = os.path.basename(__file__)\n        eType, eObject, eTraceback = sys.exc_info()\n        log(0, f'ERROR: mask_image failed on line {eTraceback.tb_lineno} in {me} - {e}')\n\n    return output\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.normalise_on_off","title":"<code>normalise_on_off(value)</code>","text":"<p>Normalise an on/off style value to the strings <code>\"on\"</code> or <code>\"off\"</code>.</p> <p>Parameters:</p> Name Type Description Default <code>value</code> <code>Any</code> <p>Raw value (e.g. <code>\"on\"</code>, <code>\"1\"</code>, <code>\"off\"</code>, <code>0</code>).</p> required <p>Returns:</p> Name Type Description <code>str</code> <p><code>\"on\"</code> if the input looks like an enabled value, otherwise <code>\"off\"</code>.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def normalise_on_off(value):\n    \"\"\"\n    Normalise an on/off style value to the strings ``\"on\"`` or ``\"off\"``.\n\n    Args:\n        value (Any):\n            Raw value (e.g. ``\"on\"``, ``\"1\"``, ``\"off\"``, ``0``).\n\n    Returns:\n        str:\n            ``\"on\"`` if the input looks like an enabled value, otherwise ``\"off\"``.\n    \"\"\"\n    if str(value).strip().lower() == 'on' or str(value).strip() == '1':\n        return 'on'\n    return 'off'\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.obfuscate_password","title":"<code>obfuscate_password(password)</code>","text":"<p>Obfuscate a password, leaving the first and last characters visible.</p> <p>This is used when logging configuration without exposing full credentials.</p> <p>Parameters:</p> Name Type Description Default <code>password</code> <code>str</code> <p>Original password string.</p> required <p>Returns:</p> Type Description <code>str</code> <p>Obfuscated password. Very short passwords are completely masked.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def obfuscate_password(password: str) -&gt; str:\n    \"\"\"\n    Obfuscate a password, leaving the first and last characters visible.\n\n    This is used when logging configuration without exposing full\n    credentials.\n\n    Args:\n        password: Original password string.\n\n    Returns:\n        Obfuscated password. Very short passwords are completely masked.\n    \"\"\"\n    if not password:\n        return \"\"\n    if len(password) &lt;= 2:\n        return \"*\" * len(password)\n    return password[0] + \"*\" * (len(password) - 2) + password[-1]\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.read_environment_variable","title":"<code>read_environment_variable(name)</code>","text":"<p>Read an environment variable without any Allsky-specific fallback.</p> <p>This is a very thin wrapper around <code>os.environ</code> access and does not attempt to pull values from <code>variables.json</code> or any debug store.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <p>Environment variable name.</p> required <p>Returns:</p> Type Description <p>The value as a string, or None if the variable is not defined.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def read_environment_variable(name):\n    \"\"\"\n    Read an environment variable without any Allsky-specific fallback.\n\n    This is a very thin wrapper around ``os.environ`` access and does not\n    attempt to pull values from ``variables.json`` or any debug store.\n\n    Args:\n        name: Environment variable name.\n\n    Returns:\n        The value as a string, or None if the variable is not defined.\n    \"\"\"\n    result = None\n    try:\n        result = os.environ[name]\n    except KeyError:\n        result = None        \n\n    return result\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.read_gpio_pin","title":"<code>read_gpio_pin(gpio_pin, pi=None, show_errors=False)</code>","text":"<p>Read the logical state of a GPIO pin via the Allsky HTTP API.</p> <p>A GET request is sent to the Allsky API, and the returned JSON is expected to contain a <code>\"value\"</code> field with the string <code>\"on\"</code> or <code>\"off\"</code>.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder for compatibility with other GPIO interfaces.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; errors are propagated via exceptions.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>bool</code> <p>True if the GPIO value is <code>\"on\"</code>, False otherwise.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def read_gpio_pin(gpio_pin, pi=None, show_errors=False):\n    \"\"\"\n    Read the logical state of a GPIO pin via the Allsky HTTP API.\n\n    A GET request is sent to the Allsky API, and the returned JSON is\n    expected to contain a ``\"value\"`` field with the string ``\"on\"`` or\n    ``\"off\"``.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        pi (Any, optional):\n            Unused placeholder for compatibility with other GPIO interfaces.\n        show_errors (bool, optional):\n            Currently unused; errors are propagated via exceptions.\n\n    Returns:\n        bool:\n            True if the GPIO value is ``\"on\"``, False otherwise.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    response = requests.get(\n        f'{api_url}/gpio/digital/{gpio_pin}',\n        timeout=2\n    )\n    response.raise_for_status()\n    data = response.json()\n\n    return data.get('value') == 'on'\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.run_python_script","title":"<code>run_python_script(script, args=None, cwd=None)</code>","text":"<p>Run a Python script using the same interpreter as the current process (e.g., inside a venv).</p> <p>This function ensures the target script is executed with the current Python interpreter (<code>sys.executable</code>), so that packages installed in the active virtual environment are available.</p> <p>Parameters:</p> Name Type Description Default <code>script</code> <code>str</code> <p>Path to the Python script to execute.</p> required <code>args</code> <code>Optional[List[str]]</code> <p>Additional arguments to pass to the script. Defaults to None.</p> <code>None</code> <code>cwd</code> <code>Optional[str]</code> <p>Working directory in which to run the script. If None, uses the current directory.</p> <code>None</code> <p>Returns:</p> Type Description <code>Tuple[int, str]</code> <p>Tuple[int, str]: A tuple containing: - return code (int): The process's exit code, or 127 if the script is not found. - output (str): Combined standard output and standard error from the script, stripped of trailing whitespace.</p> Example <p>code, output = run_python_script(\"myscript.py\", [\"--option\", \"value\"]) print(code, output) 0 Script ran successfully</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def run_python_script(script: str, args: Optional[List[str]] = None, cwd: Optional[str] = None) -&gt; Tuple[int, str]:\n    \"\"\"\n    Run a Python script using the same interpreter as the current process (e.g., inside a venv).\n\n    This function ensures the target script is executed with the current Python interpreter\n    (`sys.executable`), so that packages installed in the active virtual environment are available.\n\n    Args:\n        script (str): Path to the Python script to execute.\n        args (Optional[List[str]]): Additional arguments to pass to the script. Defaults to None.\n        cwd (Optional[str]): Working directory in which to run the script. If None, uses the current directory.\n\n    Returns:\n        Tuple[int, str]: A tuple containing:\n            - return code (int): The process's exit code, or 127 if the script is not found.\n            - output (str): Combined standard output and standard error from the script, stripped of trailing whitespace.\n\n    Example:\n        &gt;&gt;&gt; code, output = run_python_script(\"myscript.py\", [\"--option\", \"value\"])\n        &gt;&gt;&gt; print(code, output)\n        0 Script ran successfully\n    \"\"\"\n    args = args or []\n    try:\n        proc = subprocess.run(\n            [sys.executable, script, *args],\n            capture_output=True,\n            text=True,\n            check=False,\n            cwd=cwd,\n        )\n        output = (proc.stdout or \"\") + (proc.stderr or \"\")\n        return proc.returncode, output.strip()\n    except FileNotFoundError:\n        return 127, f\"Script not found: {script}\"\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.run_script","title":"<code>run_script(script)</code>","text":"<p>Run an arbitrary executable script and capture its output.</p> <p>Parameters:</p> Name Type Description Default <code>script</code> <code>str</code> <p>Path to the script or binary to execute.</p> required <p>Returns:</p> Type Description <code>int</code> <p>Tuple <code>(returncode, output)</code> where:</p> <code>str</code> <ul> <li><code>returncode</code> is the process exit code, or 127 if the script was not found.</li> </ul> <code>Tuple[int, str]</code> <ul> <li><code>output</code> is the combined stdout and stderr as a single string.</li> </ul> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def run_script(script: str) -&gt; Tuple[int, str]:\n    \"\"\"\n    Run an arbitrary executable script and capture its output.\n\n    Args:\n        script: Path to the script or binary to execute.\n\n    Returns:\n        Tuple ``(returncode, output)`` where:\n\n        - ``returncode`` is the process exit code, or 127 if the script\n          was not found.\n        - ``output`` is the combined stdout and stderr as a single\n          string.\n    \"\"\"\n    try:\n        result = subprocess.run(\n            [script],\n            capture_output=True,\n            text=True,\n            check=False\n        )\n        output = result.stdout + result.stderr\n        return result.returncode, output.strip()\n    except FileNotFoundError:\n        return 127, f\"Script not found: {script}\"\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.save_extra_data","title":"<code>save_extra_data(file_name='', extra_data={}, source='', structure={}, custom_fields={}, event='postcapture')</code>","text":"<p>Persist \"extra data\" for use by Allsky overlay modules.</p> <p>This function writes the provided data to a file inside the current ALLSKY_EXTRA directory (resolved via <code>get_extra_dir(True)</code>), using a temporary file in ALLSKY_TMP and an atomic move to avoid partial writes. It ensures the destination directory exists and is web-server accessible, applies final permissions, and (optionally) updates a database when the <code>structure</code> indicates one is in use.</p> Behavior <p>1) Ensure extra data directory exists (<code>checkAndCreateDirectory</code>) and    enable web access (<code>create_file_web_server_access</code>). 2) If the target filename ends with <code>.json</code>, normalize/shape the payload    via <code>format_extra_data_json(extra_data, structure, source)</code>. 3) Merge any <code>custom_fields</code> into the payload (overrides existing keys). 4) Serialize to JSON (pretty-printed) and write to a temp file created in    <code>ALLSKY_TMP</code>, then atomically move it to the final path. 5) Set mode 0o770 and call <code>set_permissions()</code> for owner/group alignment. 6) If <code>structure</code> contains a <code>\"database\"</code> key, call <code>update_database()</code>.</p> <p>Parameters:</p> Name Type Description Default <code>file_name</code> <code>str</code> <p>File name (with extension) to write into the extra data directory.</p> <code>''</code> <code>extra_data</code> <code>Any</code> <p>Data to persist. If <code>file_name</code> ends with <code>.json</code>, this should be JSON-serializable. Non-JSON targets are written as the JSON string.</p> <code>{}</code> <code>source</code> <code>str</code> <p>Context or origin tag passed to the JSON formatter. Default: ''.</p> <code>''</code> <code>structure</code> <code>dict</code> <p>Schema/metadata guiding JSON formatting and optional DB updates. If it contains <code>\"database\"</code>, <code>update_database()</code> will be invoked. Default: {}.</p> <code>{}</code> <code>custom_fields</code> <code>dict</code> <p>Extra key/values to inject into the payload before serialization. Keys here override the same keys in <code>extra_data</code>. Default: {}.</p> <code>{}</code> <code>event</code> <code>str</code> <p>Event type (e.g. <code>'postcapture'</code>, <code>'periodic'</code>) used when deciding if database updates should occur.</p> <code>'postcapture'</code> <p>Returns:</p> Type Description <p>None</p> Side Effects <ul> <li>Creates/updates a file in ALLSKY_EXTRA.</li> <li>Applies filesystem permissions to the output file.</li> <li>May perform a database update if requested by <code>structure</code>.</li> </ul> Error Handling <p>Any exception is (currently) allowed to propagate only into the surrounding code; earlier versions logged and swallowed errors.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def save_extra_data(file_name: str = '', extra_data: dict = {}, source: str = '', structure: dict = {}, custom_fields: dict = {}, event: str = 'postcapture'):\n    \"\"\"\n    Persist \"extra data\" for use by Allsky overlay modules.\n\n    This function writes the provided data to a file inside the current\n    ALLSKY_EXTRA directory (resolved via `get_extra_dir(True)`), using a\n    temporary file in ALLSKY_TMP and an atomic move to avoid partial writes.\n    It ensures the destination directory exists and is web-server accessible,\n    applies final permissions, and (optionally) updates a database when the\n    `structure` indicates one is in use.\n\n    Behavior:\n      1) Ensure extra data directory exists (`checkAndCreateDirectory`) and\n         enable web access (`create_file_web_server_access`).\n      2) If the target filename ends with `.json`, normalize/shape the payload\n         via `format_extra_data_json(extra_data, structure, source)`.\n      3) Merge any `custom_fields` into the payload (overrides existing keys).\n      4) Serialize to JSON (pretty-printed) and write to a temp file created in\n         `ALLSKY_TMP`, then atomically move it to the final path.\n      5) Set mode 0o770 and call `set_permissions()` for owner/group alignment.\n      6) If `structure` contains a `\"database\"` key, call `update_database()`.\n\n    Args:\n        file_name (str):\n            File name (with extension) to write into the extra data directory.\n        extra_data (Any):\n            Data to persist. If `file_name` ends with `.json`, this should be\n            JSON-serializable. Non-JSON targets are written as the JSON string.\n        source (str, optional):\n            Context or origin tag passed to the JSON formatter. Default: ''.\n        structure (dict, optional):\n            Schema/metadata guiding JSON formatting and optional DB updates.\n            If it contains `\"database\"`, `update_database()` will be invoked.\n            Default: {}.\n        custom_fields (dict, optional):\n            Extra key/values to inject into the payload before serialization.\n            Keys here override the same keys in `extra_data`. Default: {}.\n        event (str, optional):\n            Event type (e.g. ``'postcapture'``, ``'periodic'``) used when\n            deciding if database updates should occur.\n\n    Returns:\n        None\n\n    Side Effects:\n        - Creates/updates a file in ALLSKY_EXTRA.\n        - Applies filesystem permissions to the output file.\n        - May perform a database update if requested by `structure`.\n\n    Error Handling:\n        Any exception is (currently) allowed to propagate only into the\n        surrounding code; earlier versions logged and swallowed errors.\n    \"\"\"\n    saveExtraData(file_name, extra_data, source, structure, custom_fields, event)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.save_json_file","title":"<code>save_json_file(data, filename)</code>","text":"<p>Save a dictionary to a JSON file with pretty formatting.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>dict</code> <p>Dictionary to save. Must be JSON-serializable.</p> required <code>filename</code> <code>Union[str, Path]</code> <p>Path or string of the file to write.</p> required <p>Returns:</p> Type Description <code>None</code> <p>True if the file could be written successfully, False otherwise.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def save_json_file(data: dict, filename: Union[str, Path]) -&gt; None:\n    \"\"\"\n    Save a dictionary to a JSON file with pretty formatting.\n\n    Args:\n        data: Dictionary to save. Must be JSON-serializable.\n        filename: Path or string of the file to write.\n\n    Returns:\n        True if the file could be written successfully, False otherwise.\n    \"\"\"\n    file_path = Path(filename)\n\n    try:\n        with file_path.open('w', encoding='utf-8') as file:\n            json.dump(data, file, ensure_ascii=False, indent=4)\n    except:\n        return False\n\n    return True\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.set_gpio_pin","title":"<code>set_gpio_pin(gpio_pin, state, pi=None, show_errors=False)</code>","text":"<p>Set the logical state of a GPIO pin via the Allsky HTTP API.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>state</code> <code>Any</code> <p>Desired state; normalised using :func:<code>normalise_on_off</code> to <code>\"on\"</code> or <code>\"off\"</code>.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder for compatibility with other GPIO interfaces.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; errors are propagated via exceptions.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON response from the API.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def set_gpio_pin(gpio_pin, state, pi=None, show_errors=False):\n    \"\"\"\n    Set the logical state of a GPIO pin via the Allsky HTTP API.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        state (Any):\n            Desired state; normalised using :func:`normalise_on_off` to\n            ``\"on\"`` or ``\"off\"``.\n        pi (Any, optional):\n            Unused placeholder for compatibility with other GPIO interfaces.\n        show_errors (bool, optional):\n            Currently unused; errors are propagated via exceptions.\n\n    Returns:\n        dict:\n            Parsed JSON response from the API.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    state = normalise_on_off(state)\n    response = requests.post(\n        f'{api_url}/gpio/digital',\n        json={\n            'pin': str(gpio_pin),\n            'state': state.lower()\n        },\n        timeout=2\n    )\n    response.raise_for_status()\n    return response.json()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.set_last_run","title":"<code>set_last_run(module)</code>","text":"<p>Helper to record that a module has just run.</p> <p>This function simply calls the legacy :func:<code>setLastRun</code>. New code should use this name; the camelCase variant is kept for older code.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def set_last_run(module):\n    \"\"\"\n    Helper to record that a module has just run.\n\n    This function simply calls the legacy :func:`setLastRun`. New code\n    should use this name; the camelCase variant is kept for older code.\n    \"\"\"\n    setLastRun(module)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.set_pwm","title":"<code>set_pwm(gpio_pin, duty_cycle, pi=None, show_errors=False)</code>","text":"<p>Set PWM output on a GPIO pin via the Allsky HTTP API.</p> <p>This helper posts the requested duty cycle (and a fixed frequency of 1000Hz) to the API.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <code>duty_cycle</code> <code>int | float</code> <p>Duty cycle value; interpreted by the remote API.</p> required <code>pi</code> <code>Any</code> <p>Unused placeholder for compatibility with other GPIO interfaces.</p> <code>None</code> <code>show_errors</code> <code>bool</code> <p>Currently unused; errors are propagated via exceptions.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON response from the API.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def set_pwm(gpio_pin, duty_cycle, pi=None, show_errors=False):\n    \"\"\"\n    Set PWM output on a GPIO pin via the Allsky HTTP API.\n\n    This helper posts the requested duty cycle (and a fixed frequency of\n    1000Hz) to the API.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n        duty_cycle (int | float):\n            Duty cycle value; interpreted by the remote API.\n        pi (Any, optional):\n            Unused placeholder for compatibility with other GPIO interfaces.\n        show_errors (bool, optional):\n            Currently unused; errors are propagated via exceptions.\n\n    Returns:\n        dict:\n            Parsed JSON response from the API.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    frequency = 1000\n    response = requests.post(\n        f'{api_url}/gpio/pwm',\n        json={\n            'pin': str(gpio_pin),\n            'duty': duty_cycle,\n            'frequency': frequency\n        },\n        timeout=2\n    )\n    response.raise_for_status()\n    return response.json()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.should_run","title":"<code>should_run(module, period)</code>","text":"<p>Helper to check whether a module should run again.</p> <p>This wrapper simply calls the legacy :func:<code>shouldRun</code>. New code should use this snake_case name; the camelCase version is retained for backwards compatibility.</p> <p>See :func:<code>shouldRun</code> for details.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def should_run(module, period):\n    \"\"\"\n    Helper to check whether a module should run again.\n\n    This wrapper simply calls the legacy :func:`shouldRun`. New code\n    should use this snake_case name; the camelCase version is retained\n    for backwards compatibility.\n\n    See :func:`shouldRun` for details.\n    \"\"\"\n    return shouldRun(module, period)\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.stop_pwm","title":"<code>stop_pwm(gpio_pin)</code>","text":"<p>Stop PWM output on a GPIO pin via the Allsky HTTP API.</p> <p>This is implemented by sending a PWM request with 0% duty cycle.</p> <p>Parameters:</p> Name Type Description Default <code>gpio_pin</code> <code>int | str</code> <p>Pin identifier understood by the Allsky API.</p> required <p>Returns:</p> Name Type Description <code>dict</code> <p>Parsed JSON response from the API.</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If the HTTP request fails (via <code>raise_for_status</code>).</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def stop_pwm(gpio_pin):\n    \"\"\"\n    Stop PWM output on a GPIO pin via the Allsky HTTP API.\n\n    This is implemented by sending a PWM request with 0% duty cycle.\n\n    Args:\n        gpio_pin (int | str):\n            Pin identifier understood by the Allsky API.\n\n    Returns:\n        dict:\n            Parsed JSON response from the API.\n\n    Raises:\n        requests.HTTPError:\n            If the HTTP request fails (via ``raise_for_status``).\n    \"\"\"\n    api_url = get_api_url()\n    frequency = 1000\n    duty_cycle = 0\n    response = requests.post(\n        f'{api_url}/gpio/pwm',\n        json={\n            'pin': str(gpio_pin),\n            'duty': duty_cycle,\n            'frequency': frequency\n        },\n        timeout=2\n    )\n    response.raise_for_status()\n    return response.json()\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.to_bool","title":"<code>to_bool(v)</code>","text":"<p>Normalise a value to a boolean, supporting several truthy strings.</p> <p>This version differs slightly from the earlier :func:<code>to_bool</code> in this file: it treats <code>\"true\"</code>, <code>\"1\"</code>, <code>\"yes\"</code> and <code>\"y\"</code> (case- insensitive) as True, and everything else as False. It is used when normalising configuration dictionaries.</p> <p>Parameters:</p> Name Type Description Default <code>v</code> <code>bool | str | None</code> <p>Input value.</p> required <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>Normalised boolean value.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def to_bool(v: bool | str) -&gt; bool:\n    \"\"\"\n    Normalise a value to a boolean, supporting several truthy strings.\n\n    This version differs slightly from the earlier :func:`to_bool` in this\n    file: it treats ``\"true\"``, ``\"1\"``, ``\"yes\"`` and ``\"y\"`` (case-\n    insensitive) as True, and everything else as False. It is used when\n    normalising configuration dictionaries.\n\n    Args:\n        v (bool | str | None):\n            Input value.\n\n    Returns:\n        bool:\n            Normalised boolean value.\n    \"\"\"\n    if isinstance(v, bool):\n        return v\n    if v is None:\n        return False\n    return str(v).strip().lower() in (\"true\", \"1\", \"yes\", \"y\")\n</code></pre>"},{"location":"allsky_shared.html#scripts.modules.allsky_shared.update_setting","title":"<code>update_setting(values)</code>","text":"<p>Helper to update one or more settings.</p> <p>This wraps the legacy :func:<code>updateSetting</code>. New code should use this snake_case name.</p> Source code in <code>scripts/modules/allsky_shared.py</code> <pre><code>def update_setting(values):\n    \"\"\"\n    Helper to update one or more settings.\n\n    This wraps the legacy :func:`updateSetting`. New code should use\n    this snake_case name.\n    \"\"\"\n    updateSetting(values)\n</code></pre>"},{"location":"tags.html","title":"Tags","text":""},{"location":"tags.html#tags","title":"Tags","text":"<p>Browse documentation by topic.</p>"},{"location":"tags.html#tag:api-required","title":"API Required","text":"<ul> <li>            ADSB          </li> <li>            Dew Heater          </li> <li>            Discord          </li> <li>            Environment          </li> <li>            MQTT Subscribe          </li> <li>            Open Weather Map          </li> <li>            Publish Data          </li> </ul>"},{"location":"tags.html#tag:core-module","title":"Core Module","text":"<ul> <li>            Clear Sky          </li> <li>            Export          </li> <li>            Exposure Rect          </li> <li>            Histogram          </li> <li>            Intermediate Image          </li> <li>            Load Image          </li> <li>            Mask Image          </li> <li>            Meteor Count          </li> <li>            Overlay          </li> <li>            Pi Status          </li> <li>            Save Image          </li> <li>            Star Count          </li> </ul>"},{"location":"tags.html#tag:experimental","title":"Experimental","text":"<ul> <li>            Sky Quality          </li> </ul>"},{"location":"tags.html#tag:extra-module","title":"Extra Module","text":"<ul> <li>            ADSB          </li> <li>            Air Quality          </li> <li>            Border          </li> <li>            Detect Rain          </li> <li>            Dew Heater          </li> <li>            Discord          </li> <li>            Environment          </li> <li>            Fans          </li> <li>            GPIO          </li> <li>            GPS          </li> <li>            Hard Disk Temp          </li> <li>            Image Tuning          </li> <li>            JSON Import          </li> <li>            Light Meter          </li> <li>            Lightning          </li> <li>            MLX90640          </li> <li>            MQTT Subscribe          </li> <li>            Open Weather Map          </li> <li>            Power          </li> <li>            Publish Data          </li> <li>            Round Displays          </li> <li>            Run Script          </li> <li>            Sky Quality          </li> <li>            Solar System          </li> </ul>"},{"location":"tags.html#tag:hardware-required","title":"Hardware Required","text":"<ul> <li>            Air Quality          </li> <li>            Detect Rain          </li> <li>            Dew Heater          </li> <li>            Environment          </li> <li>            Fans          </li> <li>            GPS          </li> <li>            Hard Disk Temp          </li> <li>            Light Meter          </li> <li>            Lightning          </li> <li>            MLX90640          </li> <li>            Power          </li> <li>            Round Displays          </li> </ul>"},{"location":"tags.html#tag:image-adjustments","title":"Image Adjustments","text":"<ul> <li>            Border          </li> </ul>"},{"location":"tags.html#tag:overlay-data","title":"Overlay Data","text":"<ul> <li>            ADSB          </li> <li>            Detect Rain          </li> <li>            Dew Heater          </li> <li>            Environment          </li> <li>            Sky Quality          </li> <li>            Solar System          </li> </ul>"},{"location":"tags.html#tag:pipeline-day","title":"Pipeline Day","text":"<ul> <li>            ADSB          </li> <li>            Air Quality          </li> <li>            Border          </li> <li>            Detect Rain          </li> <li>            Dew Heater          </li> <li>            Discord          </li> <li>            Environment          </li> <li>            Export          </li> <li>            Exposure Rect          </li> <li>            Fans          </li> <li>            GPIO          </li> <li>            Hard Disk Temp          </li> <li>            Histogram          </li> <li>            Image Tuning          </li> <li>            Intermediate Image          </li> <li>            JSON Import          </li> <li>            Light Meter          </li> <li>            Lightning          </li> <li>            Load Image          </li> <li>            MLX90640          </li> <li>            MQTT Subscribe          </li> <li>            Mask Image          </li> <li>            Open Weather Map          </li> <li>            Overlay          </li> <li>            Pi Status          </li> <li>            Power          </li> <li>            Publish Data          </li> <li>            Round Displays          </li> <li>            Run Script          </li> <li>            Save Image          </li> </ul>"},{"location":"tags.html#tag:pipeline-daytonight","title":"Pipeline DayToNight","text":"<ul> <li>            GPIO          </li> </ul>"},{"location":"tags.html#tag:pipeline-night","title":"Pipeline Night","text":"<ul> <li>            ADSB          </li> <li>            Air Quality          </li> <li>            Border          </li> <li>            Clear Sky          </li> <li>            Detect Rain          </li> <li>            Dew Heater          </li> <li>            Discord          </li> <li>            Environment          </li> <li>            Export          </li> <li>            Exposure Rect          </li> <li>            Fans          </li> <li>            Hard Disk Temp          </li> <li>            Histogram          </li> <li>            Image Tuning          </li> <li>            Intermediate Image          </li> <li>            JSON Import          </li> <li>            Light Meter          </li> <li>            Lightning          </li> <li>            Load Image          </li> <li>            MLX90640          </li> <li>            MQTT Subscribe          </li> <li>            Mask Image          </li> <li>            Meteor Count          </li> <li>            Open Weather Map          </li> <li>            Overlay          </li> <li>            Pi Status          </li> <li>            Power          </li> <li>            Publish Data          </li> <li>            Round Displays          </li> <li>            Run Script          </li> <li>            Save Image          </li> <li>            Sky Quality          </li> <li>            Star Count          </li> </ul>"},{"location":"tags.html#tag:pipeline-nighttoday","title":"Pipeline NightToDay","text":"<ul> <li>            GPIO          </li> </ul>"},{"location":"tags.html#tag:pipeline-periodic","title":"Pipeline Periodic","text":"<ul> <li>            ADSB          </li> <li>            Air Quality          </li> <li>            Detect Rain          </li> <li>            Dew Heater          </li> <li>            Discord          </li> <li>            Environment          </li> <li>            Fans          </li> <li>            GPS          </li> <li>            Hard Disk Temp          </li> <li>            JSON Import          </li> <li>            Light Meter          </li> <li>            Lightning          </li> <li>            MLX90640          </li> <li>            MQTT Subscribe          </li> <li>            Open Weather Map          </li> <li>            Pi Status          </li> <li>            Power          </li> <li>            Publish Data          </li> <li>            Run Script          </li> <li>            Solar System          </li> </ul>"},{"location":"allsky_guide/3d.html","title":"3d Printables","text":"<p>A variety of sources containing 3d printable parts for Allsky cameras.</p> <p>The links below are all provided 'as is'. Please ensure that you do all of the relevant research before building a camera based upon these links</p> <ul> <li> <p> AllskyKamera</p> <p>Complete parts list and files for printing and building a camera</p> <p>Website</p> </li> <li> <p> printables.com</p> <p>Links to 3d files on Printables</p> <p>Website</p> </li> <li> <p> yeggi.com</p> <p>Links to 3d files on Yeggi</p> <p>Website</p> </li> </ul>"},{"location":"allsky_guide/allsky.html","title":"Allsky","text":"<p>Before you install</p> <p>Your camera must be connected to the Pi prior to installation. If you have an RPi camera, run the following to make sure the camera can be seen by Allsky:</p> <p><code>rpicam-still --list-cameras</code></p> <p>If camera number 0 (the first camera) is in the list, you're good to go. Note that some non-Raspberry Pi brand cameras may need special software installed and/or operating system configuration changes - read the camera manual.</p>"},{"location":"allsky_guide/allsky.html#before-installing","title":"Before installing","text":"<p>The following needs to be done prior to installing Allsky the first time on your Pi:</p> <ul> <li>If this is a new Pi, you'll need to install the Raspberry Pi Operating System (OS)   on it. We recommend installing the Desktop version of Pi OS.</li> <li>Make sure your Pi has a working Internet connection  . Use a wired LAN connection if possible - it's faster and more reliable than a Wi-Fi connection. If you use Power over Ethernet (PoE)   you can run a single ethernet cable to your Pi.</li> <li>Ensure git is installed: <code>sudo apt-get install git</code></li> </ul>"},{"location":"allsky_guide/allsky.html#if-allsky-is-installed","title":"If Allsky is installed","text":"<p>If Allsky already exists on your Pi, stop it:</p> <pre><code>sudo systemctl stop allsky\ncd\n</code></pre> <p>then perform one of these steps:</p> <ul> <li> <p>To upgrade the old version and keep its settings: <code>mv  allsky  allsky-OLD</code>   During installation you will be asked if you want to use the settings from allsky-OLD. Nothing is lost with this option.</p> </li> <li> <p>To archive the old version but not use it: <code>mv  allsky  allsky-SAVED</code> Nothing is lost with this option but after installation you'll need to re-enter all your settings and the new version won't have any of your prior images, timelapses, etc. At some point you'll want to delete the allsky-SAVED directory to free up its disk space.</p> </li> <li> <p>To delete the old version - only select this option if you're sure you don't want any saved images, darks, and configuration settings: <code>rm  -fr  allsky</code> Everything is lost with this option so after installation you'll need to re-enter all your settings.</p> </li> </ul>"},{"location":"allsky_guide/allsky.html#installing-allsky","title":"Installing Allsky","text":"<p>Get the Allsky software and put it in ~/allsky. Except for some system files, all Allsky-related files reside in this directory.</p> <pre><code>cd\ngit clone  --depth=1  --recursive  https://github.com/AllskyTeam/allsky.git\n</code></pre> <p>This may take a minute and should produce output similar to what's below. The new allsky directory is approximately 150 MB after download.</p> <pre><code>Cloning into 'allsky'...\nremote: Enumerating objects: 891, done.\n...  more commands here\nReceiving objects: 100% (891/891), 46.25 MiB | 17.82 MiB/s, done.\nResolving deltas: 100% (100/100), done.\nSubmodule 'src/sunwait-src' (https://github.com/risacher/sunwait) registered for ...\nCloning into '/home/pi/allsky/src/sunwait-src'...\nremote: Enumerating objects: 119, done.\n...  more commands here\nSubmodule path 'src/sunwait-src': checked out '151d8340a748a4dac7752ebcd38983b2887f5f0c'\n</code></pre> <p>Now install Allsky:</p> <p><code>cd allsky ./install.sh</code></p> <p>The installation may prompt for several items (accepting the defaults is recommended). Upgrades produce fewer prompts.</p> <ul> <li>If the host name has never been changed you are asked to enter a new name - the default is <code>allsky</code>. If you have more than one Pi on the same network they must all have unique names. For example, if you have a test Pi you may want to call it allsky-test.</li> <li>The Locale to use. This determines what the decimal separator is in log output (period or comma). Note that the default locale is <code>en_GB.UTF-8</code> where the Pi is developed.</li> <li>Adding swap space if needed. This effectively increases the amount of memory your Pi has. Insufficient swap space is one of the leading causes of timelapse video creations problems.</li> <li>Putting the ~/allsky/tmp directory in memory instead of on the disk. This directory holds temporary Allsky files and is where most Allsky files are initially written to. Putting the directory in memory significantly reduces the number of writes to the SD card, which increases its life.</li> <li>New installations will prompt for the Latitude and Longitude to use. In most cases values based on your network's location will be displayed as defaults.</li> <li>If a reboot is needed you are asked if the Pi should be rebooted when installation completes. If you answer \"no\", note that Allsky will not start until the Pi is rebooted. The installation will notify you of any actions you need to take when the installation completes. If there are any such actions, the WebUI will display a message reminding you of those actions. Clear the message(s) when done performing the actions.</li> </ul> <p>Instalation time</p> <p>The installation may take up to an hour, depending on how many package you already have installed and the speed of your Pi. Subsequent installations of Allsky will be significantly faster.</p>"},{"location":"allsky_guide/allsky.html#post-installation","title":"Post installation","text":"<p>After installation, reboot if told to, then perform any actions the identified during installation. Allsky will not begin until you do the following:</p> <ul> <li>Bring up the WebUI by entering <code>http://allsky.local</code> or <code>http://allsky.localhost</code> in a web browser. The default username is admin and the default password is secret.</li> </ul> <p>Remote Access</p> <p>If your Pi is accessible via the Internet, change the username and password via the Change Password link on the WebUI.</p> <ul> <li>Go to the <code>Allsky Settings</code> page.</li> <li>If there's a message saying you need to configure Allsky or review the settings, do that now.</li> <li>Click on the blue button. It may look like Save Changes, or Configuration Done; Start Allsky, or something similar. Allsky will start.</li> </ul>"},{"location":"allsky_guide/allsky.html#starting-and-stopping-allsky","title":"Starting and stopping Allsky","text":"<p>Allsky starts automatically when the Raspberry Pi boots up. To enable or disable this behavior, run:</p> <pre><code>sudo systemctl enable allsky     # starts Allsky when the Pi boots up\n</code></pre> <p>#   OR</p> <pre><code>sudo systemctl disable allsky    # does NOT automatically start Allsky\n</code></pre> <p>When you want to manually start, stop, or restart Allsky, or obtain status, use one of these commands:</p> <pre><code>sudo systemctl start allsky\nsudo systemctl stop allsky\nsudo systemctl restart allsky    # a restart is the same as a stop then start\nsudo systemctl status allsky\n</code></pre> <p>TIP</p> <p>Add lines like the following to ~/.bashrc to save typing: <code>alias start='sudo systemctl start allsky'</code> You then only need to type start to start Allsky. Do this for the other commands as well.</p>"},{"location":"allsky_guide/allsky.html#troubleshooting","title":"Troubleshooting","text":"<p>Starting Allsky from the terminal is a great way to track down issues as it provides debug information to the terminal window. To start Allsky manually, run:</p> <pre><code>sudo systemctl stop allsky\ncd ~/allsky\n./allsky.sh\n</code></pre> <p>If you are using a desktop environment (Pixel, Mate, LXDE, etc.) or using remote desktop or VNC, you can add the --preview argument to show the images the program is currently saving in a separate window:</p> <pre><code>./allsky.sh --preview\n</code></pre>"},{"location":"allsky_guide/alternatives.html","title":"Alternatives","text":"SoftwareHardwareComplete Solutions <ul> <li> <p> indi-allsky</p> <ul> <li>Licence: Open Source (Free)</li> <li>Platform: Linux</li> <li>Status: Active</li> <li>Site: View Here</li> </ul> </li> <li> <p> AllSkEye</p> <ul> <li>Licence: Free,  Commercial option</li> <li>Platform: Windows</li> <li>Status: Active          </li> <li>Status: View Here</li> </ul> </li> <li> <p> Meteotux Pi</p> <ul> <li>Licence: Free also has commercial option</li> <li>Platform: Windows</li> <li>Status: Dead </li> <li>Status: View Here</li> </ul> </li> <li> <p> frankAllSkyCam</p> <ul> <li>Licence: Open Source (Free)</li> <li>Platform: Linux, Single board computer</li> <li>Status: Active </li> <li>Status: View Here</li> </ul> </li> <li> <p> RPi Meteor Station</p> <ul> <li>Licence: Open Source (Free)</li> <li>Platform: Linux, Single board computer</li> <li>Status: Active </li> <li>Status: View Here</li> </ul> </li> <li> <p> UFOCapture</p> <ul> <li>Licence: Trial, Shareware</li> <li>Platform: Windows</li> <li>Status: Active </li> <li>Status: View Here</li> </ul> </li> </ul> <ul> <li> <p> Altair Astro</p> <p>Provide enclosures for a variety of cameras</p> <p>The Altair Sentinus Allsky Dome Housing has been designed from the ground up and tested over a two year period by several Allsky enthusiasts to ensure durability and flexibility. There have been no less than 6 iterations of the product to refine the design.</p> <p>The Sentinus enclosure is rainproof and can be opened and closed without any tools due to the innovative design.</p> <p>Website</p> </li> <li> <p> Allsky Optics</p> <p>Provides a variety of hardware for building Allsky Cameras</p> <p>Website</p> </li> <li> <p> Dew Control</p> <p>Provides a variety of hardware for building Allsky Cameras</p> <p>Website</p> </li> <li> <p> Titan Astro</p> <p>Provides a variety of hardware for building Allsky Cameras including Hats for the PI 4 and 5 to manage sensors and focus motors</p> <p>Website</p> </li> <li> <p> Deep Sky Dad</p> <p>Provides an enclosure for you to add your own camera and Pi to</p> <p>Website</p> </li> </ul> <ul> <li> <p> Deep Sky Dad</p> <p>Provides a complete Allsky camera solution</p> <p>Website</p> </li> <li> <p> Oculus</p> <p>Provides a complete Allsky camera solution</p> <p>Website</p> </li> </ul>"},{"location":"allsky_guide/changelog.html","title":"ChangeLog","text":"<p>This page lists the major changes to all Allsky releases. You can also see the Known Issues and Limitations of the current release.</p>"},{"location":"allsky_guide/changelog.html#v2025xxxx","title":"v2025.xx.xx","text":"v2025.xx.xx"},{"location":"allsky_guide/changelog.html#changes-that-may-require-action-upgrades-only","title":"Changes that may require action (upgrades only)","text":"<p>Warning</p> <p>The changes in this section may require settings changes; after upgrading, check that your settings and images look right.</p> <ul> <li>The Buster operating system is no longer supported.</li> <li>The \"legacy\" overlay method and the Image Overlay Settings section of the WebUI no longer exist. All overlays are now done via the Overlay Editor in the WebUI.</li> <li>If your camera is very noisy it may create dark frames that are brighter than the new Dark Frame Upper Threshold value, which is <code>0.05</code>. This threshold was <code>0.10</code> in the prior release.</li> <li>The AS_TEMPERATURE_C and AS_TEMPERATURE_F values (sensor temperature) now have 1 digit after the decimal point. This may require you to change the format of those variables in the Overlay Editor.</li> </ul>"},{"location":"allsky_guide/changelog.html#enhancements-changes","title":"Enhancements / Changes","text":"<ul> <li> <ul> <li>Several menu items are now grouped together; putting your cursor over them or clicking on them shows a list of choices.   For example, the Settings group contains Allsky Settings and Editor.</li> </ul> <p>WebUI changes:</p> <ul> <li> <p>Improved Login System</p> <ul> <li>The old login system has been removed and a new version implemented</li> <li>Existing login details are not affected</li> <li>Only used if WebUI login is enabled</li> <li>Provides stronger passwords if the Pi will be exposed to the internet</li> </ul> </li> <li> <p>New Database</p> <ul> <li>Stores information on every image taken (exposure, day/night, etc.)</li> <li>Modules can add derived data such as star and meteor counts</li> <li>Makes it easier to filter images (e.g. only nighttime startrails)</li> <li>Choice of zero-configuration internal DB or advanced configuration</li> </ul> </li> <li> <p>Images page</p> <ul> <li>Shows the image icon only if at least one image exists for the day</li> <li>Timelapse and mini-timelapse icons have been updated</li> <li>Days with no images, startrails, keograms, or timelapses are no longer shown</li> <li>Directories in the <code>images</code> directory starting with <code>test</code> are now displayed</li> <li>Image, timelapse, keogram, and startrail icons are now aligned with the Delete button</li> </ul> </li> <li> <p>You can now view the mini-timelapse (if it exists) from the top of the Live View page</p> </li> <li> <p>Overlay Editor</p> <ul> <li>Enhanced Variable Manager for easier variable handling</li> <li>Introduced Blocks for adding related fields in one step</li> <li>New, more flexible variable formatting system</li> <li>Fields can be grouped and moved together</li> <li>New alignment tools:<ul> <li>Left alignment</li> <li>Equal vertical spacing</li> <li>Equal horizontal alignment</li> </ul> </li> <li>Rectangles can now be drawn with configurable border and background colours</li> <li>Solar calculations moved to the new Solar System module</li> <li>Font Manager now auto-detects fonts in use</li> <li>Mask Editor<ul> <li>Create and edit masks directly in the WebUI</li> <li>Accessible from the Image Manager</li> <li>Masks can be reused by other modules (e.g. star count, meteor detection)</li> </ul> </li> </ul> </li> <li> <p>Module Manager</p> <ul> <li>UI now dynamically adapts to selected devices</li> <li>Search and filter modules by type</li> <li>New configuration field types:<ul> <li>Secret</li> <li>I\u00b2C Input</li> <li>1-Wire Input</li> <li>AJAX Select</li> <li>GPIO</li> <li>Image</li> <li>Variable</li> <li>Position</li> <li>URL</li> <li>Host</li> <li>Graph</li> </ul> </li> <li>Refactored module system for easier development</li> <li>New module installer (no git clone required)</li> <li>Modules are automatically upgraded</li> <li>New Device Manager for connected hardware</li> <li>Modules moved into the main Allsky directory tree</li> <li> <p>New / Updated Modules</p> <ul> <li>ADSB</li> <li>AI (deprecated)</li> <li>Dew Heater (PWM support; sensor data moving to Environment module)</li> <li>Fans</li> <li>GPIO (fixed)</li> <li>Boilerplate</li> <li>INA3221 (deprecated)</li> <li>Keogram</li> <li>LTR390 (deprecated)</li> <li>PMSX003</li> <li>Power</li> <li>Rain Detector (YOLO-based, by Muchen Han)</li> <li>Solar System</li> <li>Environment</li> <li>TPHBME680 (deprecated)</li> <li>S3 Upload (Titan Astro)</li> </ul> </li> <li> <p>For Developers</p> <ul> <li>Class-based module architecture (backward compatible)</li> <li>Reusable blocks and charts</li> <li>Overlay and chart helper functions</li> <li>Expanded metadata support:<ul> <li>Conditional fields</li> <li>Advanced DB control</li> <li>Overlay data exposure</li> <li>Install/uninstall hooks</li> </ul> </li> </ul> </li> </ul> </li> <li> <p>Charts</p> <ul> <li>Create and manage charts for camera, hardware, and analysis data</li> <li>Supports predefined and custom charts</li> <li>Tab grouping and date-range selection</li> <li>Auto-refresh support</li> <li>Chart types:<ul> <li>Line, Spline, Area</li> <li>Column, Bar</li> <li>3D Column, 3D Area</li> <li>Gauge</li> <li>Yes/No</li> </ul> </li> </ul> </li> <li> <p>System page</p> <ul> <li>Auto refresh</li> <li>Watchdog service control</li> </ul> </li> <li> <p>Helper Tools</p> <ul> <li>Check Allsky \u2014 runs <code>checkAllsky.sh</code></li> <li>Startrails \u2014 brightness threshold tuning</li> <li>Image Stretch \u2014 stretch comparison</li> <li>Timelapse \u2014 bitrate and FPS tuning</li> </ul> </li> <li> <p>Left-hand menu can now collapse to icon-only mode</p> </li> </ul> </li> <li> <p>Startrails</p> <ul> <li><code>generateForDay.sh</code> now accepts a file list</li> <li><code>allsky-config get_startrails_info</code> shows brightness thresholds used</li> </ul> </li> <li> <p>Camera images now save to <code>~/allsky/tmp/current_images</code>   and Live View reads from there.   The website <code>imageName</code> is now <code>/current/image.jpg</code>.</p> </li> <li> <p><code>generateForDay.sh</code> accepts additional arguments for keogram,   startrails, and timelapse creation.</p> </li> <li> <p><code>allsky-config bad_images_info --show_bad_images</code>   helps tune Remove Bad Images Threshold values.</p> </li> <li> <p>Updated to ZWO SDK v1.39 (new camera support, 366MC Pro removed)</p> </li> <li>Improved security for internet-connected Allsky cameras</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes","title":"Bug Fixes","text":"<ul> <li>Fixed missing thumbnails on days with thousands of images</li> <li>Fixed notification images not uploading to remote servers</li> <li>Fixed Allsky Map update failures with improved error reporting</li> </ul>"},{"location":"allsky_guide/changelog.html#deleted-settings","title":"Deleted Settings","text":"<ul> <li>Image Overlay Settings removed from Allsky Settings   For ZWO cameras, Show Histogram Box is now handled by the   ZWO Exposure Box module.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings","title":"New Settings","text":"<ul> <li>Focus Mode \u2014 temporarily optimizes capture speed for focusing</li> <li>Dark Frame Upper Threshold</li> <li>Remove Bad Images Threshold Count</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206","title":"v2024.12.06","text":"v2024.12.06"},{"location":"allsky_guide/changelog.html#v20241206_06","title":"v2024.12.06_06","text":"v2024.12.06_06 - Point Release # 6"},{"location":"allsky_guide/changelog.html#important-notes","title":"IMPORTANT NOTES:","text":"<ul> <li>This is the LAST major release that supports Buster.</li> <li>This is the LAST major release that contains the \"legacy\" overlay method.</li> </ul>"},{"location":"allsky_guide/changelog.html#enhancements-changes_1","title":"Enhancements / Changes","text":"<ul> <li>When 4 consecutive errors occur while capturing images with an RPi camera, the last error is now shown in the WebUI's \"System Messages\" section.</li> <li>The <code>allsky-config get_brightness_info</code> command now outputs the number of images used and not used in the startrails.</li> <li>Added a Troubleshooting Tools documentation page to list tools to aid in troubleshooting.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_1","title":"Bug Fixes","text":"<ul> <li>Fixed an issue where downloading the support log from the Getting Support page would hang the page.</li> <li>Fixed a couple issues with WebUI \"System Messages\":<ol> <li>Some messages were displayed hundreds or thousands of times rather than being displayed once with a number of occurrences greater than 1.</li> <li>A message was truncated when unable to download the <code>de421.bsp</code> file.</li> </ol> </li> <li>Fixed an issue with updates to the Allsky Map server failing because multiple double quotes were in a field.</li> <li>Fixed a rare situation where the Module Manager will fail to display any modules due to corruption in a module's metaData.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_1","title":"New Settings","text":"<ul> <li>None</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206_05","title":"v2024.12.06_05","text":"v2024.12.06_05 - Point Release # 5"},{"location":"allsky_guide/changelog.html#changes-that-may-require-action-upgrades-only_1","title":"Changes that may require action (upgrades only)","text":"<p>Warning</p> <p>The changes in this section may require settings changes; after upgrading, check that your settings and images look right.</p> <ul> <li>If your Keogram Font Color contained three numbers you'll need to reverse the order of the numbers.   This setting previously accepted two formats:<ol> <li><code>blue_number green_number red_number</code> (with spaces or commas separating the numbers) where each number is from <code>0</code> to <code>255</code>.</li> <li><code>#RRGGBB</code> where each two-digit pair goes from hex <code>00</code> to <code>ff</code>.</li> </ol> </li> </ul> <p>To be consistent with the hex order and with web pages, the order of the first format is now:   <code>red_number green_number blue_number</code> (red and blue switched places).   The order of the second format did not change but it now accepts either 3 or 6 hex digits.   See the documentation for more details on this setting.</p>"},{"location":"allsky_guide/changelog.html#enhancements-changes_2","title":"Enhancements / Changes","text":"<ul> <li>The <code>allsky-config get_brightness_info</code> command now displays how many images were used, and not used, in each startrail image.   This is useful when setting the Brightness Threshold.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_2","title":"Bug Fixes","text":"<ul> <li>For RPi cameras, the length of time Allsky waits before timing out an image was increased.   For some Pi's, the prior 30-second timeout was too short when the Pi was extremely busy such as during timelapse creation.</li> <li>Entering a Locale in the WebUI that is not installed on the Pi displays an error message and lists the locales that ARE installed and tells the user how to install other locales.</li> <li>Mono cameras were calculating the mean image brightness twice: once prior to the initial save of the image and a second time when determining if the image was too dark or too bright.   The second time used a different formula than the first time.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_2","title":"New Settings","text":"<ul> <li>None</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206_04","title":"v2024.12.06_04","text":"v2024.12.06_04 - Point Release # 4"},{"location":"allsky_guide/changelog.html#changes-that-may-require-action-upgrades-only_2","title":"Changes that may require action (upgrades only)","text":"<p>Warning</p> <p>The changes in this section may require settings changes; after upgrading, check that your settings and images look right.</p> <ul> <li>If your Keogram Font Color contained three numbers you'll need to reverse the order of the numbers.   This setting previously accepted two formats:<ol> <li><code>blue_number green_number red_number</code> (with spaces or commas separating the numbers) where each number is from <code>0</code> to <code>255</code>.</li> <li><code>#RRGGBB</code> where each two-digit pair goes from hex <code>00</code> to <code>ff</code>.</li> </ol> </li> </ul> <p>To be consistent with the hex order and with web pages, the order of the first format is now:   <code>red_number green_number blue_number</code> (red and blue switched places).   The order of the second format did not change but it now accepts either 3 or 6 hex digits.   See the documentation for more details on this setting.</p>"},{"location":"allsky_guide/changelog.html#enhancements-changes_3","title":"Enhancements / Changes","text":"<ul> <li>The <code>allsky-config get_brightness_info</code> command now displays how many images were used, and not used, in each startrails image.   This is useful when setting the Brightness Threshold.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_3","title":"Bug Fixes","text":"<ul> <li>For RPi cameras, the length of time Allsky waits before timing out an image was increased.   For some Pi's, the prior 30-second timeout was too short when the Pi was extremely busy such as during timelapse creation.</li> <li>Entering a Locale in the WebUI that is not installed on the Pi displays an error message and lists the locales that ARE installed and tells the user how to install other locales.</li> <li>Mono cameras were calculating the mean image brightness twice: once prior to the initial save of the image and a second time when determining if the image was too dark or too bright.   The second time used a different formula than the first time.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_3","title":"New Settings","text":"<ul> <li>None</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206_5","title":"v2024.12.06_04","text":"v2024.12.06_04 - Point Release # 4"},{"location":"allsky_guide/changelog.html#enhancements-changes_4","title":"Enhancements / Changes","text":"<ul> <li>When upgrading from a recent version from Allsky you'll likely just need to restart Allsky without having to review the settings.   The installation script will tell you what to do.</li> <li>In addition to the WebUI telling you when a new Allsky version is available, an optional note about the new version will be displayed, such as   \"Contains an important security update; please install\".</li> <li>The Allsky \"Status:\" on the top of the WebUI now updates automatically every few seconds.</li> <li>The System WebUI page now appears very quickly and some of the data is automatically updated every few seconds.   Usage of <code>~/allsky/tmp</code> is now displayed.   The \"Refresh\" button is no longer needed so was removed.</li> <li>The Editor WebUI page will display a message in the unlikely event that the file is corrupted.</li> <li>RPi cameras sometimes hang while taking pictures. This used to hang Allsky, but it now times out instead.</li> <li>When RPi cameras are unable to take an image, an error message from the camera is added to the log file.   Previously the error message was written to a temporary file that was overwritten every exposure, thereby losing prior messages.</li> <li>A message is added to the WebUI if creation of a timelapse, startrails, or keogram fails during end-of-night processing.</li> <li>If the Keograms Font Color begins with a 0 and does not have 6 characters after it (e.g. <code>#fff</code>),   an error message is displayed in the WebUI.   Those values didn't produce the color expected (e.g. <code>#fff</code> produced blue labels, not white).</li> <li>The name of the Pi is shown at the top of the WebUI. This is useful for people with multiple Pi's.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_4","title":"Bug Fixes","text":"<ul> <li>The Getting Support WebUI page (and the related <code>support.sh</code> command) no longer fail with an \"Argument list too long\" message.   They also provide more information to aid in troubleshooting.</li> <li>Setting a target temperature for cooled ZWO cameras now works.</li> <li><code>install.sh</code> no longer corrupts the Website configuration file when adding meteor fields.</li> <li><code>remoteWebsiteInstall.sh</code> now handles servers that don't return anything under certain circumstances.</li> <li>Permission denied errors from <code>moduleutil.php</code> when it tried to overwrite files ending in <code>-last</code> have been fixed.</li> <li>The Allsky Website now correctly colors aurora forecasts.</li> <li><code>upload.sh</code> no longer finds files that don't exist.</li> <li>During installation, the amount of RAM for non-Raspberry Pi boards is now determined correctly.   This is used to size swap space and populate the Computer setting.</li> </ul>"},{"location":"allsky_guide/changelog.html#deleted-settings_1","title":"Deleted Settings","text":"<ul> <li>Notification Images   Notification images (e.g. \"Allsky is starting up\") provide valuable status and troubleshooting information so can no longer be disabled.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_4","title":"New Settings","text":"<ul> <li>None</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206_03","title":"v2024.12.06_03","text":"v2024.12.06_03 - Point Release # 3"},{"location":"allsky_guide/changelog.html#enhancements-changes_5","title":"Enhancements / Changes","text":"<ul> <li>RPi cameras that report sensor temperature now support dark frames.   The TEMPERATURE_C and TEMPERATURE_F variables can be displayed in overlays for these cameras.</li> </ul> <p>??? \"Supported RPi cameras\"</p> <pre><code>  - RPi cameras that report sensor temperature and support dark frames:\n      - HQ\n      - Module 3\n      - Arducam 16 MP\n  - These cameras do not support darks:\n      - Version 1\n      - imx290 60.00 fps\n      - Arducam 64 MP\n      - Arducam 462\n      - Waveshare imx219-d160\n      - Arducam 64 MB Owlsight\n      - OneInchEye IMX283\n</code></pre> <ul> <li>Dark frames are now saved as <code>.png</code> files for better quality.</li> </ul> <p>If you have any <code>.jpg</code> darks in <code>~/allsky/darks</code> we suggest re-doing your darks then removing the old <code>.jpg</code> darks.</p>"},{"location":"allsky_guide/changelog.html#bug-fixes_5","title":"Bug Fixes","text":"<ul> <li>MOON variables work in the Overlay Editor (<code>de421.bsp</code> downloads correctly).</li> <li>All the \"Click here to ...\" messages in the WebUI now work.</li> <li>Using <code>analyticsTracking.js</code> in an Allsky Website now works.</li> <li>An issue with adding images in overlays was fixed.</li> <li>The <code>remoteWebsiteInstall.sh</code> command now works if the Image Directory setting is empty.</li> <li>Duplicate System Messages now have the correct count of the number of times the problem occurred.</li> </ul>"},{"location":"allsky_guide/changelog.html#deleted-settings_2","title":"Deleted Settings","text":"<ul> <li>Camera and Computer   These values are automatically set during installation so no longer need to be prompted for.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_5","title":"New Settings","text":"<ul> <li>Equipment Info   Optional setting to add information about your equipment (e.g. NoIR camera).   This appears on any Allsky Website you have.</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206_02","title":"v2024.12.06_02","text":"v2024.12.06_02 - Point Release # 2"},{"location":"allsky_guide/changelog.html#enhancements-changes_6","title":"Enhancements / Changes","text":"<ul> <li>The WebUI will now notify you when a new Allsky version is available.</li> <li><code>remoteWebsiteInstall.sh</code> does a better job explaining failures and fixes.</li> <li> <p>Additions to the <code>allsky-config</code> command:</p> <ul> <li>If you see a Multiple consecutive bad images message, run <code>allsky-config bad_images_info</code> to get suggestions.</li> <li>If a Website has trouble reading <code>data.json</code>, run <code>allsky-config check_post_data</code>.</li> <li><code>allsky-config move_images</code> is more robust and can move images back to <code>~/allsky/images</code>.</li> </ul> </li> <li> <p>If a Website is stuck on \"Loading ...\" because it can't find the current image, you\u2019ll get a message telling you how to fix it.</p> </li> <li>Several Website files are now in subdirectories (e.g. <code>css</code>). No user action needed.</li> <li>You can now have custom notification images:   create <code>~/allsky/config/myFiles/notificationImages</code> and place files matching the names in <code>~/allsky/notificationImages</code>.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_6","title":"Bug Fixes","text":"<ul> <li>The problem with <code>de421.bsp</code> is fixed.</li> <li>Timelapse thumbnails now have the correct name.</li> <li>A security issue was fixed.</li> <li>Installing/upgrading is less likely to hang when there's a problem with an RPi camera.</li> <li>Fixed a typo in the ssl:check-hostname command in <code>testUpload.sh</code>.</li> <li><code>removeBadImages.sh</code> now works with mean values that have a comma in them.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_6","title":"New Settings","text":"<ul> <li>None</li> </ul>"},{"location":"allsky_guide/changelog.html#deleted-settings_3","title":"Deleted Settings","text":"<ul> <li>None</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206_01","title":"v2024.12.06_01","text":"v2024.12.06_01 - Point Release # 1"},{"location":"allsky_guide/changelog.html#enhancements-changes_7","title":"Enhancements / Changes","text":"<ul> <li> <p>You can no longer enter Issues in GitHub (you can still enter Discussions).   Instead, use the Getting Support page in the WebUI to collect info needed to troubleshoot.   No private information is sent; it is kept in <code>~/allsky/env.json</code> and should never be uploaded.</p> </li> <li> <p>The WebUI Editor page now:</p> <ul> <li>Warns you about formatting errors (e.g. missing comma) and prevents saving until fixed.</li> <li>Highlights placeholders like <code>XX_NEED_TO_UPDATE_XX</code>.</li> </ul> </li> <li> <p>The WebUI now displays the status of Allsky (Running, Stopped, etc.).</p> </li> <li>You can specify a location to store images outside <code>~/allsky/images</code> (e.g. SSD) via <code>allsky-config move_images</code>.</li> <li><code>allsky-config get_brightness_info</code> helps tune the Brightness Threshold. See Startrails settings.</li> <li><code>allsky-config compare_paths</code> helps map upload locations to URLs. See Mapping Server Locations to URLs.</li> <li><code>allsky-config</code> can also adjust <code>~/allsky/tmp</code> size and swap; run <code>allsky-config</code> for options.</li> <li>New <code>meteors</code> directory exists in Websites (upload support added in a future release).</li> <li><code>remoteWebsiteInstall.sh</code> now prompts to upload startrails/keograms/timelapse and is more robust.</li> <li>Websites now show a detailed message when they can't find the image.</li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_7","title":"New Settings","text":"<ul> <li>None</li> </ul>"},{"location":"allsky_guide/changelog.html#deleted-settings_4","title":"Deleted Settings","text":"<ul> <li>Remote naming overrides were removed:   Remote Video File Name, Remote Keogram File Name, Remote Startrails File Name   were deleted from the Remote Website section.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_7","title":"Bug Fixes","text":"<ul> <li>Website icon sorting by date now works.</li> <li><code>remoteWebsiteInstall.sh</code> no longer fails if you have commands in the FTP Commands setting.</li> <li>Image resize setting changes are now saved.</li> <li><code>allsky.sh --help</code> now works and displays capture options.</li> <li>Many others including with modules and overlays.</li> </ul>"},{"location":"allsky_guide/changelog.html#v20241206-base-release","title":"v2024.12.06 - Base Release","text":"v2024.12.06 - Base Release"},{"location":"allsky_guide/changelog.html#changes-that-may-require-action-upgrades-only_3","title":"Changes that may require action (upgrades only)","text":"<p>Warning</p> <p>The changes in this section may require settings changes; after upgrading, check that your settings and images look right.</p> <ul> <li> <p>The <code>config.sh</code> and <code>ftp-settings.sh</code> files are gone \u2014 their settings are now in the WebUI. Possible action: The upgrade should migrate your prior settings unless you have a very old version.</p> </li> <li> <p>The CROP settings have been simplified to pixels from top/right/bottom/left. Possible action: If you used crop, the upgrade will tell you to re-enter values.</p> </li> <li> <p>Remove Bad Images Thresholds are now 0.0\u20131.0 (instead of 0\u2013100). Possible action: Upgrade should convert values, but verify.</p> </li> <li> <p>Mean brightness is now used to determine too bright/too dark (matches auto-exposure). Possible action: You may need to adjust Remove Bad Images Thresholds.</p> </li> <li> <p>(ZWO only) Mean brightness is now 0.0\u20131.0 (was 0\u2013255). Possible action: If MEAN is on your overlay, adjust formatting.</p> </li> <li> <p>WebUI now hides settings within sections unless that section has an error.   Click the chevron-down icon to expand. Possible action: Expect an adjustment period.</p> </li> <li> <p><code>check_allsky.sh</code> is now <code>checkAllsky.sh</code>. Possible action: None.</p> </li> </ul>"},{"location":"allsky_guide/changelog.html#enhancements-changes_8","title":"Enhancements / Changes","text":"<ul> <li>Local Website setup is now trivial: enable Use Local Website and optionally set Days To Keep on Pi Website.</li> <li>Remote Website setup is easier: only specify the top-level Image Directory.</li> <li>Remote install is easier using <code>remoteWebsiteInstall.sh</code> (uploads files and removes old ones).</li> <li>Images/videos/keograms/startrails can be written to a remote server in addition to (or instead of) a remote Website.</li> <li>New <code>allsky-config</code> command (similar to <code>raspi-config</code>); run it to see options.</li> <li><code>allsky-config samba</code> helps mount <code>~/allsky</code> on a PC/Mac. See Copy files to / from a Pi.</li> <li><code>testUpload.sh</code> uploads a test file and attempts to explain failures and fixes.</li> <li>Allsky only restarts when needed; tooltips indicate what will happen after changing settings.</li> <li>Overlay Method <code>module</code> is now default for new installs; <code>legacy</code> will be removed in the next major release.</li> <li>Multiple ZWO cameras (and on Pi 5 multiple RPi cameras) are supported; install shows all attached cameras.</li> <li>If you swap cameras without telling Allsky, it won\u2019t start and will tell you what to do.</li> <li>Unsupported cameras trigger a message on how to proceed / request support.</li> <li>All ZWO cameras as of September 7, 2024 are supported (library version 1.36).</li> <li>Support for new third-party RPi cameras added.</li> </ul> <p>Run <code>allsky-config show_supported_cameras</code> to see supported cameras. ZWO list is large; check with: <code>allsky-config show_supported_cameras --zwo | grep -i \"CAMERA_NAME\"</code> RPi list: <code>allsky-config show_supported_cameras --rpi</code></p> <ul> <li>LAN Dashboard and WLAN Dashboard now display all network adapters.</li> <li><code>endOfNight_additionalSteps.sh</code> is no longer supported (use the night-to-day module flow).</li> <li>Too-bright dark frames are deleted during capture (e.g. lens not covered).</li> <li> <p>DHCP can be configured via the Configure DHCP page (advanced option).</p> </li> <li> <p>Overlay changes:</p> <ul> <li>Overlay module debugging output is easier to read.</li> <li>Separate daytime and nighttime overlays are supported via the new Overlay Manager in the Overlay Editor.</li> <li>Overlay Editor warns if fields are outside the image and can fix them.   See Ensure overlay fields stay within bounds.</li> <li>Overlay Editor won\u2019t start if images aren\u2019t being captured (prevents using notification image as background).</li> </ul> </li> <li> <p>See Modules Documentation for details on Extra Module changes.</p> </li> <li> <p>New Modules:</p> <ul> <li>Allsky AI \u2014 Detects cloud cover using AI</li> <li>Allsky Fans \u2014 Controls a fan based on CPU temperature</li> <li>Allsky Border \u2014 Expands an image to include additional borders</li> <li>Allsky HDD Temp \u2014 Retrieves hard drive temperatures using SMART</li> <li>Allsky ina3221 \u2014 Current and voltage measurements</li> <li>Allsky influxdb \u2014 Writes data to influxdb</li> <li>Allsky light \u2014 Determines light levels using a TSL2591</li> <li>Allsky LightGraph \u2014 Displays a graph of day and night</li> <li>Allsky ltr390 \u2014 Measures UV levels</li> <li>Allsky mlx90640 \u2014 Captures an IR image of the sky (experimental)</li> <li>Allsky Publish Data \u2014 Publish to Redis, MQTT, or REST</li> <li>Allsky Temp \u2014 Reads up to three temperature sensors and controls a GPIO pin</li> </ul> </li> </ul>"},{"location":"allsky_guide/changelog.html#new-settings_8","title":"New Settings","text":"<ul> <li>Images Sort Order \u2014 sort order for the Images page</li> <li>Show Updated Message \u2014 hides the \u201cDaytime images updated every...\u201d message on Live View</li> <li>Nighttime Capture and Nighttime Save \u2014 nighttime equivalents of daytime settings</li> <li>ZWO Exposure Type \u2014 how images should be taken (see docs)</li> </ul>"},{"location":"allsky_guide/changelog.html#deleted-settings_5","title":"Deleted Settings","text":"<ul> <li>Image Width and Height removed (use crop/resize)</li> <li>Version 0.8 Exposure removed (now part of ZWO Exposure Type)</li> <li>New Exposure Algorithm removed (always used now)</li> <li><code>REMOVE_BAD_IMAGES</code> removed; set Remove Bad Images Thresholds to 0 to disable brightness checks</li> <li>Brightness settings removed; use Target Mean</li> <li>(ZWO only) Offset removed</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_8","title":"Bug Fixes","text":"<ul> <li><code>ASI_ERROR_TIMEOUT</code> messages are mostly gone. Yea!!!</li> <li>ROI editor now uses the correct image name based on settings.   See Ensure the ROI editor uses the correct image.</li> <li>Date formats in the overlay editor now work correctly</li> </ul>"},{"location":"allsky_guide/changelog.html#maintenance","title":"Maintenance","text":"<ul> <li>Setting names are now lowercase and boolean settings use <code>true</code>/<code>false</code> rather than <code>1</code>/<code>0</code>.   No user impact expected.</li> </ul>"},{"location":"allsky_guide/changelog.html#v20230501","title":"v2023.05.01","text":"v2023.05.01"},{"location":"allsky_guide/changelog.html#v20230501_04","title":"v2023.05.01_04","text":"v2023.05.01_04 - Point Release # 4"},{"location":"allsky_guide/changelog.html#enhancements","title":"Enhancements","text":"<ul> <li>Added support for Bookworm, the Pi Operating System released in October 2023.</li> </ul> <p>Support for the Buster Operating System will be removed after the next major Allsky release.</p> <ul> <li>Added support for the Pi 5.</li> <li>Increased suggested amount of swap by 1 GB to help minimize timelapse creation problems.</li> <li>New camera support:<ul> <li>Arducam IMX462 camera (inexpensive 1920\u00d71080 camera)</li> <li>All ZWO cameras as of October 19, 2023 (ZWO SDK 1.32)</li> </ul> </li> <li>The concept of Advanced Options no longer exists \u2014 all settings are always shown.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_9","title":"Bug Fixes","text":"<ul> <li>Uploads of mini-timelapse could fail if an image upload frequency was used.</li> <li>Multiple concurrent timelapse creations now work.</li> <li>Fixed reversed width/height for RPi Version 1 and IMX290 cameras.</li> <li>GCS uploads now correctly use <code>image.jpg</code> instead of <code>image-YYYYMMDDHHMMSS.jpg</code>.</li> <li>GCS uploads now error correctly if <code>gsutil</code> is missing.</li> <li>Camera Model is no longer shown since it cannot be manually changed.   To change cameras, select Refresh in the Camera Model field.</li> <li><code>~/allsky/scripts</code> is now added to <code>PATH</code> (reboot may be required).</li> <li>Documentation clarified setting <code>IMAGE_DIR=${ALLSKY_WEBSITE}</code> for local-only Websites.</li> <li>Images page now only shows icons when at least one file exists.</li> <li>Mean brightness is now calculated correctly for ZWO cameras in RAW16 mode.</li> </ul>"},{"location":"allsky_guide/changelog.html#v20230501_03","title":"v2023.05.01_03","text":"v2023.05.01_03 - Point Release # 3"},{"location":"allsky_guide/changelog.html#enhancements_1","title":"Enhancements","text":"<ul> <li>Added support for RPi Version 1 (ov5647) camera.</li> <li>Added FAQ explaining how to copy files to and from the Pi.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_10","title":"Bug Fixes","text":"<ul> <li><code>AUTO_STRETCH</code> now works.</li> <li>Improved latitude/longitude handling and fixed bugs.</li> <li>Allsky Map no longer updates when \u201cShow on map\u201d is disabled.</li> <li>Nighttime delays on ZWO cameras now work.</li> <li>Fixed missing-file error when installing a remote Website.</li> <li>Corrected default WebUI values for RPi cameras.</li> <li>Overlay Editor fixes:<ul> <li>Moon altitude corrected.</li> <li>Text no longer shifts when content changes.</li> <li>Snap rectangle alignment fixed.</li> <li>Editor works correctly when grid is disabled.</li> <li>Text alignment improved.</li> <li>Missing error for fields outside image dimensions added.</li> <li>Default stroke color fixed.</li> <li>X position no longer resets to 0.</li> <li>Sensor temperature variables hidden for unsupported cameras.</li> <li>Font ZIP handling fixed on macOS.</li> <li>Extra directory processing restricted to <code>.txt</code> and <code>.json</code>.</li> <li>Removed bottom margin.</li> <li>Visual warnings for out-of-bounds fields added.</li> <li>Fixed incorrect planet positions.</li> </ul> </li> </ul>"},{"location":"allsky_guide/changelog.html#v20230501_02","title":"v2023.05.01_02","text":"v2023.05.01_02 - Point Release # 2"},{"location":"allsky_guide/changelog.html#enhancements_2","title":"Enhancements","text":"<ul> <li>Mean Threshold now has separate daytime and nighttime settings.</li> <li>Installer resumes from last step if interrupted.</li> <li>Installer skips unnecessary steps and may skip reboot when possible.</li> <li>(RPi Bullseye only) Sensor temperature display support:<ul> <li>Add <code>--metadata /home/pi/allsky/config/overlay/extra/libcamera.json</code>   to Extra Arguments</li> <li>Add <code>AS_SensorTemperature</code> via the Overlay Editor \u2192 Variable Manager</li> <li>Save and enable the field</li> </ul> </li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_11","title":"Bug Fixes","text":"<ul> <li>Day/night Mean Target values now apply correctly.</li> <li>Keograms, startrails, and timelapse generation at end-of-night fixed.</li> </ul>"},{"location":"allsky_guide/changelog.html#v20230501_01","title":"v2023.05.01_01","text":"v2023.05.01_01 - Point Release # 1"},{"location":"allsky_guide/changelog.html#enhancements_3","title":"Enhancements","text":"<ul> <li>Multiple consecutive bad images now trigger a visible warning image and system message.</li> <li>Editor page buttons are fixed to the top with a quick \u201cTop\u201d button.</li> <li>Camera refresh allows swapping cameras of the same type.</li> <li>Installation speed significantly improved using prebuilt binaries.</li> <li>Camera changes reuse shared settings where appropriate.</li> <li>Hostname prompt only appears if hostname is still default.</li> <li>Startup now verifies camera-specific settings linkage.</li> <li>ZWO only:<ul> <li>New ZWO Experimental Exposure setting for nighttime auto-exposure.</li> <li>Target Mean now configurable for day and night.</li> <li>Mean Threshold now configurable.</li> </ul> </li> <li>All Wi-Fi interfaces are displayed.</li> <li>WebUI now validates numeric fields.</li> </ul>"},{"location":"allsky_guide/changelog.html#bug-fixes_12","title":"Bug Fixes","text":"<ul> <li>Improved bad-image detection defaults (do not disable; tune thresholds instead).</li> <li><code>s3</code> uploads now use <code>image.jpg</code>.</li> <li><code>scp</code> uploads now respect <code>REMOTE_USER</code>.</li> <li>Overlay bounds indicators added when fields move out of bounds.</li> <li>Compilation fixed on i386 platforms.</li> </ul>"},{"location":"allsky_guide/changelog.html#v20230501_1","title":"v2023.05.01","text":"v2023.05.01 - Base Release"},{"location":"allsky_guide/changelog.html#core-allsky","title":"Core Allsky","text":"<ul> <li>New camera support:<ul> <li>All ZWO cameras as of May 1, 2023</li> <li>RPi HQ and Module 3</li> <li>ArduCam 16 &amp; 64 MP</li> <li>Global Shutter Camera not supported</li> </ul> </li> <li>Mini-timelapse videos supported.</li> <li>Installation improvements:<ul> <li>Swap size checks</li> <li>Memory-resident <code>/allsky/tmp</code></li> <li>Migration from <code>~/allsky-OLD</code></li> </ul> </li> <li>Added <code>check_allsky.sh</code> sanity-check script.</li> <li>Latitude/Longitude accept decimal or N/S/E/W formats.</li> <li>Removed obsolete <code>config.sh</code> settings.</li> <li>Added SCP and GCS upload support.</li> <li>Documentation consolidated and expanded.</li> <li>AUTO_STRETCH fully functional.</li> <li>Optional original filename uploads supported.</li> </ul>"},{"location":"allsky_guide/changelog.html#webui","title":"WebUI","text":"<ul> <li>WebUI is now mandatory for configuration.</li> <li>New links:<ul> <li>Overlay Editor</li> <li>Module Manager</li> <li>Allsky Documentation</li> </ul> </li> <li>Validation and defaults corrected.</li> <li>Extensive new settings added (camera type, exposure, overlays, login, focus metrics, etc.).</li> <li>Debug levels standardized.</li> <li>System messages now surface required actions.</li> </ul>"},{"location":"allsky_guide/changelog.html#allsky-website","title":"Allsky Website","text":"<ul> <li>Website installed to <code>~/allsky/html/allsky</code>.</li> <li>Full customization of layout, icons, and appearance.</li> <li>Thumbnail creation now handled on the Pi.</li> <li>Configuration unified into <code>configuration.json</code>.</li> <li>Editor enforces configuration validity for local and remote Websites.</li> </ul>"},{"location":"allsky_guide/changelog.html#v20220301","title":"v2022.03.01","text":"v2022.03.01 <ul> <li>Switched to date-based release names.</li> <li>Added ability to have your allsky camera added to the Allsky Map by configuring:<ul> <li>Allsky Map</li> <li>Map settings   Added an Allsky Map Setup section to the WebUI to configure the map settings.   The Lens field now shows in the popout on the Allsky Website (if installed).</li> </ul> </li> <li>Significantly enhanced Wiki \u2014 more pages and more information, including known issues and fixes/workarounds.</li> <li>Added an option to keograms to make them full width, even if few images were used.   In <code>config.sh</code>, set <code>KEOGRAM_EXTRA_PARAMETERS=\"--image-expand\"</code>.</li> <li>Added/changed/deleted settings (in <code>config.sh</code> unless otherwise noted):<ul> <li>Added <code>WEBUI_DATA_FILES</code> \u2014 one or more files whose contents are shown on the WebUI System page.   See this Wiki page.</li> <li>Renamed <code>NIGHTS_TO_KEEP</code> to <code>DAYS_TO_KEEP</code> since it keeps days, not just nights.   If blank (<code>\"\"</code>), all days are kept.</li> <li>Deleted <code>AUTO_DELETE</code> \u2014 replaced by <code>DAYS_TO_KEEP</code>.   <code>DAYS_TO_KEEP=\"\"</code> is similar to the old <code>AUTO_DELETE=false</code>.</li> <li>Added <code>WEB_DAYS_TO_KEEP</code> \u2014 how many days of Allsky Website images/videos to keep when hosted on the Pi.</li> <li>Added <code>WEB_IMAGE_DIR</code> in <code>ftp-settings.sh</code> \u2014 allows copying images to a local Pi location (often the Website)   as well as to a remote machine (timelapse/startrails/keogram already supported this).</li> </ul> </li> <li>The RPi camera now supports the same text overlay features as ZWO, including the Extra Text file.</li> <li>Removed the harmless \u201cdeprecated pixel format used\u201d message from the timelapse log (it confused people).</li> <li>Improved auto-exposure for RPi cameras.</li> <li>Refactored ZWO and RPi camera code to simplify maintenance and future features.</li> <li>Upload reliability improvements:<ul> <li>If Allsky is stopped/restarted during an upload, the upload continues (fewer temp files left behind).</li> <li>Additional cases where temp files were left on remote servers were reduced.</li> <li>Uploads now do extra error checking to aid debugging.</li> <li>Only one upload runs at a time; additional uploads log a message and exit.</li> </ul> </li> <li>Added <code>--debug</code> option to <code>allsky/scripts/upload.sh</code> to aid upload debugging.</li> <li>Upload log files are now only created on error (reduces SD card writes).</li> <li><code>removeBadImages.sh</code> also only creates a log file on error (saves a write per image).</li> <li>Allsky now stops with an error message on unrecoverable errors (e.g., no camera found), instead of restarting forever.</li> <li>More meaningful on-image messages:<ul> <li>Replaced generic \u201cERROR. See /var/log/allsky.log\u201d with more specific messages   (e.g., \u201c*** ERROR *** Allsky Stopped! ZWO camera not found!\u201d).</li> <li>On restart, shows \u201cAllsky software is restarting\u201d instead of \u201cstopping\u201d then \u201cstarting\u201d.</li> </ul> </li> <li>Timelapse debug output no longer prints a line for each of thousands of images, making real errors easier to spot.</li> <li>WebUI improvements:<ul> <li>Camera Settings page now shows min/max/default values in a popup for numerical fields.</li> </ul> </li> <li>Startrails and Keogram creation no longer crash if invalid files are found.</li> <li>Removed <code>allsky/scripts/filename.sh</code>.</li> <li> <p>RPi WebUI setting Gamma renamed to Saturation (Gamma name was incorrect).</p> </li> <li> <p>Known issues:</p> <ul> <li>Startrails and keogram programs don\u2019t work well if you bin differently during day vs night.   If you don\u2019t save daytime images this won\u2019t be a problem.</li> <li>Min/max/default values shown in the WebUI Camera Settings page (especially RPi) aren\u2019t always correct,   particularly on Bullseye where many settings changed.</li> </ul> </li> </ul>"},{"location":"allsky_guide/changelog.html#08-base-release","title":"0.8 Base Release","text":"0.8 Base Release <ul> <li>Workaround for ZWO daytime auto-exposure bug.</li> <li>Improved exposure transitions between day and night to avoid large brightness jumps.</li> <li>Decrease in ZWO sensor temperature.</li> <li>Many new settings, including splitting some settings into day and night versions.</li> <li>Added error checking and log messages in many areas to aid debugging.</li> <li>Support for notification images, such as \u201cAllsky is starting up\u201d and \u201cTaking dark frames\u201d.</li> <li>Ability to resize uploaded images.</li> <li>Ability to set thumbnail size.</li> <li>Ability to delete bad images (corrupt, too light, or too dark).</li> <li>Ability to set an image file name prefix.</li> <li>Ability to reset the USB bus if a ZWO camera isn\u2019t found (requires the <code>uhubctl</code> command).</li> <li>Ability to specify the format of the time displayed on images.</li> <li>Ability to display temperature in Celsius, Fahrenheit, or both.</li> <li>Ability to set the bitrate on timelapse videos.</li> </ul>"},{"location":"allsky_guide/changelog.html#07","title":"0.7","text":"0.7 <ul> <li>Added Raspberry Pi HQ camera support based on Rob Musquetier\u2019s fork.</li> <li>Added support for x86 architecture (Ubuntu, etc.).</li> <li>Temperature-dependent dark frame library.</li> <li>Added browser-based script editor.</li> <li>Added configuration variables to crop black areas around images.</li> <li>Added timelapse frame-rate setting.</li> <li>Changed default font size.</li> </ul>"},{"location":"allsky_guide/changelog.html#06","title":"0.6","text":"0.6 <ul> <li>Added daytime exposure and auto-exposure capability.</li> <li>Added <code>-maxexposure</code>, <code>-autoexposure</code>, <code>-maxgain</code>, and <code>-autogain</code> options.   Using auto-exposure and auto-gain together may produce unexpected results (black frames).</li> <li>Autostart is now based on systemd and works on all Raspbian-based systems, including headless setups.   Remote control will not start multiple instances.</li> <li>Replaced the <code>nodisplay</code> option with the <code>preview</code> argument.   No preview is shown in autostart mode.</li> <li>When using the WebUI, camera options can be saved without rebooting the Pi.</li> <li>Added a publicly accessible preview to the WebUI: <code>public.php</code>.</li> <li>Changed exposure units to milliseconds instead of microseconds.</li> </ul>"},{"location":"allsky_guide/changelog.html#05","title":"0.5","text":"0.5 <ul> <li>Added Startrails (image stacking) with brightness control.</li> <li>Keogram and Startrails generation is now much faster thanks to a rewrite by Jarno Paananen.</li> </ul>"},{"location":"allsky_guide/changelog.html#04","title":"0.4","text":"0.4 <ul> <li>Added Keograms (a summary of the night in a single image).</li> </ul>"},{"location":"allsky_guide/changelog.html#03","title":"0.3","text":"0.3 <ul> <li>Added dark frame subtraction.</li> </ul>"},{"location":"allsky_guide/changelog.html#02","title":"0.2","text":"0.2 <ul> <li>Separated camera settings from code logic.</li> </ul>"},{"location":"allsky_guide/changelog.html#01","title":"0.1","text":"0.1 <ul> <li>Initial release.</li> </ul>"},{"location":"allsky_guide/faq.html","title":"FAQ","text":""},{"location":"allsky_guide/faq.html#stuck-allsky-software-is-starting-up","title":"Stuck \"Allsky software is starting up\"","text":"<p>Most likely Allsky is dropping all images for being overly dark or overly bright due to inappropriate settings. Check the log to see what it says by running tail -f /var/log/allsky.log in a terminal window.</p> <p>If you are using manual exposure/gain try adjusting those values.</p> <p>If you are using auto exposure/gain, the starting values are what you specified as the manual values, and it may take several exposures for the software to find the best exposure. While it's doing that, you'll see the \"Allsky software is starting up\" message. This is normal. However, if the message remains after several minutes follow the instructions here to report the problem.</p> <p>You can also temporarily set the Remove Bad Images Thresholds to 0 to see what the incorrectly exposed images look like - this might give you an idea of the problem.</p>"},{"location":"allsky_guide/faq.html#my-sd-card-is-getting-full-moving-images","title":"My SD card is getting full/ Moving Images","text":"<p>How do I move my images somewhere else, like to a bigger SSD? If you would like to store more images or other files than will fit on your SD card, you can:</p> <ul> <li> <p>Buy a bigger SD card.</p> <p>This is fairly easy to do and is relatively inexpensive. The disadvantage is that you would still using an SD card, which is not a fast or reliable as other media.</p> <p>If you go with this option, follow the steps on the Imaging a storage device   page.</p> </li> <li> <p>Replace the SD card with a bigger, more reliable drive like an SSD.</p> <p>This option is similar to buying a bigger SD card, but you will be using a faster, more reliable media, potentially with much more disk space. On the other hand, an SSD may not fit in your allsky camera enclosure.</p> <p>If you go with this option, follow the same instructions as above.</p> </li> <li> <p>Add a second disk, such as a USB thumb drive or SSD.</p> <p>This option is probably the easiest one to implement - you won't need to reinstall Linux or any programs. Just follow a couple easy steps:</p> <ul> <li> <p>Make sure your SSD or other media is attached to the Pi and you know how write files there.</p> <ul> <li> <p>How you do that is outside the scope of this Allsky documentation.</p> </li> <li> <p>If you don't know, try searching the Internet for instructions.</p> </li> </ul> </li> <li> <p>Run: <code>allsky-config move_images</code></p> <ul> <li> <p>It will prompt you for the full pathname of where the images should be moved to, for example, /media/SSD/images.</p> </li> <li> <p>We recommend having images as the last part of the location since you may want to store other files on the SSD and don't want them in the same directory as the images.</p> </li> <li> <p>You will also be asked if you want your current images:</p> <ul> <li> <p>Moved to the new location.</p> </li> <li> <p>Copied to the new location.</p> </li> <li> <p>Left in the old location.</p> </li> </ul> <p>In most cases you'll want to move the images.</p> </li> </ul> </li> </ul> </li> </ul> <p>The new location will be maintained during future Allsky upgrades, as long as you tell the installation script you want to use the prior allsky-OLD directory.</p>"},{"location":"allsky_guide/faq.html#why-is-there-is-a-long-delay-between-pictures","title":"Why is there is a long delay between pictures?","text":"<p>The time between when one picture ends and another starts is determined by these settings:</p> <ol> <li> <p>Delay (daytime or nighttime).</p> </li> <li> <p>Max Auto-Exposure (daytime or nighttime), even if you are using manual exposure.</p> </li> <li> <p>Consistent Delays Between Images .</p> </li> </ol> <p>There are two possibilities:</p> <ol> <li> <p>If Consistent Delays Between Images is \"Yes\", then the total delay is always: Delay + Max Auto-Exposure.</p> </li> <li> <p>If Consistent Delays Between Images is \"No\", then the total delay is simply the Delay.</p> </li> </ol> <p>If the time between pictures is longer than you expected, check your Max Auto-Exposure.</p>"},{"location":"allsky_guide/faq.html#reduce-wear-on-my-sd-card","title":"Reduce wear on my SD card?","text":"<p>SD cards have a limited number of writes they can handle before they wear out. Although this is usually a very large number you may want to minimize writes to the SD card by moving the ~/allsky/tmp directory from the SD card into memory.</p> <p>During Allsky installation you were prompted to do this - if you did you can ignore this FAQ item.</p> <p>Pi 5 or newer</p> <p>If you have a Pi 5 or newer you can also replace the SD card with an NVMe SSD disk which is much faster, more reliable, and allows significantly more space than an SD card (but costs more). To do this you'll need to add a board to your Pi (called an NVMe HAT) as well as an NVMe disk. Search for those terms on the Internet to see your options.</p> <p>Before putting <code>~/allsky/tmp</code> into memory note the following:</p> <ul> <li> <p>In order to do this you'll need enough free RAM memory, so this may not work well with systems with very limited memory, for example, 512 MB.</p> </li> <li> <p>The <code>~/allsky/tmp</code> directory and its contents will be erased every time you reboot your Pi. This is ok since that directory is only used for temporary files (hence the same) that are invalid after a reboot.</p> </li> </ul> <p>then execute:</p> <p><code>allsky-config  recheck_tmp</code></p> <p>You should accept the defaults.</p>"},{"location":"allsky_guide/faq.html#how-do-i-focus-my-allsky-camera","title":"How do I focus my allsky camera?","text":"<p>Almost all allsky lenses can focus - either manually (i.e., you focus them) or automatically via a motor on the lens that focuses.</p>"},{"location":"allsky_guide/faq.html#manual-focus-cameras","title":"Manual-focus cameras","text":"<p>Manual-focus lenses have a ring that you turn to change the focus. If your lens does NOT have a focus ring or some other focusing mechanism, it's called a \"fixed focus\" lens and you can skip this FAQ item.</p> <p>Try to get your camera at least roughly focused during the day - it'll be easier to see the focus ring on your lens, and exposure duration will be much shorter so you'll get more instant feedback. Focusing on slow-moving clouds works well.</p> <p>Most lenses have a screw to lock the focus ring - if your's does, loosen the screw. In the WebUI, enable the Focus Mode setting. It will set up Allsky to take and display pictures as fast as possible by disabling all processing except adding the focus metric to each image. The images are not permanetly saved (so won't appear in timelapse) and are not uploaded.</p> <p>Go to the WebUI's Live View page. If you were already on that page, refresh it via SHIFT-F5 so it knows to reload the images very quickly. A focus number will appear on the images - the higher the number, the better focus. The number can change depending on the brightness, so focus when the brightness isn't changing. While looking at the focus number, turn the lens' focus ring a very small amount. If the image and focus number get worse, turn the ring the other way. At some point the image will get worse - that means you've past the best focus, so turn the focus ring in very small increments the other direction.</p> <p>This method is often \"good enough\" but the most accurate (and slowest) way to focus is at night using stars. Zoom in on the image and look for stars that are bright but not saturated. Keep focusing until the stars are as small as possible.</p> <p>When done focusing tighten the focus lock screw Look at the focus metric to make sure it's not worse - if it is, you probably moved the focus ring when tightening it; it's easy to do. In the WebUI, disable Focus Mode.</p>"},{"location":"allsky_guide/faq.html#auto-focus-cameras","title":"Auto-focus cameras","text":"<p>If you have a camera with an auto-focus lens like the RPi Module 3, see the camera documentation   for a description of focus-related settings. You'll use the --lens-position setting to determine where the best focus is. Run the following (which puts the lens at infinity), then as needed, increase the lens position in small increments until you find the best focus:</p> <p><code>libcamera-still --timeout 1 -shutter 5000 --lens-position 0.0</code></p> <p>You will likely need to adjust the shutter speed to get a good exposure (5000 is 5 seconds). Once the camera is focused we suggest disabling auto focus since it adds several seconds to each daytime image while it's finding focus, and adds minutes to nighttime images. To do so, add <code>--lens-position X</code> to the Extra Parameters setting in the WebUI, replacing X with the lens position of best focus.</p>"},{"location":"allsky_guide/faq.html#how-do-i-change-the-icons-on-the-allsky-website","title":"How do I change the icons on the Allsky Website?","text":"<p>The icons on the left side of an Allsky Website page and what happens when you click one are controlled by the leftSidebar setting  . The icon itself is specified via the icon sub-setting. See the Font Awesome   page (version 6.2.1) for other choices. Note that not all icons work so you'll need to try them.</p>"},{"location":"allsky_guide/faq.html#varlogallskylog-file-is-gone","title":"/var/log/allsky.log file is gone.","text":"<p>Do the following in order, stopping when the log file reappears:</p> <ol> <li> <p>Try restarting the software: <code>sudo systemctl restart allsky</code>.</p> </li> <li> <p>Restart the software that controls the log files: sudo systemctl restart syslog.</p> </li> <li> <p>Reboot the Pi.</p> </li> <li> <p>Wait until tomorrow - sometimes the log file mysteriously reappears after midnight. Note this is NOT an Allsky problem since it also happens with other services.</p> </li> </ol>"},{"location":"allsky_guide/glossary.html","title":"Glossary","text":"<ul> <li>Allsky is the main program that captures and saves images and includes the Web User Interface (WebUI) used to administer Allsky and parts of your Pi. You can also:<ul> <li>When a page says \"Allsky Software\" or just \"software\" it's referring to the main Allsky software that's running on your Pi and resides in the ~/allsky directory.</li> </ul> </li> <li>Allsky Website is a simple web interface that can run on your Pi and/or a remote server and displays:<ul> <li>This is often shortened to Website - always with a capital W.</li> <li>A local Allsky Website runs on the same Pi that Allsky runs on.</li> <li>A remote Website runs somewhere else. Allsky doesn't care if the remote machine is a true \"server\" or simply a 10-year old PC sitting under your desk. The Allsky documentation considers both of them a \"remote server\".</li> </ul> </li> <li>WebUI is the Web User Interface used to administer Allsky.</li> <li>Module Code that runs during the image capture and processing pipelines</li> <li>Extra Module Code contributed by both the Allsky team and others that runs during the image cpature and processing pipelines</li> <li>Server A server, as in \"remote server\", is a computer that often sits in a datacenter and has a dedicated purpose such as hosting web pages or returning search results like Google.</li> </ul>"},{"location":"allsky_guide/known_issues.html","title":"Known Issues","text":"<p>This page lists known issues and limitations with the current Allsky release. Workarounds and plans to address the items, if known, are also given.</p>"},{"location":"allsky_guide/known_issues.html#image-capture","title":"Image Capture","text":"<ul> <li> <p>Limitation (ZWO only): When using the default ZWO Exposure Method of Snapshot, Auto Gain and Auto White Balance do not work.</p> <p>Workaround: Auto Gain should normally not be used since it conflicts with the Allsky Auto Exposure algorithm.</p> <p>If you need Auto White Balance, try a different ZWO Exposure Method.</p> <p>Future Plans: None.</p> </li> </ul>"},{"location":"allsky_guide/known_issues.html#overlays","title":"Overlays","text":"<ul> <li> <p>Known Issue: Fonts sometimes change to Glyphicons This just a display problem in the Text Editor; the actual font used is whatever you initially specified.</p> <p>Workaround: None</p> <p>Future Plans: Will fix in next major release.</p> </li> </ul>"},{"location":"allsky_guide/known_issues.html#modules","title":"Modules","text":"<ul> <li> <p>Limitation: Modules can only run once per flow, e.g., once per image, once per day/night transition, etc.</p> <p>Workaround: None</p> <p>Future Plans: Will change in next release.</p> </li> <li> <p>Known Issue: The Overlay Module may be disabled the first time it runs. This is due to the module having to download the JPL ephemeris data which can take some time on a slow Internet connection.     Workaround: Re-enable it in the Module Manager.</p> <p>Future Plans: Will fix in the next release.</p> </li> <li> <p>Known Issue: The \"additional modules\" have been installed but they don't all appear.</p> <p>Workaround: Ensure the \"Show Experimental\" setting is enabled in the Module Manager's settings.</p> <p>Future Plans: Will fix in the next release.</p> </li> </ul>"},{"location":"allsky_guide/known_issues.html#other","title":"Other","text":"<ul> <li> <p>Limitation: If you have three or more cameras connected to a single Pi (very rare except while testing) including at least one RPi and one ZWO, if you switch from the current camera type to the other type which has at least two cameras, which of those cameras is used is undefined. For example, assume you have one ZWO camera and two RPi cameras and the ZWO camera is the current one and you switch to the RPi Camera Type in the WebUI. Which RPi camera becomes current is undefined, and you'll likely see several errors about missing or empty fields.</p> <p>Workaround: Click on the Allsky Settings link to refresh the page.</p> <p>Future Plans: The Camera Type and Camera Model settings will be merged into one setting that contains both items. You will then be able to select exactly which camera to change to, which will eliminate this problem.</p> </li> </ul>"},{"location":"allsky_guide/server.html","title":"Server","text":"<p>This page describes how to prepare a remote server to accept uploads of the current Allsky image as well as startrails, keograms, and timelapse videos.</p> <p>Warning</p> <p>This page is for setting up a remote server, which typically does not run an Allsky Website. If you want to set up a remote Website, click here.</p>"},{"location":"allsky_guide/server.html#why-use-a-remote-server","title":"Why use a remote server?","text":"<p>Since this server does NOT run the Allsky Website software you may wonder why have a remote server. Let's say you have a web page for an observatory that has a description of your equipment as well as some astrophotographs you've taken. If you also want to include the current allsky image as well as last night's timelapse, you'd simply set up your observatory web server to accept pictures from Allsky, then update Allsky to upload the pictures.</p>"},{"location":"allsky_guide/server.html#preparing-the-remote-server","title":"Preparing the remote server","text":"<p>The exact commands you use will depend on your server and/or hosting solution, but at a high level the steps are:</p> <ul> <li>Create the following directories on the server, making sure their names are lowercase and spelled exactly as below:  </li> <li>allsky </li> <li>allsky/videos </li> <li>allsky/videos/thumbnails </li> <li>allsky/startrails </li> <li>allsky/startrails/thumbnails </li> <li>allsky/keograms </li> <li> <p>allsky/keograms/thumbnails </p> </li> <li> <p>Go to the Remote Server Settings section of the WebUI's Allsky Settings page and fill in the settings. See the Allsky Settings   page for a description of the settings.</p> </li> </ul> <p>After enabling the Use Remote Server setting a test file will be uploaded to the server to ensure it works. If there are any problems, visit the Troubleshooting -&gt; Uploads page for details on how to fix the problem.</p>"},{"location":"allsky_guide/website.html","title":"Website","text":"<p>This page describes how to install a new Allsky Website or upgrade an existing Website.</p> <p>An Allsky Website running on your Pi is called a local Website because it is local to your Pi. An Allsky Website running on anywhere else is called a remote Website.</p>"},{"location":"allsky_guide/website.html#local-website","title":"Local Website","text":"<p>The code for a local Website is already on your Pi so getting it to work is easy:</p>"},{"location":"allsky_guide/website.html#new-allsky-installations-or-upgrades-with-no-prior-local-website","title":"New Allsky installations or upgrades with no prior local Website","text":"<p>The new local Website needs to be enabled and configured before it can be used. If you go to the Website prior to that you'll get an error message telling you what to do.</p> <ul> <li>Enable the Website by going to the <code>Allsky Settings</code> page in the WebUI and enabling the Use Local Website setting in the Websites and Remote Server Settings section. This will create a default configuration file you'll use in the next step.</li> <li>Configure the Website in the <code>Editor page</code> in the WebUI by selecting <code>configuration.json (local Allsky Website)</code>. from the drop-down. You will see one or more XX_NEED_TO_UPDATE_XX entries that need changing. Set the remaining entries to your liking.</li> </ul> <p>See the Website Settings  page for a description of the settings.</p>"},{"location":"allsky_guide/website.html#allsky-upgrades-with-an-existing-local-website","title":"Allsky Upgrades with an existing local Website","text":"<p>The Allsky upgrade will use your prior local Website configuration and automatically enable the new Website. Any existing images and videos from the prior Website will be moved to to the new Website. You are done unless the prior Website was version v2022.03.01+ or earlier, in which case you need to:</p> <ul> <li>Manually copy your prior settings from /var/www/html/allsky/config.js to configuration.json by going to the <code>Editor</code> page in the WebUI and selecting <code>configuration.json (local Allsky Website)</code>. Note that there are more settings in the new configuration file, but it should be straightforward to map settings from the old file to the new file.</li> <li>After configuring the local Website, check in /var/www/html/allsky for any files you may have manually added and store them in ~/allsky/html/allsky/myFiles.</li> <li>Save config.js somewhere in case you need it later.</li> <li>Remove the old Website: <code>rm -fr /var/www/html/allsky</code></li> </ul>"},{"location":"allsky_guide/website.html#remote-website","title":"Remote Website","text":"<p>Most people have their Pi on a home network where it's not accessible from the Internet, so they install the Allsky Website on a different machine that is accessible on the Internet.</p> <p>Prior to installing a remote Website, make sure Allsky is working on your Pi. If you will also have a local Website, get it working to your liking before enabling the remote Website so you don't have to update settings in both places.</p> <p>Do the following:</p> <ul> <li>On the remote server:<ul> <li>Create an allsky directory to hold the Website. Keep track of where on your server you created the directory - you will need that information later when you tell Allsky where to upload the images.</li> </ul> </li> <li> <p>On the Pi:</p> <ul> <li>Go to the Websites and Remote Server Settings section in the WebUI's Allsky Settings page. Update the settings in the Remote Website subsection. Do NOT enable Use Remote Website yet, but update the other settings so Allsky knows how to upload a file to the Website. The Website will be automatically enabled in the next step.</li> <li>Run cd ~/allsky; ./remoteWebsiteInstall.sh to upload the Website code and create a default remote configuration file.<ul> <li>The installation will try to upload a file to the server; If that fails it should tell you why. If not, see the Troubleshooting uploads page on how to debug the problem.</li> <li>If you previously enabled the local Allsky Website, the remote configuration file will be identical to the local one with the exception of the imageName setting which will be configured for the remote Website.</li> <li>If you want the remote configuration to differ from the local one (for example, to add a background image to the remote Website), edit the remote configuration file - see the next step.</li> </ul> </li> <li> <p>Configure the remote Website:</p> <ul> <li>In the WebUI, click on the Editor link.</li> <li>In the drop-down at the bottom of the page, select remote_configuration.json (remote Allsky Website).</li> <li>See the Settings -&gt; Allsky Website   page for details on the settings.</li> <li>A copy of the remote Website configuration file will be uploaded to the server.</li> </ul> <p>Warning</p> <p>Whenever you update the remote Website's configuration you must do so via WebUI following the steps above. Do NOT edit the configuration file directly on the remote server.</p> </li> </ul> </li> <li> <p>Your remote server is now ready.</p> </li> <li>Give your family and friends the URL to your Allsky Website so they can enjoy your images!</li> </ul>"},{"location":"allsky_guide/website.html#remote-website-requirements","title":"Remote Website Requirements","text":"<p>The remote server needs to support the following: - PHP version 7 or newer. - The <code>imagecreatefromjpeg</code> function in PHP to create thumbnails of the startrails and keogram files. If that function does not exist (which is rare), you'll see a thumbnail that says \"No thumbnail\". Everything else will still work.  - Optionally, the ffmpeg command and exec function in PHP to create thumbnails of the timelapse videos.</p> <p>Warning</p> <p>Most hosting solutions don't support those commands for security reasons. In that case, make sure Upload Timelapse Thumbnail is enabled (and Upload Mini-Timelapse Thumbnail if you are creating mini timelapses). Failure to set those variables will result in \"No thumbnail\" messages when viewing videos. Everything else will still work.</p>"},{"location":"allsky_guide/website.html#post-installation","title":"Post installation","text":"<p>Change Allsky Website Settings as desired so the Website looks and behaves like you want. Changes to both local Websites and remote Websites are done via the WebUI.</p> <p>Warning</p> <p>If you have both a local and a remote Website, they each have their own configuration file which is accessible via the WebUI's Editor page. They are NOT automatically kept in sync so if you change something, for example, the lens, you'll need to change it in both files.</p>"},{"location":"allsky_guide/hardware/camera.html","title":"Camera Options","text":""},{"location":"allsky_guide/hardware/camera.html#choosing-a-camera","title":"Choosing a Camera","text":"<p>Your budget will often be the driving factor when picking an allsky camera. The Raspberry Pi HQ (RPi HQ) camera is relatively inexpensive and produces good images but can only be used with a Pi. Many people choose ZWO cameras because they are familiar with them or they have a spare one lying around, and they may use their allsky camera for astrophotography as well.</p> <p>Some things to consider:</p> <ul> <li> <p>The RPi HQ is hard to beat unless you plan to also use the camera for astrophotography.</p> </li> <li> <p>Stay away from the ZWO ASI120 camera. Although it is inexpensive it often produces a lot of errors and many people complain about its noise and hot pixels so have replaced theirs.</p> </li> <li> <p>The choice of mono versus color is a personal one. Mono cameras are usually more sensitive so require shorter exposures or less gain, but many people prefer color for its more \"natural\" look, especially during the day.</p> </li> <li> <p>Higher-resolution sensors (for example the RPi HQ @ 4056x3040 and ASI178MC @ 3096x2080) require more memory to produce timelapses, so you may need to follow these suggestions to get timelapse working.</p> </li> <li> <p>For allsky use, an extremely high resolution camera (e.g., higher than the RPi HQ) probably isn't useful since the lens and dome cause some distortion that limits the effective resolution.</p> </li> <li> <p>Increasing sensor temperature will always increase noise and hot pixels, sometimes to the point of making the image unusable, so many people put a fan in their allsky enclosure to pull in cooler outside air. This can also increase the life of the camera and Pi.</p> </li> <li> <p>Different cameras have different dynamic ranges (the difference between the brightest and darkest parts). Increasing a camera's gain will produce brighter, noisier images with less dynamic range. Consult the camera specs to learn more about the trade-off between gain and dynamic range.</p> </li> <li> <p>Some RPi and RPi-compatible cameras support auto focus. That feature sounds great but has some major limitations:</p> <ul> <li> <p>You will almost always disable auto focus at night - it takes a long time since the camera has to take several long-exposure images to find the correct focus.</p> </li> <li> <p>The lenses that come with these cameras typically produce at most a 120 degree field of view. Many allsky lenses produce about 180 degrees. A narrower field of view may not matter if you have a lot of trees and/or buildings blocking the view, however.</p> </li> <li> <p>Some people with auto focus lenses focus during the day and may refocus if the temperature changes drastically.</p> </li> </ul> </li> <li> <p>The \"T7C\" camera is an OEM version of the ASI120MC-mini. We do not recommend it.</p> </li> </ul>"},{"location":"allsky_guide/hardware/lens.html","title":"Lens Options","text":""},{"location":"allsky_guide/hardware/lens.html#choosing-a-lens","title":"Choosing A lens","text":"<p>Lenses have a few attributes you'll want to be aware of, and together with the camera sensor determine what kind of image you'll see.</p> <p>Generally, the lower a lens' focal length is (expressed in mm, like 2.1 mm), the wider a field of view (FOV) it produces. Most people like a very wide FOV such as 180 degrees so they can image as much of the sky as possible. Lenses that produce very wide FOVs are usually called fisheye lenses. If your allsky camera is surrounded by lots of trees or buildings and you don't want them in your images, use a higher focal length lens.</p> <p>Typical focal lengths used in allsky lens are 1.5 mm - 2.5 mm. Some allsky lens can vary their focal length so are called \"zoom\" lenses. These are more expensive and produce lesser-quality images so are seldom used. Typical FOVs are 120 degrees - 180 degrees.</p> <p>The aperture of a lens determines how much light it passes through. Lower numbers let more light through but in general produce fuzzier images that you may or may not notice. Typical apertures (prepended by f) used in allsky lens are f 1.4 - f 2.8.</p> <p>Lenses are round so produce round images. The size of the image it produces on the sensor, measured by its diameter in mm, is called its image circle.</p>"},{"location":"allsky_guide/hardware/lens.html#image-circles","title":"Image Circles","text":"<p>Most allsky cameras have rectangular sensors that are wider than they are tall. The images below show a sensor (black with dark gray border) and image circles produced by various fictional lenses (white with stars and a yellow borders).</p> <p>Depending on the physical size of the sensor and the size of the image circle, you'll get different results, as shown below. There is no \"right\" or \"wrong\" combination - it's a personal preference.</p> <ol> <li> <p>An image circle that is much smaller than the sensor. This uncommon scenario produces a very small sky image.</p> <p></p> </li> <li> <p>An image circle whose height is the same as the sensor. This shows the whole the sky image and leaves ample room to overlay text and images.     It's rare to have the sensor height and imager circle be identical as shown below. The AIS 676 is an exception to this and a great camera for Allsky imaging</p> <p></p> </li> <li> <p>An image circle whose height is bigger than the sensor but whose width is the same as the sensor. This cuts off part of the sky image but minimizes the black border, yet still allows for some space to add text without overwriting the sky image. Most very wide FOV sky images include some landscape and/or buildings around the edges so depending on how much of the sky image is cut off, this combination can be beneficial.</p> <p>It's rare to have the sensor width and imager circle be identical as shown below.</p> <p></p> </li> <li> <p>If the lens' image fills the whole sensor you'll see what appears to be a \"normal\" image with no black border. This combination is usually the result of a very small camera sensor.</p> <p></p> </li> </ol>"},{"location":"allsky_guide/hardware/lens.html#determining-image-type","title":"Determining Image Type","text":"<p>To determine which of the examples above you'll get you need to know the physical size of the camera's sensor and the size of the lens' image circle.</p> <p>Determining Size</p> <p>Don't confuse a sensor's physical size with its pixel size. The pixel size only determines how fine of detail you'll see in a sky image - it has nothing to do with anything else on this page.</p> <p>Most camera web pages list the sensor's width and height but you'll normally need to calculate the sensor's diagonal size using a little math:</p> <p>Take the square root of:</p> \\[ (sensor\\_width \\times sensor\\_width) + (sensor\\_height \\times sensor\\_height) \\] <p>So for the Pi HQ Camera</p> \\[ (6.3\\,\\text{mm} \\times 6.3\\,\\text{mm}) + (4.7\\,\\text{mm} \\times 4.7\\,\\text{mm}) = 7.86\\,\\text{mm} \\] <p>Not all lens web pages list the image circle size - in fact, one of the lenses below didn't list it. You may need to contact the seller or search on the Web.</p> <p>To see what you'll get, compare the sizes:</p> <ul> <li> <p>If the image circle size is less than or equal to the sensor height, the full image will fit on the sensor (examples 1 and 2 above).</p> </li> <li> <p>If the image circle size is less than the sensor diagonal, the top and bottom of the sky image will be cut off (example 3).</p> </li> <li> <p>If the image circle size is greater than the sensor diagonal, the sky image will completely fill the sensor (example 4).</p> </li> </ul> <p>Some common allsky cameras and lenses are shown below followed by an example of the results that different lenses produce using the same camera.</p> Common allsky cameras Camera Sensor Sensor Width Sensor Height Sensor Diagonal Resolution (w\u00a0x\u00a0h) RPi HQ Sony IMX477 6.3 mm 4.7 mm 7.86 mm 4056 x 3040 ZWO ASI178 Sony IMX178 7.4 mm 5.0 mm 8.93 mm 3096 x 2080 ZWO ASI224 Sony IMX224 4.9 mm 3.7 mm 6.14 mm 1403 x 976 ZWO ASI290 Sony IMX290 5.6 mm 3.2 mm 6.45 mm 1936 x 1096 Example allsky lenses Lens Focal length Image circle Aperture FOV cnAICO ACF12F0155IRMM 1.5 mm 4.6 mm F 2.0 185 deg cnAICO ACTCS25IR8MPF 2.5 mm 6.4 mm F 1.6 190 deg cnAICO ACCF021163MP 2.1 mm ??  F 1.6 160 deg cnAICO ACF12FM014IRCMM 1.4 mm 4.59 mm F 1.4 182 deg <p>Lens # 1, ACF12F0155IRMM: 1.5 mm focal length. The lens' image circle (4.6 mm) is smaller than the height of the sensor (5.0 mm) so the whole image fits on the sensor. You may want to crop the sides of the image to remove some of the black border and save disk space.</p> <p></p> <p>Lens # 2, ACTCS25IR8MPF: 2.5 mm focal length. The lens' image circle (6.4 mm) is larger than the height of the sensor (5.0 mm) but smaller than the width of the sensor (7.4 mm), so you'll see a circle with the top and bottom cut off and some black on the sides.</p> <p></p> <p>In the examples above, if you used a camera with a much larger sensor you would see the full cicular image even with the 2.5 mm lens. On the other hand, if you used a much smaller sensor, like the ASI224, you would see a slightly cut-off circle with the 1.5 mm lens and would see a rectangular image with no black using the 2.5 mm lens.</p>"},{"location":"allsky_guide/hardware/lens.html#image-offset","title":"Image Offset","text":"<p>It's not uncommon for the sky image to be off center relative to the sensor, as seen below. The small yellow circle is the center of the sky image and the small dark square is the center of the sensor.</p> <p></p> <p>Most allsky lenses are inexpensive and don't provide \"perfect\" results. This is not a problem since you can easily crop the image to center it.</p>"},{"location":"allsky_guide/hardware/pi.html","title":"Pi Options","text":""},{"location":"allsky_guide/hardware/pi.html#choosing-a-pi-model","title":"Choosing a Pi Model","text":"<p>A Pi 5 with 8 GB memory is the best choice if you can afford it. It handles everything Allsky currently does and has enough memory and CPU power for the future. You'll notice the speed increase while producing keograms, startrails, and timelapse videos as well as during installation and upgrades. Taking pictures doesn't require much power so you likely won't notice a difference there. If you use the Pi 5 for non-Allsky work you'll likely notice the speed increase as well.</p> <p>The next best Pi to get is the Pi 4 with 4 GB memory; if that's still too expensive get a Pi 4 with 2 GB memory.</p> <p>Pi Speed</p> <p>Note that in general, the faster a Pi is, the more heat it produces. If your allsky camera's case is not ventilated you may run into problems.</p> <p>If the options above are too expensive, a Pi 3B+ with 2 GB memory will also work but will take longer to create timelapse videos, and will limit how often you can create mini-timelapse videos. The 1 GB versions of the Pi 3B+ and Pi 4 will work but require adding more swap space, slowing things down and putting more wear on your SD card.</p> <p>Do NOT get the Pi Zero - its extremely slow CPU and minimal memory will cause problems. You likely won't be able to create timelapse videos. The Pi Zero 2 has a faster CPU than the Pi Zero but still has limited memory and should only be considered if cost is the ONLY concern. You may or may not be able to do timelapse videos. Future versions of Allsky will likely require more processing power and memory so the Pi Zero 2 may not work in the future.</p> <p>Pi Clones</p> <p>We have not found any Pi clones except Le Potato to be compatible with Allsky, and it works only with a ZWO ASI120 camera (which we don't recommend).</p>"},{"location":"allsky_guide/hardware/pi.html#choosing-an-sd-cards","title":"Choosing an SD cards","text":"<p>We suggest getting at least a 128 GB SD card. They are fairly inexpensive so if you can afford a 256 GB card, get it - it will let you store more images and videos. Unless you are copying lot of files, the speed of the SD card won't make much of a difference.</p> <p>For speed a v30 rated SD card is recommended</p>"},{"location":"allsky_guide/howtos/allsky_map.html","title":"The Allsky map","text":"<p>The Allsky Map  shows the location and basic information of all known allsky cameras. Clicking on a pin displays information about the camera and if the owner has set their image URL, you'll see their last image as well; clicking on the image takes you to their Allsky website.</p> <p></p> <p>The Allsky Map</p>"},{"location":"allsky_guide/howtos/allsky_map.html#adding-your-camera","title":"Adding your camera","text":"<p>To add your camera to the map, enable the Show On Map setting in the Allsky Map Settings section of the WebUI. If your camera is already on the map you can remove it by turning the setting off. You can also update your information by changing any of the map-related settings.</p> <p>Once you've enabled Show On Map, your map information will be automatically sent to the map server whenever you change it, as well as every other day so it can distinguish current data from old, expired data.</p> <p>All these changes take effect immediately - no human intervention required!</p> <p>See the Allsky Settings   documentation page for a description of the map-related settings.</p> <p>My Website isn't available on the Internet</p> <p>You can still have a pin of your camera's location appear on the map - just leave the Website URL and Image URL fields blank in the WebUI.</p>"},{"location":"allsky_guide/howtos/angle_sunrise_sunset.html","title":"Angle, Sunrise and Sunset","text":"<p>The time the sun actually sets and rises at your location is dependent on the day of the year and your latitude and longitude, and defines what people call daytime and nighttime. Allsky also has a daytime and nighttime, but they determine when to use your daytime and nighttime settings, and can be changed as described below.</p> <p>Info</p> <p>Don't confuse Allsky's daytime and nighttime with your actual daytime and nighttime. Allsky's version should really be called daytime settings start and nighttime settings start.</p> <p>Allsky's daytime is your actual sunrise time plus an offset you define, called the Angle  . This is set in the Allsky Settings page of the WebUI and is a positive or negative number that indicates the number of degrees above (positive) or below (negative) the horizon the Sun is when daytime starts.</p> <p>Allsky's nighttime is your actual sunset time minus the Angle.</p> <p>As an example, assume the Sun rises at 7:00 AM and sets at 18:00 (6:00 PM). Using an Angle of 0 degrees, Allsky's daytime starts at 7:00 and nighttime starts at 18:00, and that's when Allsky will start using your daytime and nightttime settings, respectively.</p> <p>The Sun moves at 15 degrees per hour, so 6 degrees is 24 minutes (6 degrees / 15 degrees * 60 minutes). Remember: daytime ADDs the number of minutes represented by Angle and nighttime SUBTRACTs it. Subtracting a negative number is the same as adding a positive number, so 100 MINUS -5 is the same as 100 PLUS 5.</p> <p>Using an Angle of 6 degrees, Allsky's daytime starts at 7:24 (7:00 PLUS 24 minutes) and nighttime at 17:36 (18:00 MINUS 24 minutes). An Angle of -6 degrees would give 6:36 (7:00 PLUS -24 minutes) and 18:24 (18:00 MINUS -24 minutes). The Angle effectively determines the length of daytime - the larger the Angle the shorter the daytime.</p> <p>Why is Angle important?</p> <p>You tell Allsky when to start using your daytime settings and nighttime settings by adjusting your Angle. Many people use -6 but it's up to you to determine where the daytime and nighttime transition points should be.</p> <p>Info</p> <p>Startrails, keograms, and timelapse videos are created at the end of nighttime, so your Angle value will determine how dark or light the beginning of the timelapse video is.</p> <p>To see what Allsky uses for today's daytime and nighttime based on your Angle, Latitude, and Longitude, execute:</p> <pre><code>allsky-config  show_start_times\n</code></pre> <p>You can tell it to use different values by appending one or more of the following to the command above:</p> <pre><code>    --angle some_angle\n    --latitude some_latitude\n    --longitude some_longitude\n</code></pre> <p>For example:</p> <pre><code>allsky-config  show_start_times  --angle -7.1  --longitude 105W\n</code></pre> <p>If you want daytime and nighttime to start at a certain time, execute the command with different angles until you get the times you want.</p>"},{"location":"allsky_guide/howtos/cleanup_website.html","title":"Cleanup A Website","text":""},{"location":"allsky_guide/howtos/cleanup_website.html#local-website","title":"Local Website","text":"<p>You can easily limit the number of days of images stored on your local Website via the Days To Keep on Pi Website setting in the WebUI with the number of days' data you want to keep. Older files will be removed every morning.</p>"},{"location":"allsky_guide/howtos/cleanup_website.html#remote-website","title":"Remote Website","text":"<p>Because remote web sites vary, the instructions below are generic and it's assumed you know how to perform the steps.</p> <ol> <li>Connect to the remote Website server.</li> <li>For each of the startrails, keograms, and videos directories do the following:</li> <li>Enter the directory.</li> <li>Search for all .jpg, .png, or *.mp4 files older than your threshold, for example, older than one month.</li> <li>Remove them. Do NOT remove the index.php files!</li> <li>Enter the thumbnails sub-directory and delete files older than your threshold.</li> </ol>"},{"location":"allsky_guide/howtos/constellation_overlay.html","title":"Constellation Overlay","text":"<p>The Allsky Website allows an overlay to appear over the image which can contain constellations, stars, objects, and other items. This overlay is called the \"constellation overlay\" and should not be confused with \"image overlays\" which contain text and other items that are embedded in captured images. You can view the constellation overlay by clicking on the constellation icon on the left side of the Website page (the icon looks like Cassiopeia).</p> <p>Info</p> <p>By default the constellation overlay icon doesn't appear since many people never align their overlay with the stars in their image, thereby making their overlay useless and misleading to others who might view it.</p> <p>You should only make the icon appear if you are going to follow the instructions below to align the overlay.</p> <p>To make the overlay icon appear:</p> <ul> <li> <p>In the WebUI, click on the Editor link.</p> </li> <li> <p>On the drop-down at the bottom of the page, click on the configuration.json file for your local or remote Website.</p> </li> <li> <p>In the homePage section of the file, go to the leftSidebar setting.</p> </li> <li> <p>The first group of sub-settings should be for the constellation overlay.</p> </li> <li> <p>Set the display setting to true.</p> </li> <li> <p>Save the file.</p> </li> <li> <p>Refresh your browser.</p> </li> </ul> <p>For more information on this, and other Website settings, visit the Allsky Website Settings page.</p>"},{"location":"allsky_guide/howtos/constellation_overlay.html#adjusting-image-size","title":"Adjusting image size","text":"<p>The default maximum size of the image that's displayed on the Website is 960 pixels wide by 720 pixels high. If your monitor is very small or can support a larger resolution, you may wish to change the default size by doing the following:</p> <ul> <li> <p>In the WebUI's Editor page, edit the imageHeight setting in the configuration.json file. The image's width will be automatically determined.</p> </li> <li> <p>Refresh your browser.</p> </li> <li> <p>If you resized the image via the WebUI the final images size should be the same or greater than the size of the imageHeight value.</p> </li> </ul>"},{"location":"allsky_guide/howtos/constellation_overlay.html#aligning-the-overlay","title":"Aligning the overlay","text":"<p>Info</p> <p>Getting the overlay placed over the sky image correctly is a trial-and-error effort that takes time.</p> <p>Most allsky cameras produce rectangular pictures, but the portion of the picture with your allsky image is often round, surrounded by black. Further, the round portion may not be centered exactly in the picture, although it's usually close.</p> <p>When aligning the overlay keep in mind the difference between the rectangular, full-size picture and the (usually) round portion of that picture that contains the allsky image.</p> <p>In the steps below you'll be editing the configuration.json file using the WebUI's Editor page.</p> <ul> <li> <p>Change the width and height settings. These should be roughly the size of the circular portion of the image your lens produces, not the whole image. At night it can be difficult to determine where the border of the lens image is, so this step may be easier during the day.</p> </li> <li> <p>Tweak imageHeight if needed. If it's not large enough, the overlay will be cut off at the bottom.</p> </li> <li> <p>Center the overlay by changing overlayOffsetLeft and overlayOffsetTop.</p> </li> <li> <p>Make the overlay the correct size:</p> <ul> <li> <p>THE FOLLOWING HASN'T BEEN TESTED YET:</p> </li> <li> <p>Determine the center of the lens image (not the center of the whole image).</p> </li> <li> <p>Remember where the center is - possibly measure it from the top and side of your monitor.</p> </li> <li> <p>Set keyboard to true.</p> </li> <li> <p>Refresh your browser and display the overlay.</p> </li> <li> <p>With the mouse over the overlay, press z to toggle the gridlines so you can easily see where the center of the overlay is.</p> </li> <li> <p>Modify overlayOffsetLeft and overlayOffsetTop to get center of the overlay to match the center of the lens image.</p> </li> <li> <p>Modify overlayWidth and overlayHeight so the overlay is the correct size. You may need to re-center the overlay as you do this.</p> </li> </ul> </li> <li> <p>Rotate the overlay to match the stars. Increasing the az setting rotates the overlay clockwise.</p> </li> </ul>"},{"location":"allsky_guide/howtos/constellation_overlay.html#tips","title":"Tips","text":"<p>The following items can be done while aligning the overlay, and undone when finished.</p> <ul> <li> <p>Set the opacity to 1.0 (pure white) to make it easier to see the overlay.</p> </li> <li> <p>Optionally set showOverlayAtStartup to true to eliminate the need to manually display the overlay every time you refresh the browser.</p> </li> <li> <p>Set constellationlabels, showgalaxy, and gridlines_eq to false so it's easier to compare the overlay with the actual sky. Keeping constellations on can help identify stars, though.</p> </li> <li> <p>Setting mouse can be useful to allow you to rotate the sky overlay with the mouse. This will give an indication if the overlay size and position are correct, and you just need to modify az.</p> </li> <li> <p>Have multiple windows open:</p> <ul> <li> <p>One editing configuration.json.</p> </li> <li> <p>A big one that shows the full image and overlay.</p> </li> </ul> </li> </ul>"},{"location":"allsky_guide/howtos/dark_frames.html","title":"Dark Frames","text":"<p>All cameras produce noise, which is shown in the picture below (click on it to show a larger version where the noise is more apparent). A theoretical \"perfect\" camera would produce a pure black image.</p> <p>Noise can be one or more of the following:</p> <ol> <li> <p>Pixels that are stuck on and appear white on a mono camera, or red, green, or blue on a color camera. These are called \"hot pixels\".     White hot pixels are visible in the unaltered left side of the image. Blue hot pixels are visible in the artifically-brightened right side of the image.</p> </li> <li> <p>A salt and pepper-like pattern, visible in the right side of the image, especially when zoomed in.</p> </li> <li> <p>Pixels that are always off and appear black (called \"cold pixels\"). This noise is very difficult to see unless zoomed in several hundred percent. You might see cold pixels if they are in a bright area of the picture (more likely during the day).</p> </li> </ol> <p></p> <p>Examples of Camera Noise</p> <p>Noise increases with temperature and exposure length. You won't notice noise in a daylight image because it's significantly brighter than the noise, but with long exposures at night you'll likely see it. Newer cameras tend to produce less noise, but they still produce it.</p> <p>Info</p> <p>Even expensive cameras like the Hubble Space Telescope produce noise, which is why they are cooled to extremely cold temperatures. Most cameras designed for amature astrophotographers are also cooled, but typically only 10 - 30 degrees C below ambient temperature.</p> <p>Many people find noise distracting, and a good way to decrease it is to subtract it from a captured image. A picture that contains your desired object, e.g., night sky, and noise is called a light frame. A picture with just the noise (like the picture above) is called a dark frame because it's mostly dark. Subtracting a dark frame from a light frame leaves just your desired object.</p>"},{"location":"allsky_guide/howtos/dark_frames.html#when-to-take-dark-frames","title":"When to take dark frames","text":"<p>You can take dark frames anytime - the software will use your night settings when taking dark frames, even if you take them during the day. The most important thing is to cover your lens fully so no light gets in. This isn't always easy and is why many people take dark frames at night. A good time to take them is on cloudy nights so you aren't \"wasting\" any time.</p> <p>Info</p> <p>The lens caps that come with many cameras let a small amount of light in, so don't depend on them to block all the light. Use the lens cap to keep the lens clean, but put a dark towel or something else over the lens. To be extra careful, only take dark frames at night or in a dark room.</p> <p>You'll probably want to take dark frames before you install your allsky camera, especially if the camera will be difficult to access, for example, on the top of a tall pole. The noise produced by a camera changes over time so you'll want to take new darks whenever you notice \"too much\" noise.</p> <p>Some people put their camera in the freezer before taking darks, then take darks until the camera is fully warmed. If that's not possible, take darks a few times a year when the temperature changes. The goal is to have a range of temperatures, but it's not critical to have EVERY possible temperature. A 2 or 3 degree spread is usually fine, e.g., 21, 24, 27 degrees C.</p>"},{"location":"allsky_guide/howtos/dark_frames.html#how-to-take-and-use-darks","title":"How to take and use darks?","text":"<p>Execute these steps to take and then use dark frames.</p>"},{"location":"allsky_guide/howtos/dark_frames.html#capture-dark-frames","title":"Capture dark frames","text":"<ul> <li> <p>In the WebUI's Allsky Settings page, set Take Dark Frames to Yes.</p> </li> <li> <p>Click on the  button.</p> <p>Allsky will stop and wait until you manually start it below. This gives you time for the next step...</p> </li> <li> <p>Cover your camera lens and/or dome. Make sure NO light gets in.</p> </li> <li> <p>Start Allsky: <code>sudo systemctl start allsky</code>. Dark frames will be saved in the ~/allsky/darks directory. A new dark is created every time the sensor temperature changes by 1 degree C.</p> </li> <li> <p>After you are done taking darks, set Take Dark Frames in the WebUI to No.</p> <p>Allsky will stop and wait for you to manually start it. This gives you time for the next step...</p> </li> <li> <p>Remove the cover from the lens/dome.</p> </li> <li> <p>Restart Allsky: <code>sudo systemctl start allsky</code>.</p> </li> </ul>"},{"location":"allsky_guide/howtos/dark_frames.html#subtract-dark-frames","title":"Subtract dark frames","text":"<ul> <li> <p>On the WebUI's Allsky Settings page set Use Dark Frames to Yes.</p> </li> <li> <p>Click on the Save Changes  button. This will restart Allsky taking light frames, and subtract dark frames at night.</p> </li> </ul> <p>You will get an error message in the WebUI if there aren't any dark frames.</p>"},{"location":"allsky_guide/howtos/dark_frames.html#how-does-allsky-handle-darks","title":"How does Allsky handle darks?","text":"<p>When you are taking dark frames, the software will turn off auto-exposure, auto-gain, and any overlay settings (e.g., time) and use your nighttime settings for Max Auto-Exposure, Gain, and Binning.</p> <p>Info</p> <p>If you later change the Gain or Binning, you must discard the old darks and take new ones (noise, and hence dark frames, is impacted by these settings). If you think you'll go back to the original settings, save the old darks somewhere else instead of discarding them.</p> <p>When a dark image is taken a file called dark.png is saved in ~/allsky/tmp, then moved to ~/allsky/darks with a name like \"XX.png\", where \"XX\" is the temperature, for example, 21.png.</p> <p>When darks are being subtracted, the software looks in ~/allsky/darks for the dark frame that is closest to the current sensor temperature. For example, if the current temperature is 21 and you have 3 darks, 17.png, 20.png, and 23.png, the software will pick 20.png because it's only 1 degree off from the current sensor temperature.</p> <p>The software does not actually look in the dark files - it simply looks at the names of the files. Unless something is really weird with your camera, or your darks are pretty old, the closest dark frame will give the best results.</p>"},{"location":"allsky_guide/howtos/exposure_settings.html","title":"Exposure Settings","text":"<p>There are several settings that determine what an image looks like - how bright it is, how colorful it is, and its color balance. The WebUI lets you manually set those settings, or have them automatically set by the software.</p>"},{"location":"allsky_guide/howtos/exposure_settings.html#image-brightness","title":"Image Brightness","text":"<p>If you've every used a film or DSLR camera, you know the concepts of shutter speed and ISO. With an allsky camera the shutter speed is called Exposure and the ISO is called Gain, and they work together to determine the final image brightness. If you take a picture at some exposure and gain, then halve the exposure and double the gain, you should get a second picture of the same brightness as the first, but slightly noisier since increasing gain or ISO increases the salt-and-pepper like noise. If you have a manual camera you can set the shutter speed and ISO to any value you want, but what if your camera (or allsky camera) automatically sets those values but you want an image that's brighter or dimmer? In Allsky you can set the Mean Target to change what settings the auto-exposure algorithm uses.</p> <p>Increasing that value, which ranges from 0.0 (pure black) to 1.0 (pure white), increases the overall brightness of the image.</p>"},{"location":"allsky_guide/howtos/exposure_settings.html#image-color","title":"Image Color","text":"<p>If your sky looks green instead of blue, your color balance is off. This is also called white balance because it can be easier to determine which way the color is off by looking at something white.</p> <p>On color cameras you can turn on Auto White Balance in the WebUI to have the camera set the white balance, but you may not like the results. You can also manually set the Red Balance and Blue Balance to get a picture of your liking (there is no Green Balance because you can adjust the amount of green in an image by adjusting the amount of red and blue).</p> <p>We suggest trying Auto White Balance during the day and if you don't like the results, turn it off and set the red and blue balance manually. You can change the Auto White Balance and red and blue balances separately for daytime and nighttime.</p> <p>Warning</p> <p>You may not want to disable Auto White Balance at night since it may significantly increase the total time needed to get one picture. Some camera's auto white balance algorithm works by taking several pictures in a row, and if each picture is 60 seconds you may wait 3 minutes for each picture. If in doubt, enable Auto White Balance at night and see what happens.</p>"},{"location":"allsky_guide/howtos/exposure_settings.html#saturation","title":"Saturation","text":"<p>Info</p> <p>This applies to Rpi cameras only</p> <p>Saturation determines how vivid the colors are, from black and white to very vivid (usually to the point where the colors look unnatural). To change saturation, use the Saturation setting in the WebUI. The middle point is \"normal\" saturation, but you may like more or less. If you want a black and white image, set the Saturation to its lowest value.</p>"},{"location":"allsky_guide/howtos/exposure_settings.html#stretch","title":"Stretch","text":"<p>Stretching an image changes its contrast (difference between light and dark) and is good to bring out details in pictures. There are separate stretch settings for daytime and nighttime that work the same (daytime stretching is not very common). The stretch-related settings are:</p> <ul> <li> <p>Stretch Amount (default: <code>0</code> which disables stretching)</p> <p>3 is typical and 20 is a lot. Higher numbers lighten the image more.</p> </li> <li> <p>Stretch mid point (default: <code>10</code>)</p> <p>This specifies what part of the image should be lightened: 0 lightens black items, 50 lightens middle-gray items, and 100 lightens white items.</p> </li> </ul> <p>You may find that you can decrease the gain, and hence the noise, by increasing the stretch. Experiment with the settings to get the results you want.</p>"},{"location":"allsky_guide/howtos/exposure_settings.html#sample-stretch-images","title":"Sample Stretch Images","text":"<p>Stretch Amount: <code>0</code></p> <p>The exposure is 60 seconds; anything longer will produce streaks with most lenses. The gain is 250 which is near the maximum for the camera, and is already producing some noise.</p> <p></p> <p>Stretch Amount: <code>10</code>, Stretch mid point: <code>10</code></p> <p>Notice the dark parts of the image are much brighter, and the light stars are only a little brighter (but the dark stars are much brighter and easier to see).</p> <p></p> <p>Stretch Amount: <code>10</code>, Stretch mid point: <code>30</code></p> <p>Notice a very slight overall increase in brightness, but a noticable increase in brightness of the stars.</p> <p></p> <p>Stretch Amount: <code>20</code>, Stretch mid point: <code>10</code></p> <p>Compare this image to the Stretch Amount: 10 image; this one is even brighter.</p> <p></p>"},{"location":"allsky_guide/howtos/keograms.html","title":"Keograms","text":"<p>A keogram is a time-based visual summary of the sky created from a sequence of images taken over a period of time, typically a full night or day. It is generated by extracting a single vertical (or horizontal) line of pixels from each image\u2014usually through the centre of the frame\u2014and stacking those lines side-by-side in chronological order.</p> <p>The result is an image where one axis represents time and the other axis represents position in the sky. This makes keograms particularly useful for showing how sky brightness, cloud cover, twilight, aurora, airglow, or other large-scale atmospheric features change over time.</p> <p>In an Allsky context, keograms are commonly used to:   - Visualise the transition from day to night and night to day</p> <ul> <li> <p>Identify periods of cloud cover or clearing</p> </li> <li> <p>Detect aurora or airglow activity</p> </li> <li> <p>Provide a compact overview of an entire night in a single image</p> </li> </ul> <p>Because a keogram condenses thousands of images into one continuous timeline, it is an efficient way to analyse long-term sky behaviour without inspecting individual frames.</p> <p>Warning</p> <ul> <li> <p>Only images that are saved are included in a keogram, so if you don't save your daytime and/or nightime images, they won't be included.</p> </li> <li> <p>Keograms only show what happens at the center of the image and will not display events on the East or West.</p> </li> </ul> <p></p> <p>Example Keogram</p>"},{"location":"allsky_guide/howtos/keograms.html#creating-a-keogram","title":"Creating a keogram","text":"<p>You specify whether or not you want a keogram automatically created via the Generate   setting in the Keograms sub-section of the WebUI. When enabled, a keogram will be created at the end of night and will contain information for the prior 24 hours.</p> <p>The easiest way to create and optionally upload a keogram is via the generateForDay.sh command. For example, to create and then upload a keogram to any Allsky Website and/or remote server you have for July 10, 2025:</p> <pre><code>generateForDay.sh --keogram 20250710\ngenerateForDay.sh --upload --keogram 20250710\n</code></pre> <p>This will use the settings specified in the Keograms sub-section of the WebUI.</p> <p>If you want to experiment using other settings you can specify those settings as such:</p> <pre><code>generateForDay.sh --keogram --keogram-params \"--font-color #ff0000\" 20250710\n</code></pre> <p>This will create a keogram with a red timeline for July 10, 2025, overwriting any keogram that may already exist</p> <p>Make sure the parameters are enclosed in quotes</p> <p>See the Advanced section below for the possible parameters you can specify.</p> Advanced users: running the keogram program manually <p><code>generateForDay.sh</code> calls the keogram program to actually create the keogram, passing it several arguments (the underlined ones below), plus any others you add to the Keogram Extra Parameters setting.</p> <p>Executing the keogram program manually is possible, but not very useful. If run manually you need to specify at least the three required arguments.</p> <pre><code>Usage:  keogram -d &lt;imagedir&gt; -e &lt;ext&gt; -o &lt;outputfile&gt; [optional arguments]\n\nArguments:\n-d | --directory &lt;str&gt; : directory from which to load images (required)\n-e | --extension &lt;str&gt; : image extension to process (required)\n-o | --output-file &lt;str&gt; : name of output file (required)\n-r | --rotate &lt;float&gt; : number of degrees to rotate image, counterclockwise (0)\n-s | --image-size &lt;int&gt;x&lt;int&gt; : only process images of a given size, eg. 1280x960\n-h | --help : display this help message\n-v | --verbose : Increase logging verbosity\n-n | --no-label : Disable hour labels\n-C | --font-color &lt;str&gt; : label font color, in HTML format (#0000ff)\n-L | --font-line &lt;int&gt; : font line thickness (3)\n-N | --font-name &lt;str&gt; : font name (simplex)\n-S | --font-size &lt;float&gt; : font size (2.0)\n-T | --font-type &lt;int&gt; : font line type (1)\n-Q | --max-threads &lt;int&gt; : limit maximum number of processing threads. (use all cpus)\n-q | --nice-level &lt;int&gt; : nice(2) level of processing threads (10)\n-x | --image-expand : expand image to get the proportions of source - avoids tall and narrow images\n-c | --channel-info : show channel infos - mean value of R/G/B\n-f | --fixed-channel-number &lt;int&gt; : define number of channels 0=auto, 1=mono, 3=rgb (0=auto)\n\nFont name is one of these OpenCV font names:\n        Simplex, Plain, Duplex, Complex, Triplex, ComplexSmall, ScriptSimplex, ScriptComplex\nFont Type is an OpenCV line type: 0=antialias, 1=8-connected, 2=4-connected\n</code></pre> <p>Example of running the keogram program manually:</p> <pre><code>cd ~/allsky/bin\n./keogram -d images/20250710 -e jpg -o images/20250710/keogram/keogram.jpg --rotate 42 --font-size 2\n</code></pre>"},{"location":"allsky_guide/howtos/keograms.html#troubleshooting","title":"Troubleshooting","text":"<p>Info</p> <p>It is extremely rare that a keogram isn't created.</p> <p>Warning</p> <ul> <li> <p>The resolution of all images must be identical; if not, only images with the same resolution as the FIRST image are used.</p> </li> <li> <p>This can happen if the daytime and nighttime Binning settings are not the same, or any day you change the Image Resize and/or Image Crop settings.</p> </li> </ul> <ul> <li> <p>If a keogram isn't being created, make sure the Keogram Generate setting is enabled. If that IS enabled, run:</p> <p><code>generateForDay.sh  --keogram  DATE</code></p> <p>replacing DATE with a valid date like 20250710 and check for errors.</p> </li> <li> <p>If a keogram is created but not uploaded, make sure the Keogram Upload setting is enabled. If that IS enabled, run:</p> <p><code>generateForDay.sh  --upload  --debug  --keogram  DATE</code></p> <p>and check for errors. If needed, run testUpload.sh to see why the upload fails.</p> </li> <li> <p>If your keograms are tall and skinny you can have them created so they look like regular images by enabling the Expand setting.</p> </li> </ul>"},{"location":"allsky_guide/howtos/layout.html","title":"Allsky layout","text":"<p>When you install Allsky it put its files and directories in the allsky directory of the login you installed it with, typically pi. That directory is usually referred to as ~/allsky.</p> <p>Ever wonder what all the files and directories are in the ~/allsky directory? Read on.</p> <pre><code>allsky\n\u251c\u2500\u2500 assets\n\u251c\u2500\u2500 bin\n\u251c\u2500\u2500 config\n\u251c\u2500\u2500 darks\n\u251c\u2500\u2500 config_repo\n\u251c\u2500\u2500 html\n\u251c\u2500\u2500 images\n\u2502   \u2514\u2500\u2500 20251117\n\u2502       \u251c\u2500\u2500 keogram\n\u2502       \u251c\u2500\u2500 keolapse\n\u2502       \u251c\u2500\u2500 startrails\n\u2502       \u2514\u2500\u2500 thumbnails\n\u251c\u2500\u2500 notification_images\n\u251c\u2500\u2500 resized\n\u251c\u2500\u2500 scripts\n\u251c\u2500\u2500 src\n\u2514\u2500\u2500 tmp\n    \u251c\u2500\u2500 aborts\n    \u251c\u2500\u2500 flowtimings\n    \u251c\u2500\u2500 lftp_cmds\n    \u251c\u2500\u2500 logs\n    \u2514\u2500\u2500 __pycache__\n</code></pre> <p>assets</p> <p>Contains files used by the developers in creating Allsky as well as images used by the README.md file. You can ignore this directory.</p> <p>bin</p> <p>This holds all the binary files (files created by compiling source code), for example capture_RPi and capture_ZWO are the programs that read your settings and take pictures, storing them in the tmp directory, described below.</p> <p>config Contains all the configuration files. Some of the files in this directory include:</p> <ul> <li> <p>settings.json is updated via the Allsky Settings page in the WebUI and contains most of the settings used by Allsky. This file is linked to a file that contains your camera type and camera model in the file name.</p> </li> <li> <p>The modules and overlay directories contain the configuration files for the Module Manager and Overlay Editor, respectively.</p> </li> <li> <p>cc.json (camera capabilities) and options.json are created as part of the installation based on what capabilities your camera has, and determine what settings you see in the WebUI as well as their minimum, maximum, and default values. If you change cameras via the WebUI, these files are re-created.</p> </li> <li> <p>If you have a remote Allsky Website a remote_configuration.json file will exist that's uploaded to the remote server whenever you change it via the WebUI's Editor page.</p> </li> </ul> <p>config_repo</p> <p>This holds \"templates\" of the configuration files. Copies of most of these files are updated and stored in the config directory during installation.</p> <p>darks</p> <p>This holds optional dark frames which are used to decrease noise in pictures.</p> <p>html</p> <p>All the WebUI and local Allsky Website files are here. The WebUI itself doesn't have a configuration file, but a local Allsky Website has configuration.json which is updated via the WebUI's Editor page.</p> <p>The Allsky Documentation is also in this directory.</p> <p>images</p> <p>This holds all the daily images, keograms, startrails, and timelapse videos for as long as you have specified in the Days To Keep setting in the WebUI. Each day's files are stored in a subdirectory called YYYYMMDD, for example, 20240710.</p> <p>tmp</p> <p>Hold temporary files, including most log files, used by Allsky while it's running. The contents of this directory are usually cleaned out after a reboot.</p> <p>venv</p> <p>You can ignore this directory. It holds Python configuration data used by Allsky.</p> <p>allsky.sh</p> <p>This is the program that's executed when you start Allsky. It calls the appropriate program to take pictures.</p> <p>env.json</p> <p>This file contains private settings used to upload files such as user names and passwords. These settings are in a separate file so you can safely upload the settings.json file to GitHub without exposing sensitive information.</p> <p>The data in this file is updated via the WebUI.</p> <p>install.sh</p> <p>The installation / upgrade script for Allsky.</p> <p>LICENSE</p> <p>Holds the Allsky license. If you plan to copy Allsky in part or in whole you should be aware of the license.</p> <p>Makefile</p> <p>This is used during installation to create directories and binary files and perform other tasks. You can ignore this file. notification_images</p> <p>Holds all the images such as \"Allsky software is starting up\". There are both .jpg and .png files, depending on whether your image is called image.jpg or image.png.</p> <p>README.md</p> <p>A file containing information about Allsky. You'll normally view the Allsky Documentation via the WebUI's Documentation link instead of this file. remoteWebsiteInstall.sh</p> <p>The program used to prepare an optional remote Allsky Website. This should only be run after viewing the Allsky Website Installation page for instructions on installing a remote Allsky Website.</p> <p>scripts</p> <p>Holds all the scripts (i.e., programs) used by Allsky while it's running. Several scripts can be manually executed for debugging purposes, per the documentation. For example running testUpload.sh manually can help debug upload problems.</p> <p>src Holds the source code for the capture, keogram, startrails, and sunwait programs.</p> <p>upgrade.sh</p> <p>Do not use - it's incomplete and for developer testing only.</p> <p>When finished, this script will perform all steps needed to upgrade the existing Allsky to the newest version.</p> <p>uninstall.sh</p> <p>A VERY BASIC uninstallation script that hasn't been tested much.</p> <p>variables.sh</p> <p>Defines a lot of variables used by other programs. These variables define where various files and directories are. Super advanced users who want to put items in different locations can create a config/uservariables.sh file to define their own locations.</p> <p>Note that although this has a .sh extension which indicates it's a shell script, it's colored in black which means it is NOT executable. This script is only included in other scripts, never executed on its own.</p> <p>version</p> <p>A file that holds the version of Allsky you're running.</p>"},{"location":"allsky_guide/howtos/managing_files.html","title":"Managing Files","text":"<p>This page describes how to copy files to and from the Pi.</p>"},{"location":"allsky_guide/howtos/managing_files.html#small-text-files","title":"Small text files","text":"<p>If the file you want to copy is a text file and it fits on one screen you can simply highlight the text and copy to the clipboard, then paste it into a file on your PC or Mac.</p>"},{"location":"allsky_guide/howtos/managing_files.html#other-files","title":"Other files","text":"<p>For all other files you can mount the Pi's <code>/home/pi</code> directory (or the user you installed Allsky as) onto your PC or Mac using the SAMBA service.</p> <p>The first step is to install SAMBA on the Pi:</p> <pre><code>allsky-config  samba\n</code></pre> <p>Follow the prompts.</p> <p>When installation is done you should see something like this on a PC in Windows File Explorer, where ALLSKY is the name of the Pi:</p> <p></p> <p>To mount this directory on a PC:</p> <ul> <li> <p>Right-click the \"pi_home\" icon and select Map network drive....</p> <p>You'll see something like:</p> </li> </ul> <p></p> <ul> <li> <p>Pick any drive letter you want.</p> </li> <li> <p>Check the Connect using different credentials box.</p> </li> <li> <p>Click the Finish button. You'll then see a dialog box like this:</p> </li> </ul> <p></p> <ul> <li> <p>For the User name, enter WORKGROUP\\pi (replacing pi with the login you installed Allsky as).</p> </li> <li> <p>Use the SAMBA password you entered during installation.</p> </li> <li> <p>Check the Remember my credentials box so you don't have to manually log in every time.</p> </li> <li> <p>Click OK.</p> </li> </ul> <p>SAMBA only needs to be installed once unless you reimage your SD card.</p>"},{"location":"allsky_guide/howtos/mapping_server_locations.html","title":"Mapping Server Locations To URLs","text":"<p>Info</p> <p>If you have a remote Allsky Website or a remote Server, the Server Name, URL, and Image Directory settings in the WebUI can be very confusing.</p> <p>Read this page carefully.</p> <p>It may take 5 or 10 minutes, but it's important that you understand what you are doing and why so that you can fix any future problems quickly.</p> <p>At a high level, a website is a collection of files sitting in a directory on some computer's disk drive. If a company called Classic Cars has a website at <code>https://classiccars.com</code>, the directory on its computer that contains that website might be called cars. It may have sub-directories containing related files like wheels and seats.</p> <p>If you want to get information on red wheels you enter <code>https://classiccars.com/wheels/red.pdf</code> into your browser, and software called the \"web server\" on the <code>classiccars.com</code> computer starts in the cars directory, then goes to the wheels directory, then gets the red.pdf file and sends it to your browser. The web server mapped the <code>https://classiccars.com/wheels/red.pdf</code> URL to the cars/wheels/red.info file on the server.</p> <p>Likewise, when you go to the Allsky WebUI, for example via <code>http://allsky</code>, your Pi's web server looks in <code>~/allsky/html</code> since that's what the Allsky developers specified as the root of the WebUI.</p> <p>We now know there are TWO paths to a file in a website:</p> <ol> <li>a URL used in a browser</li> <li>a file path name used when logged into the server</li> </ol> <p>As a user, you only care about the first path. If you work for Classic Cars and need to update the red.pdf file, you only care about the second path.</p> <p>Allsky needs to know about BOTH paths to files on your remote Website. Sometimes mapping a URL to file location on a server is easy, and other times it's more difficult.</p> <p>Easy case: server directory structure matches URL</p> <p>Info</p> <p>If you are having a problem with your remote Website settings, this case probably doesn't apply to you unless you know almost nothing about computers. Read it anyhow because it will give you a better understanding of the problem.</p> <p>You want to create a remote Allsky Website so you purchase a plan with a hosting provider for a website with a URL of https://mysite.com. The provider gives you a login on their server and tells you the:</p> <ul> <li>Server Name</li> <li>User Name</li> <li>Password</li> </ul> <p>so you enter those into the WebUI. The provider also tells you that whatever you upload to the server will be visible via the URL using the same name. You use an FTP program like FileZilla   to log into the server and create a directory called allsky for the remote Website. (Visit the Allsky Website Installation   for the rest of the steps for creating a remote Website).</p> <p>In the WebUI you set the Remote Website's Website URL to <code>https://mysite.com/allsky</code> and Image Directory to /allsky (or allsky, depending on your service provider).</p> <p>More difficult case: directory structure does NOT match URL</p> <p>You have the same website URL as above, but when you log into the server you see a directory called public_html. The hosting provider tells you that you need to put file into that directory in order to see them via the <code>https://mysite.com</code> URL.</p> <p>In this case the web server is mapping the <code>https://mysite.com</code> URL to the /public_html directory on the server. You need to create a /public_html/allsky directory on the server and install the Allsky Website there. The URL to the Allsky Website is still <code>https://mysite.com/allsky</code> but in the WebUI you'd set the Remote Server's Image Directory to <code>/public_html/allsky`` (or</code>public_html/allsky``` depending on your service provider).</p> <p>Mapping URLs to server directories like this is fairly common on remote servers that are shared by many people.</p> <p>Hardest case: you are totally lost</p> <p>If the hosting provider didn't tell you where to put your files on their server, you'll need to figure it out. When you log into the server you see a directory called users and inside it is a directory called your_login_name. Inside that directory is a public_html directory.</p> <p>You first try creating the allsky directory in users but it gives you an \"Access Denied\" message.</p> <p>You then try creating the allsky directory in users/your_login_name and it works, so in the WebUI you set the remote Website's Image Directory to users/your_login_name/allsky. After installing the remote Allsky Website   you go to <code>https://mysite.com/allsky</code> in your browser but get a \"404 - Not Found\" message. Frustrated, you create an allsky directory in the <code>users/your_login_name/public_html</code> directory on the server. It's late so you go to bed.</p> <p>The next day you go to <code>https://mysite.com/allsky</code> and see your Website, but notice the startrails, keogram, and timelapse files aren't there.</p> <p>To help determine what's happening you run the following on your Pi:</p> <pre><code>allsky-config  compare_paths  --website\n</code></pre> <p>This command tries to determine both paths to the allsky directory - the location on the server where the <code>https://mysite.com/allsky</code> points to, and the location of the directory on the server when you log into it.</p> <p>It returns:</p> <pre><code>UPLOAD directory = /users\nWEB    directory = C:\\www\\users\\your_login_name\\public_html\\allsky\nA list of files on the UPLOAD site is in '/home/pi/allsky/tmp/comparePaths.sh-WEBSITE/upload-ls.txt'.\nA list of files on the WEB server is in '/home/pi/allsky/tmp/comparePaths.sh-WEBSITE/web-ls.txt'.\n</code></pre> <p>The <code>UPLOAD</code> directory is what you see when you log into the server. The WEB directory is where the allsky directory is on the server when you log into it, i.e., it's the directory on the server that the <code>https://mysite.com/allsky</code> URL maps to.</p> <p>You notice that both directories have users in them so you (correctly) determine the /users UPLOAD directory is the same as the C:\\www\\users directory on the server. That means the files that are being displayed in a browser are in <code>users/your_login_name/public_html/allsky</code> on the server. Allsky uploads files to the location specified in the Image Directory setting, which is still users/your_login_name/allsky. You look at that directory on the server and see the startrails, keogram, and timelapse files.</p> <p>You fix the problem by changing Image Directory to <code>users/your_login_name/public_html/allsky</code> and deleting the users/your_login_name/allsky directory on the server since it's not used. You then run generateForDay.sh --upload on the Pi to have Allsky upload the startrails, keogram, and timelapse files from last night to the correct place.</p>"},{"location":"allsky_guide/howtos/new_camera.html","title":"Support For A New Camers","text":"<p>This page describes how to request that Allsky support a camera.</p>"},{"location":"allsky_guide/howtos/new_camera.html#zwo-cameras","title":"ZWO Cameras","text":"<p>Open a new Discussions in GitHub using the New feature requests category. Let us know what model of ZWO camera it is, and if you know it, when the camera came out.</p> <p>Allsky uses a library provided by ZWO, and that library determines what cameras are supported. ZWO comes out with a new library every few months, so if your camera isn't supported that means the camera is newer than the library Allsky is using. We normally update the library when we release a new Allsky version.</p> <p>Advanced users</p> <p>If you can't wait for the next Allsky version you can download the newest ZWO library and install it yourself. Search for \"zwo downloads\" on the Web and go to the ZWO site. Look for the \"Developer\" page and download the Linux/Windows/Mac SDK to your Pi. Unzip the file and copy the libASICamera2.a files from the library to the various ~/allsky/src/lib/arm* directories on the Pi, then execute:</p> <pre><code>cd ~/allsky/src\nmake capture_ZWO\nsudo systemctl stop allsky\ncp capture_ZWO ../bin\nsudo systemctl start allsky\n</code></pre> <p>Allsky should now recognize your camera.</p>"},{"location":"allsky_guide/howtos/new_camera.html#rpi-cameras","title":"RPi Cameras","text":"<ul> <li> <p>Step 1: Check if the camera is good for allsky</p> <p>Connect the camera(s) to the Pi. If you have a single RPi camera connected to your Pi, run:</p> <pre><code>allsky-config  new_rpi_camera_info\n</code></pre> <p>If you have multiple RPi cameras connected, run the following, replacing NUM with the camera number - 0 is the first camera and 1 is the second camera.</p> <pre><code>allsky-config  new_rpi_camera_info --camera NUM\n</code></pre> <p>Either way, after a few seconds you'll see something like:</p> <pre><code>Maximum exposure time for sensor 'imx708_wide_noir' is 220.5 seconds.\n&gt;&gt;&gt; This will make a good allsky camera. &lt;&lt;&lt;\n\n************************\nWhen requesting support for this camera, please attach\n    /home/pi/allsky/tmp/camera_data.txt\nto your request.\n************************\n</code></pre> <p>Warning</p> <p>The maximum exposure times of many RPi and compatible cameras are very short, e.g., 15 seconds, so do not make very good allsky cameras. Before requesting that Allsky support a camera (and ideally before you purchase the camera), make sure it'll make a good allsky camera.</p> <p>If the second line in the output is:</p> <pre><code>&gt;&gt;&gt;This is a short maximum exposure so may not make a good allsky camera.&lt;&lt;&lt;\n</code></pre> <p>you may want to consider a different camera. Nighttime exposures are typicall around 60 seconds, so any camera with a shorter maximum may not properly expose nighttime shots. Do NOT request support for the camera since it's likely no one else will use it either.</p> </li> <li> <p>Step 2: Request support</p> <p>If the longest exposure the camera supports is enough for you, open a new Discussions in GitHub with a New feature requests category. Attach the <code>/home/pi/allsky/tmp/camera_data.txt</code> file from above as well as a URL for information on the camera (often a URL of where you bought the camera).</p> </li> </ul>"},{"location":"allsky_guide/howtos/ssl.html","title":"Using SSL","text":"<p>SSL (Secure Socket Layers) allows you to use secure https URLs on your Pi for your WebUI and/or Allsky Website, instead of the less secure http. This is desirable (really, mandatory) when accessing the Pi from the Internet. If your Pi is only available on a local network, SSL isn't needed.</p>"},{"location":"allsky_guide/howtos/ssl.html#requirements","title":"Requirements","text":"<ol> <li>Allsky must be working on your Pi prior to installing SSL.</li> <li>You must already have an Internet domain name for your Pi. The instructions below use www.myallsky.com but replace that with your domain name.</li> <li>We assume that you used the default Pi user to install Allsky in /home/pi, so adapt the path to your needs.</li> <li>You must forward the ports 80 and 443 to your Raspberry Pi private IP address on your router.</li> </ol> <p>Warning</p> <p>Installing SSL requires that your Pi be accessible via the Internet and can be a huge security risk if not done correctly.</p> <p>Do not attempt unless you know what you are doing. The Allsky developers are not responsible for any loss or damages.</p> <p>There are additional steps you should take to secure your Pi that aren't described in these instructions.</p> <p>If you aren't familiar with the following you're probably not qualified to install SSL:</p> <ul> <li>installing a firewall and a VLAN</li> <li>obtaining an Internet domain name</li> </ul> <p>There are many ways to implement SSL; the instructions below use the popular and free Let's Encrypt SSL .</p>"},{"location":"allsky_guide/howtos/ssl.html#software-installation","title":"Software installation","text":"<p>Install the following software on your Pi (you can copy/paste these lines into a terminal window):</p> <pre><code>sudo apt update\nsudo apt install software-properties-common certbot\nmkdir -p ~/allsky/config/ssl/www.myallsky.com\nchmod -R 775 ~/allsky/config/ssl\n</code></pre> <p>If you are not using the default user name of pi, run whoami to determine your user name, then replace all occurances of pi in the commands below with your user name.</p> <p>In your favorite text editor create a file called /etc/lighttpd/conf-enabled/97-certbot.conf. For example with the nano text editor:</p> <pre><code>sudo nano /etc/lighttpd/conf-enabled/97-certbot.conf\n</code></pre> <p>Add these lines to the file:</p> <pre><code>$HTTP[\"url\"] =~ \"^/.well-known/\" {\n    alias.url += ( \"/.well-known/\" =&gt; \"/home/pi/allsky/config/ssl/www.myallsky.com/.well-known/\" )\n}\n</code></pre> <p>Save the file with Ctrl+x.</p> <p>Restart the lighttpd web service to use the new configuration:</p> <pre><code>sudo systemctl restart lighttpd.service\n</code></pre>"},{"location":"allsky_guide/howtos/ssl.html#certificates-generation","title":"Certificates generation","text":"<p>The cerbot command will prompt for registration and create the SSL certificate and private key. Replace x@y.com with your email:</p> <pre><code>sudo certbot certonly --webroot -w allsky/config/ssl/www.myallsky.com \\\n    -d www.myallsky.com -m x@y.com --agree-tos\n</code></pre> <p>Combine the certificate and private key into one file:</p> <pre><code>sudo cat /etc/letsencrypt/live/www.myallsky.com/cert.pem \\\n    /etc/letsencrypt/live/www.myallsky.com/privkey.pem | \\\n    sudo tee /etc/letsencrypt/live/www.myallsky.com/fullchain.pem\n</code></pre> <p>Web server configuration</p> <p>Configure lighttpd to use SSL and redirect any \"http\" requests on your Pi to \"https\" requests. Create a file called <code>/etc/lighttpd/conf-enabled/98-www.myallsky.com&gt;.conf</code>:</p> <pre><code>sudo nano /etc/lighttpd/conf-enabled/98-www.myallsky.com.conf\n</code></pre> <p>Add these lines to the file:</p> <pre><code>server.modules += ( \"mod_openssl\" )\n\n$SERVER[\"socket\"] == \":443\" {\n        ssl.engine = \"enable\"\n        ssl.pemfile = \"/home/pi/fullchain.pem\"\n        ssl.ca-file = \"/home/pi/chain.pem\"\n        ssl.privkey = \"/home/pi/privkey.pem\"\n        server.name = \"www.myallsky.com\"\n\n        # Uncomment the next line if you want the web server to log access requests.\n        # accesslog.filename = \"/var/log/lighttpd/www.myallsky.com_access.log\"\n}\n\n$HTTP[\"scheme\"] == \"http\" {\n        $HTTP[\"host\"] == \"www.myallsky.com\" {\n                url.redirect = (\"\" =&gt; \"https://${url.authority}${url.path}${qsa}\")\n                url.redirect-code = 308\n        }\n}\n</code></pre> <pre><code>cd\nsudo cp /etc/letsencrypt/live/www.myallsky.com/{privkey.pem,fullchain.pem,chain.pem} .\nsudo chown pi:pi privkey.pem fullchain.pem chain.pem\nsudo chmod 644 privkey.pem fullchain.pem chain.pem\nsudo systemctl restart lighttpd.service\n</code></pre>"},{"location":"allsky_guide/howtos/ssl.html#testing","title":"Testing","text":"<p>Try to access your Pi via both http://www.myallsky.com&gt; and https://www.myallsky.com&gt;. You should see the WebUI in both cases.</p>"},{"location":"allsky_guide/howtos/ssl.html#renewal-process","title":"Renewal process","text":"<p>Let's Encrypt certificates are only valid for 90 days. You need to configure the Pi to renew your certificates before they expire (or do it manually).</p> <p>First, renew your certificate, replacing x@y.com with your email:</p> <pre><code>sudo certbot certonly --webroot -w allsky/config/ssl/www.myallsky.com \\\n    -d www.myallsky.com -m x@y.com --agree-tos\n</code></pre> <p>You should see output similar to below:</p> <pre><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator webroot, Installer None\nCert not yet due for renewal\n\nYou have an existing certificate that has exactly the same domains or certificate name you requested and isn't close to expiry.\n(ref: /etc/letsencrypt/renewal/www.myallsky.com.conf)\n\nWhat would you like to do?\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n1: Keep the existing certificate for now\n2: Renew &amp; replace the certificate (may be subject to CA rate limits)\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSelect the appropriate number [1-2] then [enter] (press 'c' to cancel):\n</code></pre> <p>Select option 2. You will then see:</p> <pre><code>Renewing an existing certificate for www.myallsky.com\nPerforming the following challenges:\nhttp-01 challenge for allsky02.my-cosi.info\nUsing the webroot path /home/pi/allsky/config/ssl/www.myallsky.com.info for all unmatched domains.\nWaiting for verification...\nCleaning up challenges\n\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at:\n   /etc/letsencrypt/live/www.myallsky.com/fullchain.pem\n   Your key file has been saved at:\n   /etc/letsencrypt/live/www.myallsky.com/privkey.pem\n   Your certificate will expire on 2024-09-07. To obtain a new or\n   tweaked version of this certificate in the future, simply run\n   certbot again. To non-interactively renew *all* of your\n   certificates, run \"certbot renew\"\n - If you like Certbot, please consider supporting our work by:\n\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n</code></pre> <p>Now combine the certificate and private key created above into one file:</p> <pre><code>sudo cat /etc/letsencrypt/live/www.myallsky.com/cert.pem \\\n    /etc/letsencrypt/live/www.myallsky.com/privkey.pem | \\\n    sudo tee /etc/letsencrypt/live/www.myallsky.com/fullchain.pem\n</code></pre> <p>Now copy the files to your home directory and restart the web server to use the new configuration certs files:</p> <pre><code>cd\nsudo cp /etc/letsencrypt/live/www.myallsky.com/{privkey.pem,fullchain.pem,chain.pem} .\nsudo chown pi:pi privkey.pem fullchain.pem chain.pem\nsudo chmod 644 privkey.pem fullchain.pem chain.pem\nsudo systemctl restart lighttpd.service\n</code></pre> <p>Info</p> <p>You can renew your Let's Encrypt certificates at most 30 days before they expire - two weeks prior to expiration is a good goal. You will also receive an email from letsencrypt before your certificates expire.</p>"},{"location":"allsky_guide/howtos/ssl.html#notes","title":"Notes","text":"<ul> <li> <p>Your SSL-related files are stored in ~/allsky/config/ssl and will be preserved across Allsky upgrades.</p> </li> <li> <p>When you are done installing and testing SSL, make a copy of the following items and store on something other than your Pi in case your Pi crashes:</p> </li> <li> <p><code>/etc/letsencrypt</code> directory</p> </li> <li><code>~/allsky/config/ssl</code> directory</li> <li><code>/etc/lighttpd/conf-available/97-certbot.conf</code></li> <li><code>/etc/lighttpd/conf-available/98-www.myallsky.com.conf</code></li> <li><code>/home/pi/fullchain.pem</code></li> <li><code>/home/pi/chain.pem</code></li> <li><code>/home/pi/privkey.pem</code></li> </ul>"},{"location":"allsky_guide/howtos/startrails.html","title":"Startrails","text":"<p>A startrail image shows the apparent paths of stars across the sky over an extended period of time. It is created by combining many individual long-exposure or short-exposure images taken sequentially, typically over several hours, and stacking them so that each star\u2019s movement forms a continuous arc.</p> <p>These arcs are caused by the rotation of the Earth, which makes the stars appear to move around the celestial poles. The length of each trail corresponds to the duration of time covered by the images, while the curvature and direction of the trails depend on the camera\u2019s orientation and the observer\u2019s latitude.</p> <p>In an Allsky context, startrails are used to:   - Illustrate Earth\u2019s rotation in a visually intuitive way</p> <ul> <li> <p>Summarise an entire night of observations in a single image</p> </li> <li> <p>Reveal cloud interruptions, gaps in imaging, or camera downtime</p> </li> <li> <p>Highlight the position of the celestial pole and overall sky coverage</p> </li> <li> <p>Highlight, meteor and aircraft trails</p> </li> </ul> <p>Startrail images provide both scientific and aesthetic value, turning many hours of sky monitoring into a single, easily interpreted visual record.</p> <p>Warning</p> <p>Only nighttime images that are saved are included in a startrails, so if you don't save your nightime images, they won't be included.</p> <p></p> <p>Example Startrails Image</p>"},{"location":"allsky_guide/howtos/startrails.html#creating-a-startrail","title":"Creating a Startrail","text":"<p>To have a startrails image automatically created at the end of each night, enable the Generate  setting in the Startrails sub-section of the WebUI.</p> <p>To manually create a startrails image run the generateForDay.sh command. For example, to create and then upload a startrails to any Allsky Website and/or remote server you have for July 10, 2025:</p> <pre><code>generateForDay.sh --startrails 20250710\ngenerateForDay.sh --upload --startrails 20250710\n</code></pre> <p>This will use the settings specified in the Startrails sub-section of the WebUI.</p> <p>If you want to experiment using other settings you can specify those settings as such:</p> <pre><code>generateForDay.sh --startrails 20240710 --startrails-params \"--brightness 0.15 -o ~/allsky/tmp/test.jpg\"\n</code></pre> <p>This will use a Brightness Threshold of 0.15 and put the resulting startrails in ~/allsky/tmp/test.jpg.</p> <p>Make sure the parameters are enclosed in quotes.</p> <p>See the Advanced section below for the possible parameters you can specify.</p> Advanced users: running the startrails program manually <p><code>generateForDay.sh</code> calls the startrails program to actually create the startrails, passing it several required arguments (the underlined ones below), plus any others you add to the Startrails Extra Parameters setting.</p> <p>Executing the startrails manually is possible, but not very useful.</p> <p>``` Usage: startrails [-v] -i  | -d  -e  \\   [-b  -o  | -S][-D ]  \\   [-s ][-Q ] [-q ] <p>Arguments:   -h | --help : display this message, then exit.   -v | --verbose : increase log verbosity.   -S | --statistics : print image directory statistics without producing image.   -i | --images  : file containing list of images to process.         If the file also contains the mean brightness for an image, it will be used.   -d | --directory  : directory from which to read images.         If --images is specified then --directory is not needed unless.         one or more image names does not start with a '/'..   -D | --output-data  : save per-image summary data to the specified file.   -e | --extension  : filter images to just this extension.   -Q | --max-threads  : limit maximum number of processing threads (all cpus).   -q | --nice-level  : nice(2) level of processing threads (10).   -o | --output  : output image filename.   -s | --image-size x : restrict processed images to this size.   -b | --brightness  : ranges from 0 (black) to 1 (white). (0.35).   A moonless sky may be as low as 0.05 while full moon can be as high as 0.4.   ```</p> <p>Example of running the startrails program manually:</p> <p><code>cd ~/allsky/bin   ./startrails -d images/20250710 -e jpg -b 0.15 -o images/20250710/startrails/startrails.jpg</code></p>"},{"location":"allsky_guide/howtos/startrails.html#startrails-settings","title":"Startrails settings","text":"<p>The only configuration setting for startrails is Brightness Threshold. Images have an average, or \"mean\" brightness level from 0.0 (pure black) to 1.0 (pure white). The default Brightness Threshold is 0.1 which is a fairly dark image, typical of a moon-less night.</p> <p>Any image with an average brightness greater than the Brightness Threshold is skipped during startrails generation, so daytime images should be skipped. You need to experiment with this setting to get the best results, as allsky cameras, lenses, and sky conditions impact an image's average brightness, and hence what you use for this setting. Every time a startrails image is created a summary of brightness values is saved to the Allsky log file.</p> <p>If you aren't seeing trailed stars in your images and you get a message like \"No images below threshold 0.100, writing the minimum image only\", your images are too bright and Brightness Threshold needs to be reduced. To determine what number to use you need to know the typical nighttime sky brightness value. Do the following:</p> <ul> <li> <p>Run <code>allsky-config get_startrails_info</code> to see what your brightness values are.</p> </li> <li> <p>If there is no data yet a message will appear with a possible reason, otherwise the output will look like: </p><pre><code>Startrails date        Minimum   Maximum   Mean      Median    Images used   Not used  Threshold\n------------------------------------------------------------------------------------------------\n2025-01-17  06:20:45   0.084     0.146     0.103     0.105     250           3         0.15\n2025-01-18  06:16:18   0.045     0.135     0.102     0.106     247           6         0.15\n------------------------------------------------------------------------------------------------\nAverages               0.065     0.140     0.103     0.106     497           9         -\n\n1 entry not used due to invalid data.\n</code></pre><p></p> </li> </ul> <p>Note</p> <p>Note that the Mean brightness is determined by looking at the whole image, including any black areas. This number is likely different from the mean brightness that can be overlayed onto your images, which is determined by looking at the central portion of an image.</p> <p>If you crop your image, add a mask to it, or change cameras you'll most likely need to update the Brightness Threshold setting.</p> <ul> <li>Set the Brightness Threshold to the Maximum, or slightly below it. If you have an Averages line, use its Maximum.</li> </ul> <p>You'll now create a startrails and if needed, change Brightness Threshold, then create another startrails, change the setting, etc.</p> <ul> <li> <p>To make startrails generation MUCH faster, do it using a small number of images.</p> </li> <li> <p>Create a temporary directory to hold some nighttime images: <code>mkdir ~/allsky/images/test</code>.</p> </li> <li> <p><code>cd ~/allsky/images/DATE</code>, replacing DATE with the date of a non-working startrails.</p> </li> <li> <p>Using the timestamp of each image, move a few hours of nighttime images to the ~/allsky/images/test directory:</p> <ul> <li> <p>If you are running SAMBA (<code>allsky-config samba</code>) you can view the files from your PC or Mac and then select some files with the mouse and drag to the test directory.</p> </li> <li> <p>If you are not running SAMBA and you are logged into the Pi desktop, open a \"File Manager\" window on the Pi and drag/drop the files.</p> </li> <li> <p>If neither of the above work for you, you'll need to use the mv command to move the files. Using the * wildcard in the file names will allow you to move multiple files at a time.</p> </li> </ul> <p>For example: <code>mv 2025071001* ../test</code> to move all the images taken from 1:00 AM to 1:59 AM.</p> </li> <li> <p>Run ``generateForDay.sh --startrails test``` to create a startrails file in the test directory. Look at the image using the Images page in the WebUI. Also look at the Images used and Not used columns of the output.</p> </li> <li> <p>As needed, adjust Brightness Threshold and re-run <code>generateForDay.sh</code>.</p> </li> <li> <p>When done, move all the images from the allsky/images/test directory back to allsky/images/DATE.</p> </li> <li> <p>Remove the temporary directory: <code>rmdir ~/allsky/images/test</code>.</p> </li> <li> <p>Now, create the final startrails:</p> <ul> <li> <p><code>generateForDay.sh --startrails DATE</code></p> </li> <li> <p>If you want to upload the file you just created, see the note generated by <code>generateForDay.sh</code>.</p> </li> </ul> </li> </ul>"},{"location":"allsky_guide/howtos/startrails.html#troubleshooting","title":"Troubleshooting","text":"<p>Info</p> <p>It's extremely rare that a startrails image isn't created at all. It's much more common that an image is created but none of the stars have trails. If none of the stars have trails, see the Startrails settings section above.</p> <p>Warning</p> <p>The resolution of all images must be identical; if not, only images with the same resolution as the FIRST image are used.</p> <p>This can happen if the daytime and nighttime Binning settings are not the same, or any day you change the Image Resize and/or Image Crop settings.</p> <ul> <li> <p>If a startrails image isn't being created, make sure the Startrails Generate setting is enabled. If it IS enabled, run:</p> <p><code>generateForDay.sh  --startrails  DATE</code></p> <p>replacing DATE with a valid date like 20250710 and check for errors.</p> </li> <li> <p>If a startrails image is created but not uploaded, make sure the Startrails Upload setting is enabled. If that IS enabled, run:</p> <p><code>generateForDay.sh  --upload  --debug  --startrails  DATE</code></p> <p>and check for errors. If needed, run testUpload.sh to see why the upload fails.</p> </li> </ul>"},{"location":"allsky_guide/howtos/system_page.html","title":"System Page Additions","text":"<p>You can add information and buttons to the WebUI's System page without having to change any Allsky files. The data can be anything you want, but often contains weather, dew heater, and/or fan data.</p> <p>This documentation page assumes you are familiar with writing scripts; if so, adding the information is straightforward if you follow the instructions on this page. The image below shows the types of items that can be added:</p> <ol> <li>Simple data: \"Allsky is the     BEST!!!\"</li> <li>Progress bar: \"Dew heater status\"</li> <li>Buttons: \"Heater ON\" and \"Heater OFF\". Clicking a button performs an action that you define.</li> </ol> <p></p> <p>Example System Page With Added Buttons</p>"},{"location":"allsky_guide/howtos/system_page.html#details","title":"Details","text":"<p>The information to display on the System page is described in one or more \"data files\" which are listed in the System Page Additions setting. This section describes the format of those data files.</p> <p>Each data file contains one or more lines. Blank lines and lines that begin with # are ignored. Each remaining line will display something on the System page and must contain the fields listed in the tables below, separated by tabs.</p> <p>As a very simple example, if you want to add the 2 buttons in the image above to turn your dew heater on and off you'd have a file called, for example, <code>/home/pi/my_buttons.txt</code>. That file needs 2 lines describing the attributes for each button such as color and what it should say (e.g., \"Heater ON\"). The exact contents of those lines are described below. The buttons appear on the System page when you set the System Page Additions setting to <code>/home/pi/my_buttons.txt</code>.</p> <p>There are three types of lines in a data file. The first word of a line determines what type of line it is:</p> <ol> <li> <p>data lines specify basic, two-column information that goes before the first progress bar. These lines are good when the data has a single value like:</p> <p><code>Ambient temperature     20 C</code></p> </li> <li> <p>progress lines display as progress bars like the CPU Temperature bar in the image above. Your bars go after the last system-supplied progress bar and are good when the data has an associated status, for example, when the CPU is too hot its bar turns red.</p> </li> <li>button lines add a button to the page under the last system-supplied button, and are used to initiate an action like turning a dew heater on.</li> </ol>"},{"location":"allsky_guide/howtos/system_page.html#data-lines","title":"Data Lines","text":"Fields Description Typically changes type Must be <code>data</code>. Defines the line type. Never timeout Number of seconds after the data file was created that the data should expire. <code>0</code> disables the check. Expired data has (EXPIRED) appended to the label. No label The name for this data, for example: <code>Ambient temperature</code>. No data The actual data - what should appear in the second column on the web page. For example, for <code>20 C</code>. Yes - every time new data is written to the file"},{"location":"allsky_guide/howtos/system_page.html#progress-lines","title":"Progress Lines","text":"Fields Description Typically changes type Must be <code>progress</code>. Defines the line type. Never timeout Number of seconds after the data file was created that the data should expire. 0 disables the check. Expired data has (EXPIRED) appended to the label. No. label The name for this data, for example: <code>Dew point</code>. No. data The data to appear inside the progress bar. Typically a number followed by an optional unit specifier, for example, <code>20 C</code> for temperature, but could be any text. Yes - every time new data is written to the file. minimum value The minimum possible value of current value; often 0, but for a temperature will usually be negative. Must be a number. No. current value The current value of the data. This determines how wide the progress bar is. Will typically be the same as data without the unit specifier, for example, <code>20</code>. This value should normally be between minimum value and maximum value inclusive. Must be a number. Yes - every time new data is written to the file. maximum value The maximum possible value of current value; often 100, especially for percents. For a temperature, use the highest value you expect the temperature to be. Must be a number. No. danger A current value greater than or equal to the danger value causes the progress bar to turn red. Must be a number. No. warning A current value greater than or equal to the warning value and less than the danger value causes the progress bar to turn amber. The progress bar will be green. for any value less than warning. Must be a number. No."},{"location":"allsky_guide/howtos/system_page.html#button-lines","title":"Button Lines","text":"Fields Description Typically changes type Must be <code>button</code>. Defines the line type. Never message An optional message that should appear at the top of the page after the button is pressed, if the button command was successful. For example, Dew heater turned on. If the command was not successful an error message is displayed containing any output from the command. Use - (minus sign) to indicate no message should be displayed on success (error messages will still be displayed). No. command The script that should be executed when the button is pressed. For example, /home/pi/turn_on_dew_heater.sh. If needed you can prepend sudo to the command. No. button color The button's color. Choices are: red, green, blue, yellow, cyan, white, and black. See the Tips section for information on button colors. No. FA icon The Fonts Awesome (FA) icon on the button. For example, the right-facing triangle on the \"Start Allsky\" button has an FA icon of \"play\". If you don't want an icon on the button, enter - (minus sign). No. button label What should appear on the button face, for example, Heater ON. No."},{"location":"allsky_guide/howtos/system_page.html#example","title":"Example","text":"<p>This section gives an example of adding items to the WebUI's System page. The example assumes you have a weather station that provides the ambient temperature, humidity, and dew point. Further, your allsky camera has a dew heater that you want to automatically turn on and off depending on the weather.</p> <p>You wrote a script called <code>/home/pi/weather/getWeatherData.sh</code> that polls the weather station and writes the ambient temperature, humidity, and dew point to a data file called <code>/home/pi/weather/weatherdata.txt</code> every minute. You must manually turn the dew heater on and off via a Python script called <code>/home/pi/dewheater/toggleDewHeater.py</code>. This command toggles the status of the dew heater and writes the new status (either \"on\" or \"off\") to the data file <code>/home/pi/dewheater/status.txt</code> whenever you call the script.</p> <p>To get this working, consider the following:</p> <p>Determine what data you want to display</p> <p>You want to display the temperature, humidity, dew point, and dew heater status. You will use the humidity and dew point numbers to determine if you should turn the dew heater on or off via a toggle button you'll add to the web page. You want the ambient temperature in Celsius.</p> <p>Here's what you'll add to the WebUI's System page:</p> <ul> <li>temperature</li> <li>humidity</li> <li>dew point</li> <li>dew heater status</li> <li>a button to toggle the dew heater on/off</li> </ul> <p>Determine what you want to call the items</p> <p>This is pretty easy. You will set the label fields as follows:</p> <ul> <li>temperature: Ambient temperature</li> <li>humidity: Humidity</li> <li>dew point: Dew point</li> <li>dew heater status: Dew heater status</li> <li>button: Toggle dew heater</li> </ul> <p>Determine how you want the data displayed</p> <p>The temperature is just a number with no \"good\" or \"bad\" value so it will be of type data. Although the dew point is also just a number, you want to highlight it when it's getting close to the ambient temperature so you'll know it's possible for dew to form. Hence, it will be of type progress.</p> <p>If the humidity gets too high you want to call attention to it, so it will be of type progress.</p> <p>The dew heater toggle switch will be of type button.</p> <p>Determine expiration timeout</p> <p>If the weather data gets too old it may fool you into turning the dew heater off when it should remain on, so you want its data to expire. Your weather station provides new data every minute. If it misses a minute or two you don't want the data on the System page to turn red, so you'll set the temperature and dew point timeout fields to 300 seconds (5 minutes). Just for fun you'll set the humidity timeout value to 600 seconds (10 minutes). The dew heater status information doesn't change unless you manually turn it on or off, so you don't want it's status to expire, hence will use 0 for its timeout value.</p> <p>Timeout values don't apply to buttons.</p> <p>Determine progress bar cutoff values</p> <p>You've noticed that when the humidity gets above 90% you get dew on the inside of the dome, so you'll set the dew heater danger value to 85 so it's bar turns red. You aren't sure what to use for the warning value so you'll initially set it to 75, and will adjust it later if needed. By definition humidity ranges from 0% to 100% so use 0 and 100 for its minimum value and maximum value respectively.</p> <p>The cutoffs for the dew point will vary based on the temperature so require some logic in getWeatherData.sh. Let's say you decide to set the dew point danger cutoff to be 90% of the ambient temperature, and the warning cutoff to be 80%. This means if the ambient temperature is 20 C, the dew point danger cutoff would be 18 C (20 * 0.9) and the warning cutoff would be 16 C (20 * 0.8). You aren't interested in dew point values significantly less than the ambient temperature since the chance of dew in those cases is almost zero, so you'll set the dew point minimum value to the ambient temperature minus 5 degrees. Likewise, you aren't interested in dew point values significantly greater than the ambient temperature since it's almost certain there will be dew, so you'll set the maximum value to the dew point danger value plus 3 degrees. This in effect sets the left side of the progress bar to be (ambient - 5) and the right side of the bar to be (danger + 3).</p> <p>[This may be confusing now, but will clear up when you see what it looks like and play around with different values.]</p> <p>The other items are of type data and button so this step doesn't apply to them.</p> <p>Determine what the buttons should look like</p> <p>You like green so will make the dew heater toggle button green by specifying its button color as green. You want an icon on the button since the other buttons have icons, so you go to Font Awesome   to look for an icon (Allsky uses Font Awesome version 6). You pick the \"random\" icon so set the button's FA icon field to random.</p> <p>Specify the data files</p> <p>You need to enter the names of your data files (i.e., the files created by your scripts) in the System Page Additions setting. But how many data files should you have? You could put everything in one file but you have two scripts that create data files and would need to coordinate between them so they don't overwrite each other. You decide on three data files containing:</p> <ul> <li>weather data</li> <li>dew heater status</li> <li>button information</li> </ul> <p>You could have put the button information in the first or second file, but to simplify the <code>toggleDewHeater.py</code> script you put it in a 3rd file that will never change. You call the 3rd file <code>/home/pi/dewheater/button.txt</code>.</p> <p>This is what you enter into the System Page Additions setting.</p> <pre><code>/home/pi/weather/weatherdata.txt:/home/pi/dewheater/status.txt:/home/pi/dewheater/button.txt\n</code></pre> <p>Info</p> <p>The file names must be full path names and must be separated by colons (\":\").</p> <p>The data, progress, and button lines in the first data file will appear first on the System page; those in the second file will appear second, etc. You can change the order items appear by changing the order of data file names in the System Page Additions setting.</p> <p>Create/modify scripts to update the data file(s)</p> <p>The <code>getWeatherData.sh</code> script needs to write the three weather data lines to <code>/home/pi/weather/weatherdata.txt</code>. It helps if you have the script create header lines in the output file so you remember what field is what. The script's logic would be:</p> <ol> <li>Get the data from the hardware.</li> <li>Optionally write a data header comment to /home/pi/weather/weatherdata.txt. See line 1 below.</li> <li>Append the Ambient temperature data line to the file (line 2).</li> <li>Optionally append a blank line for readability (line 3).</li> <li>Optionally append a progress header comment to the file (line 4).</li> <li>Calculate new danger, warning, minimum value, and maximum value numbers for the Dew point based on the ambient temperature (line 5).</li> <li>Append the Dew point progress line (line 6).</li> <li>Append the Humidity progress line (line 7).</li> <li>Wait for some period of time, then go back to step 1.</li> </ol> <p>Using the decisions you made above, the <code>/home/pi/weather/weatherdata.txt</code> would look like the following, assuming the temperature was 20 C, the dew point was 17 C, and the humidity was 87%.</p> <p>Info</p> <p>The initial line numbers below are only for illustration purposes and should NOT appear in your file.</p> <pre><code>1   # Type  Timeout Label           Data\n2   data    300 Ambient temperature 20 C\n3   \n4   # Type  Timeout Label           Data    Min Current Max Danger  Warning\n5   progress    300 Dew point       17 C    12  17  21  18  16\n6   progress    600 Humidity        87% 0   87  100 85  75\n</code></pre> <p>Note all fields are separated by one or more tabs (multiple tabs in a row are counted as a single tab). The header lines (which are ignored since they begin with #) can be in any format, so to ensure you have the correct fields you lined the header fields up with the data fields below.</p> <p>The toggleDewHeater.py script needs to write the data line for the dew heater status to /home/pi/dewheater/status.txt every time it is executed. Its logic is:</p> <ol> <li>Get the dew heater status from the hardware.</li> <li>Toggle the status.</li> <li>Optionally write a data header comment line to <code>/home/pi/dewheater/status.txt</code>.</li> <li>Append the new dew heater status data line to the file.</li> <li>Output \"Dew heater turned on\" or \"Dew heater turned off\".</li> <li>Exit.</li> </ol> <p>The <code>/home/pi/dewheater/status.txt</code> file will look like the following after clicking the button, assuming the dew heater is currently off.</p> <pre><code># Type    Timeout  Label                 Data\ndata      0        Dew heater status     on\n</code></pre> <p>Since the toggle button won't change, create the <code>/home/pi/dewheater/button.txt</code> file manually:</p> <pre><code># Type    Message  Command                                 Color   FA icon  Button  Label\nbutton    -        /home/pi/dewheater/toggleDewHeater.py   green   random   Toggle  dew heater\n</code></pre> <p>Notice the Message field is - which means there's no message to display on success. This is because the <code>toggleDewHeater.py</code> command outputs \"Dew heater turned on\" or \"Dew heater turned off\", and that output is displayed as a message. Remember that if <code>toggleDewHeater.py</code> exits with a failure (i.e., a non-0 exit code) any error message it outputs will be displayed as an error message on the web page so you should make sure those error messages are useful.</p> <p>When you press the \"Toggle dew heater\" button it will update the <code>/home/pi/dewheater/status.txt</code> data file by changing the \"off\" to \"on\" or vice versa. The rest of the data file remains the same.</p> <p>Warning</p> <p>Commands listed in a button's Command field must be executable by the web server running as group www-data, and must be in a directory that the web server has permissions to get to.</p> <p><code>chmod g+x /home/pi/dewheater/toggleDewHeater.py</code> will fix permissions on the Command.</p> <p>Files written from a button's Command must be writable by www-data.</p> <p><code>chgrp www-data /home/pi/dewheater/status.txt; chmod g+w /home/pi/dewheater/status.txt</code> will fix permissions on the file.</p> <p>Test, test, test. Then test some more.</p> <p>To get a feel for what things look like and how the above actually works, copy/paste the above file examples to <code>/home/pi/weather/weatherdata.txt</code>, <code>/home/pi/dewheater/status.txt</code>, and <code>/home/pi/dewheater/button.txt</code> files on your Pi. Then add</p> <p></p><pre><code>/home/pi/weather/weatherdata.txt:/home/pi/dewheater/status.txt\n</code></pre> to the System Page Additions setting.<p></p> <p>Now, go to the <code>System</code> page in the WebUI and in addition to the normal information you should see the items you added. Refreshing the screen won't change those items since the data files are not being updated yet.</p> <p>Clicking the \"Toggle dew heater\" button should display a red message at the top of the web page that says <code>'/home/pi/dewheater/toggleDewHeater.py' failed: sh: 1: /home/pi/dewheater/toggleDewHeater.py</code>: not found\" That's the output when the web page tried to execute <code>/home/pi/dewheater/toggleDewHeater.py</code> which doesn't exist.</p> <p>Try making changes to the three files you created. For example, change the command for the button to <code>echo 'Hello, world!'</code>. When you next click on the button you should see a green message at the top saying \"Hello, world!\". Now change it to <code>echo 'Hello, world!' ; exit 1</code>. What happens now?</p> <p>After you understand what's happening and why, start modifying your script(s) to put your own data into the required format.</p>"},{"location":"allsky_guide/howtos/system_page.html#tips","title":"Tips","text":"<ul> <li> <p>Do not store your data files in the allsky directory since they won't be saved when upgrading Allsky. Instead, create a directory one level above allsky and put all your files there. The System Page Additions setting WILL be saved when upgrading Allsky.</p> </li> <li> <p>HTML and CSS code can be applied to message, label, and data fields to add color, bolding, etc. That's how \"Allsky is the     BEST!!!\" was formatted in the image at the top of this page.</p> </li> <li> <p>To see what the button colors look like, add the following lines to <code>/home/pi/dewheater/button.txt</code>:</p> <pre><code>button  -   /home/pi/dewheater/toggleDewHeater.py   red     random  red\nbutton  -   /home/pi/dewheater/toggleDewHeater.py   green   random  green\nbutton  -   /home/pi/dewheater/toggleDewHeater.py   blue    random  blue\nbutton  -   /home/pi/dewheater/toggleDewHeater.py   yellow  random  yellow\nbutton  -   /home/pi/dewheater/toggleDewHeater.py   cyan    random  cyan\nbutton  -   /home/pi/dewheater/toggleDewHeater.py   white   random  white\nbutton  -   /home/pi/dewheater/toggleDewHeater.py   black   random  black\n</code></pre> <p></p> </li> </ul>"},{"location":"allsky_guide/howtos/system_page.html#troubleshooting","title":"Troubleshooting","text":"<p>Below are some warning messages you may receive and how to resolve them.</p> <p>Wrong line type</p> <p></p> <p>If you get this message but the first field IS one of those words, the fields probably aren't separated by tabs. In the example above, the data line type is misspelled.</p> <p>Incorrect number of fields</p> <p></p> <p>Look in the tables in the Details section to see how many fields each line type has as as well as what the fields are. Also make sure ALL fields are separated by tabs. In the example above, \"Dew heater status\" is the message, and the \"Data\" field is missing (e.g., \"ON\" or \"OFF\").</p> <p>No tabs found</p> <p></p> <p>Fields in the lines must be separated by one or more tabs. Although you can't tell from the message, the field in the file are separated by spaces.</p> <p>No permissions</p> <p>If your scripts require <code>sudo</code> you'll need to allow the web server to execute the scripts. To do so:</p> <ol> <li>Create a file called, for example, myCommands_sudo.txt in the same directory as your other files.</li> <li> <p>For each script that needs sudo add a line like:</p> <p><code>www-data ALL=(ALL) NOPASSWD:full_path_name_to_script</code></p> <p>replacing full_path_name_to_script with the name of the script. The web server runs as the www-data user; these lines allow the web server to use sudo to run your scripts.</p> </li> <li> <p>Run: <code>sudo  cp  myCommands_sudo.txt  /etc/sudoers.d</code></p> </li> <li>The file should normally be recognized immediately; if not, a reboot may be necessary.</li> </ol>"},{"location":"allsky_guide/howtos/timelapse.html","title":"Timelapse","text":"<p>A timelapse is a video created by combining a sequence of images taken at regular intervals and playing them back at a much higher speed than they were captured. This compression of time allows slow or gradual changes to be observed in a short, continuous video.</p> <p>In an all-sky imaging context, timelapses are commonly used to show:</p> <ul> <li> <p>The movement of stars, the Moon, and planets across the sky</p> </li> <li> <p>The progression of clouds and weather systems</p> </li> <li> <p>The transition from daylight to twilight and night, and back again</p> </li> <li> <p>Events such as aurora, airglow, or passing satellites</p> </li> </ul> <p>Each frame in the timelapse corresponds to a single captured image, and the final playback speed is determined by the capture interval and the frames-per-second (FPS) setting used when generating the video. Timelapses provide an intuitive and engaging way to review long periods of sky activity that would otherwise require examining many individual images.</p> <p>Allsky supports two types of timelapse:</p> <pre><code>1. Daily Timelapse\n2. Mini Timelapse\n</code></pre> <p>Settings for both types of timelapses are in the Timelapse Settings section of the WebUI's Allsky Settings page. Each type of timelapse has its own sub-section in the WebUI, and there is a sub-section that applies to both timelapse types.</p>"},{"location":"allsky_guide/howtos/timelapse.html#daily-timelapse","title":"Daily Timelapse","text":"<p>The \"Daily\" timelapse is the one that's created once a day, at the end of nighttime. It includes all the images saved in the last 24 hours.</p> <p>You specify whether or not you want a daily timelapse automatically created via the Generate   setting. When enabled, a daily timelapse will be created (and optionally uploaded) at the end of night.</p> <p>The easiest way to manually create and optionally upload a daily timelapse is via the <code>generateForDay.sh</code> command. For example, to create and then upload a daily timelapse to any Allsky Website and/or remote server you have for July 10, 2025:</p> <pre><code>generateForDay.sh --timelapse 20250710\ngenerateForDay.sh --upload --timelapse 20250710\n</code></pre> <p>This will use the settings specified in the Daily Timelapse sub-section of the WebUI.</p> <p>If you have a remote Website you'll most likely need to enable the Upload Thumbnail setting so the timelapse's thumbnail is created on the Pi and uploaded to the Website.</p> <p>If your camera has a lot of pixels you may need to resize the timelapse in order to decrease the processing power needed to create it and to reduce the file size. If so, update the Width and Height settings. Cutting each size in half is a good starting point.</p>"},{"location":"allsky_guide/howtos/timelapse.html#mini-timelapse","title":"Mini Timelapse","text":"<p>A mini timelapse contains a limited number of images and is constantly recreated throughout the day. For example, you can have a mini timelapse that shows the last 50 of images, and is recreated every 5 images. Note that every new mini timelapse replaces the prior one, so there is ever only one mini timelapse.</p> <p>You specify whether or not you want a mini timelapse created via the Number Of Images   setting. If greater than 0, mini timelapses will be created (and optionally uploaded) containing that number of images. You can enter any number you want, but beware:</p> <ul> <li> <p>A small number of images will produce a very short video. For example, a video with 5 images will usually last less than a second.</p> </li> <li> <p>A large number of images will take longer to create and depending on the speed of your Pi, could cause other things to run slowly.</p> </li> <li> <p>On a Pi 4, try starting with 50 images and adjust as needed.</p> </li> </ul> <p>If Number Of Images is greater than 0, a new mini timelapse will be created after the number of images you specify in Frequency. The smaller the number the more often a mini timelapse will be created, and the more processing power needed. Try starting off at 5 and adjust as needed.</p> <p>Mini timelapses are not designed to be created manually because some configuration files need to be updated after creation.</p>"},{"location":"allsky_guide/howtos/timelapse.html#change-the-timelapse-length","title":"Change the timelapse length","text":"<p>Two things determine how long a timelapse video is:</p> <pre><code>1. The number of images (called \"frames\") in a video.\n\n2. How many frames are displayed per second (called \"Frames Per Second\" or \"FPS\").\n</code></pre> <p>These are described in more details below.</p>"},{"location":"allsky_guide/howtos/timelapse.html#number-of-frames","title":"Number of frames","text":"<p>Everything else being equal, the more frames in a video, the longer it plays. Doubling the number of frames will double the video's length.</p> <p>To increase a video's length, do options A and/or B below.</p> <p>To decrease a video's length, do the opposite of the options below.</p> <ul> <li> <p>Decrease the interval between images.</p> <p>Depending on the speed of your Pi, the size of each image, and how much image processing you do (e.g., how complex your overlay is, if you crop or stretch the image, etc.), you may be able to get by with a delay of a second or two (1000 - 2000 ms). Make sure you DISABLE the Consistent Delays Between Images setting.</p> <p>Try a Delay of 2000 ms and let it run for a day. If Allsky can't keep up you'll get messages in the WebUI. You may be able to live with an occassional error, although you may get tired seeing the error messages.</p> <p>Advantages:</p> <ul> <li> <p>Easy to do.</p> </li> <li> <p>Videos will look smoother; stars and clouds won't \"jump\" as much from one image to the next.</p> </li> <li> <p>If you like capturing meteors and other items that appear for only a few seconds, a smaller delay means more time is spent capturing images versus waiting, so it can significantly increase your chances of catching items.</p> </li> </ul> <p>Disadvantages:</p> <ul> <li>More images take up more disk space.</li> </ul> </li> </ul> <p>Tip</p> <p>Most people start off adjusting the delay between images to change the length of a video.</p> <ul> <li>Take shorter exposures.</li> </ul> <p>In order to keep the image brightness the same, you must also increase the gain.</p> <p>Advantages:</p> <ul> <li>Easy to do.</li> <li>Moving objects will have less blur.</li> <li>Stars will have shorter trails, although you may not notice unless you zoom into the video.</li> </ul> <p>Disadvantages:</p> <ul> <li> <p>More images take up more disk space.</p> </li> <li> <p>It takes longer to create a timelapse with more images. For daily timelapses this may not be an issues since they are created while Allsky continues taking pictures.</p> </li> <li> <p>Image quality decreases as gain increases. There's probably a gain level where you'll say \"this is too grainy\".</p> </li> <li> <p>If you like capturing meteors, shorter exposures increase the time when no image is being taken, which increases the chance of missing a meteor.</p> <p>For example, assume your exposure length is 60 seconds and you have a 2 second delay between images. In an hour about 58 images will be taken and will be spent processing images and not taking them.</p> <p>Decreasing the exposure to 30 seconds produces 112 images but increases the total delay to about 3 minutes 45 seconds.</p> </li> <li> <p>Taking shorter exposures only helps at night - typical daytime exposures are less than a second.</p> </li> </ul>"},{"location":"allsky_guide/howtos/timelapse.html#frames-per-second-fps","title":"Frames Per Second (FPS)","text":"<p>A video with 2000 frames displayed at the default FPS of 25 will run for 80 seconds (2000 / 25). The same video displayed at 10 FPS will run for 200 seconds, or 3 minutes, 20 seconds.</p> <p>Advantages:</p> <ul> <li>Easy to do.</li> </ul> <p>Disadvantages:</p> <ul> <li> <p>The lower the FPS is, the \"jerkier\" the video is.</p> </li> <li> <p>Who wants to watch a 3 minute, 20 second video of the sky moving? A minute or two is the limit for many people.</p> </li> </ul> <p>Do the following to see how low the FPS can go before you think the video is too jerky or too long:</p> <pre><code>cd ~/allsky/images\nmkdir test\n# Copy about 100 images from another directory to the \"test\" directory.\n\n# Do the following 3 steps a few times, changing your 'Delay' each time.\n# Change the \"20\" in the steps to whatever you set the delay to.\n\n# Set your 'Delay' in the WebUI to something like 20.\ngenerateForDay.sh --timelapse test\nmv test/allsky-test.mp4  test/allsky-test-20.mp4\n\n# After you've created some test videos, watch them and pick whichever one\nyou think is best.\n\n# When done delete the test images:\nrm -fr test\n</code></pre>"},{"location":"allsky_guide/howtos/timelapse.html#troubleshooting","title":"Troubleshooting","text":"<p>See the Troubleshooting -&gt; Timelapse for troubleshooting information.</p>"},{"location":"allsky_guide/howtos/helper_tools/image_stretch.html","title":"Image Stretch","text":"<p>The Image Stretch helper tool aids you in determining the best settings to stretch an image.</p> <p>If you want to lighten parts of your image to bring out details you can \"stretch\" your images. The Stretch Amount setting determines how much of a stretch is applied, and the Stretch Mid Point determines WHERE the stretch is applied - to the dark parts of an image, the mid-gray parts, the light parts, or anything in between. This helper tool allows you to specify multiple settings and then look at the results.</p> <p></p> <p>Typical Image Stretch Helper Tool page</p> <p>The following information is needed:</p> <ul> <li> <p>Image to stretch</p> <p>By default the current image is used. If you are running this tool during the day and want to stretch nighttime images, find a \"typical\" nighttime image to use.</p> </li> </ul> <p>Warning</p> <p>If you are already stretching images the tool will display a warning. Find a non-stretched image to use - you don't want to stretch and already stretched image. If you don't have any non-stretched images, temporarily turn stretching off and wait until you have an image, then use it.</p> <ul> <li>Stretch Amount values to use</li> </ul> <p>This determines how much of a stretch to apply. The default list is a good place to start.</p> <p>Note that stretching images increases their noise, which you can see in the 4th image below.</p> <ul> <li>Stretch Mid Point values to use   This determines what part of an image is modified. Lower numbers modify darker parts of the image and higher numbers modify lighter parts of the image.</li> </ul> <p>You'll probably want / need to run this tool multiple times. Changes to the Amount are fairly obvious but changes to the Mid Point can be very subtle and often need to be played with.</p> <p></p> <p>A typical output is shown below.</p> <p>Note that the first images has no stretch. This is so you can see what the different settings do.</p> <p>The last image has a Stretch Amount of 20, which is way too much.</p>"},{"location":"allsky_guide/howtos/helper_tools/startrails.html","title":"Startrails","text":"<p>The WebUI Helper Tools do what the name suggests - they \"help\" you do something, often helping determine what settings to use.</p>"},{"location":"allsky_guide/howtos/helper_tools/startrails.html#startrails","title":"Startrails","text":"<p>The Startrails helper tool aids you in determining what Brightness Threshold setting to use.</p> <p>Many people find the stars in their startrails images don't have trails. This can almost always be fixed by adjusting the startrails Brightness Threshold setting. This helper tool allows you to specify multiple settings and then look at the results and pick the setting that gives you the best trails without including too many bright images.</p> <p></p> <p>Typical Startrails Helper Tool page:</p> <p>The following information is needed:</p> <ul> <li> <p>Use images from</p> <p>This determines what images on the Pi will be used to create the test startrails. Ideally you want to use images from a night whose startrails had no trails.</p> <ul> <li> <p>If you don't change it, images from last night are used.</p> </li> <li> <p>If you enter a directory name that begins with a / then that full path name will be used.</p> </li> <li> <p>Otherwise the directory you enter is assumed to be in the same location as the daily images.</p> </li> </ul> </li> <li> <p>Number of images in include in each startrail</p> <p>Pick a number of images to include in each startrails that is big enough that you'll be able to see trailed stars, but small enough that you won't have to wait an extremely long time to see the results.</p> <p>Start with the default and adjust as needed.</p> </li> <li> <p>Brightness Threshold values to use</p> <p>This is where you tell the command what settings to use. Keep in mind that every number you enter will produce a separate startrails image so don't add too many number or else you'll be waiting a long time for the results.</p> <p>The first number in the default list is your CURRENT Brightness Threshold value. You will almost always have to increase your current value so each subsequent number in the default is larger than the previous one. The default values increase by 0.03.</p> <p>Once you are \"close\" you can run this tool again with numbers that are much closer together, such as 0.01.</p> </li> <li> <p>Verbose output?</p> <p>Enabling this option displays summary information on each test startrails, including the number of images included and not included.</p> </li> </ul> <p>A typical output is shown below. Note that no images were used in the first startrails with a Brightness Threshold of 0.30. This is probably because the moon is out on the right side of the image so the overall brightness of the image is somewhat high.</p> <p>The second image has trails but only 13 of the 15 images were used so the ideal Brightness Threshold is probably a little higher than 0.35.</p> <p></p> <p>Typical Startrails Helper Tool output</p>"},{"location":"allsky_guide/howtos/helper_tools/timelapse.html","title":"Timelapse","text":"<p>The Timelapse helper tool aids you in determining the best settings to use when creating timelapse videos.</p> <p></p> <p>Typical Timelapse Helper Tool page</p> <p>The following information is needed:</p> <ul> <li> <p>Use images from</p> <p>This determines where the images are that will be used to create the timelapses. By default yesterday's images are used.</p> </li> <li> <p>Number of images to include in the videos</p> <p>This determines how many images to use. The more images you include the longer the video, but the longer it'll take to create each timelapse. The default number is a good place to start.</p> </li> <li> <p>Bitrate values to use</p> <p>This determines the quality of a timelapse. Higher bitrates include more information in each frame, but also make the video larger.</p> <p>Enter a space-separated list of bitrates.</p> </li> <li> <p>FPS values to use</p> <p>This determines how many frames per second are displayed, and hence how long the video is. Larger numbers produce smoother, but larger videos.</p> <p>Enter a space-separated list of bitrates.</p> </li> </ul> <p>Info</p> <p>Note that the number of videos created is the number of bitrates times the number of FPS values, so if you have 3 bitrates and 5 FPS then 15 videos will be created, which will take a LONG time.</p> <p>We recommend initially leaving the FPS values to the default, which is your current FPS setting, and using 2 or 3 bitrates. Once you have the quality you desire, use that as the only bitrate and use 2 or 3 FPS values.</p> <p></p> <p>Typical Timelapse Helper Tool output</p>"},{"location":"allsky_guide/overlays/extra.html","title":"Extra Data","text":""},{"location":"allsky_guide/overlays/extra.html#extra-data","title":"Extra Data","text":"<p>This section explains how you can wite data that is available for use in the overlay from yoru own scripts outside of Allsky.</p> <p>This is an advanced topic that requires an understanding of the Linux file system and how to manage files within it. The Linux Basics page should provide the understanding you need.</p> <p>As an example, assume you want to add weather data to your images. You first need to create or obtain a program that gathers that data and writes it to a file. How you obtain that file is outside the scope of this documentation, but the program needs to write the data in a specific format in a file called ``~/allsky/tmp/extra/xxxxx``` (replace the xxxxx with an appropriate name).</p> <p>The \"extra\" file can be either a simple .txt file or preferably a .json file since it provides much more flexibility. You can have multiple \"extra\" files with different names; this can be useful if you want to add different types of data to the overlay, and each type has its own program to gather the data. A typical example is weather data and dew heater status.</p> <p>Dates</p> <p>When adding dates to any extra data files please ensure that the date is formatted in the same format as the Time Format setting in WebUI</p>"},{"location":"allsky_guide/overlays/extra.html#text-files","title":"Text Files","text":"<p>Text files must end with a .txt extension. The format is a simple name=value pair structure, with anything after the = being the value, as shown below:</p> Line in File Resulting Variable AG_TEMP=14.3 ${AG_TEMP} AG_LOCATION=South Pole ${AG_LOCATION} AG_HUMIDITY=67.2 ${AG_HUMIDITY} <p>The data in these files could become old if the application creating them fails or is not running. To have Allsky detect this you tell it to ignore \"extra\" files when they are over a certain age. For .txt files there is a single value which is specified in the Overlay Editor settings dialog box. See the next section for how to specify the expiration time for .json files.</p>"},{"location":"allsky_guide/overlays/extra.html#json-files","title":"JSON Files","text":"<p>.json files are more complex in their structure but provide a lot more flexibility to add your own variables and even control the attributes of a field.</p> <p>The .json file below will produce exactly the same variables as the .txt file described above. The data will expire as defined in the Overlay Editor settings dialog box.</p> <pre><code>{\n  \"AG_TEMP\": {\n    \"value\": \"14.3\"\n  },\n  \"AG_LOCATION\": {\n    \"value\": \"South Pole\",\n  },\n  \"AG_HUMIDITY\": {\n    \"value\": \"67.2\",\n  }\n}\n</code></pre> <p>This .json file includes an expiry time (in seconds) for the temperature and humidity, which change often, so those times will be used. The location doesn't specify an expiry time since the location never changes, so the one in the Overlay Editor dialog expiry setting will be used.</p> <pre><code>{\n  \"AG_TEMP\": {\n    \"value\": \"14.3\",\n    \"expires\": 600\n  },\n  \"AG_LOCATION\": {\n    \"value\": \"South Pole\",\n  },\n  \"AG_HUMIDITY\": {\n    \"value\": \"67.2\",\n    \"expires\": 600,\n  }\n}\n</code></pre> <p>A note on the expires field:</p> <ul> <li> <p>Instead of specifying an expiry time on two variables and not the third one as shown above, you could instead specify a value for the third field and use the Overlay Editor default expiry setting for the other two. This works well if you only have one \"extra\" file.</p> </li> <li> <p>If you have multiple \"extra\" files it's probably best to specify an expiry time for ALL fields in all files, rather than using the Overlay Editor default expiry setting for fields that don't explicity set one. If a field shouldn't have an expiry time, use \"expires\": 0, which disables its expiry time.</p> </li> </ul> <p>This .json file, which has been truncated for brevity, includes all of the attributes that a field can set. It also adds an image.</p> <pre><code>{\n  \"AG_TEMP\": {\n    \"value\": \"14.3\",\n    \"format\": \"{:.0f}\",\n    \"x\": 800,\n    \"y\": 200,\n    \"fill\": \"#333333\",\n    \"font\": \"ledsled\",\n    \"fontsize\": 40,\n    \"opacity\": 0.2,\n    \"stroke\": \"#000000\",\n    \"strokewidth\": 1\n  },\n  \"AG_SCOPE\": {\n    \"image\": \"crosshair.png\",\n    \"x\": 300,\n    \"y\": 400,\n    \"scale\": 0.1,\n    \"expires\": 6000,\n    \"opacity\": 0.5\n  }\n}\n</code></pre> <p>This example demonstrates some important points:</p> <ul> <li> <p>The attributes of a variable can be used to control how the variable appears, so for example if the temperature is close to the dew point then some text could be displayed in a highlighted colour. Note that this makes the variable a 'Field' and can only be used where a single variable is used within a field.</p> </li> <li> <p>Images can by dynamically added to the captured image. So if you wanted to control when an image is added or not added, the program that creates the \"extra\" file can simply add the image's json code, or not add it, to the file.</p> </li> </ul> <p>The \"extra\" files must be created by an application you provide and there are a few things to consider when creating these files:</p> <ul> <li> <p>Variable names must be prefixed with a string that's unique to you, e.g., your initials, to avoid conflicting with the names of Allsky variables. The variables in the examples above are prefixed with <code>AG_</code>. You can use anything except <code>AS_</code> and <code>ALLSKY_</code>.</p> </li> <li> <p>Variable values should generally not include units of measure. For example <code>${DOME_TEMPERATURE}</code> should be <code>20.72</code>, not <code>20.72\u00b0 C</code> because <code>20.72</code> is a \"Numeric\" variable that can be formated (e.g., to <code>20.7</code>) whereas <code>20.72\u00b0 C</code> is a \"Text\" string that can't be formatted. If you want <code>\u00b0 C</code> to appear on the overlay, add it in the field itself: <code>Dome temperature: ${DOME_TEMPERATURE}&amp;deg; C</code>. Note that \u00b0 adds the degree symbol \u00b0. Or use the formatting system within the overlay editor to set the format</p> </li> <li> <p>Permissions You must ensure that the \"extra\" files can be read by the web server. Adding <code>chmod 644 file</code> ... to the programs that create the files should suffice. The Overlay Module will silently ignore any files it cannot read.</p> </li> </ul>"},{"location":"allsky_guide/overlays/fieldsandvariables.html","title":"Fields And Variables","text":""},{"location":"allsky_guide/overlays/fieldsandvariables.html#fields-and-variables","title":"Fields and Variables","text":"<p>Fields are the heart of the Overlay Editor. They are distinct items that are added to an overlay and each field has its own properties like color, size, rotation, etc. Most people have several fields on their overlays - date and time the image was taken, the exposure length, etc.</p> <p>Variables are parts of a field whose value is determined when an image is saved. A common variable is ${TIME} which is replaced by the time the image was taken and changes every image. Some variables rarely or never change, for example ${CAMERA_MODEL} displays the model of the camera used to take the image, like \"HQ\" or \"ASI290MM\". It only changes if you change cameras. See the Variable names section for details on variable names.</p> <p>There are two types of fields:</p> <ul> <li>Text fields contain text and/or variables, for example, Exposure: ${sEXPOSURE}, which adds the word Exposure: followed by the image's exposure time to the overlay.</li> <li>Image fields contain pictures, graphics, or any image you want and are often used are logos, weather graphs, and compasses.</li> </ul>"},{"location":"allsky_guide/overlays/fieldsandvariables.html#variable-names","title":"Variable Names","text":"<ul> <li>Must begin with a letter a - z or A - Z.  </li> <li>The remaining characters may contain any number of letters, number 0 - 9, or the underscore character _.  </li> <li>Should be prefixed with a string that's unique to you like your initials, to avoid conflicting with the names of Allsky system variables. This prefix can be anything except AS_ and ALLSKY_, which are reserved for the Allsky development team.  </li> <li>Should make sense to you. You are more likely to remember what ${MY_AMBIENT_TEMP} means than ${MY_AT}.  </li> <li>By convention are UPPERCASE, but you can mix case, however, variable names are case-sensitive, so ${MY_ABIENT_TEMP} and ${MY_ABIENT_temp} are different variables.  </li> </ul> <p>If you see a variable displayed on the overlay as ??? it usually means the variable is undefined - either it's not in the Variable Manager at all (could be a typo), or is only in the All Variables tab. The variable needs to be defined and copied to the Allsky Variables tab. Undefined variables will have a line in <code>/var/log/allsky.log</code> like: <code>ERROR: ${T2} has no variable type.</code></p> <p>If a variable is displayed as ?? it usually means the variable's formatting is incorrect, for example, you tried to display a number as a date. Make sure the formatting is valid for the type of variable - click on the [?] icon to see valid formats for each type of variable. Incorrectly formatted variables will have a line in <code>/var/log/allsky.log</code> like: ERROR: Cannot use format '%a' on Number variables like ${GAIN}.</p>"},{"location":"allsky_guide/overlays/fieldsandvariables.html#example-text-fields","title":"Example text fields","text":"Field Example Output Description ${DATE} 24/10/2025 Displays the date from the DATE system variable. The date can be formatted in a variety of ways. This example field contains only a variable. Date: ${DATE} Date: 24/10/2025 Displays the text \"Date: \" then the date the image was taken from the DATE system variable. As above, the date can be formatted in a variety of ways. This field contains text and a variable. Date: ${DATE} ${TIME} Date: 24/10/2025 23:12:34 Displays the date and time the image was taken from the DATE and TIME system variables, respectively. Both variables can be formatted in a variety of ways.This field contains text and two variables. You can have any number of variables you want. Date: DATE TIME Date: DATE TIME Because this field doesn't have any variables, it simply displays \"Date: DATE TIME\". This field contains only text. <p>Variables come from a variety of sources:</p> <p>Allsky - The main Allsky application generates many variables. Modules - Any module can create variables. Extra Data - Typically created by an application external to Allsky.  </p>"},{"location":"allsky_guide/overlays/fieldsandvariables.html#allsky-variables","title":"Allsky Variables","text":"<p>The table below shows the most commonly used Allsky variables; a complete list can be found in the Variable Manager.</p> Variable Example Data Description ${DATE} 20250228 The date the image was taken. ${TIME} 221623 The time the image was taken. ${GAIN} 4.692540 The gain used for the image. If auto-gain was disabled, this value will be what you set in the Gain setting in the WebUI, otherwise it's the value the auto-gain algorithm used. ${AUTOGAIN} 1 1 if auto-gain was enabled, 0 if disabled. Taken from the Auto-Gain WebUI setting. ${sAUTOGAIN} (auto) A string containing either (auto) if auto-gain was enabled, or blank. Useful to put after the gain, e.g., Gain: ${GAIN} ${sAUTOGAIN}. ${EXPOSURE_US} 218000 The exposure of the image in micro seconds. If auto-exposure was disabled, this value will be what you set in the Manual Exposure setting in the WebUI, otherwise it's the ${sEXPOSURE} 218 ms (0.2 sec) The exposure of the image in a human readable format. The format changes depending on the exposure time, for example, very short exposures may be 218.48 ms (0.2 sec) whereas a long exposure may be 45.3 sec. ${AUTOEXPOSURE} 1 1 if auto-exposure was enabled, 0 if auto-exposure was disabled. Taken from the Auto-Exposure WebUI setting. ${sAUTOEXPOSURE} (auto) A string containing either (auto) or blank - similar to ${sAUTOGAIN}. ${TEMPERATURE_C} and ${TEMPERATURE_F} 36 The temperature of the camera sensor, if available. This does NOT include the C or F for Centigrade or Fahrenheit so you'll need to add them yourself, e.g., Sensor Temp: ${TEMPERATURE_C} C. ${MEAN} 0.108564 The mean brightness value for the image, from 0.0 (pure black) to 1.0 (pure white)."},{"location":"allsky_guide/overlays/fieldsandvariables.html#module-variables","title":"Module Variables","text":"<p>Any module can create variables for use in the Overlay Module. For this reason it's important that the Overlay Module runs as late as possible within the module flow. As an example, the Star Count Module creates a variable called ${STARCOUNT} and passes it to the next module.</p> <p>Please refer to the documentation on each module for the variables they make available.</p>"},{"location":"allsky_guide/overlays/formatting.html","title":"Formatting Variables","text":""},{"location":"allsky_guide/overlays/formatting.html#formatting-fields","title":"Formatting Fields","text":"<p>All data within Allsky is stored in consistent internal formats, so for example ALL temeopratures are stored in Degreed Centigrade. Yo will therfore probably want to format data to improve its visual appearance, typicall formatting options are</p> <ul> <li>Changing Unit i.e. Degreed Centigrade to Degrees Farenhite</li> <li>Setting the number of decimal places</li> <li>Converting an internal format, i.e. decimal degrees to DDD MM SS</li> </ul> <p>Each variable within Allsky has a default format but you can override this. To overide a variables format double click on the field containing the variable then click on the ? button at the end of the format field</p> <p></p> <p>The Variable Format Dialog</p> <p>In this example we have double clicked the 'AS-SUN_DAWN' field and then clicked on the ? (1). The resultignm dialog displays all of the formatting options available for the variable, in this case data formats.</p> <p>Simply select the format you required and save the overlay.</p>"},{"location":"allsky_guide/overlays/formatting.html#common-formats","title":"Common Formats","text":"<p>NOTE: Some formats will display legacy formatting options. These mUST NOT be used for formatting fields and are present for backwards compatibility only</p> <p>Please Note The lists below are not exhaustive and may change from release to release. Please refer to the Formatting Dialog for available options</p>"},{"location":"allsky_guide/overlays/formatting.html#date-formats","title":"Date Formats","text":"<p>This allows dates to be formatted in a number of ways. A custom date formatter is provided allowing you to format a date in any way you like</p> Format Description Example Default date Use default data attributes - see Sample --&gt; 25-12-23 23:20 %d-%m-%y %H:%M Short date/time (UK format) 25-12-23 23:20 %m-%d-%Y %I:%M %p Short date/time (US format) 12-25-2023 11:20 AM %d-%m-%y Short date (UK format) 25-12-23 %m-%d-%y Short date (US format) 12-25-23 %d-%m-%y %H:%m Short date and time (UK format) 25-12-23 23:10 %m-%d-%y %H:%m Short date and time (US format) 12-25-23 23:10 Custom date Custom date format N/A"},{"location":"allsky_guide/overlays/formatting.html#number-formats","title":"Number Formats","text":"<p>This allows numbers ot be formatted, setting decimal places etc</p> Format Description Example Custom number Displays the number format dialog N/A <p></p> <p>The Number Format Dialog</p>"},{"location":"allsky_guide/overlays/formatting.html#boolean-formats","title":"Boolean Formats","text":"<p>This allows boolean values to be displayed in a more Human Readable format</p> Format Description Example yesno Output 'Yes' if input is 1, or 'No' Yes, No onoff Output 'On' if input is 1, or 'Off' On, Off truefalse Output 'True' if input is 1, of 'False' True, False num Output '1' if input is 1, or '0' 1, 0"},{"location":"allsky_guide/overlays/formatting.html#elevation-formats","title":"Elevation Formats","text":"<p>This allows an elevation value to be displayed in a Human Readable format</p> Format Description Example Custom elevation Elevation with decimal places and degree symbol 52.12 \u00b0"},{"location":"allsky_guide/overlays/formatting.html#azimuth-formats","title":"Azimuth Formats","text":"<p>This allows an azimuth value to be displayed in a Human Readable format</p> Format Description Example Custom azimuth Azimuth with decimal places and degree symbol 52.12 dms Display azimuth with Degrees, Minutes, and Seconds 123"},{"location":"allsky_guide/overlays/formatting.html#filesize-formats","title":"Filesize Formats","text":"<p>This allows an filesize value to be displayed in a Human Readable format</p> Format Description Example Auto filesize The most appropriate unit will be displayed (GB, etc.) 12 GB Custom filesize Filesize with decimal places and units (GB, MB, etc.) 12 TB"},{"location":"allsky_guide/overlays/formatting.html#filesize-formats_1","title":"Filesize Formats","text":"<p>This allows an filesize value to be displayed in a Human Readable format, converting between units if required</p> Format Description Example Default temperature Use default temperature attributes - see Sample --&gt; 23.5\u00b0 C Custom temperature Customize variable attributes 23,54\u00b0 C"},{"location":"allsky_guide/overlays/formatting.html#gpio-formats","title":"GPIO Formats","text":"<p>This allows the state of a GPIO pin to be displayed in a more Human Readable format</p> Format Description Example onoff Show as On or Off On yesno Show as Yes or No Yes truefalse Show as True or False False num Show as 1 or 0 0"},{"location":"allsky_guide/overlays/formatting.html#string-formats","title":"String Formats","text":"<p>This allows strings to be formatted in a a variety of ways</p> Format Description Example none No change to the string N/A upper Convert string to UPPER CASE HELLO, WORLD! lower Convert string to lower case hello, world! camel Convert string to camelCase hello, World! capitalize Capitalize the string Hello, World! sentence Capitalize the string, removing leading and trailing spaces Hello, World!"},{"location":"allsky_guide/overlays/formatting.html#altitude-formats","title":"Altitude Formats","text":"<p>This converts an altitude to a Flight level</p> Format Description Example flightlevel Convert altitude in metres to flight level FL020"},{"location":"allsky_guide/overlays/formatting.html#distance-formats","title":"Distance Formats","text":"<p>Converts distance between Units</p> Format Description Allsky internal Allsky internal distance (miles) mtok Miles to Kilometres ktom Kilometres to Miles"},{"location":"allsky_guide/overlays/how.html","title":"How They Work","text":""},{"location":"allsky_guide/overlays/how.html#how-they-work","title":"How They Work","text":"<p>The Overlay Editor, which is accessed via the Overlay Editor WebUI page, is used to define what information you want on the captured images and where it should go. Once you have specified that information, you won't use the editor again until you want to change something in the overlay, which typically isn't done very often.</p> <p>The Overlay Module program is invoked every time an image is captured and places the information you specified in the Overlay Editor onto the image. This module is one of several modules   that can be invoked after every image is captured.</p> <p>In the Overlay Editor you specify what information you want to go where, and what it should look like. For example, you want the date and time the image was taken to be in blue, 12 point font in the upper left of the image and a compass rotated 20 degrees so it's pointing north in the upper right of the image. You also have a graph of weather information you want on the bottom of the image, but because it will hide some of the image you want it to be partially transparent.</p> <p>After Allsky captures an image it passes that image as well as information about the image to the Overlay Module, including the time the image was taken, the exposure length, the gain, and a lot more. This information is put into System Variables that can be used per you configuration in the Overlay Editor, which then:</p> <ul> <li>Replaces the system variables with their values and adds them to the overlay.  </li> <li>Replaces any other variables with their values and adds them to the overlay.  </li> <li>Adds any images you specified to the overlay.  </li> </ul>"},{"location":"allsky_guide/overlays/interface.html","title":"Interface","text":""},{"location":"allsky_guide/overlays/interface.html#editor-interface","title":"Editor Interface","text":"<p>The Overlay Editor web page consists of two key areas:</p> <ul> <li>The toolbar contains icons that perform actions or bring up dialog boxes.  </li> <li>The working area contains the overlay and the current image in the background.</li> </ul> <p>NOTE: The Overlay Editor will only start if Allsky is capturing images. If Allsky is not capturing a warning is displayed and the Overlay Editor will wait until Allsky start capturing.</p> <p>New fields are initially added to the upper left corner of the overlay but can be moved anywhere you want - just drag and drop! If you added a field by mistake, delete it by clicking on the  icon (4) before doing anything else.</p> <p></p> <p>The Overlay Editor toolbar</p> Number Function Description 1 Save The Current Configuration This is enabled and turns green when any changes have been made that require saving. The word \"Modified\" is also appended to the tab label, i.e., \"Overlay Editor - Modified\". 2 Add New Text Field Click to add a new field with text and/or variables to the overlay, including adding a variable 3 Add New Image Field Click to add an existing image to the overlay. The image must have previously been uploaded using the Image Manager. 4 Delete selcted field Click to delete the selected field. The \"del\" or \"delete\" keys on the keyboard can also be used. The icon is only enable turns green when a field is selected. 5 Variable manager Click to add a pre-defined field from the Variable Manager. See the Variable Manager section for more details. 6 Preview Click to preview each of the fields. This is useful to see what actual data will look like on the overlay so you can better align fields. 7 Group Fields Groups the selected fields 8 Un Group Fields Ungroups the selected group 9 Left Align Lest aligns the selected fields 10 Equal Vertical Space Equally distributes the selected fields between the first and last selected fields 11 Equal Horizontal Space Equally distributes the selected fields between the first and last selected fields 12 Zoom In Zooms into the overlay 13 Zoom Out Zooms out of the overlay 14 Full Size Views the overlay at full resolution 15 Fit Fits the overlay into the screen 16 Overlay Manager Displays the Overlay Manager 17 Overlay Errors Only displayed if any fields are detected that are off the screen. Selecting this icon will display the Overlay Errors dialog allowing the off-screen fields to be deleted or fixed. Fixing the field will move it into the visible portion of the overlay editor allowing you to move it to the exact position required. 18 Font Manageer Displays the Font Manager 19 Image Manager Displays the Image Manager 20 Settings Displays the Overlay Settings 21 Help Displays the overlay manager help"},{"location":"allsky_guide/overlays/interface.html#keyboardmouse","title":"Keyboard/Mouse","text":"<p>There are various keyboard and mouse shortcuts used by the overlay manager</p> <ul> <li>The Del or Delete key will delete a field if one is selected  </li> <li>A single mouse click will select the field</li> <li>Double clikcing a field will display its properties</li> <li>Once the properties window is visible clicking a field will switch to that fields properties</li> <li>Clicking the mouse and dragging around fields will select all of the fields</li> <li>Holding the alt key and dragging will draw a rectange</li> </ul>"},{"location":"allsky_guide/overlays/interface.html#variable-manager","title":"Variable Manager","text":"<p>The variable manager allows you to select variables and add them to overlays as a field. I also allows block of fields to be added</p> <p></p> <p>The Variable Manager Dialog</p> <ol> <li>Allows the columns displayed in the variable manager to be selected</li> <li>The available variables that can be added</li> <li>Display all variables, by default oly variables with a value are displayed</li> </ol> <p>To add a variable either double click it or single click it and click the 'Select' button</p> <p></p> <p>The Variable Manager Blocks Dialog</p> <p>This dialog allows blocks to be added to the overlay, blocks are a collection of fields in a predefined layout. </p> <ol> <li>Select he font details for the block. NOTE This must be selected BEFORE adding the block</li> <li>Click the add button to add the block</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#overlay-manager","title":"Overlay Manager","text":"<p>The Overlay Manager is used to create and enable overlays for day and nighttime capture.</p> <p></p> <p>The Overlay Manager</p> <p>The Overlay Manager comes pre installed with several overlays for common cameras. The Allsky team maintain these overlays. During installation the most appropriate overlay for your camera will have been selected, the Overlay Manager allows you to use these overlays or create a new one.</p> <p>The Allsky maintained overlays cannot be edited, you must create a new overlay if you wish to edit it. The new overlay can be copied from any exising overlay.</p> <p>During an upgrade from a previous version of Allsky the Module Manager will attempt to convert any of your customised overlays into the module manager format.</p>"},{"location":"allsky_guide/overlays/interface.html#main-tab","title":"Main Tab","text":"<p>Field Details</p> <ol> <li>Selects the main overlay manager tab</li> <li>Displays the tab to allow overlays to be activated</li> <li>Selects the overlay to display/edit. When selecting an overlay the overlay will be displayed in the main overlay editor. If you select an overlay that cannot be edited then a warning is displayed in the main overlay editor.</li> <li>Adds a new overlay</li> <li>Deletes an overlay. NOTE: Allsky maintained overlays cannot be deleted</li> <li>The name of the overlay, this is used to identify the overlay in a human readable format</li> <li>The name of the overlay description</li> <li>The camera brand the overlay applies to</li> <li>The camera model the overlay applies to</li> <li>The width of the captured image, after any cropping</li> <li>The height of the captured image, after any cropping</li> <li>The Time of Day the overlay should be used for</li> </ol> <p>When making any changes in the overlay meta data section you must use the main save button on the Overlay Editor toolbar, this will be highlighted in green if there are any changes to save</p>"},{"location":"allsky_guide/overlays/interface.html#options-tab","title":"Options Tab","text":"<p>Field Details</p> <ol> <li>Selects the overlay to use when capturing daytime images</li> <li>Selects the overlay to use when capturing nightime images</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#selecting-overlays","title":"Selecting Overlays","text":"<p>To select the overlays to use for day or night open the Overlay Manager and switch to the Options Tab. Here you can select the appropriate overlay to use.</p> <p>Overlays can be limited to daytime, nighttime capture or both. Only the available overlays for day / nighttime capture will be displayed in the drop downs</p>"},{"location":"allsky_guide/overlays/interface.html#create-new-overlay","title":"Create New Overlay","text":"<p>To create a new overlay click the + icon (4). A new dialog will be displayed allowing you to create the new overlay.</p> <p></p> <p>Add new overlay main tab</p> <ol> <li>Selects the overlay you wish to use as a starting point or select 'Blank Overlay' for an empty overlay</li> <li>Enter a Human Readable name for the overlay</li> <li>Enter a Human Readable name for the overlay</li> <li>Select the time of day you wish this overlay to be used in</li> <li>If selected then the overlay will be activated after it has been created. If not selected the overlay will be saved as a draft and you will have to manually activate it.</li> </ol> <p>By default when an overlay is created it is activated for day/night or both as defined by the 'Available For' dropdown. If you DO NOT want the overlay to be activated by default then select 'No' in the 'Activate After Creation' option.</p> <p></p> <p>Add new overlay advanced tab</p> <p>You will only need to make changes on this tab if you are creating an empty overlay. If you are copying an existing overlay then all of the fields will be defaulted from the copied overlay.</p> <ol> <li>This is for information only and is the filename of the overlay that will be used to store it on the Pi</li> <li>The camera brand the overlay applies to</li> <li>The camera model the overlay applies to</li> <li>The width of image the overlay applies to. This will default to the width of the last captured image</li> <li>The height of image the overlay applies to. This will default to the width of the last captured image</li> </ol> <p>Once you have completed the required fields in the dialog select the 'Ok' button and the new overlay will be displayed allowing you to edit it.</p>"},{"location":"allsky_guide/overlays/interface.html#delete-overlay","title":"Delete Overlay","text":"<p>To delete an overlay select the required overlay and click the delete buttton.</p> <p>NOTE: You cannot delete an overlay if it is currenty active. You must activate another overlay before deleting it.</p>"},{"location":"allsky_guide/overlays/interface.html#overlay-errors","title":"Overlay Errors","text":""},{"location":"allsky_guide/overlays/interface.html#font-manager","title":"Font Manager","text":"<p>The Font Manager allows you to manage fonts used in overlays. It supports all mainstream browser fonts and allows you to upload any TrueType font for use in text fields. You only need to use the Font Manager if you intend to use any non built in fonts.</p> <p>In version 2024.12.06_06 and before you were required to add fonts to the overlay in the Fonat Manager before they could be used. This is no longer a requirement and the fonts used in an overlay are automatically managed</p> <p></p> <p>The Font Manager Dialog</p> <ol> <li>Lists all the fonts that can be used. System Fonts are marked as such in the Path column.</li> <li>Deletes a font.</li> <li>Adds a font from daFont.com by entering a URL. See below.</li> <li>Uploads a zip file to install fonts. See below.</li> </ol> <ul> <li>It is not possible to delete a System Font and they will not have a delete icon as shown for the first several fonts above.</li> <li>If a font is in use when deleted then any fields using the font will revert to the default font as specified in the overlay settings.</li> </ul>"},{"location":"allsky_guide/overlays/interface.html#font-preview","title":"Font Preview","text":"<p>The Font Preview dialog allows you to preview any installed font, including system fonts.</p> <p></p> <p>The Font Manager Preview Dialog</p> <ol> <li>Selects the font you wish to preview</li> <li>Select the font size for the preview</li> <li>Enter some text to preview</li> <li>The previewd text</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#image-manager","title":"Image Manager","text":"<p>The Image Manager allows you to upload images for use on overlays and create masks for certain functions such as star and meteor detection. Allsky comes with several basic images.</p> <p></p> <p>The Image Manager Dialog</p> <ol> <li>Adds the selected image to the overlay</li> <li>Deleted the selected image</li> <li>The image library</li> <li>Area to drop images onto to upload them, clicking this area will present an upload dialog</li> <li>Starts the Mask Editor</li> </ol>"},{"location":"allsky_guide/overlays/interface.html#the-mask-editor","title":"The Mask Editor","text":"<p>Some modules with Allsky benefit from having a mask applied to them prior to running the module. The Starcount module us a good example of this. To prevent false positives a mask is applied that removes the areas of the image you are not interested in counting stars in.</p> <p>Masks can also be used to mask out areas outside of the image circle thay mak have light leaks. This give syou a nice dark area to place th eoverlays on.</p> <p>Masks consist of two colours</p> <ul> <li>Black - Any black areas will be masked out of the image i.e. set to black</li> <li>White - Any white areas will be preserved</li> </ul> <p>For more complex masks its possible to blend the black to white transisiotn in the mask to prevent false positives in modules that may be looking for edges such as the Meteor detection module.</p> <p>The Mask Editor has two modes, Easy and Expert, the default is Easy mode. In Easy mode all you do is draw a white ellipse to capture the areas you wish to keep, when you ssave the mask the bacl areas will be automatically added. In Expert mode you have a series of drawing tools you can use to create much more detailed masks including blended edges on shapes to help with false positives on edge detection.</p> <p></p> <p>The Mask Editor Dialog</p> <ol> <li>Start creating a new mask</li> <li>Switch between easy and export mode</li> <li>In Expert mode select the type of drawing tool to use</li> <li>Undo and Redo buttons</li> <li>Sets the opactity of the mask being created, useful for fine details work where you need to see thru the mask</li> <li>Set the brightnedd of the background image</li> <li>For the brush tool set the thickness of the brush</li> <li>Zoom controls</li> </ol> <p>Once you are happy with the mask click the 'Save' button and you will be prompted to give the mask a name and it will then be saved. There are a few rules around names</p> <ol> <li>The name must be unique to all other images</li> <li>Do not use spaces in the name</li> </ol> <p>Other ways to create masks</p> <p>You can create a mask in any drawing application, shuch as Gimp or Photoshop. To do so create a Mono image and paint areas you wanto to keep white and those you want to mask black</p> <p>Tip</p> <p>When creating a mask turn off all modules that may add to the image, overlays etc to ensure you have a clean image to create the mask with</p>"},{"location":"allsky_guide/overlays/interface.html#overlay-settings","title":"Overlay Settings","text":"<p>The overlay Editor has three tabs for settings</p> <ul> <li>Overlay Settings Settings that affect new fields added to an Overlay</li> <li>Editor Settings Settings that apply the the Overlay Editor</li> <li>Overlays - Available overlays to edit</li> </ul> <p></p> <p>The Overlay Settings</p> <ol> <li>The default opacity for new images.</li> <li>The default rotation for new images.</li> <li>The default font for new text fields.</li> <li>The default font size for new text fields.</li> <li>The default font opacity for new text fields.</li> <li>The default font color for new text fields.</li> <li>The default rotation for new text fields.</li> <li>The default colour used for the font stroke.</li> <li>The default expiration time in seconds for \"extra\" data files that do not specify an expiry time. This applies to all variables in .txt files and entries in .json files that don't have an \"expires\" attribute.</li> <li>The default text used when a field has expired.</li> </ol> <p></p> <p>The Overlay Editor Settings</p> <ol> <li>When enabled, displays a grid for easier alignment of fields on the overlay. The grid is used to 'snap' fields making their placement easier.</li> <li>The size of the grid in pixels. NOTE Changing the grid size on an existin glayout will not adjust any fields</li> <li>The colour to use for the grid.</li> <li>The grid brightness. Values range from 0 (lowest brightness) to 100 (brightest).</li> <li>When enabled, moving a field will cause a rectangle to be displayed showing where the field will snap to if dropped.</li> <li>The number of variables to show per page in the Variable Manager.</li> <li>When adding a new field all other fields will be set to this brightness to make the new field easier to see. Values range from 0 (darkest) to 100 (each field's full brightness).</li> <li>When selecting a field all other fields will be set to this opacity to make the new field easier to see. Values range from 0 (darkest) to 100 (each field's full brightness).</li> <li>When enabled, scrolling the mouse wheel will zoom the overlay.</li> <li>Brightness of the captured image being overlayed. Lower this if the captured image is bright to make it easier to see the overlay fields. Values range from 0 (black background) to 100 (full brightness of captured image).</li> </ol> <pre><code>When changing the brightness settings you may need to click somewhere in the overlay in order for the change to take affect.\n</code></pre> <p></p> <p>The Overlay Editor Overlays</p> <ol> <li>Displays a table showing all of the overlays available.</li> <li>This icon is displayed when the overlay is not editable, these are overlays provided by the Allsky team. Clicking the button will view the overlay but not allow it to be edited</li> <li>This icon is displayed when the overlay is editable. Clicking the button will view the overlay and allow it to be edited</li> </ol>"},{"location":"allsky_guide/overlays/overview.html","title":"Overview","text":"<p>An overlay is information that is added, i.e., overlayed, on top of each captured Allsky image. This often includes the time the image was taken, the sensor temperature, and the exposure length, but can include any other text or images you want.</p>"},{"location":"allsky_guide/overlays/overview.html#tldr","title":"TL;DR","text":"<ul> <li> <p> Yes, there are detailed instructions for the Overlay Manager\u2026 but if you\u2019d rather skip the homework and start clicking buttons like a caffeinated raccoon, go right ahead. It\u2019s surprisingly hard to break anything.</p> <ul> <li>Click the Variable Manager to add data to the overlay</li> <li>Click the Image icon to add an image (use the Image Manager to upload new images)</li> <li>Click a field to set its properties (font, size, etc.)</li> <li>Click the Preview button to preview the overlay \u2014 Allsky must be running</li> <li>Click and drag to select fields. Once selected:<ul> <li>Click the Group button to group fields</li> <li>Click the Left Align button to align the fields</li> </ul> </li> </ul> </li> </ul>"},{"location":"allsky_guide/overlays/overview.html#features","title":"Features","text":"<p>Almost any information can be added to a captured Allsky image. Some of the key features of Allsky's overlays include:</p> <ul> <li>Overlay Editor - this is the web page for creating and managing overlays and supports:  <ul> <li>Drag and Drop interface - Fields can be dragged around the screen to position them.  </li> <li>Customisable Interface - The Overlay Editor user interface can be highly customised.  </li> <li>Overlay Manager - Allows multiple overlays to be created and used in daytime / nighttime capture.  </li> <li>Font Manager - You can upload any TrueType font and use it in the overlays or use any font already on your Pi.  </li> <li>Variable Manager - Provides a library of fields that you can add to the image. You can also add your own fields.  </li> <li>Image Manager - Allows you to upload and manage images you wish to add to the image.  </li> <li>Blocks - Allows groups of fields to be added using a template  </li> <li>Field Grouping - Fields can be groupd to make moving and alignment easier  </li> <li>Field Alignment - Fields can be left aligned, spaced equally etc</li> </ul> </li> <li>Text Fields - This allows text to be added to the image. Key features include:  <ul> <li>Ability to add any data from Allsky to the image  </li> <li>Ability to add custom (extra) data to the image  </li> <li>Any TrueType font can be used  </li> <li>Text can be any colour or size  </li> <li>Text can be rotated  </li> </ul> </li> <li>Image Fields - This allows images to be added to the image:  <ul> <li>Any image can be uploaded  </li> <li>Images can be scaled and rotated and their opacity changed  </li> </ul> </li> <li>Shapes <ul> <li>Rectangles - You can draw on the overlay with a fill, border and transparency. This can be used to help highlight groupd of fields</li> </ul> </li> </ul>"},{"location":"allsky_guide/overlays/sunmoon.html","title":"Sun and Moon","text":"<p>In version v2024.12.06_06 and before there Overlay Manager allowed for the calculation of Solar System objects such as</p> <ul> <li>The Sun</li> <li>The Moon</li> <li>The Planets</li> <li>Any satellites you configure</li> </ul> <p>This functionality has moved to the Allsky Solar System module. </p>"},{"location":"allsky_guide/overlays/tips.html","title":"Tips","text":""},{"location":"allsky_guide/overlays/tips.html#best-practice","title":"Best Practice","text":"<p>Create separate overlys for day and night</p> <p>A lot of varibles make no sense in the daytime, for example a starcount. To make the overlays clearer in both daytime and nighttime create an overlay for each only displayng the required data.</p> <p>Use separate labels and variables.</p> <p>Whilst you can combine the label and variable into a single field this can make the layout of the overlay tricky. Since you can group and align fields its better to create to fields for each value you wish to display. One for the label and one for the value</p> <p>Group fields</p> <p>To make managing the overlay easy group logic filds together, this will make moving them far easier.</p> <p>Test The Overla</p> <p>Use the Preview option to check that the data is formatted as you expect</p> <p>Be Sensible With Fonts</p> <p>Use fonts sparingly. Try to keep to a consisten font and use different weights of the same font for headings and data</p> <p>Ensure Images Are Optimised</p> <p>When uploading images ensure they are sized correctly. Whilst you can resize on image in the overlay you should not rely on this to reize very large images. Ading very large images to an overlay will significantly slow down the generation of the overlay</p>"},{"location":"allsky_guide/settings/allsky.html","title":"Allsky","text":"<p>After you install Allsky for the first time there are many settings you must modify via the WebUI's Allsky Settings page. If you are upgrading from a recent prior release those settings can optionally be brought to the new release. Settings that change the look and feel of an Allsky Website are described here  .</p> <p>The list of settings available in the WebUI depends on your camera model; settings specific to a camera type (e.g., RPi or ZWO) are indicated as such in the table below. Where appropriate, the WebUI displays the minimum, maximum, and default values when you hover over a value, and only displays settings the camera supports, like cooler temperature for cooled cameras.</p> <p></p> <p>The Allsky Settings Page</p> <p>AllskySettings</p> <p>Legend</p> <ul> <li>CD indicates the setting's default is Camera Dependent and is displayed in the WebUI by hovering your cursor over the value.</li> <li>AW indicates a setting who's value is uploaded to your Allsky Website(s) when changed.</li> </ul>"},{"location":"allsky_guide/settings/allsky.html#daytime","title":"Daytime","text":"Settings WebUI Setting Default Description Daytime Capture Yes Enable to capture images during the day. Daytime Save AW No Enable to save images during the day (they are always saved at night). Only applies if Daytime Capture is enabled. Auto-Exposure Yes Turns on/off Auto-Exposure, which delivers properly exposed images even if the overall brightness of the sky changes due to cloud cover, sun, etc. Max Auto-Exposure CD CD The maximum exposure in milliseconds when Auto-Exposure is enabled. Ignored if Auto-Exposure is disabled.  When Auto-Exposure and Consistent Delays Between Images are both on, the time between the start of one image and the start of the next images is the Max Auto-Exposure + Delay. Manual Exposure 0.5 Manual exposure time in milliseconds. If Auto-Exposure is on this value is used as a starting exposure.  The time between the start of one image and the start of the next images will be the Manual Exposure + Delay, regardless of the status of Consistent Delays Between Images. Mean Target 0.5 The target mean brightness level when Auto-Exposure is on. Ranges from 0.0 (pure black) to 1.0 (pure white). Best used when both Auto-Exposure and Auto-Gain are enabled. Mean Threshold 0.1 When using Mean Target, this specifies how close (plus or minus) the target brightness should be to the Mean Target.  For example, if Mean Target is <code>0.4</code> and Mean Threshold is <code>0.1</code> then the target brightness ranges from <code>0.3</code> to <code>0.5</code>. Delay 5000 Time in milliseconds to wait between the end of one image and the start of the next. Auto-Gain No Turns on/off Auto-Gain which delivers properly exposed images even if the overall brightness of the sky changes. With RPi cameras, this should typically be turned on. With ZWO cameras you'll probably want this off and use the lowest gain possible since daytime images are bright and don't need any gain. Max Auto-Gain CD CD Maximum gain when using Auto-Gain. Ignored if Auto-Gain is off. Gain CD CD Gain is similar to ISO on regular cameras. When Auto-Gain is on, this value is used as a starting gain. When Auto-Gain is off, increasing this produces brighter images, but with more noise.  The default daytime gain is the minimum possible for the camera since daytime images are normally bright and don't need any additional gain. Stretch Amount 0 Stretching increases the contrast of an image without saturating the bright parts or making the dark parts turn black. It is most often used to lighten an image so isn't normally used during the day. This setting determines how much to change the image: 3 is typical and 20 is a lot.  Set to <code>0</code> to disable stretching.  See this page for more information on stretching images. Stretch Mid Point 10 Determines what brightness level in the image should be stretched: 0 stretches black pixels, 50 stretches middle-gray, etc. Binning 1x1 Bin 2x2 collects the light from 4 pixels to form one larger pixel on the image. Bin 3x3 uses 9 pixels, etc. Increasing the bin results in smaller, lower-resolution images and reduces the need for long exposure. Look up your camera specifications to know what values are supported.  During the day this setting is usually only changed for testing.   Binning on CCD cameras normally produces brighter images. CMOS camera may, or may not produce brighter images, depending on the camera model. Auto White Balance No Sets daytime auto white balance. When used, Red Balance and Blue Balance are used as starting points. Red Balance CD CD The intensity of the red component of the image. Blue Balance CD CD The intensity of the blue component of the image. Frames To Skip 5 When starting Allsky during the day, skip up to this many images while the auto-exposure software gets to the correct exposure.  Only applies if daytime Auto-Exposure is enabled. Cooling No (ZWO cooled cameras only) Enable to use cooling on cameras that support it. Target Temp 0 (ZWO cooled cameras only) Sensor's target temperature when cooler is enabled. In degrees Celsius. Tuning File No (RPi on Bookworm and Bullseye only) Full path name of the optional daytime tuning file. See the Raspberry Pi Documentation for more information.   System-supplied tuning files on Raspberry Pi models prior to 5 are in <code>/usr/share/libcamera/ipa/rpi/vc4</code>. New Pi's files are in <code>/usr/share/libcamera/ipa/rpi/pisp</code>."},{"location":"allsky_guide/settings/allsky.html#nighttime","title":"Nighttime","text":"Settings <p>Note</p> <p>Unless otherwise specified, these settings are the same as the Daytime ones.</p> WebUI Setting Default Description Auto-Exposure Yes Max Auto-Exposure CD CD Manual Exposure 10000 Mean Target 0.2 Mean Threshold 0.1 Delay 10 Auto-Gain No With ZWO cameras enabling Auto-Exposure and Auto-Gain together can produce unpredictable results so testing is needed. Max Auto-Gain CD CD Gain CD CD The default is one-half the maximum for the camera. Stretch Amount 0 Stretch Mid Point 10 Binning 1x1 Auto White Balance No Red Balance CD CD Blue Balance CD CD Frames To Skip 1 Only applies if nighttime Auto-Exposure is enabled. Cooling No (ZWO cooled cameras only) Target Temp 0 (ZWO cooled cameras only) Tuning File No (RPi on Bookworm and Bullseye only)"},{"location":"allsky_guide/settings/allsky.html#day-and-night","title":"Day and Night","text":"Settings WebUI Setting Default Description Days To Keep 14 Number of days of images and videos in <code>~/allsky/images</code> to keep. Any directory older than this many days will be deleted at each end of night. Set to <code>0</code> to keep ALL days' data; you will need to manually manage disk space. Configuration File [none] Configuration file to use for settings. Not currently used. Extra Parameters (RPi only) Any additional parameters to send to the <code>libcamera-still</code> image capture program. It supports a lot of settings that Allsky doesn't (e.g., auto-focus options), and this field allows you to enter those settings. Saturation CD CD (RPi only) Sets saturation from black and white to extra saturated. Contrast CD CD (RPi only) Changes the difference between blacks and whites in an image. Sharpness CD CD (RPi only) Changes the sharpness of an imgage. Images that are too sharp look unnatural. Aggression 75% (ZWO only) Specifies how much of a calculated exposure change should be made during auto-exposure. Lower numbers smooth out brightness changes but take longer to react to changes. Gain Transition Time 15 (ZWO only) Number of minutes over which to increase or decrease the gain when going from day-to-night or night-to-day images. This helps smooth brightness differences. Only works if nighttime Auto-Gain is off. <code>0</code> disables transitions. Image Type auto Image format: auto automatically picks the best type of image based on the camera. If you have a color camera it will use RGB24; mono cameras use RAW16 if the output file is a .png, otherwise RAW8 is used. RAW8: 8-bit mono. RGB24: color (red, green, blue), 8 bits per channel. RAW16: 16-bit mono. Quality / Compression 95 For JPG images, this specifies the quality - 0 (low quality) to 100 (high quality). Larger numbers produce higher-quality, but larger, files. For PNG, this is the amount of compression - 0 for no compression (but quicker to save) to 9 for highest compression (but slowest to save). If you use very short delays between pictures you may want to play with these numbers to get the quickest delay possible. Auto USB Bandwidth Yes (ZWO only) Automatically sets the USB Bandwidth. USB Bandwidth CD CD (ZWO only) How much of the USB bandwidth to use. Filename AW image.jpg The name of the image file. Supported extensions are jpg and png. Rotation None (RPi on Bookworm and Bullseye only) How to rotate the image. Choices are 0 and 180 degrees. Flip No flip How to flip the image (No flip, Horizontal, Vertical, or Both). Focus Mode No Enable to have images created and displayed as fast as possible, to aid in focusing. Other than adding the focus metric (see next setting) to each image, no other post-processing is performed - no resizing, no overlay or other modules are run, images aren't permanently saved or uploaded, and there is no delay between images - as soon as an image is available and the focus metric added, the next image is taken.  The WebUI's Live View refreshes the image every second or so. Because this happens so quickly, it's possible the Live View page will try to read the image as it's being updated, so you may see occasional \"glitches\". Record Focus No Enable to have the overall focus of the image determined and output via the <code>FOCUS</code> variable, which can then be used in an overlay. Unless you are focusing in \"Focus Mode\" (in which case this setting is enabled), it's not all that useful to see the metric since it can change depending on image brightness and other factors. Consistent Delays Between Images Yes Enabling this makes the time between the start of one auto-exposure and the start of the next exposure a consistent length (Max Auto-Exposure + Delay). Timelapse video frames will be equally spaced.  For example, if the Max Auto-Exposure is 60 seconds and the Delay is 30 seconds, the start of an exposure will be exactly 90 seconds after the prior exposure's start time, regardless of how long an individual frame's exposure is. So if the first exposure was only 3 seconds, the second exposure will still start 90 seconds after the first one.  Disabling this means the time between exposure starts varies depending on the actual length of each exposure. At nighttime when most exposure are at their maximum length this setting doesn't make a difference, but during the day or at twilight the exposure length is usually not at the maximum.  Note that if manual exposure is used this setting doesn't apply since the time between exposures (Manual Exposure + Delay) is always the same. Time Format <code>%Y%m%d %H:%M:%S</code> Determines the format of the displayed time. Run <code>man 3 strftime</code> to see the options. Temperature Units Celsius Determines what unit(s) the temperature will be displayed in (Celsius, Fahrenheit, or Both). Latitude AW Latitude of the camera. Formats include: <code>123.4N</code>, <code>123.4S</code>, <code>+123.4</code>, or <code>-123.4</code>. Southern hemisphere is negative. The <code>+</code> is needed for positive numbers. Longitude AW Longitude of the camera. Formats include: <code>123.4E</code>, <code>123.4W</code>, <code>+123.4</code>, or <code>-123.4</code>. West is negative. The <code>+</code> is needed for positive numbers.   The actual values for latitude and longitude are not displayed on the map, but users can zoom in to see exactly where your camera is. If that bothers you, change the latitude and/or longitude values slightly. Allsky itself only uses them to determine when daytime and nighttime begin so you can change the values a fair amount and not impact anything.   When installing Allsky the first time, the installation script will attempt to determine your rough Latitude and Longitude based on your IP address. These values may be \"close enough\" in most cases but you may want to check them anyhow. Angle AW -6 Altitude of the Sun above or below the horizon at which daytime and nighttime switch. Can be negative (Sun below horizon) or positive (Sun above horizon).  - <code>0</code> = Sunset  - <code>-6</code> = Civil twilight  - <code>-12</code> = Nautical twilight  - <code>-18</code> = Astronomical twilight  Click here for a more detailed description of Angle. Take Dark Frames No Enable to take dark frames which are use to decrease noise in images.  See the in-depth explanation of dark frames, including how to take and use them. Dark Frame Upper Threshold 0.05 Any dark frame that has a mean brightness higher than this number is not saved.  If you're getting messages about \"bad images\" while taking dark frames, first make sure your lens is FULLY covered and NO light is getting in.  If you are positive no light is getting in and your camera is noisy, then increase this to <code>0.1</code> and see if it helps. If not, then increase it more. Use Dark Frames No Enable to perform dark frame subtraction at night. Requires that you first took dark frames using Take Dark Frames. Locale The locale is used to determine what the thousands and decimal separators are as well as the language to use for many non-Allsky commands. If you have never set the locale in Allsky, the installation script will display a list of locales installed on your Pi, highlighting the current one. If it's the correct one, press TAB until the cursor is over <code>&lt;Ok&gt;</code>, then press ENTER.   The locale only needs to be set once and won't change unless you reinstall the Pi OS. Changing the locale requires a reboot, which must be done before continuing the installation.  If the correct locale isn't in the list it needs to be installed, so cancel out of the installation and run <code>sudo raspi-config</code>, selecting <code>Localisation Options</code>, followed by the <code>Locale</code> option. You will be shown a drop-down list with hundreds of locales; when you find the correct one for your language and country, press SPACE, then TAB to the <code>&lt;Ok&gt;</code> button. When done, re-run the installation script selecting the locale you just installed. ZWO Exposure Type Snapshot (ZWO only) Determines what type of exposures to take:  1. Snapshot takes pictures one at a time like a \"normal\" camera. Note that Auto-Gain and Auto White Balance do not work when Snapshot is used.  2. Video Off takes pictures like a video camera that is turned off after every picture. This is the same as the old Version 0.8 exposure setting.  3. Video (original) takes pictures like a video camera that is always on. This is the original exposure method.  The first two types decrease the sensor temperature between 5 - 15 degrees Celsius. Histogram Box 500 500 50 50 (ZWO only) X and Y size of histogram box in pixels and the middle point of the box in percent. This box is used to determine the average brightness of the image for auto-exposure compensation. If the Sun goes through the center of your image you may want to move the box. Debug Level 1 Determines the amount of output in the Allsky log file:  - <code>0</code> outputs error messages only.  - <code>1</code> outputs \"what's happening\" type messages.  - <code>2</code> outputs more \"what's happening\" messages.  - <code>3</code> outputs debugging information. Use this level when debugging problems. - <code>4</code> outputs a LOT of INFO messages. Use only if directed to by an Allsky developer."},{"location":"allsky_guide/settings/allsky.html#post-capture","title":"Post Capture","text":"Settings WebUI Setting Default Description Remove Bad Images Threshold Low 0.1 Images whose mean brightness is below this will be removed. Useful values range from <code>0.01</code> to around <code>0.2</code>. Set to <code>0</code> to disable this check. Remove Bad Images Threshold High 0.9 Images whose mean brightness is above this will be removed. Useful values range from <code>0.8</code> to around <code>0.95</code>. Set to <code>0</code> to disable this check. Remove Bad Images Threshold Count 5 Display a System Message when this many consecutive \"bad images\" are taken. A notification image will also be displayed telling you how many consecutive bad images there are. Once a \"good\" image is taken, the notification image will be replaced by the good image. Create Image Thumbnails Yes Create thumbnails of the images and save in <code>~/allsky/images</code>? If you never look at them via the WebUI's Images page, consider changing this to \"No\". Thumbnail Width 100 Sets the width of image and video thumbnails. Thumbnail Height 75 Sets the height of image and video thumbnails. These numbers determine the size of the thumbnails in <code>~/allsky/images</code> as well as any thumbnails created by the Allsky Website.   Although changing these will change the size of the thumbnails, no testing has been done to see if there are negative side effects. Image Resize Width 0 The width to resize images to. Large sensor cameras like the RPi HQ may need to be resized (shrunken) in order for timelapses to work. Resizing is done before cropping. Must be an even number and <code>0</code> disables resizing. Image Resize Height 0 Same as Image Resize Width but for the image height. Typically you'll want the Width/Height ratio to be the same as the sensor's width/height ratio, otherwise images will be distorted. Image Crop Top 0 Number of pixels to crop off the top of an image. This is often used to remove the dark areas around an image when using a fisheye lens. All the Crop numbers should either be <code>0</code> to disable cropping that side of an image, or a positive number. Image Crop Right 0 Number of pixels to crop off the right side of an image. Image Crop Bottom 0 Number of pixels to crop off the bottom an image. Image Crop Left 0 Number of pixels to crop off the left side of an image."},{"location":"allsky_guide/settings/allsky.html#timelapse","title":"Timelapse","text":"Settings Daily Timelapse WebUI Setting Default Description Generate Yes Enable to generate a timelapse video at the end of the night. Width 0 Changes the width of the generated timelapse; must be an even number. <code>0</code> uses the image's full size. Large sensor cameras like the RPi HQ often need the timelapse to be shrunk in order for timelapses to work (or the individual images need to be shrunk). Height 0 Changes the height of the generated timelapse; must be an even number. <code>0</code> uses the image's full size. If you change the width and height you'll probably want the resulting aspect ratio to match the original images. Bitrate 5000 Bitrate the timelapse video will be created with, in kilobytes. Higher values produce better quality video but larger files. Do NOT add a trailing <code>k</code>. FPS 25 The timelapse video ==F==rames ==P==er ==S==econd. Higher numbers produce smoother, but shorter, videos. Keep Sequence No Keep the sequence of symbolic links created when creating a timelapse? Primarily used when debugging. Extra Parameters Any additional timelapse parameters. If video quality is poor or videos don't play on Apple devices, try adding <code>-level 3.1</code>. Run <code>ffmpeg -?</code> to see the options. Mini-Timelapse <p>Note</p> <p>Several of these settings are similar to the setting with the same name for daily timelapses. In those cases, only differences are noted.</p> WebUI Setting Default Description Number Of Images 0 A \"mini-timelapse\" only includes the most recent images and is created often. It's a good way to see \"recent\" activity. This setting determines the number of images in the mini-timelapse. Keep in mind the more images you have the longer it'll take to create the video. 30 is a good starting point. <code>0</code> disables mini-timelapse creation.  Note that each mini-timelapse overwrites the prior one. The following settings only apply if this setting is greater than 0. Force Creation No Should a mini-timelapse be created even if Number Of Images images haven't been taken yet? For example, you want 15 images in each mini-timelapse but only 5 have been taken; should a mini-timelapse still be created? Frequency 5 After how many images should the mini-timelapse be created? Slower machines and machines with slow networks should use higher numbers. 3\u20135 works well on a Pi 4 with 4 GB memory. Every Frequency images a new mini-timelapse is created using the last Number Of Images images.   \u26a0\ufe0f Be very careful when setting Number Of Images and Frequency. If either or both numbers are too high, or the daytime/nighttime Delay is too short, there may not be enough time to finish one mini timelapse creation before the next one starts. If this happens the second one will be aborted and you'll see a System Message in the WebUI. Width 0 Height 0 Bitrate 2000 This is normally smaller than a full timelapse to save on processing time. FPS 5 Mini-timelapses contain a small number of images so this setting should be low to avoid very short videos. Both Timelapses WebUI Setting Default Description VCODEC libx264 Encoder used to create the timelapse video. Rarely changed. Run <code>allsky-config encoders</code> for a (long) list. Pixel format yuv420p Pixel format. Rarely changed. Run <code>allsky-config pix_fmts</code> for a (long) list. Log Level Warning Level of debugging information output when creating a timelapse. Set to Info + Warnings + Errors for more output. Primarily used for debugging or when tuning the algorithm."},{"location":"allsky_guide/settings/allsky.html#keogram-and-startrails","title":"Keogram and Startrails","text":"Settings Keograms WebUI Setting Default Description Generate Yes Enable to generate a keogram image at the end of the night. Expand Yes Enable to expand keograms to the image width. Same as the <code>--image-expand</code> and <code>-x</code> options. Font Name Simplex Font name. Font Color #ffffff (white) Color of the date/time label on the keogram. Same as the <code>--font-color</code> and <code>-C</code> options.  The color can be specified using one of the following:  1. Three comma- or space-separated numbers between <code>0</code> and <code>255</code> in RGB order. Example: <code>0,255,0</code> (green), <code>255 0 1</code> (red with a tiny bit of blue).  2. <code>#</code> followed by six hex digits <code>00</code> to <code>ff</code> in RGB order. Example: <code>#00ff00</code> (green), <code>#ff0001</code> (red with a tiny bit of blue).  3. <code>#</code> followed by three hex digits <code>0</code> to <code>f</code> in RGB order. Example: <code>#0f0</code> == <code>#00ff00</code> (green), <code>#f00</code> == <code>#ff0011</code> (red with a little bit of blue).  Hex digits include 0\u20139 and a\u2013f, where hex <code>a</code> = decimal <code>10</code>, \u2026 hex <code>f</code> = decimal <code>15</code>. Hex <code>10</code> = decimal <code>16</code> and hex <code>ff</code> = decimal <code>255</code>.  Larger values mean more of that color: <code>#000000</code> is black, <code>255 255 255</code> is white, <code>128,128,128</code> is middle gray. Font Size 2 Font size. Same as the <code>--font-size</code> and <code>-S</code> options. Font Line Thickness 3 Thickness of the font's line. Same as the <code>--font-line</code> and <code>-L</code> options. Extra Parameters Optional additional keogram creation parameters. Execute <code>~/allsky/bin/keogram --help</code> for a list of options. Startrails WebUI Setting Default Description Generate Yes Enable to generate a startrails image at the end of night. Brightness Threshold 0.1 Average brightness level above which images are discarded (moon, headlights, aurora, etc.). If you are only getting very short trails, or none at all, adjust this number. Values are 0.0 (pure black, filters out nothing) to 1.0 (pure white, uses every image). Extra Parameters Optional additional startrails creation parameters. Execute <code>~/allsky/bin/startrails --help</code> for a list of options."},{"location":"allsky_guide/settings/allsky.html#websites-and-remote-server","title":"Websites and Remote Server","text":"Settings <p>Note</p> <p>Allsky supports uploading files to a local (on your Pi) Website, a remote Website, and/or a remote server that is NOT an Allsky Website.</p> WebUI Setting Default Description Resize Uploaded Images Width 0 Set to an even number to resize images that will be uploaded. This decreases the size of uploaded files and saves network bandwidth. Further, images from cameras with large sensors won't fit on most monitors at full resolution, so in effect it's a waste to have large images. Set to <code>0</code> to disable resizing. Resize Uploaded Images Height 0 Same as Resize Uploaded Images Width but for the height. If that setting is <code>0</code> this setting must be as well. Upload Every X Images 1 How often should the current image be uploaded? This is useful for slow or costly networks. <code>0</code> disables uploading images. Note that startrails, keograms, and timelapse videos have their own upload settings. Upload Daily Timelapse Yes Enable to upload the timelapse video to an Allsky Website and/or remote server. If not set, the timelapse videos can still be viewed via the WebUI. Ignored if you do not have an Allsky Website or remote server. Upload Daily Timelapse Thumbnail Yes Enable to upload the timelapse video's thumbnail to your Allsky Website. Many remote servers don't support thumbnail creation so the thumbnail needs to be created on the Pi and uploaded. Not needed if your only Allsky Website is on your Pi. Upload Keogram Yes Enable to upload the keogram image to an Allsky Website and/or remote server. Upload Startrails Yes Enable to upload the startrails image to an Allsky Website and/or remote server. Upload Mini-Timelapse Yes Upload Mini-Timelapse Thumbnail Yes Display Settings No People sometimes ask others what settings they are using. Enable this setting to add a link to your Allsky Website's right-side popout that displays your settings. This only works if you are running the Allsky Website. Local Website WebUI Setting Default Description Use Local Website No Enable to use a local Allsky Website. No other settings are needed for a local Website. If you were using a local Website and disable it you will be asked if you want to keep or remove the saved images, keograms, startrails, and timelapse videos. Either way, the Website itself is not removed nor are its settings so you can easily re-enable it and pick up where you left off. Days To Keep on Pi Website 14 Any image, video, or thumbnail older than this many days will be deleted at each end of night. <code>0</code> disables the check and keeps ALL days' web data; you will need to manually manage disk space. Remote Website WebUI Setting Default Description Use Remote Website No Enable to use a remote Allsky Website. Enable the Website BEFORE you install it since the installation needs the settings below. Image Directory Name of the directory the current image should be uploaded to.   This setting is a major cause of confusion for many users. If you don't know what to enter, ask the person or company supporting the server or look in Troubleshooting \u2192 Uploads for more information. Protocol ftps Specifies how files should be uploaded to the remote Website.  - <code>ftps</code>: secure FTP  - <code>sftp</code>: SSH file transfer  - <code>ftp</code>: insecure FTP (not recommended) - <code>scp</code>: secure copy  - <code>rsync</code>: rsync copy  - <code>s3</code>: Amazon Web Services  - <code>gcs</code>: Google Cloud Storage   \u26a0\ufe0f <code>ftp</code> is unsecure; please use <code>ftps</code> or <code>sftp</code> instead.  Some of the settings below only apply to certain protocols. Server Name Name of the remote server. Note this is normally NOT the same as the URL used to access the server. Port (ftp protocols only) Optional port required by the server. Rarely needed. User Name The username of the login on the remote Website. Password The password of the login on the remote Website. FTP Commands (ftp protocols only) Optional command(s) to send to the ftp server prior to transferring files. If you need multiple commands, separate them with a semi-colon. See Troubleshooting \u2192 Uploads. SSH Public Key File (scp and rsync protocols only) Path to the SSH public key file.  You need to set up SSH key authentication on your server. First generate a key on your Pi:  <code>bash&lt;br&gt;ssh-keygen -t rsa&lt;br&gt;</code>Leave the default filename and use an empty passphrase. Then copy the key to your server:  <code>bash&lt;br&gt;ssh-copy-id remote_username@remote_server&lt;br&gt;</code>Replace <code>remote_username</code> and <code>remote_server</code> appropriately. If prompted to continue connecting, enter <code>yes</code>.  The private key will be stored in <code>~/.ssh/id_rsa</code>.  If you are using SSH Key with Amazon Lightsail, copy <code>ssh-key.pem</code> to your Pi (e.g., in <code>~</code>), run:  <code>bash&lt;br&gt;chmod 400 ~/ssh-key.pem&lt;br&gt;</code>and set:  - Protocol: <code>sftp</code> - Server Name: <code>remote host name</code> - User Name: <code>remote user name</code> - Password: <code>n/a</code> - FTP Commands: <code>set sftp:connect-program 'ssh -a -x -i /home/pi/ssh-key.pem'</code> AWS CLI Directory (s3 protocol only) Directory on the Pi where the AWS CLI tools are installed, typically <code>${HOME}/.local/bin</code>. Install and configure:  <code>bash&lt;br&gt;pip3 install awscli --upgrade --user&lt;br&gt;export PATH=\\\"${HOME}/.local/bin:${PATH}\\\"&lt;br&gt;aws configure&lt;br&gt;</code>Enter a valid access key ID, Secret Access Key, Default region name (e.g., <code>us-west-2</code>), and set Default output format to <code>json</code>. S3 Bucket (s3 protocol only) Name of the S3 bucket where files will be uploaded to (must be in the Default region above). Suggested name: <code>allskybucket</code>. Consider turning off/limiting bucket versioning to avoid consuming lots of space with multiple versions of <code>image.jpg</code>. S3 ACL private (s3 protocol only) S3 Access Control List (ACL). If you want to serve your uploaded files via http(s), change to <code>public-read</code> and ensure bucket policy allows public access. You may need CORS if accessed by JavaScript from a different domain. GCS Bucket (gcs protocol only) Name of the GCS bucket where files will be uploaded to. Suggested name: <code>allskybucket</code>. You need <code>gsutil</code> (Google Cloud SDK). See installation instructions. The <code>gsutil</code> command must be in standard <code>$PATH</code> (usually <code>/usr/bin</code>). Authenticate the CLI tool with the correct user. GCS ACL private (gcs protocol only) GCS Access Control List (ACL). Use a predefined ACL rule from here. To access files over https, set this to <code>publicRead</code>. Upload With Original Name No Determines the name of the uploaded image: <code>image.jpg</code> (No) or <code>image-YYYYMMDDHHMMSS.jpg</code> (Yes). This is rarely used since changing the image name will make it unviewable. Website URL Your website's URL, e.g. <code>https://www.mywebsite.com/allsky</code>.  - If Website URL is specified, Image URL must also be specified, and vice versa.  - Both URLs must begin with <code>http</code> or <code>https</code>. Image URL The URL to your allsky image, e.g. <code>https://www.mywebsite.com/allsky/image.jpg</code>. Normally this will be the Website URL followed by <code>image.jpg</code>. Use https if possible. Remote Server <p>Note</p> <p>These settings are the same as for the Remote Website so are not described.</p> WebUI Setting Default Description Use Remote Server No Enable to use a remote server which is NOT running the Allsky Website software. Files will be copied to this server which normally will be a private website where you want to display the most recent images along with other, non-Allsky information. Image Directory Protocol ftps Server Name Port User Name Password FTP Commands SSH Public Key File AWS CLI Directory S3 Bucket S3 ACL private GCS Bucket GCS ACL private Upload With Original Name No Unless you are using the remote server as a backup, this is rarely used since changing the image name will make it unviewable. Remote Video File Name allsky.mp4 Unless you are using the remote server as a backup, this is usually used so the server knows the file name. Remote Keogram File Name keogram.jpg Unless you are using the remote server as a backup, this is usually used so the server knows the file name. Remote Startrails File Name startrails.jpg Unless you are using the remote server as a backup, this is usually used so the server knows the file name."},{"location":"allsky_guide/settings/allsky.html#allsky-map","title":"Allsky Map","text":"Settings <p>Note</p> <p>If you want your allsky camera's location to display on the Allsky map, the information in this section will be sent to the map server every other morning to ensure it's fresh. The server automatically removes old data. Only a limited number of updates per day are allowed.</p> WebUI Setting Default Description Show on Map No Enable to have your camera appear on the Allsky map. If off, the following settings are ignored. Location AW The location of your camera. You can put any level of detail you want. Owner AW The owner of the camera - your name, an association name, an observatory, etc. Lens AW The lens you're using on your camera, for example: Arecont 1.55. Equipment Info AW Any optional information you want to add about the equipment you are using. For example, if you are using a camera with no infrared filter (a \"NoIR\" camera)."},{"location":"allsky_guide/settings/allsky.html#webui","title":"WebUI","text":"Settings WebUI Setting Default Description Images Sort Order Ascending Determines how the images for a day in the WebUI's Images page are displayed. Ascending sorts oldest \u2192 newest. Descending sorts newest \u2192 oldest. Show Updated Message Yes Determines whether the <code>Daytime images updated every...</code> message in the Live View page is shown. Require WebUI Login Yes Determines if you need to log into the WebUI. If your Pi is accessible on the Internet, do NOT disable this!! System Page Additions One or more colon-separated full path names to text files that contain user-supplied data to display on the WebUI's System page. See System Page Additions for more information and an example."},{"location":"allsky_guide/settings/allsky.html#database","title":"Database","text":"Settings <p>\u26a0\ufe0f Only change the database settings if you know what you are doing.</p> WebUI Setting Default Description Enable Database Yes Enables the Allsky database, which keeps information on images taken like exposure time and a day/night flag. Some Allsky modules update these records (e.g., meteor detection adds the number of meteors). The database enables features like using only nighttime images in startrails. Disabling it will keep many new features from working properly. Database allsky The name of the database. Database Type SQLite The type of database. MySQL has more features but uses a lot more CPU and memory than SQLite. It would typically only be used if you already have a MySQL database on your Pi (extremely rare). Database Host (MySQL only) The IP address or hostname of the server running the database. By default the database runs on your Pi. Database User (MySQL only) The username used to connect to the database. Suggest using the same as your Pi login so you have one less thing to remember. User Password (MySQL only) The password used to connect to the database.   Keep track of the User and Password - if <code>~/allsky/env.json</code> is accidently removed you'll need to enter the User and Password in order for the database to work."},{"location":"allsky_guide/settings/allsky.html#camera","title":"Camera","text":"Settings WebUI Setting Default Description Camera Type The type of camera you are using: ZWO or RPi. To select a camera of a different Camera Type:  1. Select the Type.  2. Save the change via the Save changes button.  3. Update the Camera Model as desired.  If you connect or disconnect a camera on the Pi, select Refresh to update the list of camera types and models. Camera Model The model of camera you are using. Note this list is only the models of the current Camera Type."},{"location":"allsky_guide/settings/website.html","title":"Website","text":"<p>The Allsky Website allows you to display your most recent captured image on a Website on your Pi, on another machine, or on both. Saved timelapse videos, keograms, and startrails can also be viewed. Constellations and other objects can be overlayed on the image, and aurora activity can be listed.</p> <p>For a local Allsky Website you only need to configure and enable it as described below; no installation is needed.</p> <p>Before you configure a remote Website you must first install it - see the Allsky Website Installation Instructions . Then return to this page.</p> <p>Steps to configure an Allsky Website are below.</p>"},{"location":"allsky_guide/settings/website.html#configure-website-settings","title":"Configure Website Settings","text":"<ul> <li>In the WebUI, click on the Editor link.</li> <li> <p>In the drop-down at the bottom of the page, select one of the following, depending on which Website you want to configure:</p> <ul> <li><code>configuration.json (local Allsky Website)</code> or</li> <li><code>remote_configuration.json (remote Allsky Website)</code> (only if you installed a remote Website)</li> <li>You will then see something like this:</li> </ul> </li> </ul> <p></p> <p>Example Remote Configuration Settings</p>"},{"location":"allsky_guide/settings/website.html#using-the-editor","title":"Using The Editor","text":"Using the Editor <p>The WebUI's Editor page allows editing Allsky configuration files. Items in the editor window are color-coded depending on what they are.</p> <p>Tip</p> <p>The Editor accepts CTRL-Z to undo actions.</p> <p>A typical view of a JSON file being edited is below, followed by a description of the color scheme.</p> <p></p> <p>A typical view of a JSON file being edited</p> <p>Color scheme</p> <p>Setting names look different depending on the file type:</p> <ul> <li> <p>In .json files they look likeThis.</p> <p>Settings names MUST be enclosed in double quotes, but quotes around them are omitted in the Allsky documentation for readability.</p> </li> <li> <p>Colors for setting values vary based on value's type:</p> <ul> <li>Text (anything surrounded by quotes): \"sample text\". Note that a number surrounded by quotes like \"41.79\" is treated as text and is confusing to people looking at the value. If a value is supposed to be a number, don't add quotes.</li> <li>Numbers (when not quoted): 41.79, -88.1.</li> <li>Booleans (when not quoted): true, false.</li> </ul> </li> <li> <p>Special characters: { } : , =</p> </li> <li>JSON brackets: [ ]</li> </ul> <p>Problems in the file</p> <p>If there's a formatting error in the file a small red \"x\" will appear to the left of a the line number. Hover your cursor over it to see the error.</p> <p>In the example below, a comma is missing from the end of line 37. The message is somewhat cryptic but is telling you it was expecting to see one of the listed characters at the end of the line.</p> <p></p> <p>Error in Configuration File</p> <p>You will not be able to save the file until all errors are resolved.</p> <p>If the page doesn't indicate there's an error but you get an error when you try to view the page, check if the colors on the page are different than what was described above. The most common errors are below:</p> <ul> <li> <p>In JSON files:</p> <ul> <li> <p>Missing commas are needed after each value except the last one in a sub-section.</p> <p>{ \"setting1\" : \"value 1\" &lt; missing comma \"setting2\" : \"value 2\" &lt; last entry, no comma needed }</p> </li> <li> <p>Missing quotes - setting names and string values must be surrounded by double quotes.</p> <p>setting1:\"value 1\" &lt; missing quotes around name</p> </li> <li> <p>Missing colons - one must separate each setting name from its value. </p> <p>There can be 0 or more spaces before and/or after the colon. </p> <p>setting1 \"value 1\" &lt; missing colon</p> </li> </ul> </li> </ul> <ul> <li> <p>Ignore any message about the Website not being enabled - you will do that in the next step.</p> <ul> <li> <p>The settings in both files are identical although their values may differ. The files are split into two sections:</p> </li> <li> <p>\"config\" - settings for the webpage image and constellation overlay.</p> </li> <li> <p>\"homePage\" - settings to change the look and feel of the Website's home page including the icons on the left side, the information popout on the right side, an optional background image, etc.</p> </li> </ul> <p>See the two sections at the bottom of this page for information on each section.</p> <ul> <li> <p>Each setting has a name and value, separated by a colon (:). Setting names in the file look like this and should generally NOT be changed unless, for example, you are adding a new icon on the left side of the screen.</p> <p>Setting names MUST always be enclosed in double quotes.</p> </li> <li> <p>You should change setting values as desired - they have different colors depending on their types, as described here.</p> <p>IMPORTANT</p> <p>Make sure all XX_NEED_TO_UPDATE_XX values are updated.</p> </li> <li> <p>Some settings like the latitude are also in the WebUI and should already be filled in. Those settings should only be changed in the WebUI, not in the file itself. The WebUI will ensure any changes are propogated to the appropriate file(s).</p> </li> </ul> </li> </ul> <p>Tip</p> <p>Tip: You can add comments to yourself by adding a new setting name and value, e.g.,</p> <p>\"myComment1\" : \"Need to check the next setting\",</p> <p>Be sure all setting names are unique.</p>"},{"location":"allsky_guide/settings/website.html#enable-the-website","title":"Enable The Website","text":"<ol> <li>On the WebUI's Allsky Settings page display the Website and Remote Server Settings section.</li> <li>Enable the Website in either the Local Website Settings or Remote Website Settings subsection, depending on which Website you are configuring.</li> <li>Change the other settings in that subsection as needed. Remote Websites need to know the server name, login, etc.</li> </ol> <p>The subsections below describe the settings in the json files, their default values, and a description.</p>"},{"location":"allsky_guide/settings/website.html#config-settings","title":"Config Settings","text":"<p>Legend</p> <ul> <li>Values for setting names with \"(map)\" after them are sent to the Allsky Map server if your camera is on the map.</li> <li>Setting names with \"(vs)\" after them impact the virtual sky overlay, i.e., the constellation overlay. See the complete list of virtual-sky based options.</li> <li>Values marked with  are automatically set during installation based on your WebUI settings and your Pi model, but can be overridden.</li> </ul> <p>Updating Settings</p> <p>It's important to update your settings in the WebUI before configuring the Allsky Website so you only have to update them once.</p> Setting Default Value Description <code>comment</code> This line describes what this section is for and can be deleted if desired. <code>imageName</code> <code>/current/tmp/image.jpg</code> (local)<code>image.jpg</code> (remote) The image uploaded from your Allsky camera.Normally should not be changed. <code>location</code> (auto) The location of your camera. <code>latitude</code> (auto) Latitude of the camera as a decimal number (negative is Southern hemisphere) or as an unsigned number with <code>N</code> or <code>S</code>, e.g. <code>\"41.79N\"</code> or <code>41.79</code>. <code>longitude</code> (auto) Longitude of the camera as a decimal number (negative is west of the prime meridian) or as an unsigned number with <code>E</code> or <code>W</code>, e.g. <code>\"101.9W\"</code> or <code>-101.9</code>. <code>camera</code> (auto) The camera type and model.Should not be changed \u2013 use the <code>equipmentinfo</code> setting instead. <code>lens</code> (auto) Short description of the camera's lens, for example brand, focal length, etc. <code>computer</code> (auto) The Raspberry Pi model.Should not be changed \u2013 use the <code>equipmentinfo</code> setting instead. <code>equipmentinfo</code> (auto) Any optional information on your equipment. <code>owner</code> (auto) The camera owner. <code>auroraForecast</code> <code>false</code> Displays the 3-day aurora forecast in the top right corner when set to <code>true</code>. <code>auroraMap</code> (auto) Aurora oval map for the <code>north</code> or <code>south</code> hemisphere. <code>intervalSeconds</code> <code>5</code> Number of seconds between checks for a new image.You may set this to roughly half the exposure cycle to reduce browser CPU usage. <code>showOverlayAtStartup</code> <code>false</code> Set to <code>true</code> to display the constellation overlay when the page loads. <code>overlayWidth</code> <code>875</code> Width of the overlay in pixels. <code>overlayHeight</code> <code>875</code> Height of the overlay in pixels. <code>overlayOffsetLeft</code> <code>0</code> Positive values move the overlay right; negative values move it left. <code>overlayOffsetTop</code> <code>0</code> Positive values move the overlay down; negative values move it up. <code>az</code> <code>0</code> Azimuth rotation of the overlay.<code>0</code> = north up, <code>90</code> = north right, etc. <code>imageWidth</code> <code>900</code> Width of the captured image in pixels.Height is calculated automatically to preserve aspect ratio. <code>opacity</code> <code>0.5</code> Opacity of the overlay from <code>0.0</code> (invisible) to <code>1.0</code> (full brightness). <code>objectsComment</code> Informational comment line; may be deleted if not needed. <code>XXX_objects</code> <code>virtualsky/messier.json</code> One or more semicolon-separated object files to display.To enable, remove the leading <code>XXX_</code>. <code>meridian</code> <code>false</code> Display the meridian line? <code>ecliptic</code> <code>false</code> Display the ecliptic line? <code>fontsize</code> <code>14px</code> Font size for constellation and star names. <code>cardinalpoints</code> <code>true</code> Display the cardinal points (N, S, E, W)? <code>cardinalpoints_fontsize</code> <code>18px</code> Size of cardinal point labels.Increase if difficult to read or adjust colour via <code>colours</code>. <code>showstarlabels</code> <code>true</code> Display star names? <code>projection</code> <code>fisheye</code> Leave at default for fisheye lenses (most Allsky cameras). <code>constellations</code> <code>true</code> Show constellation lines? <code>constellationwidth</code> <code>0.75</code> Width of constellation lines. <code>constellationlabels</code> <code>false</code> Show constellation names? <code>constellationboundaries</code> <code>false</code> Show constellation boundaries? <code>constellationboundarieswidth</code> <code>0.75</code> Width of constellation boundary lines. <code>gridlines_eq</code> <code>true</code> Show RA/Dec grid lines? <code>gridlineswidth</code> <code>0.75</code> Width of RA/Dec grid lines. <code>showgalaxy</code> <code>true</code> Show galaxies? <code>galaxywidth</code> <code>0.75</code> Width of galaxy outline lines. <code>mouse</code> <code>false</code> Allow mouse interaction to rotate the overlay. <code>keyboard</code> <code>true</code> Enable keyboard controls.Press <code>?</code> while hovering over the image for help. <code>showdate</code> <code>false</code> Show date and time in the overlay?Usually unnecessary if already embedded in the image. <code>showposition</code> <code>false</code> Show latitude/longitude in the overlay. <code>sky_gradient</code> <code>false</code> Lighten the sky toward the horizon? <code>gradient</code> <code>false</code> Reduce star brightness near the horizon? <code>transparent</code> <code>true</code> Make the sky background transparent? <code>lang</code> <code>en</code> Language for object names.See <code>~/allsky/html/allsky/virtualsky/lang</code>. <code>colours</code> Override default overlay colours in normal and negative modes.<code>rgba()</code> uses red, green, blue, and opacity (0.0\u20131.0). <code>live</code> <code>true</code> Update the display in real time (rarely changed). <code>id</code> Do not change. <code>AllskyVersion</code> Do not change."},{"location":"allsky_guide/settings/website.html#homepage-settings","title":"Homepage Settings","text":"Setting Default Value Description <code>comment</code> This line describes what this section is for and can be deleted if desired. <code>title</code> <code>XX_NEED_TO_UPDATE_XX</code> Text displayed next to the Allsky logo on the upper left.Can be anything you want, but keep it short because it is also displayed on the tab in your browser. <code>og_description</code> <code>XX_NEED_TO_UPDATE_XX</code> The description given to your Website if you drag/drop its icon to things like social media sites.Often the same as <code>title</code>. <code>backgroundImage</code> Optional background image for the Website home page.Sub-settings:- <code>url</code> \u2013 location of the image (URL or file name)- <code>style</code> \u2013 optional CSS style (e.g. <code>border: 1px solid red;</code>) <code>loadingImage</code> <code>loading.jpg</code> Location of the \u201cLoading \u2026\u201d image shown after starting the Website and before the first image appears.Can be a URL or a file name.Note: If this is a file on your Pi or remote server, put it in the Website\u2019s <code>myFiles</code> directory (restored during upgrades). <code>imageBorder</code> <code>false</code> Add a border to the image?The border helps distinguish the image from the black background. <code>includeGoogleAnalytics</code> <code>false</code> Include the <code>analyticsTracking.js</code> file?If you don\u2019t know what this is, leave it <code>false</code>.If you change the file it will be copied to newer releases during upgrades. <code>includeLinkToMakeOwn</code> <code>true</code> Display the \u201cBuild your own\u201d link at the bottom right of the home page? <code>personalLink</code> Adds an optional link at the top of the home page.Example: Click here to go to Google.Sub-settings:- <code>prelink</code> \u2013 text before the link (e.g. <code>Click</code>)- <code>message</code> \u2013 link text (e.g. <code>here to go to Google</code>)- <code>url</code> \u2013 destination URL (e.g. <code>https://google.com</code>)- <code>title</code> \u2013 hover text (e.g. <code>this is a title</code>)- <code>style</code> \u2013 optional CSS for <code>prelink</code> text (e.g. <code>color: red;</code>) <code>og_type</code> <code>website</code> Used by social media and other sites when dragging/dropping your Website icon.Rarely changed. <code>og_url</code> Link to your Allsky Website page (used by social media and other sites). <code>og_image</code> <code>image.jpg</code> Link to an image used as the thumbnail when dragging/dropping your Website icon to social media and other sites. <code>favicon</code> <code>allsky-favicon.png</code> Location of the browser \u201cfavorite icon\u201d.Note: If this is a file on your Pi or remote server, put it in the Website\u2019s <code>myFiles</code> directory (restored during upgrades). <code>thumbnailsizex</code> <code>100</code> Horizontal size of keogram, startrails, and timelapse thumbnails. <code>thumbnailsizey</code> <code>75</code> Vertical size of keogram, startrails, and timelapse thumbnails. <code>thumbnailsortorder</code> <code>ascending</code> Sort order of keogram, startrails, and timelapse thumbnails.<code>ascending</code> = newest to oldest<code>descending</code> = oldest to newest <code>leftSidebar</code> Settings that modify the left sidebar icons.Each icon supports:- <code>display</code> \u2013 <code>true</code> to show, <code>false</code> to hide (constellation overlay icon defaults to <code>false</code>)- <code>url</code> \u2013 page to open (directory name or full URL)- <code>title</code> \u2013 hover text- <code>icon</code> \u2013 Font Awesome class list (not all icons work)- <code>other</code> \u2013 text to add in place of a url (often used to trigger actions/popups)- <code>style</code> \u2013 optional CSS (e.g. <code>color: red;</code> turns the icon red)You can add, update, reorder, and delete icons. <code>leftSidebarStyle</code> CSS for the left sidebar itself (not the icons).Example: <code>background-color: yellow;</code> <code>popoutIcons</code> Settings that control the popout on the right side.Each entry supports:- <code>display</code> \u2013 <code>true</code> to show, <code>false</code> to hide- <code>label</code> \u2013 name shown for the entry- <code>icon</code> \u2013 same as <code>leftSidebar</code> icon setting- <code>variable</code> \u2013 a setting name from the <code>config</code> section whose value is displayed (e.g. <code>owner</code> shows the configured owner)- <code>value</code> \u2013 explicit value instead of a variable (text or URL)- <code>style</code> \u2013 optional CSS (e.g. <code>color: red;</code> turns the text red)You can add, update, reorder, and delete entries.Warning: The <code>Allsky Settings</code> popout entry\u2019s <code>display</code> should be changed via the WebUI Display Settings, not on the Editor page. <code>ConfigVersion</code> Do not change."},{"location":"allsky_guide/things/allskykamera.html","title":"Allskykamera","text":""},{"location":"allsky_guide/things/allskykamera.html#the-allskykamera-case","title":"The allskykamera Case","text":"<p>Stefan has designed and published a very nice modular case for Allsky cameras that you can 3d print.</p> <p>The case supports adding external sensors, these can be omitted to make the build easier. We particularly like the way the sensors have been made modular.</p> <p>Stefan has kindly provided the source files for the case allowing changes to be made if required. The designs are available on </p> <ul> <li>Tinkercad</li> <li>Makerworld</li> </ul> <p></p> <p>Camera housing with mounted components</p> <p></p> <p>The Tinkercad models</p>"},{"location":"allsky_guide/things/esp32.html","title":"Round Displays","text":""},{"location":"allsky_guide/things/esp32.html#esp32-p4-allsky-display","title":"ESP32-P4 AllSky Display","text":"<p>Transform your ESP32-P4 display into an all-sky camera viewer with multi-image cycling, hardware acceleration, and seamless Home Assistant integration.</p> <p>This is a great project that allows you to use the Waveshare round displays to show images from your Allsky camera</p> <ul> <li>Multi-Image Display - Cycle through up to 10 image sources automatically or via API triggers</li> <li>Flexible Update Modes - Automatic cycling or API-triggered refresh for external control (v-snd-0.62+)</li> <li>Runtime Display Selection - Switch between 3.4\" and 4.0\" displays via Web UI without recompilation (v-snd-0.61+)</li> <li>Enhanced Brightness Control - Three modes: Manual, MQTT Auto, or Home Assistant with clear UI indication (v-snd-0.61+)</li> <li>Hardware Accelerated - ESP32-P4 PPA for fast scaling and rotation (385-507ms render time)</li> <li>High Resolution - Up to 1448\u00d71448 pixel images with 2\u00d7 scaling capability</li> <li>Per-Image Transforms - Individual scale, offset, and rotation settings for each image</li> <li>Touch Controls - Tap to navigate, double-tap to toggle modes</li> <li>Home Assistant Ready - Auto-discovery via MQTT with full control</li> <li>Web Configuration - Modern, responsive UI for all settings</li> <li>OTA Updates - Wireless firmware updates with automatic rollback</li> <li>Easy Setup - Captive portal WiFi configuration with QR code</li> </ul> <p></p> <p>A running ESP32 P4 Display</p> <p>The project supports both the 3.4 and 4 inch displays</p>"},{"location":"allsky_guide/things/things.html","title":"Introduction","text":"<p>This section contains projects that the Allsky Team 'Love'</p>"},{"location":"allsky_guide/troubleshooting/flicker.html","title":"Image Flicker","text":"<p>If your videos to change in brightness every image or \"strobe\", see below.</p>"},{"location":"allsky_guide/troubleshooting/flicker.html#during-daytime-and-nighttime","title":"During daytime AND nighttime","text":"<p>If images on the WebUI's Liveview page or the Allsky Website flicker every time a new image appears, it could be the Firefox browser which has a known issue with image updates. Try a different browser. To ensure the issue is browser-related, click on the Images link in the WebUI and view the images one at a time, checking if their brightness changes every image. If they do NOT, then it's a browser issue.</p>"},{"location":"allsky_guide/troubleshooting/flicker.html#daytime-only-flicker-zwo-cameras","title":"Daytime only flicker (ZWO cameras)","text":"<p>Daytime auto exposures with ZWO cameras use an AllSky algorithm that looks at part of the image (called the histogram box) to determine the average brightness, and adjusts exposure to keep the brightness within an acceptable range. By default the histogram box is centered on the image. If the Sun or Moon go through that box, your images may flicker, especially if it is cloudy. If that's the case, try moving the histogram box to one of the corners (but be sure it's within the image the camera lens produces and NOT in the black border). You can also try adjusting the histogram box size - it should be around 15% of the width of the camera sensor in pixels. For a sensor that's 1000 pixels wide, a histogram box of 150 pixels wide is a good place to start.</p> <p>If you are STILL having flicker issues after doing the above, please follow the instructions on the Reporting Problems   page.</p>"},{"location":"allsky_guide/troubleshooting/flicker.html#nighttime-only-flicker-zwo-cameras","title":"Nighttime only flicker (ZWO cameras)","text":"<p>Nighttime images use the ZWO algorithm, not the Allsky algorithm for auto exposure. If you see flickering at night, try the following - these steps have helped some people, but not everyone:</p> <p>Change the USB Bandwidth and Auto USB settings in the WebUI. Add a more powerful power supply to the Pi, or a thicker/shorter wire from the power supply to the Pi. The Pi may not be getting enough power, which causes it to not provide enough power to the camera. Add a powered USB 3 hub between the Pi and the camera to ensure the camera's getting enough power. Update the Pi's firmware by executing sudo rpi-update.</p>"},{"location":"allsky_guide/troubleshooting/hardware.html","title":"Other Hardware","text":"<p>Problems with your Raspberry Pi are not an issue with the AllSky software, but we're providing this page as a service to Allsky users.</p>"},{"location":"allsky_guide/troubleshooting/hardware.html#my-pi-isnt-using-all-its-disk-space","title":"My Pi isn't using all its disk space","text":"<p>If you have a large SD card like 64 GB but the WebUI's System page shows significantly less, you need to resize the card. For example you see this: </p> <p></p> <p>Pi Disk Space</p> <p>but your SD card is much bigger than 28 GB, you need to resize your filesystem:</p> <p><code>sudo resize2fs /dev/sda2</code></p> <p>It may ask you to run an fsck command then run the resize again. If so, follow its instructions - you'll need to use sudo. After the resize, you should have all your space reporting correctly.</p>"},{"location":"allsky_guide/troubleshooting/hardware.html#pi-keeps-rebooting-after-a-few-minutes","title":"Pi keeps rebooting after a few minutes","text":"<p>One user reported his Pi was stuck in a loop where it would continually reboot after a few minutes. He had removed power from his Pi while it was still running. He fixed the problem by shutting the system down as soon as it came up.</p> <p>If you need to shut down your Pi do not simply unplug the power; instead, use the Shutdown button button on the WebUI's System page or via the command prompt:</p> <p><code>sudo shutdown -r now</code></p>"},{"location":"allsky_guide/troubleshooting/hardware.html#lenses","title":"Lenses","text":"<p>Lenses need to be matched to your camera and your environment. If you're in an urban canyon, maybe you don't need a 180\u00b0 lens. If you have light interference near the horizon you can create an artificial horizon, with a piece of black PVC pipe for example. If you're unsure of the field of view you can use a tool like Bintel   to calculate the field of view on the sensor, or Stellarium   to simulate the field of view.</p>"},{"location":"allsky_guide/troubleshooting/hardware.html#moisture-on-dome","title":"Moisture on dome","text":"<p>If you are getting moisture on the inside of your allsky dome, consider adding a Dew Heater</p> <p>You can also add a fan to the enclosure that sends air warmed by the Pi into the dome via one hole, and out via another.</p>"},{"location":"allsky_guide/troubleshooting/others.html","title":"Others","text":"<p>This pages lists how to troubleshoot other problems that don't deserve their own page.</p>"},{"location":"allsky_guide/troubleshooting/others.html#usb-reset-messages-in-system-logs","title":"USB reset messages in system logs","text":"<p>You can ignore entries similar to the following in the system logs:</p> <p><code>Sep 15 17:44:28 Pi-Allsky kernel: [108641.695297] usb 1-1.5: reset high-speed USB device number 4 using dwc_otg</code></p> <p>The ZWO software adds these whenever an image is taken.</p>"},{"location":"allsky_guide/troubleshooting/others.html#cant-save-image-because-one-is-already-being-saved","title":"Can't save image because one is already being saved","text":"<p>This message appears in the WebUI when the time to save and process an image is greater than the time to take an image plus the Delay between images. For example, if it takes 10 seconds to save and process an image but your exposure time is 1 second and your Delay between exposures is 2 seconds (for a total of 3 seconds), the software will try to save the second picture while the first one is still being saved.</p> <p>png files can take 10 or more seconds to save on a Pi 4 because there is no hardware support for them. You may also see this message if the Delay between images is too short, e.g., less than a second.</p> <p>There also may be messages like these in <code>/var/log/lighttpd/error.log</code>:</p> <pre><code>2021-10-19 15:17:10: (chunk.c.831) file shrunk: /home/pi/allsky/tmp/image.jpg\n2021-10-19 15:17:10 (connections.c.456) connection closed: write failed on fd 8\n</code></pre> <p>This means that a file shrunk in size while the web server was reading it. With these errors you'll usually see bands of pixels in the images. To fix this:</p> <ul> <li> <p>Increase your Delay or save to jpg format instead of png.</p> </li> <li> <p>If you have an extremely slow SD card try replacing it with a faster one. Or, make the allsky/tmp directory a memory-filesystem if not already done during installation. See the Reducing wear on your SD card   page.</p> </li> </ul>"},{"location":"allsky_guide/troubleshooting/others.html#images-are-too-light-too-dark-or-stars-are-hard-to-see","title":"Images are too light, too dark, or stars are hard to see","text":"<p>Overall image too light or too dark</p> <p>If your images are too light or too dark and you are using manual exposure try adjusting the Gain, Exposure, and/or Bin. There are separate exposure-related settings for daytime and nighttime, so make sure you pick the right ones. During the day you'll normally use Bin of 1x1 (i.e., binning off), and Gain of 0 since images are bright enough that you don't need those settings.</p> <p>If you are using auto exposure change the Mean Target to change the overall brightness of the image. It will vary the gain and exposure up to the maximum values you specify. If your images are still too dark overall try increasing the maximum values. Note that every camera has a maximum gain and exposure it supports - hover your cursor over those values to see what the maximums are.</p> <p>Stars hard to see</p> <p>If the stars are too hard to see but the overall image image brightness is where you want it, try stretching   the image.</p>"},{"location":"allsky_guide/troubleshooting/others.html#images-are-corrupted","title":"Images are corrupted","text":"<p>Various forms of image corruption have been observed: the right side of the image is full of repeating pixels, image contains parts of two or more frames, offset lines, etc.</p> <ul> <li> <p>Check your power supply and cooling. The Pi will report on undervoltage and/or throttled status on the System page of the WebUI. If it doesn't say No throttling you should investigate and remediate.</p> </li> <li> <p>If you have a ZWO camera it may be experiencing some internal firmware error; reset the camera either by unplugging it or power cycling the port with     </p><pre><code>sudo uhubctl -a 2 $(grep -l 03c3 /sys/bus/usb/devices/*/idVendor | \\\n    cut -d / -f 6 | sed -Ee 's/(.*)[.]([0-9]+)$/-l \\1 -p \\2/')\n</code></pre><p></p> </li> </ul>"},{"location":"allsky_guide/troubleshooting/others.html#errors-when-running-git-clone","title":"Errors when running git clone...","text":"<p>The git command is used to download Allsky releases from the git server. The command rarely fails, but it can if there are networking problems or the git server is down.</p> <p>The first thing to check is your networking - can you get to a site on the Internet? If you can and you see unusual messages like below, the git server is probably having problems so try again a few hours later.</p> <pre><code>error: RPC failed; curl 92 HTTP/2 stream 0 was not closed cleanly\nerror: 1234 bytes of body are still expected\nfetch-pack: unexpcted disconnect while reading sideband packet\nfatal: early EOF\nfatal: index-pack failed\n</code></pre>"},{"location":"allsky_guide/troubleshooting/reporting.html","title":"Reporting Problems","text":"<p>Regardless of what you want to ask or report, first look at the existing GitHub Discussions and Issues.</p> <p>If someone else has reported it, add to their post; do not create a new one.</p> <p>A problem is something that isn't working correctly and likely is caused by the Allsky Software. Misconfigured settings and other user errors are not problems since the Allsky Software won't need to change.</p> <p>A bug is something that isn't working correctly and you are pretty sure it's caused by the Allsky Software.</p>"},{"location":"allsky_guide/troubleshooting/reporting.html#reporting-problems","title":"Reporting Problems","text":""},{"location":"allsky_guide/troubleshooting/reporting.html#the-automated-method","title":"The Automated Method","text":"<p>Info</p> <p>This is the preferred method to report problems and should be used if your WebUI is working.</p> <p>Follow the instructions on the WebUI's Getting Support  page.</p>"},{"location":"allsky_guide/troubleshooting/reporting.html#the-manual-method","title":"The Manual Method","text":"<p>Warning</p> <p>Only use this method if you are unable to use the automated method above, for example, if Allsky didn't install or the WebUI isn't working</p> <p>If you can easily reproduce the problem, even if it means waiting until tomorrow for it to occur again, do the following:</p> <ul> <li> <p>Run the following command to make sure Allsky will produce the necessary information to help the Allsky Team troubleshoot your problem: <code>allsky-config   prepare_logs</code>. </p> <p>If the command changed the Debug Level you are told what its prior value was so you can restore it when troubleshooting is over.</p> </li> <li> <p>Wait until the problem occurs, then follow the steps below.</p> </li> </ul> <p>Either way:</p> <ul> <li> <p>Run the following to create a support log file in ~/allsky/html/support:</p> <p><code>cd ~/allsky; ./support.sh</code></p> </li> <li> <p>Create a new Problem Discussions in GitHub and attach the support log file to it.</p> </li> <li> <p>Attach screenshots of any error messages or copy/paste their text and surround them with three tildas in the Discussion, for example:     </p><pre><code>~~~\nERROR: error message line 1\n  error message line 2, ...\n~~~\n</code></pre><p></p> <p>This makes the message format properly.</p> </li> <li> <p>If there are any other files you think would be helpful, attach those as well (do not copy/paste their text).</p> </li> </ul> <p>GitHub File Type</p> <p>GitHub only accepts certain file types. See this URL for a list of supported types. If your file has an unsupported extension, append a .txt to its name, e.g., settings.json.txt.</p>"},{"location":"allsky_guide/troubleshooting/reporting.html#reporting-other-things","title":"Reporting Other Things","text":"<p>If you have a new item and it's:</p> <ul> <li>a QUESTION, create a GitHub Q&amp;A Discussion </li> <li>a request for a NEW FEATURE, create a GitHub Feature Request </li> <li>anything else that's not a problem or bug, create a GitHub Discussion </li> </ul>"},{"location":"allsky_guide/troubleshooting/rpicam.html","title":"RPi Cameras","text":"<p>This page describes known issues with RPi and RPi-compatible cameras.</p> <p>Warning</p> <p>The first step in diagnosing problems with RPi cameras is to run</p> <p><code>rpicam-still --timeout 1 --nopreview</code></p> <p>If it gives an error (usually one of the errors described below), then the problem is with the camera and NOT with Allsky.  </p>"},{"location":"allsky_guide/troubleshooting/rpicam.html#camera-not-found-or-not-working","title":"Camera not found or not working","text":"<p>A \"camera not found\" message can be due many different things. Here are some steps to try:</p> <ul> <li>If this is a new RPi camera, make sure the ribbon cable is installed correctly. This is an easy mistake to make since the cable will go in backwards. See the camera documentation for details on how to correctly plug the camera in.</li> <li>If you have access to another Pi, try plugging the camera in it to see if it works.</li> <li> <p>If you are running the Bullseye operating system, check for the correct camera driver.</p> <p><code>rpicam-still --timeout 1 --nopreview</code></p> <p>Ignoring all the INFO and WARN messages, if you get an error like this:</p> <p><code>terminate called after throwing an instance of 'std::runtime_error'</code> <code>what():  failed to import fd 22</code></p> <p>run:     - <code>sudo raspi-config</code>     - Navigate to Advanced Options     - Enable Glamor graphic acceleration     - Reboot your Pi     - Try <code>rpicam-still --timeout 1 --nopreview</code> again. It should work   </p> </li> <li> <p>Check for under voltage.</p> <p>Execute:</p> <p><code>rpicam-still --timeout 1 --nopreview</code></p> <p>Ignoring all the INFO and WARN messages, if you get an error that contains  </p> <p><code>Unable to request 0 buffers: Device or resource busy</code></p> <p>your Pi may be under voltaged     - If you have another power supply try it     - Using sudo, add over_voltage=4 to /boot/firmware/config.txt then reboot your Pi. If you are still having the problem, add arm_freq=700 to /boot/firmware/config.txt then reboot your Pi. Note that this decreases the speed of your Pi so should be a last resort     See more information.</p> </li> </ul>"},{"location":"allsky_guide/troubleshooting/rpicam.html#error-unable-to-request-4-buffers","title":"ERROR: Unable to request 4 buffers","text":"<p>ERROR: Unable to request 4 buffers: Cannot allocate memory </p> <p>If you see this message, either in the WebUI or from running rpicam-still, that means that the camera is detected but it can't take a picture.</p> <pre><code>ERROR V4L2 v4l2_videodevice.cpp:1241 /dev/video14[15:cap]: Unable to request 4 buffers: Cannot allocate memory\nERROR: *** failed to allocate capture buffers ***\n</code></pre> <p>The following will usually fix it:</p> <ul> <li>Using your favorite text editor, use sudo to edit the /boot/firmware/config.txt file (if that file doesn't exist try /boot/config.txt).</li> <li>Add the following line to the bottom of the file:   <code>cma=256M</code></li> <li>Reboot the Pi.</li> </ul> <p>If it does NOT fix the problem:</p> <ul> <li>Run allsky-config prepare_logs.</li> <li>Wait for the error to occur. This may take minutes or hours.</li> <li>Run grep \"Running:\" /var/log/allsky.log | tail -1.</li> <li>Run rpicam-still --timeout 1 --nopreview.</li> <li>Create a new Issue on the rpicam-apps GitHub page  .</li> <li>Attach the output from the last two commands to the new Issue.   Do not attach any Allsky files - this is NOT an Allsky problem.</li> </ul>"},{"location":"allsky_guide/troubleshooting/rpicam.html#rpi-hd-camera-stops-taking-pictures","title":"RPi HD camera stops taking pictures","text":"<p>This issue is normally resolved by upgrading the firmware on your Pi by doing the following:</p> <pre><code>sudo apt update \nsudo apt full-upgrade\nsudo shutdown -r now\n</code></pre>"},{"location":"allsky_guide/troubleshooting/rpicam.html#retcode137","title":"RETCODE=137","text":"<p>When a Linux command (for example, date) completes, it has an exit code, also called a \"return code\" or \"RETCODE\". By convention, a code of 0 means the command was successful and a non-zero code means there was some problem. The developer of the command specifies what each non-zero code means. When Allsky commands detect an issue, like a required file is not found, they print an error message then exit with a non-zero code.</p> <p>An exit code of 137 usually means the command was forcefully killed by an outside source, often the Linux operating system. When this happens to an Allsky command, the log file will usually contain a message with Killed in it, and often with <code>RETCODE=137</code> in it.</p> <p>If you are using a RPi camera and get a notification message saying ERROR See /var/log/allsky.log for details and the log file contains entries similar to these:</p> <pre><code>Jan 20 18:45:50 allsky allsky.sh[4480]: /home/pi/allsky/allsky.sh: line 372: 4562 Killed \"${ALLSKY_HOME}/${CAPTURE}\" \"${ARGUMENTS[@]}\"\nJan 20 18:45:50 allsky allsky.sh[4480]: 'capture_RPi' exited with RETCODE=137\n</code></pre> <p>that usually means the Linux kernel killed the command because it was using more memory than was available. This can also happen when a timelapse is being created, and the solution is the same - increase swap space.</p> <p>The installation of Allsky checked if additional swap space was needed, and if so, prompted you to add it. If you are seeing this problem you either didn't add swap space, or additional space is needed.</p> <p>This problem happens more often on Pi's with small amounts of memory such as the Pi Zero 2 with only 512 MB. It's less likely (although still possible) on a Pi 4 with 4 or 8 GB of memory.</p>"},{"location":"allsky_guide/troubleshooting/startrails.html","title":"Startrails","text":"<p>A startrails is an image that contains all the images from a night on top of each other in order to show star movement.</p> <p>Info</p> <p>Only nighttime images that are saved are included in a startrails, so if you don't save your nightime images, they won't be included.</p> <p></p> <p>An Example Startrail Image</p>"},{"location":"allsky_guide/troubleshooting/startrails.html#creating-a-startrails-image","title":"Creating a startrails image","text":"<p>To have a startrails image automatically created at the end of each night, enable the Generate setting in the Startrails sub-section of the WebUI.</p> <p>To manually create a startrails image run the generateForDay.sh command. For example, to create and then upload a startrails to any Allsky Website and/or remote server you have for July 10, 2025:</p> <pre><code>generateForDay.sh --startrails 20250710\ngenerateForDay.sh --upload --startrails 20250710\n</code></pre> <p>This will use the settings specified in the Startrails sub-section of the WebUI.</p> <p>If you want to experiment using other settings you can specify those settings as such:</p> <p><code>generateForDay.sh --startrails 20240710 --startrails-params \"--brightness 0.15 -o ~/allsky/tmp/test.jpg\"</code></p> <p>This will use a Brightness Threshold of 0.15 and put the resulting startrails in ~/allsky/tmp/test.jpg.</p> <p>Make sure the parameters are enclosed in quotes.</p> <p>See the Advanced section below for the possible parameters you can specify.</p> <p>Advanced users: running the startrails program manually</p> <p><code>generateForDay.sh</code> calls the <code>startrails</code> program to actually create the startrails, passing it several required arguments (the underlined ones below), plus any others you add to the Startrails Extra Parameters setting.</p> <p>Executing the <code>startrails</code> manually is possible, but not very useful.</p> <pre><code>Usage: startrails [-v] -i &lt;images-file&gt; | -d &lt;imagedir&gt; -e &lt;ext&gt; \\\n  [-b &lt;brightness&gt; -o &lt;output&gt; | -S] [-D &lt;output-data-file&gt;]  \\\n  [-s &lt;WxH&gt;] [-Q &lt;max-threads&gt;] [-q &lt;nice&gt;]\n\nArguments:\n  -h | --help : display this message, then exit.\n  -v | --verbose : increase log verbosity.\n  -S | --statistics : print image directory statistics without producing image.\n  -i | --images &lt;str&gt; : file containing list of images to process.\n        If the file also contains the mean brightness for an image, it will be used.\n  -d | --directory &lt;str&gt; : directory from which to read images.\n        If --images is specified then --directory is not needed unless.\n        one or more image names does not start with a '/'..\n  -D | --output-data &lt;str&gt; : save per-image summary data to the specified file.\n  -e | --extension &lt;str&gt; : filter images to just this extension.\n  -Q | --max-threads &lt;int&gt; : limit maximum number of processing threads (all cpus).\n  -q | --nice-level &lt;int&gt; : nice(2) level of processing threads (10).\n  -o | --output &lt;str&gt; : output image filename.\n  -s | --image-size &lt;int&gt;x&lt;int&gt; : restrict processed images to this size.\n  -b | --brightness &lt;float&gt; : ranges from 0 (black) to 1 (white). (0.35).\n  A moonless sky may be as low as 0.05 while full moon can be as high as 0.4.\n</code></pre> <p>Example of running the startrails program manually:</p> <pre><code>cd ~/allsky/bin\n./startrails -d images/20250710 -e jpg -b 0.15 -o images/20250710/startrails/startrails.jpg\n</code></pre>"},{"location":"allsky_guide/troubleshooting/startrails.html#startrails-settings","title":"Startrails settings","text":"<p>The only configuration setting for startrails is Brightness Threshold. Images have an average, or \"mean\" brightness level from 0.0 (pure black) to 1.0 (pure white). The default Brightness Threshold is 0.1 which is a fairly dark image, typical of a moon-less night.</p> <p>Any image with an average brightness greater than the Brightness Threshold is skipped during startrails generation, so daytime images should be skipped. You need to experiment with this setting to get the best results, as allsky cameras, lenses, and sky conditions impact an image's average brightness, and hence what you use for this setting. Every time a startrails image is created a summary of brightness values is saved to the Allsky log file.</p> <p>If you aren't seeing trailed stars in your images and you get a message like \"No images below threshold 0.100, writing the minimum image only\", your images are too bright and Brightness Threshold needs to be reduced. To determine what number to use you need to know the typical nighttime sky brightness value. Do the following:</p> <ul> <li> <p>Run <code>allsky-config</code> <code>get_startrails_info</code> to see what your brightness values are.</p> </li> <li> <p>If there is no data yet a message will appear with a possible reason, otherwise the output will look like:   </p><pre><code>Startrails date        Minimum   Maximum   Mean      Median    Images used   Not used  Threshold\n------------------------------------------------------------------------------------------------\n2025-01-17  06:20:45   0.084     0.146     0.103     0.105     250           3         0.15\n2025-01-18  06:16:18   0.045     0.135     0.102     0.106     247           6         0.15\n------------------------------------------------------------------------------------------------\nAverages               0.065     0.140     0.103     0.106     497           9         -\n\n1 entry not used due to invalid data.\n</code></pre><p></p> </li> </ul> <p>Mean Brightness</p> <p>Note that the Mean brightness is determined by looking at the whole image, including any black areas. This number is likely different from the mean brightness that can be overlayed onto your images, which is determined by looking at the central portion of an image. If you crop your image, add a mask to it, or change cameras you'll most likely need to update the Brightness Threshold setting.</p> <ul> <li>Set the Brightness Threshold to the Maximum, or slightly below it. If you have an Averages line, use its Maximum.</li> </ul> <p>Set the Brightness Threshold to the Maximum, or slightly below it. If you have an Averages line, use its Maximum.</p> <ul> <li>To make startrails generation MUCH faster, do it using a small number of images.</li> <li>Create a temporary directory to hold some nighttime images: <code>mkdir ~/allsky/images/test</code>.</li> <li><code>cd ~/allsky/images/DATE</code>, replacing DATE with the date of a non-working startrails.</li> <li>Using the timestamp of each image, move a few hours of nighttime images to the ~/allsky/images/test directory:<ul> <li>If you are running SAMBA (<code>allsky-config samba</code>) you can view the files from your PC or Mac and then select some files with the mouse and drag to the test directory.</li> <li>If you are not running SAMBA and you are logged into the Pi desktop, open a \"File Manager\" window on the Pi and drag/drop the files.</li> <li>If neither of the above work for you, you'll need to use the mv command to move the files. Using the * wildcard in the file names will allow you to move multiple files at a time.   For example: <code>mv 2025071001* ../test</code> to move all the images taken from 1:00 AM to 1:59 AM.</li> </ul> </li> <li>Run generateForDay.sh --startrails test to create a startrails file in the test directory. Look at the image using the Images page in the WebUI. Also look at the Images used and Not used columns of the output.</li> <li>As needed, adjust Brightness Threshold and re-run generateForDay.sh.</li> <li>When done, move all the images from the allsky/images/test directory back to allsky/images/DATE.</li> <li>Remove the temporary directory: <code>rmdir ~/allsky/images/test</code>.</li> <li>Now, create the final startrails:<ul> <li><code>generateForDay.sh --startrails DATE</code></li> <li>If you want to upload the file you just created, see the note generated by generateForDay.sh</li> </ul> </li> </ul>"},{"location":"allsky_guide/troubleshooting/startrails.html#troubleshooting","title":"Troubleshooting","text":"<p>Missing Startrails</p> <p>It's extremely rare that a startrails image isn't created at all. It's much more common that an image is created but none of the stars have trails. If none of the stars have trails, see the Startrails settings section above</p> <p>Image Resolutions</p> <p>The resolution of all images must be identical; if not, only images with the same resolution as the FIRST image are used.</p> <p>This can happen if the daytime and nighttime Binning settings are not the same, or any day you change the Image Resize and/or Image Crop settings.</p> <ul> <li> <p>If a startrails image isn't being created, make sure the Startrails Generate setting is enabled. If it IS enabled, run:   <code>generateForDay.sh  --startrails  DATE</code></p> <p>replacing DATE with a valid date like 20250710 and check for errors.</p> </li> <li> <p>If a startrails image is created but not uploaded, make sure the Startrails Upload setting is enabled. If that IS enabled, run:   <code>generateForDay.sh  --upload  --debug  --startrails  DATE</code></p> <p>and check for errors. If needed, run testUpload.sh to see why the upload fails.</p> </li> </ul>"},{"location":"allsky_guide/troubleshooting/swap.html","title":"Increase Swap Space","text":"<p>If you see a Killed or a RETCODE=137 message in /var/log/allsky.log, there's a good chance you need to increase the amount of swap space you Pi has. It's easy to do:</p> <pre><code>systemctl stop allsky\nallsky-config  recheck_swap\nsystemctl start allsky\n</code></pre> <p>Warning</p> <p>The swap file cannot be in use when increasing it, so make sure you don't try to increase it when a timelapse or another memory-intensive command is being run.</p> <p>If you are still having problems, try increasing swap size to 2048 MB or even 4096 MB.</p> <p>A more detailed description of how to manually increase swap space, including adding multiple swap files, is here  .</p>"},{"location":"allsky_guide/troubleshooting/timelapse.html","title":"Timelapse","text":"<p>Timelapse video creation can fail or result in poor quality videos for a number of reasons. The steps below, which apply to both the daily- and mini-timelapse, will almost always fix it.</p>"},{"location":"allsky_guide/troubleshooting/timelapse.html#timelapse-video-is-not-created","title":"Timelapse video is not created","text":"<p>First make sure the timelapse is enabled. In the Timelapse Settings section of the WebUI's Allsky Settings page, check that Generate setting for a Daily Timlapse is enabled; for a mini-timelapse, make sure Number of Images is not 0.</p> <p>If the timelapse is enabled you should see a message in /var/log/allsky.log like this:</p> <p><code>*** timelapse.sh: ERROR: ffmpeg failed.</code> <code>(ffmpeg is the command that actually creates the video.)</code></p> <p>See if one of the first lines in the error message is either:</p> <p><code>/home/pi/allsky/scripts/timelapse.sh: line 294: 6546 Killed ffmpeg -y -f image2 -loglevel ...</code>   OR <code>x264 [error]: malloc of size 38600544 failed</code></p> <p>These errors are almost always caused by not enough RAM memory and swap space, or by having a large camera sensor (e.g., the RPi HQ).</p> <p>To fix, do the following:</p> <ul> <li> <p>Decide if you need a full-resolution video. Most monitors only display High Definition (HD) which is 1920 x 1080 pixels. If your sensor size is larger than that you can decrease the timelapse Width and Height settings to 1920 by 1080, adjusted for the aspect ratio of your sensor. Decreasing these values will also make the video file smaller. Even if your monitor can display higher resolution than HD, do other people who will view your video have monitors that can? If this doesn't solve your problem, do the steps below.</p> </li> <li> <p>If you saw the <code>Killed ffmpeg ...</code> error increase swap space (or buy a Pi with more memory). The Linux kernel will kill any process that is taking \"too much\" memory to avoid system issues. Click here for details on how to increase swap.</p> </li> <li> <p>Install htop via ``sudo apt install htop<code>. It's great for checking</code>ffmpeg<code>'s memory use. Run htop in one terminal while running</code>generateForDay.sh --timelapse DATE<code>in another terminal to check on</code>ffmpeg<code>'s memory use. If the number in the \"VIRT\" (virtual memory) column of</code>htop``` hits a maximum of around 2900M and the timelapse fails, adding swap space will unlikely fix the issue so you'll need to try one of the other workarounds.</p> </li> <li> <p>The <code>malloc of size ...</code> error is often caused by using a high resolution camera. The default video codec (VCODEC) setting is <code>libx264</code> which has a stated maximum resolution of 4096 x 2304. However, the RPi HQ, ZWO ASI183, and other cameras have resolutions higher than that. If you saw the malloc error do one of the following:</p> <ul> <li>Decrease the timelapse Width and Height settings.</li> <li>Set the VCODEC setting to <code>libx265</code> and set timelapse Extra Parameters to <code>-x265-params crf=30</code>. This video codec takes a long time to create a video (over 3 hours on a PI 4b with 1500 RPi HQ images versus about 15 minutes with <code>libx264</code>). Lower crf numbers (a measure of file compression) mean larger, higher-quality videos. Note that small changes to the number can result in huge difference in file size, for example, going from <code>crf=30</code> to <code>crf=25</code> can increase the video size by over five times.</li> </ul> </li> </ul>"},{"location":"allsky_guide/troubleshooting/timelapse.html#poor-quality-timelapse","title":"Poor Quality Timelapse","text":"<p>If your timelapse videos have poor quality, typically more noticable in fast-moving areas like clouds, and/or the videos are \"blocky\", as seen in the image blow, try the steps below.</p> <p>Image Sizes</p> <p>A timelapse video made up of 1000 images, each one 2 MB, isn't 2000 MB (2 GB) in size. Instead, the software reduces the file size in various ways, which also reduces the quality of the video. However, you have control over how much the video quality is reduced. The key is to find a happy medium between quality and size.</p> <p></p> <p>Still frame from a alocky timelapse video</p> <ul> <li>If you have a high-resolution camera like the RPi HQ (4056 x 3040 pixels) or many ZWO cameras, try decreasing the resolution of the video. Many people have \"High Definition\" monitors with a width of 1920 pixels, so you can probably reduce your video without anyone noticing. Using half the camera's resolution is a good place to start (2028 x 1520 for the RPi HQ). Make sure to reduce the width and height by the same percent, not the same number. Decreasing resolution also decreases timelapse creation failures, speeds up processing, and results in faster uploads and less disk space used.  </li> </ul> <p>There are two ways to reduce the resolution.</p> <ul> <li>Decrease the resolution of each image.     Decrease the Image Resize Width and Image Resize Height in the Post Capture Settings section of the WebUI.     Note that decreasing the image resolution may make the images in the WebUI and in an Allsky Website appear smaller. It will also reduce that amount you can \"zoom in\" to the images.  </li> <li>Decrease the resolution of only the timelapse video.     Decrease the timelapse Width and Height in the Timelapse Settings section of the WebUI. This has no impact on the resolution of each individual image.  </li> <li>Add a Video Coding Level   to the timelapse Extra Parameters setting. Start with -level 3.1; if that doesn't help enough try level 3.2, 4, 4.1, or 4.2. Higher levels may also work but have not been tested.  </li> <li>Increase the Bitrate. This setting determines how much data is included in the video, and hence, how much data is left out. The more data that's left out, the smaller the file is.     The default is around 5000 kilobits/second (5 Mb/second) and is typically sufficient. Increasing the value too high, e.g., 25000 (25 Mb/second) could cause problems viewing the video - not all  network connections and devices can support that speed and you may get pauses.</li> </ul>"},{"location":"allsky_guide/troubleshooting/timelapse.html#missing-images-in-timelapse","title":"Missing Images In Timelapse","text":"<p>The number of images (also called \"frames\") in a timelapse video is the number of seconds long it is (including fractions of a second) times the Frames Per Second (FPS) you set. Execute the following to determine how many frames are in a video file as well as the length in seconds. Ignore the fps number, and replace YOUR_FILE with the name of your video:</p> <p><code>ffmpeg -i YOUR_FILE -vcodec copy -f rawvideo -y /dev/null 2&gt;&amp;1 | tail -2</code></p> <p>One cause for videos that are too short is zero-length files. Apparently when ffmpeg encounters a zero-length file it quits. To remove zero-length files for a specified day, do the following, replacing \"DATE\" with the name of a directory in ~/allsky/images:</p> <p><code>removeBadImages.sh DATE</code></p> <p>It will take a while to run. When it's done you can re-create the timelapse by executing:</p> <p><code>generateForDay.sh --timelapse DATE</code></p>"},{"location":"allsky_guide/troubleshooting/timelapse.html#deprecated-pixel-format","title":"Deprecated pixel format","text":"<p>If you see an error message like \"deprecated pixel format used, make sure you did set range correctly\" you can safely ignore it</p>"},{"location":"allsky_guide/troubleshooting/tools.html","title":"Tools","text":"<p>This pages lists some tools and techniques to aid in troubleshooting Allsky. If you have any other tools, please submit a GitHub Discussion and let the Allsky developers know.</p> <p>allsky-config command</p> <p>The <code>allsky-config</code> command performs various actions. Some let you easily configure a feature (like the ability to share files between your Pi and a PC or Mac), while other actions let you view various types of information which is often used to troubleshoot.</p> <p>The list of actions grows often so is not shown here but you can enter <code>allsky-config --help</code> to see the list.</p> <p>Info</p> <p>The Allsky developers may ask you to run <code>allsky-config</code> to provide additional information. In most cases you can simply copy and paste the command you are asked to run into a terminal window on the Pi.</p> <p><code>allsky-config</code> can be used two different ways:</p> <ul> <li> <p>Menu-driven</p> <p>In this mode you simply type <code>allsky-config</code> and are presented with a menu of actions you can perform. Use the up and down arrow keys to navigate the list and the left right arrow keys to go to the choices at the end of the list. After selecting an action, if additional information is needed you are prompted for it. The action you selected is then executed and its output displayed.</p> <p>You can then enter q to quit <code>allsky-config</code> or press return to be shown the menu of actions again.</p> <p>When viewing the menu, the name of the action that will be taken is listed at the end of every entry. That action name is used in the next mode of <code>allsky-config</code> - see below.</p> </li> <li> <p>Action-specific</p> <p>In this mode, you type <code>allsky-config ACTION</code> where \"ACTION\" is the name of an actions to execute, optionally followed by arguments.</p> <p>For example: <code>allsky-config show_supported_cameras --zwo</code>.</p> <p>Most actions only output information but a few first prompt for something then perform the action.</p> </li> </ul> <p>To see what an action does and what, if any arguments it takes, enter <code>allsky-config ACTION --help</code>, replacing \"ACTION\" with an action name shown in the command above.</p> <p>htop</p> <p>If your Pi seems very slow you can run the Linux <code>htop</code> command which displays the usage of all the CPUs and the amount of memory and swap in use, as well as the processes using the most CPU. The display is updated roughly every second.</p> <p>You will probably first need to install htop by executing <code>sudo apt install htop</code>.</p>"},{"location":"allsky_guide/troubleshooting/uploads.html","title":"Uploads (ftp, scp etc)","text":"<p>Uploading a file means copying it to a different computer. Allsky supports several ways to upload files including <code>ftp</code>, <code>scp</code>, and others.</p>"},{"location":"allsky_guide/troubleshooting/uploads.html#testing-an-upload","title":"Testing an upload","text":"<p>After you've configured settings such as Server Name and Protocol for a remote Website or remote server, run one of the commands below, depending on whether you are testing uploads to a remote Allsky Website or a remote server:</p> <pre><code>testUpload.sh --website\n     OR\ntestUpload.sh --server\n</code></pre> <p>This attempts to upload a file to the server, and if it fails, it often tells you how to fix it.</p> <p>If that doesn't help, look at the sections below for additional information.</p>"},{"location":"allsky_guide/troubleshooting/uploads.html#incorrect-webui-connection-settings","title":"Incorrect WebUI connection settings","text":"<p>A common mistake is having incorrect values for the Server Name and associated URL settings in the WebUI.</p> <ul> <li> <p>A Server Name looks like myserver.com and is the address FTP and other file transfer programs use to connect to the server.     It is NOT a URL so generally shouldn't have \"http\", \"https\", or \"/\" in its value.</p> </li> <li> <p>A Website URL or Server URL look like http://mywebsite.com/allsky/ and is the address web browsers use to connect to the server.     It MUST begin with \"http://\" or \"https://\".</p> </li> </ul> <p>See Mapping server locations to URLs   for tips on what values to use for these settings, especially if you get messages like \"Not found\" or \"404\".</p>"},{"location":"allsky_guide/troubleshooting/uploads.html#incorrect-webui-settings","title":"Incorrect WebUI settings","text":"<p>The Server Name, User Name, and other connection settings in the WebUI for the remote Website or remote server must be correct. If YOU can't log in to the server, Allsky won't be able to either.</p> <p>The directory structure for a remote Website must match the Allsky standard; changing locations and/or names of files and directories will cause uploads to fail. For a remote server you can use use any directory structure you want; Allsky only writes to the Image Directory location.</p>"},{"location":"allsky_guide/troubleshooting/uploads.html#certificate-related-errors","title":"Certificate-related errors","text":"<p>There are three main certificate-related error messages you'll see.</p> <ul> <li> <p>Host key verification failed   OR</p> <p>The authenticity of host 'xxxxx' can't be established</p> <p>These errors typically occur when using the sftp PROTOCOL. On the Pi, ssh to your remote server: ssh -p 22 username@host (replacing \"username\" and \"host\" with the appropriate values). The host will display a message and prompt for \"yes\" or \"no\". Enter \"yes\". This only needs to be done once for a given host.</p> <p>The remote server now knows about the Pi.</p> </li> <li> <p>Certificate verification: certificate common name doesn't match requested host name \"xyz.com\"</p> <p>There are two ways to fix this:</p> <ul> <li> <p>Create a file called ~/.lftprc and add set ssl:check-hostname false to it:</p> <p><code>echo \"set ssl:check-hostname\" &gt; ~/.lftprc</code></p> </li> <li> <p>Set the FTP Commands setting to set ssl:check-hostname false. If you expect to execute lftp manually the first method is better, otherwise use the second method so all your configuration changes are in one place.</p> </li> </ul> </li> <li> <p>Certificate verification: Not trusted</p> <p>Add <code>`set ssl:verify-certificate no</code> to FTP Commands or the ~/.lftprc file as above.</p> </li> </ul> <p>If your Pi's IP address changed, or the IP address remained but the machine using the addressed changed, you probably need to remove the previous key from your ~/.ssh/known_hosts file. If the file has only one entry, simply remove it. If the file has multiple entries, make a backup of the file, then delete one entry at a time until you find the \"bad\" one.</p>"},{"location":"allsky_guide/troubleshooting/uploads.html#missing-directories-on-the-remote-website-or-server","title":"Missing directories on the remote Website or server","text":"<p>Review the Allsky Website installation instructions or the Remote server installation instructions  to determine how to create the necessary directories.</p>"},{"location":"allsky_guide/troubleshooting/website.html","title":"Website","text":"<p>This page lists various issues you may have with the Allsky Website and how to solve them.</p>"},{"location":"allsky_guide/troubleshooting/website.html#warning-sunset","title":"WARNING: Sunset ...","text":"<p>WARNING: sunset is XX days old. Check Allsky log file if 'postData.sh' has been running...</p> <p>If you have a local or remote Allsky Website, at the end of every night Allsky calls postData.sh to upload a file called data.json to the Website(s). This file contains the sunset time and other information needed by the Website.</p> <p>If you are seeing the message above when you go to the Allsky Website, run:</p> <p><code>allsky-config  check_post_data</code></p> <p>It will run the postData.sh command and if there is a problem it will suggest a fix.</p>"},{"location":"allsky_guide/troubleshooting/website.html#error-sunset-not-defined","title":"ERROR: sunset not defined ...","text":"<p>ERROR: 'sunset' not defined in 'data.json' ... Follow the instructions in the error message. If this message continues to appear, follow the instructions on the WebUI's Getting Support page and upload the support log it creates to a new GitHub Discussion  .</p>"},{"location":"allsky_guide/troubleshooting/website.html#change-filename-issues","title":"Change filename issues","text":"<p>After changing the Filename in the WebUI you no longer see images on the Website</p> <p>If you changed the Filename setting or its extension (for example, from image.jpg to myimage.jpg or from image.jpg to image.png) in the WebUI, this change should automatically be sent to your Website(s). If that didn't happen, you must manually update the fileName value in the configuration.json file (local and/or remote) via the WebUI's Editor page. If that solved your problem, please follow these instructions to report a problem.</p>"},{"location":"allsky_guide/troubleshooting/website.html#cannot-access-website","title":"Cannot access website","text":"<p>Can't access the Allsky Website from a browser</p> <p>If nothing appears when you go to a local or remote Allsky Website it's usually a settings issue. If the Website is on your Pi, look in /var/log/lighttpd/error.log for clues to the problem. If the Website is remote, ask your hosting provider if you can have access to the web server's log file. In both cases, you can also look at the configuration.json file in the WebUI's Editor page to see if the editor's colors are off. If so, that indicates a syntax error in the file that needs to be fixed.</p> <p>If you are using the Pi's hostname in the URL, for example http://allsky/allsky, then try using the Pi's IP address, for example http://192.168.0.21/allsky.</p> <p>Info</p> <p>Remember that to access an Allsky Website on your Pi you need to enter http://allsky/allsky; entering http://allsky takes you to the WebUI.</p>"},{"location":"allsky_guide/troubleshooting/website.html#missing-archived-thumbnails","title":"Missing Archived thumbnails","text":"<p>Archived video files have no thumbnail</p> <p>If you click on the  (Archived Timelapses) icon on the left side of the Website and one or more videos say \"No Thumbnail\", see below.</p> <p>On your Pi</p> <p>This shouldn't happen on the Pi - it should automatically create the thumbnails when you go to the archived timelapses directory. Look in /var/log/lighttpd/error.log for clues to the problem.</p> <p>On a remote server</p> <p>For security reasons, many hosting solutions disable the commands needed to create video thumbnails.</p> <p>To overcome this problem enable the Upload Thumbnail setting(s) for the Daily and/or Mini Timelapse.</p> <p>Info</p> <p>Making this change will only create thumbnails for all future videos. To create the currently missing thumbnails, do the following for each missing thumbnail, replacing YYYYMMDD with the date in ~/allsky/images</p> <p><code>generateForDay.sh --thumbnail-only --upload --timelapse YYYYMMDD</code></p> <p>This will upload the thumbnail for the specified date.</p>"},{"location":"allsky_guide/troubleshooting/webui.html","title":"WebUI","text":""},{"location":"allsky_guide/troubleshooting/webui.html#username-and-password-issues","title":"Username and password issues","text":"<p>If you previously changed the username or password they are stored in encrypted format in a file. Deleting the file will restore the default values:</p> <p><code>sudo rm -f ~/allsky/config/raspap.auth</code></p> <p>If you never changed the username or password, do you get a dialog box asking for them when you go to the WebUI? If not, see below.</p>"},{"location":"allsky_guide/troubleshooting/webui.html#cant-access-the-webui-from-a-browser","title":"Can't access the WebUI from a browser","text":"<p>For example, you aren't prompted for username and password. This is usually a settings issue. Look in /var/log/lighttpd/error.log for clues to the problem.</p> <p>If you are using the Pi's hostname in the URL, for example http://allsky, then try using the Pi's IP address, for example http://192.168.0.21.</p>"},{"location":"allsky_guide/troubleshooting/zwo.html","title":"ZWO Cameras","text":""},{"location":"allsky_guide/troubleshooting/zwo.html#zwo-camera-not-found","title":"ZWO camera not found","text":"<p>If you have a new ZWO camera model that Allsky doesn't support you'll get an appropriate message in the WebUI when you start Allsky. The message will also tell you how to request support.</p> <p>If your camera is supported, check:</p> <ul> <li>Try plugging the camera into a different port.</li> <li>Try a different USB cable - they DO go bad sometimes.</li> <li>Is the camera plugged in to a USB hub? Make sure the hub is plugged into the Pi. Try plugging the hub into a different port on the Pi. Temporarily bypass the hub.</li> <li>If you have access to another Pi, or a PC, plug the camera into it to see if it works.</li> </ul>"},{"location":"allsky_guide/troubleshooting/zwo.html#asi_error_timeout","title":"ASI_ERROR_TIMEOUT","text":"<p>Info</p> <p>This is should almost never happen with newer Allsky releases.</p> <p>If images are not being taken with your ZWO camera and you see many ASI_ERROR_TIMEOUT messages in /var/log/allsky.log, try the steps below. The exact reason for these messages is unclear, although it's often due to USB settings or an excessive voltage drop going to the Pi or the camera. Long or thin wires can cause a voltage drop big enough that the camera has problems producing an image.</p> <p>Additionally, some cameras have buggy firmware that causes image acquisition to fail, even when other operations succeed. This condition may persist through a restart of Allsky.</p> <p>If you are seeing lots of errors (an occasional one can be ignored) try the following, in this order:</p> <ul> <li>If you have easy access to your Pi:<ul> <li>Check if there is moisture or water in it and if so, let it dry out for a couple days. This solved weird problems for some people, such as 60 second exposures finishing in 2 seconds, and continual ASI_ERROR_TIMEOUT messages.</li> <li>Unplug and replug the camera to fully reboot it.</li> <li>Move the camera to a different port on the Pi or from a USB 2 port to USB 3 or vice versa.</li> </ul> </li> <li>Change the USB settings. On the WebUI's Allsky Settings page, try increasing and decreasing the USB Bandwidth setting and try turning Auto USB Bandwidth on and off.</li> <li>See if the system is in under-voltage mode or is throttling which could lead to insufficient power getting to the camera. The WebUI's System page will display the throttle and under voltage status.   If you are getting under-voltage, this power unit   may help. Or use a more powerful power supply or power cables with thicker wires.</li> <li>If you have easy access to your Pi and have a spare powered USB hub, plug the hub into your Pi and a power source, and plug the camera into the hub. This will usually resolve any power issues with the camera.</li> <li>If you have a Windows PC, plug the camera into it and use the ZWO software that came with the camera to see if it also has problems. If it does, it's likely a hardware issue.</li> <li>The above changes work for almost everyone. If they don't work for you, follow the instructions on the Reporting Problems   page to report the problem.</li> </ul>"},{"location":"allsky_guide/troubleshooting/zwo.html#advanced-steps","title":"Advanced steps","text":"<p>The steps listed below haven't been fully tested and we suggest entering a new Discussions    item before trying them.</p> <p>Try adding <code>swiotlb=131072</code> to end of the line in /boot/cmdline.txt, then reboot. This increases the number of USB buffers from 32 to 128 and might be needed for cameras with very large sensors like the ASI294MM (8288 x 5644) @ 16 bits.</p> <pre><code>32  buffers * 1024 bytes/buffer =  32768 bytes.\n128 buffers * 1024 bytes/buffer = 131072 bytes.  \n</code></pre> <p>Prior to this change the contents of /sys/kernel/debug/swiotlb/io_tlb_used was hitting the maximum of 32768 bytes. After the change it was hitting a maximum of about 46000.</p> <p>Enable <code>DebugPrint</code> in ~/.ZWO/ASIconfig.xml by changing the 00 to 01, then restart Allsky. A LOT of lines will be added to /var/log/allsky.log, so be sure to set it back to 00 when done testing. The extra log entries may offer some insight into causes of the exposure failures.</p>"},{"location":"allsky_guide/troubleshooting/zwo.html#asi120-etc","title":"ASI120 etc","text":"<p>Warning</p> <p>Many people with the ASI120 camera have problems and bought better cameras. Beware.</p> <p>Owners of USB2.0 cameras such as the ASI120 may need to do a firmware upgrade  .</p>"},{"location":"allsky_guide/troubleshooting/zwo.html#t7-cameras","title":"T7 Cameras","text":"<p>The T7 / T7C cameras from Datyson and other sellers are an OEM version of the ZWO ASI120 and isn't officially supported in Allsky because it does not work out of the box. If you do decide to try this camera, you do so at your own risk.</p> <p>We do not know if the camera has a fail-safe boot loader that will prevent the camera from being bricked if a firmware update fails. ZWO states that updating the firmware may result in reduced camera performance. As with all firmware updates, this may damage your camera. Once again, use this camera at your own risk.</p> <p>The stock firmware uses invalid 1024-byte packets, rather than 512-byte. Plugging in this camera will result in kernel logs similar to this:</p> <pre><code>usb 3-2: new high-speed USB device number 62 using xhci_hcd\nusb 3-2: config 1 interface 0 altsetting 0 bulk endpoint 0x82 has invalid maxpacket 1024\nusb 3-2: New USB device found, idVendor=03c3, idProduct=120b, bcdDevice= 0.00\nusb 3-2: New USB device strings: Mfr=1, Product=2, SerialNumber=3\nusb 3-2: Product: ASI120MC\nusb 3-2: Manufacturer: ZWOptical company  \nusb 3-2: SerialNumber: 00000\n</code></pre> <p>You should now be experiencing some feelings of regret for buying this camera. Any attempt to actually use the camera will fail, likely producing kernel messages similar to:</p> <pre><code>usb 3-2: reset high-speed USB device number 62 using xhci_hcd\nusb usb3-port2: disabled by hub (EMI?), re-enabling...\n</code></pre> <p>While we cannot help with the buyer's remorse, the USB errors can be remedied using ZWO's compatible firmware  . Without this firmware the camera will not work on Linux. Unfortunately, the firmware updater must be run from Windows in order to update USB 2 cameras. ZWO support confirms that it does not work on MacOS or Linux. Additionally, the firmware update requires you to install a specific version of MSVCRT, and also the ZWO driver package (this is not obvious on the firmware page).</p> <p>If you do not have Windows, you can get a legitimate developer VM image from Microsoft which may work well enough to re-flash the camera. Use your favorite search engine to find a \"Microsoft windows developer vm image\". Then look for instructions on enabling \"USB pass-through\" for your virtualization platform. Note that USB pass-through to VMs has been the source of issues in many different projects, e.g., anything that does DSP, timing-critical operations, or device reprogramming.</p> <p>It may be necessary to append <code>program_usb_boot_mode=0</code> to /boot/config.txt to make this camera work. As this changes some one-time-programmable EPROM - permanently altering your Raspberry Pi - do not set this unless absolutely necessary (and we don't know why it would be necessary).</p>"},{"location":"allsky_modules/introduction.html","title":"Introduction","text":"<p>Modules can be used to enhance images created by Allsky. Different modules perform different tasks, the Module Manager allows you to control which modules run and when.</p> <p>There are two types of modules:</p> <ul> <li> <p>Allsky Modules are developed and maintained by the Allsky team and are installed with Allsky.</p> </li> <li> <p>User Modules are developed and maintained by other people and can optionally be installed and deleted if no longer required.</p> </li> </ul> <p>Warning</p> <p>User Modules should only be installed from the official user-modules   repository using the directions listed there. Installing from other source can be dangerous.</p> <p>Warning:</p> <p>Some modules are shown as experimental. Before using these modules you should ensure that you are proficient in analysing Linux log files. Experimental modules can be unstable and as such may \"break\" Allsky.</p> <p>Some modules are designed to operate with external hardware, typically connected to the Pi's GPIO pins. Before attempting to use any of these modules make sure you have an understanding of interfacing hardware to the PI's GPIO.</p> <p>Don't be discouraged by the above warnings - the module system is very flexible and allows you to customise Allsky without having to change any Allsky code.</p>"},{"location":"allsky_modules/introduction.html#what-are-modules","title":"What Are Modules","text":"<p>Modules are Python components that extend the functionality of Allsky. They typically fall into one of several categories:</p> <ul> <li>Data-enhancement modules \u2014 These add extra information that can be used in overlays. For example, the Solar System module provides details about celestial objects such as the Moon\u2019s position.</li> <li>Hardware-control modules \u2014 These interact with external devices. A common example is the Dew Heater module, which reads sensor data and automatically adjusts the dew heater.</li> <li>Image-processing modules \u2014 These operate on the captured images. Some modify the image itself (such as the Mask module), while others analyse the image to generate additional overlay data, such as the Star Count module.</li> </ul>"},{"location":"allsky_modules/introduction.html#available-pipelines-flows","title":"Available Pipelines (flows)","text":"<p>There are 5 pipelines available in Allsky.</p> Pipeline Description Daytime Used whilst Allsky is capturing images during the day Nightime Used whilst Allsky is capturing images during the night Day to Night Used when Allsky transitions from Daytime to Nighttime capture Night to Day Used when Allsky transitions from Nighttime  to Daytime capture Periodic Run periodically outside of the main Allsky capture process <p>Each pipeline can run a series of modules in sequence. By default, the Daytime and Nighttime pipelines include the core modules that load and save the captured image; these core modules cannot be removed. All other pipelines start empty. You can use the Module Manager to add additional modules to any pipeline as needed.</p> <pre><code>flowchart TB\n    A[\"Capture Image\"] --&gt; B[\"Remove Bad Images\"]\n    B --&gt; C[\"Resize\"] &amp; A\n    C --&gt; D[\"Crop\"]\n    D --&gt; E[\"Stretch\"]\n    E --&gt; F{\"Flow Type\"}\n    F -- Daytime Pipeline --&gt; FDL[\"Load Image\"]\n    FDL --&gt; FDM[\"Load Modules\"]\n    FDM --&gt; FDR[\"Run Modules\"]\n    FDR --&gt; FDS[\"Save Image\"]\n    FDS --&gt; P[\"Create Thumb\"]\n    F -- Nighttime Pipeline --&gt; FNL[\"Load Image\"]\n    FNL --&gt; FNM[\"Load Modules\"]\n    FNM --&gt; FNR[\"Run Modules\"]\n    FNR --&gt; FNS[\"Save Image\"]\n    FNS --&gt; P\n    PTE[\"Perodic Timer\"] -- Periodic Pipeline --&gt; FPM[\"Load Modules\"]\n    FPM --&gt; FPR[\"Run Modules\"]\n    F -- End Of Night Pipeline --&gt; FEONM[\"Load Modules\"]\n    FEONM --&gt; FEONR[\"Run Modules\"]\n    FEONR --&gt; FEONCS[\"Create Startrails\"]\n    FEONCS --&gt; FEONCT[\"Create Timelapse\"]\n    FEONCT --&gt; FEONCK[\"Create Keogram\"]\n    FEONCK --&gt; FEONU[\"Upload Images / Videos\"]\n    FEONU --&gt; A\n    F -- Start Of Day Pipeline --&gt; FEODM[\"Load Modules\"]\n    FEODM --&gt; FEODR[\"Run Modules\"]\n    FEODR --&gt; P\n    P --&gt; Q[\"Create Mini Timelapse\"]\n    Q --&gt; R[\"Upload Image\"]\n    R --&gt; A</code></pre>"},{"location":"allsky_modules/introduction.html#the-module-manager","title":"The Module Manager","text":"<p>Pipelines are managed by adding and removing modules via the Module Manager.</p> <p>Default Pipline</p> <p>When entering the module manager the default pipeline will be either Day or Night depending upon the time of day</p> <p></p> <p>The Module Manager</p> Number Function Description 1 Save The Current Pipeline USe this button to save the pipeline after you have made any changes to modules or module configuration. 2 Select Pipeline Selects the pipeline to manage 3 Periodic Flow Shortcut to display the periodic flow. 4 Module Filter Filters modules in the available lkist by module type 5 Search Allows searching in the available and selected module lists. 6 Device Manager Displays the 'Device Manager'. 7 Settings Displays the module manager settings 8 Debug Displays debug information for the last pipeline run 9 Available Modules Lists the modules available to be added to the pipeline 10 Selected Modules Lists the modules selected for the  pipeline"},{"location":"allsky_modules/introduction.html#enabling-a-module","title":"Enabling a module","text":"<p>To enable a module drag it from the Available Modules column to the Selected Modules column and select the \"Enabled\" checkbox. The module will become active after the flow has been saved. You can set modules to be automatically enabled when dragging them to the Selected Modules column in the Module Editor Module Options.</p> <p>Most modules require some configuration after they have been moved to the Selected Modules column. Clicking the settings button will display any configuration options for the module.</p>"},{"location":"allsky_modules/introduction.html#disabling-a-module","title":"Disabling a Module","text":"<p>There are two ways to disable a module:</p> <ul> <li>Drag the module to the Available Modules column - this will disable the module and lose any settings for it.</li> <li>Uncheck the \"Enabled\" checkbox - this will disable the module but retain any settings. This is the preferred method if you just wish to temporarily disable a module.</li> </ul>"},{"location":"allsky_modules/introduction.html#execution-order","title":"Execution order","text":"<p>The modules are run in the order they appear in the Selected Modules column. To change the order simply drag the modules up or down the list. Modules highlighted in red can not be moved.</p> <p>Module Order</p> <p>The order modules run is important. For example dont put the overlay module before a module that generates data for it. If you do this the overlay will display the data from the previous run of the pipeline</p>"},{"location":"allsky_modules/introduction.html#module-settings","title":"Module Settings","text":"<p>Each module provides a dialog where its settings can be managed. These settings are divided into tabs. Each module will have different tabs but there are a few that are consistent across all modules</p>"},{"location":"allsky_modules/introduction.html#the-history-tab","title":"The History Tab","text":"<p>If the module produces any graphs then the main graph will be displayed in the history tab</p> <p> </p> <p>The History tab</p>"},{"location":"allsky_modules/introduction.html#the-variables-tab","title":"The Variables Tab","text":"<p>This tab shows what variables the module will generate, these can then be used in the VAriable manager to add fields to the overlays. This is really only for information purposes.</p> <p> </p> <p>The Variables tab</p>"},{"location":"allsky_modules/introduction.html#the-changelog-tab","title":"The Changelog Tab","text":"<p>This tab shows a history of the changes that have been mad to the module</p> <p> </p> <p>The Change Log tab</p>"},{"location":"allsky_modules/introduction.html#the-important-tab","title":"The 'Important' tab","text":"<p>If this module or any portions of it are deprecated then this tab will display information about those deprecations</p> <p> </p> <p>The Deprecation tab</p>"},{"location":"allsky_modules/introduction.html#testing-modules","title":"Testing Modules","text":"<p>Some modules provide the ability to test the module rather than waiting for it to run and reviewing the Allsky logs. </p> <p> </p> <p>The Test button</p> <p>clicking the test button will run the module with the current settings you have configured and display a results dialog with two tabs</p> Teh test results The Extra Data the test generated"},{"location":"allsky_modules/core/clear_sky.html","title":"Clear Sky","text":"","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/clear_sky.html#description","title":"Description","text":"<p>This module attempts to determine if the sky is clear. It does this by counting the number of stars in a specific region of the image. If the count is above a threshold then the sky is considered clear.</p> <p>Several other modules, star count and meteor count, can use the results of this module. If the sky is not considered clear then these modules will not attempt to run as there would be no point.</p>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/clear_sky.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Region of Interest Selects the area of the image to use for determining if the sky is clear Fallback % If no region of interets is specified then an are around the center of the image will be used. This determines what percentage of the image, from the center, is used Clear Sky If the number of stars is above this then the sky is conidered clear","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/clear_sky.html#the-debug-options","title":"The Debug Options","text":"<p>The debug options allow you to fine tune the settings and annotate the main image so see what the algorithms are detecting.</p> Setting Description Annotate stars will highlight detected stars in the debug image specified Debug Image When using a debug image the resulting detected image will be saved as this name <p>Tip</p> <p>When using debug images set the 'Debug Image Name' to a file inside the Allsky web root. This will allow you to browse to the image</p>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/clear_sky.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/export.html","title":"Export","text":"","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/export.html#description","title":"Description","text":"<p>This allows Allsky data to be exported to a json file.</p>","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/export.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description File Location The file to create the data in Extra Data To Export Comma separated list of Allksy variables to export","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/export.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/exposure_rect.html","title":"Exposure Rect","text":"","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/exposure_rect.html#description","title":"Description","text":"<p>This module draws the exposure rectangle definied in the main settings on the image</p> <p>This only works with ZWO Cameras</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/exposure_rect.html#settings","title":"Settings","text":"<p>None</p> <p> </p> <p>Example ZWO Exposure Rectangle</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/exposure_rect.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/histogram.html","title":"Histogram","text":"","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/histogram.html#description","title":"Description","text":"<p>This module draws a histogram on the image</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/histogram.html#settings","title":"Settings","text":"Setting Description x The left position of the histogram box y The top position of the histogram box width The width of the  histogram box height The height of the histogram box <p>Example Histogram </p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/histogram.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/intermediate_image.html","title":"Intermediate Image","text":"","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/intermediate_image.html#description","title":"Description","text":"<p>This module allows you to save a copy of the image to a specific location</p> <p>Warning</p> <p>Currently Allsky does not use these images, they are intended for your scripts. You are responsible for ensuring they are removed when not needed</p> <p>The position of this module in the pipeline will determined whats saved. So for example if its the very first module then the image will be as captured, if you place it after the mask module it will contain the masked image. This can be useful for saving images before the overlay has been appended to them.</p>","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/intermediate_image.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Image Folder The location to save the images, see notes below on using variables in the path","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/intermediate_image.html#using-allsky-variables","title":"Using Allsky variables","text":"<p>You can use any Allsky variables when constructing the path, for example</p> <pre><code>${ALLSKY_IMAGES}/${DATE}-clean\n</code></pre> <p>This will save the images in a folder within the main images directory <code>${ALLSKY_IMAGES}</code> by date <code>${DATE}</code> with <code>-clean</code> appended</p>","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/intermediate_image.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/core/load_image.html","title":"Load Image","text":"","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/load_image.html#description","title":"Description","text":"<p>This module is responsible for loading the last captured image for the daytime and nighttime pipelines.</p> <p>This module is automatically added to the daytime and nighttime flows and cannot be removed of moved.</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/load_image.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/mask_image.html","title":"Mask Image","text":"","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/mask_image.html#description","title":"Description","text":"<p>This module applied a mask to an image. This is mainly uised to ensure the areas outside of the image circle are black, serving two purposes</p> <ul> <li>Aesthetically it looks better</li> <li>It allows for a more consistent background for overlaid data</li> </ul> <p>For details on howto create masks please refer to the Creating Masks documentation</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/mask_image.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Mask Path Select the mask to use. Unmasked Image Masked Image <p>Example masking an image</p> <p>In the above example the image on the left has no mask applied resulting in the areas outside of th eimage circle looking messy. The right hand image has a mask applied giving a much cleaner image</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/mask_image.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/meteor_count.html","title":"Meteor Count","text":"","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/meteor_count.html#description","title":"Description","text":"<p>This module counts meteors in an image. It utilises a couple of algorithms to acheive this.</p> <p>Create a mask</p> <p>It is essential that you create a mask before attempting to use this module. Failure to mask the image properly will result in a considerable number of false positives</p> <p>For details on howto create masks please refer to the Creating Masks documentation</p> <p>The Moon</p> <p>The Moon can play havoc with star detection due to reflections in the dome. During intense moonlit nights the star count will be inaccurate</p> <p>Tip</p> <p>When creating a mask ensure that it removes ALL areas of the image that could trigger false positives. Ideally the masked area should be smaller then the image circle, probably quite a bit smaller to prevent false positives around the horizon.</p>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/meteor_count.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Use clearsky If the clearsky module is enabled then this will be used to determine if the star count module should even run Mask Path The mask to apply to the image Min Length The minimum length of a streak","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/meteor_count.html#the-debug-options","title":"The Debug Options","text":"<p>The debug options allow you to fine tune the settings and annotate the main image so see what the algorithms are detecting.</p> Setting Description Enable Debug Mode Enables debug mode Annotate Main If enabled any detected stars will be circled on the captured image <p>Tip</p> <p>When using debug images set the 'Debug Image Name' to a file inside the Allsky web root. This will allow you to browse to the image</p>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/meteor_count.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/overlay.html","title":"Overlay","text":"","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/overlay.html#description","title":"Description","text":"<p>This module is responsible for drawing the overlay on the captured image.</p> <p>Module Placement</p> <p>Ideally this module should be placed last in the pipeline, this is to ensure that all data generated by other modules in the pipeline is available.</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/overlay.html#settings","title":"Settings","text":"<p>None</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/overlay.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/pi_status.html","title":"Pi Status","text":"","tags":["Core Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/core/pi_status.html#description","title":"Description","text":"<p>This module reads data from the Pi's hardware. Teh following is read</p> <ul> <li>CPU Temperature</li> <li>PI Model</li> <li>Error Status</li> <li>Disk Info. Size, usage, free</li> <li>Memory Info. Size, usage, free</li> <li>Uptime</li> </ul>","tags":["Core Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/core/pi_status.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Read Every The number of seconds between reading the data","tags":["Core Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/core/pi_status.html#available-variables","title":"Available Variables","text":"Variable Description AS_CPUTEMP The CPU temperature of the pi in centigrade AS_CPUTEMP_C The CPU temperature of the pi in centigrade, maintained for legacy overlays AS_CPUTEMP_F The CPU temperature of the pi in Fahrenheit, maintained for legacy overlays AS_PIMODEL The module of pi, 4B, 5B etc AS_TSTATSUMARYTEXT The Throttled status in text format, see below for details AS_DISKSIZE The size of the disk AS_DISKUSAGE The amunt of disk space used AS_DISKFREE The amount of disk space free AS_DISKUSEDPERCENT The precentage of disk used AS_DISKFREEPERCENT The percentage of disk free AS_MEMORYTOTAL Total memory AS_MEMORYUSED Total memory used AS_MEMORYAVAILABLE Total memory available AS_MEMORYUSEDPERCENTAGE Percentage of memory used AS_MEMORYFREEPERCENTAGE Percentage of memory free AS_UPTIME the uptim eof th pi","tags":["Core Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/core/pi_status.html#throttled-status","title":"Throttled Status","text":"<p>When a Raspberry Pi detects unsafe operating conditions, it protects itself by reducing performance. This is known as throttling and can involve:</p> <ul> <li>Reducing CPU frequency</li> <li>Reducing GPU frequency</li> <li>Limiting power to peripherals</li> <li>In extreme cases, shutting down components</li> </ul> <p>Throttling is not a software bug \u2014 it is a hardware protection mechanism.</p> <p>The following throttle conditions can occur</p> Meaning What it indicates Under-voltage detected (current) The Pi is not getting enough power right now ARM frequency capped (current) CPU speed is being limited due to power issues CPU throttled (current) Performance reduced due to high temperature or power instability Soft temperature limit active (current) Temperature is approaching the safe limit and performance is reduced Under-voltage occurred since boot Power has been unstable at least once since startup ARM frequency capping occurred since boot CPU performance was limited at least once since startup CPU throttling occurred since boot The system overheated or power dipped at least once Soft temperature limit occurred since boot The Pi reached high temperatures at least once","tags":["Core Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/core/pi_status.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/core/save_image.html","title":"Save Image","text":"","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/save_image.html#description","title":"Description","text":"<p>This module is responsible for saving the last captured image for the daytime and nighttime pipelines once all other modules have run.</p> <p>This module is automatically added to the daytime and nighttime flows and cannot be removed of moved.</p>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/save_image.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night","Pipeline Day"]},{"location":"allsky_modules/core/star_count.html","title":"Star Count","text":"","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/star_count.html#description","title":"Description","text":"<p>This module counts stars in an image. It utilises a couple of algorithms to acheive this.</p> <p>Create a mask</p> <p>It is essential that you create a mask before attempting to use this module. Failure to mask the image properly will result in a considerable number of false positives</p> <p>For details on howto create masks please refer to the Creating Masks documentation</p> <p>The Moon</p> <p>The Moon can play havoc with star detection due to reflections in the dome. During intense moonlit nights the star count will be inaccurate</p> <p>Tip</p> <p>When creating a mask ensure that it removes ALL areas of the image that could trigger false positives. Ideally the masked area should be smaller then the image circle, probably quite a bit smaller to prevent false positives around the horizon.</p>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/star_count.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Use clearsky If the clearsky module is enabled then this will be used to determine if the star count module should even run Mask Path The mask to apply to the image Detection Method Either fast or slow. The Fast detection is a lot faster but less accurate Scale Factor Amount to scale the image by before detecting stars. Reducing the image size will speed up both detection methods Min Star Size The minimum size of a star in the image","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/star_count.html#the-debug-options","title":"The Debug Options","text":"<p>The debug options allow you to fine tune the settings and annotate the main image so see what the algorithms are detecting.</p> Setting Description Enable Debug Mode Enables debug mode Annotate Main If enabled any detected stars will be circled on the captured image Colour The colour for the circle when annotating the main image Debug Image The path to a file used to test the algorithms. This path must be on the local pi Debug Image Name When using a debug image the resulting detected image will be saved as this name <p>Tip</p> <p>When using debug images set the 'Debug Image Name' to a file inside the Allsky web root. This will allow you to browse to the image</p>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/core/star_count.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Core Module","Pipeline Night"]},{"location":"allsky_modules/extra/adsb.html","title":"ADSB","text":"<p>This module allows you to display information on Aircraft in your vicinity on overlays. It utilises a system called ADS-B or, Automatic Dependent Surveillance\u2013Broadcast. There are two methods for obtaining the ADS-B data.</p> <ul> <li>Installing an ADS-B reception station at home</li> <li>Using an online API</li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#ads-b-overview","title":"ADS-B Overview","text":"<p>ADS-B is a modern surveillance technology used in aviation to determine and share the position of aircraft in real time. The system is called automatic because it transmits information continuously without pilot input, dependent because it relies on the aircraft\u2019s onboard navigation system, and broadcast because the data is openly transmitted as a one-way signal that anyone with the right equipment can receive. At the heart of ADS-B is the aircraft\u2019s ability to calculate its own position. Using GNSS satellite navigation\u2014such as GPS, Galileo, or GLONASS\u2014the aircraft\u2019s avionics system determines its latitude, longitude, altitude, heading, ground speed, and vertical rate. This information is updated multiple times per second and is considered far more accurate than traditional radar measurements.</p> <p>Once the aircraft has determined its position, it broadcasts this information over one of two frequencies. The most common is 1090 MHz, known as 1090ES (Extended Squitter), which is used globally and required for high-altitude and international operations. In the United States, a secondary system called 978 MHz UAT is available for general aviation flying below 18,000 feet. These ADS-B broadcasts are not encrypted or directional\u2014they are simply radio messages radiating outward from the aircraft. Any receiver within line-of-sight can detect them, which includes other aircraft, ground stations, satellites, and even hobbyists at home.</p> <p>Other aircraft equipped with ADS-B IN can directly receive these broadcasts. This enables pilots to see nearby traffic on cockpit displays with unprecedented accuracy, enhancing situational awareness and reducing the risk of mid-air collisions. This air-to-air capability is one of the most transformative aspects of ADS-B because it provides real-time traffic information independent of air traffic control or radar coverage. Many modern avionics systems integrate ADS-B IN with synthetic vision, terrain maps, and weather overlays to give pilots a much clearer picture of the environment around them.</p> <p>On the ground, air traffic control stations operate specialized antennas that receive ADS-B broadcasts from aircraft within range. Unlike primary radar\u2014which relies on bouncing radio waves off aircraft\u2014ADS-B gives ATC precise, continuous position reports without the need for expensive radar equipment. This allows controllers to track aircraft more accurately, optimize airspace, and support more efficient routing. In areas with limited radar coverage, ADS-B dramatically improves visibility and safety.</p> <p>In addition to ground receivers, ADS-B signals can be detected by satellites in low Earth orbit. These satellites carry sensitive radio receivers capable of listening to the 1090 MHz broadcast from space. Companies like Aireon operate constellations that provide global ADS-B coverage, including remote oceans and polar regions where radar and ground receivers cannot reach. This satellite-based ADS-B has revolutionized long-haul flight tracking and greatly improved emergency response and search-and-rescue operations.</p> <p>A unique and democratic aspect of ADS-B is that the broadcast can also be received by anyone at home. A simple setup\u2014a USB software-defined radio (RTL-SDR), a small 1090 MHz antenna, and decoding software such as dump1090 or readsb\u2014allows enthusiasts to see the same real-time aircraft positions that ATC receives. Many popular flight-tracking websites, such as Flightradar24, ADSBexchange, RadarBox, and OpenSky Network, rely on thousands of these volunteer home receivers feeding data into their networks. Crowdsourcing ADS-B in this way creates rich, high-resolution global flight maps that would be impossible using only official infrastructure.</p> <p>In summary, ADS-B is a highly accurate, globally scalable surveillance system where aircraft continuously broadcast their own positions. These broadcasts are received by other aircraft for traffic awareness, by ground stations for air traffic control, by satellites for global coverage, and by home hobbyists who contribute to online flight-tracking networks. This open, cooperative design has transformed modern aviation by making the skies more transparent, safer, and more efficiently managed.</p> <p></p> <p>ADS-B Overview</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#local-installation","title":"Local Installation","text":"<p>Hardware</p> <p>To setup a local installation requires additional hardware. At a bare minimum you will need </p> <ul> <li>Host computer, something like a pi3 or 4</li> <li>A SDR dongle, some dongles are specific to ads-b</li> <li>A 1090MHz antenna</li> </ul> <p>Details on how-to set this up are beyond the scope of this document but there are a lot of resources available online to help, some examples</p> <ul> <li>FlightRadar24 Contributing to Flightradar24 will give you a 'Contributor Plan' with access to a lot of the paid features.</li> <li>ADS-B Exchange Contributing to ADS-B Exchange will remove all ads</li> <li>Plane Finder Contributing to Plane Finder will give you access to premium apps</li> <li>360 Radar NOTE: UK Only Great for Military aircraft and they are working on a mode a system</li> <li>Open Sky</li> <li>Airplanes Live</li> <li>adsb.fi</li> <li>And many more ...</li> </ul> <p>Contributing Data</p> <p>If you are running a local ADS-B installation then most online services will provide you with some benefits if you contribute data. Contributing is easy and documented on the relevants services websites. We encourage people to contribute data if possible, it should be noted that you can contribute to multiple services at the same time.</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#local-settings","title":"Local Settings","text":"<p>To use a local installation select 'Local' from the data source dropdown</p> Setting Description Local Address The local address of your data <p>To obtain this address find the ip address of your ads-b installation and use it in the following URL</p> <p>http://&lt;ADSB INSTALLATION IP&gt;:8080/data/aircraft.json</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#online-apis","title":"Online API's","text":"<p>The module supports three online API's for accessing ADS-B data</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#opensky","title":"OpenSky","text":"<p>The OpenSky Network is a non-profit association based in Switzerland. It aims at improving the security, reliability and efficiency of the air space usage by providing open access of real-world air traffic control data to the public. The OpenSky Network consists of a multitude of sensors connected to the Internet by volunteers, industrial supporters, and academic/governmental organizations. All collected raw data is archived in a large historical database. The database is primarily used by researchers from different areas to analyze and improve air traffic control technologies and processes.</p> <p>Before using OpenSky you will need either a paid subscription or to be contributing data, see the Open Sky Website for details.</p> <p>Settings</p> Setting Description Client Id The client ID from your account Secret The secret from your account Min Latitude The minimum latitude for the bounding box Min Longitude The minimum longitude for the bounding box Max Latitude The maximum latitude for the bounding box Max Longitude The maximum longitude for the bounding box <p>Bounding Box</p> <p>OpenSky requires that you provide a bounding box. Only aircraft within this box will be returned, the size of the box will also determine how many api credits are used for each request. To create the bounding box use a site like bbox finder</p> <p>Distance Limit</p> <p>OpenSky does not use the distance limit setting when requesting data. It will however use it once the data has been retreived. So for example if your distance limit is set to 50 miles but your bounding box is much bigger the API will return all aicraft withing the bounding box but the module will then filter this to only aircraft within 50 miles.</p> <p>API Limits</p> <p>API credits are  used for all endpoints except /states/own. Credit usage is lower in general for restricted/smaller areas (/states/all) and shorter time frames (/flights and /tracks). For /states/all the credit calculation is done by square degrees. The area can be restricted by using the lamin, lamax, lomin, lomax query parameters. The area square deg column in the table below indicates the square degree limit - e.g. a box extending over latitude 10 degrees and longitude 5 degrees, would equal 50 square degrees:</p> <p>Most unpaid accounts will start with 4000 credits</p> Area square deg Credits 0 - 25 (&lt;500x500km) 1 25 - 100 (&lt;1000x1000km) 2 100 - 400 (&lt;2000x2000km) 3 over 400 or all (&gt;2000x2000km) 4","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#airplaneslive","title":"AirplanesLive","text":"<p>Airplanes.Live is a website dedicated to aviation enthusiasts. It leverages enthusiast receivers to capture ADS-B (Automatic Dependent Surveillance-Broadcast) and MLAT (Multilateration) data, providing real-time information about aircraft in your area. Your unfiltered data allows enthusiasts, researchers, and journalists access to an incredible amount of data related to flight monitoring. Airplanes.Live displays all ADS-B and all Mode S equipped, calculated by MLAT, aircraft on a full featured tracking map with history and replay functions.</p> <p>Settings</p> <p>There are no specific settings for the Airplanes live API</p> <p>API LImits</p> <p>The Airplanes.live REST API is rate limited to 1 request per second.</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#adsbfi","title":"adsb.fi","text":"<p>adsb.fi is a community-driven flight tracker, with over 4500 feeders around the world. We provide open and unfiltered access to worldwide air traffic data.</p> <p>Settings</p> <p>There are no specific settings for the adsb.fi API</p> <p>API Limits</p> <p>adsb.fi uses rate limiting to protect against abuse and misuse, and to help ensure everyone has fair access to the API. The public endpoints are rate limited to 1 request per second, and the feeder endpoint to 1 request every 30 seconds.</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#settings","title":"Settings","text":"<p>Aside from the data source the following settings are available on the settings tab</p> Setting Description Aircraft Type Source The data source for determining the aircraft type, see notes below Get Flight Route If enabled will use an external API to try and get the flight route for the aircraft Limit Distance For all datasources except Open Sky, limits the distance for aircraft Altitude The altitude of your station in metres Read Every Only access the API's every this number of seconds, this helps to reduce hitting rate limits on API's","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#aircraft-type-data-source","title":"Aircraft Type Data Source","text":"<p>ADS-B does not provide an aircraft type in its data but it does provide a unique hex code for the aircraft. Contributors on the internet have built an database that maps these hex code to aicraft types. The module provides two different ways to get more detailed information about an aircraft</p> <ul> <li>Local. This uses a local database but be aware that this may not be uptodate and will contain incorrect data. Its fine for most purposes</li> <li>hexdb. This is an online service that contains much more uptodate information</li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#flight-routes","title":"Flight Routes","text":"<p>Flight routes are obtained from an online service. This service imposes rate limits which unless you live in a very busy area you are unlikely to hit</p> <p>The Rate limits are calculated over a rolling 60 second time period.</p> Rate Block time (Seconds) 512 + 60 1024 + 300","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#overlay-data","title":"Overlay Data","text":"<p>For each aircraft the following data is available for use in overlays, (X) in the table below relates to the aircraft number. The aircraft are sorted with the first being the closest to your location</p> Variable Description AS_DISTANCE_AIRCRAFT(X) The distance of the aircraft from your station in miles AS_HEX_AIRCRAFT(X) The hex code of the aircraft AS_AZIMUTH_AIRCRAFT(X) The azimuth of the aircraft from your location AS_ELEVATION_AIRCRAFT(X) The elevation of the aircraft from your location AS_ALTITUDE_AIRCRAFT(X) The raw altitude of the aircraft AS_TYPE_AIRCRAFT(X) The aircraft type AS_OWNER_AIRCRAFT(X) The owner of the aircraft AS_REGISTRATION_AIRCRAFT(X) The registration of the aircraft AS_MANUFACTURER_AIRCRAFT(X) The aircraft manufacturer AS_MILITARY_AIRCRAFT(X) Flag to indicate if the aircraft is military AS_TEXT_AIRCRAFT(X) The flight number and azimuth of the aircraft AS_LONGTEXT_AIRCRAFT(X) The flight number, type, azimuth, distance, altitude and speed AS_SHORT_ROUTE_AIRCRAFT(X) Short route text of the aircraft ICAO -&gt; ICAO AS_MEDIUM_ROUTE_AIRCRAFT(X) Medium route text of the aircraft CITY -&gt; CITY AS_LONG_ROUTE_AIRCRAFT(X) Long route text of the aircraft (ICAO) AIRPORT -&gt; (ICAO) Airport <p></p> <p>Example ADS-B data on an overlay</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#blocks","title":"Blocks","text":"<p>Several blocks are provide to make adding data to the overlays easier. These can be access from the variable manager in the overlay editor</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#charts","title":"Charts","text":"<p>A chart and gauge showing the number of aircraft received are available. These can be found in the Chart Manager</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/adsb.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/air_quality.html","title":"Air Quality","text":"<p>Monitor air quality using a pms5003, pms7003 or pmsa003. All three of thsese sensors provide digital particulate matter measurements and are best suited for trend monitoring and relative air quality assessment rather than regulatory-grade measurements. Proper airflow design, dust protection, and periodic cleaning are important to maintain long-term accuracy regardless of the model used.</p> <p>PMS5003</p> <p>The PMS5003 is a widely used laser-based particulate matter (PM) sensor manufactured by Plantower. It measures airborne particles by drawing air through an internal chamber and using laser scattering to detect particle concentrations. The sensor reports mass concentrations for PM1.0, PM2.5, and PM10, as well as particle counts across multiple size bins. Data is provided digitally over a UART interface, making the PMS5003 easy to integrate with microcontrollers such as the ESP32, Raspberry Pi, and Arduino. Due to its reliability, availability, and extensive community support, the PMS5003 is commonly used in indoor air quality monitors, weather stations, and DIY environmental sensing projects.</p> <p>PMS7003</p> <p>The PMS7003 is functionally very similar to the PMS5003, offering laser-based detection of PM1.0, PM2.5, and PM10 concentrations along with particle number counts. The primary difference lies in its form factor and airflow design; the PMS7003 is thinner and slightly larger in footprint, which can make it easier to integrate into slim enclosures or wall-mounted devices. Like the PMS5003, it communicates via UART and provides real-time particulate measurements suitable for indoor and outdoor applications. Performance and accuracy are comparable between the two models, so the PMS7003 is often selected based on mechanical design requirements rather than sensing capability.</p> <p>PMSA003</p> <p>The PMSA003 is a compact, low-profile particulate matter sensor designed for space-constrained applications. It uses the same laser scattering measurement principle as other Plantower sensors but is optimised for reduced size and power consumption. The PMSA003 reports PM1.0, PM2.5, and PM10 mass concentrations and is typically used in consumer devices, portable monitors, and embedded systems where enclosure depth is limited. Despite its smaller form factor, it maintains good measurement consistency for general air quality monitoring, though it may be slightly more sensitive to airflow and placement compared to larger models like the PMS5003 or PMS7003.</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/air_quality.html#settings","title":"Settings","text":"Setting Description Serial Port The serial port the device is connected to. Only available serial ports will be listed <p>Serial Ports</p> <p>If no serial ports are displayed in the drop down then the sensor has not been detected. Please check the sensors connections</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/air_quality.html#available-variables","title":"Available Variables","text":"Variable Description AS_PM1_0CF1 PM1.0 concentration in \u00ce\u00bcg/m3 (corrected to standard conditions) PM2_5CF1 PM2.5 concentration in \u00ce\u00bcg/m3 (corrected to standard conditions) PM10CF1 PM10 concentration in \u00ce\u00bcg/m3 (corrected to standard conditions) PM1_0 PM1.0 concentration in \u00ce\u00bcg/m3 (under atmospheric conditions) PM2_5 PM2.5 concentration in \u00ce\u00bcg/m3 (under atmospheric conditions) PM10 PM10 concentration in \u00ce\u00bcg/m3 (under atmospheric conditions) N0_3 number of particles with diameter greater than 0.3 \u00ce\u00bcm (in 100 ml of air) N0_5 number of particles with diameter greater than 0.5 \u00ce\u00bcm (in 100 ml of air) N1_0 number of particles with diameter greater than 1.0 \u00ce\u00bcm (in 100 ml of air) N2_5 number of particles with diameter greater than 2.5 \u00ce\u00bcm (in 100 ml of air) N5_0 number of particles with diameter greater than 5.0 \u00ce\u00bcm (in 100 ml of air) N10 number of particles with diameter greater than 10 \u00ce\u00bcm (in 100 ml of air) AS_AQI Air quality AS_AQI_TEXT Human readable air quality","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/air_quality.html#air-quality","title":"Air quality","text":"<p>To determine the air quality first the maximum of AS_PM2_5 and AS_PM10 is taken, then the following table is used</p> Range Air Quality 0 - 49 Good 50 - 99 Moderate 100 - 149 Unhealthy for Sensitive Groups 150 - 199 Unhealthy 200 - 299 Very Unhealthy 300+ Hazardous","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/air_quality.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/border.html","title":"Border","text":"<p>This module allows you to draw a border around the captured image, this can be useful for creating a blank area to draw overlay data on. The borders are drawn on the top, left, bottom and right had side of the image. Each border can be a different size</p>","tags":["Extra Module","Image Adjustments","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/extra/border.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Left Size The size of the left border in pixels Right Size The size of the right border in pixels Top Size The size of the top border in pixels Bottom Size The size of the bottom border in pixels Border Colour The colour of the border","tags":["Extra Module","Image Adjustments","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/extra/border.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Image Adjustments","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/extra/dew_heater.html","title":"Dew Heater","text":"<p>Important</p> <p>This module requires external hardware and some basic knowledge of electronics</p> <p>This module allows you to control a GPIO pin that can in turn be used to drive a dew heater. The GPIO pin cannot directly drive the heater, instead it must be used to drive a mosfet that in turn controls the heater. </p> <p>Whilst the electronics to do this are beyond the scope of this documentation some examples are provided as is.</p> <p>The Environment module is also required to provide the temperature and humidity for this module. The environment module should be placed before this module in the pipeline.</p> <p>There are two modes of operation for the dew heater</p> <ul> <li>Digital - The heater is either on or off</li> <li>Pulse Width Modulation (PWM) - The heater voltage is 'controlled' by the mosfet between 0 and 100%. This allows for finer control of the heater</li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#sensor-tab","title":"Sensor Tab","text":"<p>The settings on this tab control how the module gets its temeprature and humidity data</p> Setting Description Sensor Type The type of sensor to use. See notes below Temperature Variable The variable to use for temperature. Do not change this unless you know what yo are doing Humidity Variable The variable to use for humidity. Do not change this unless you know what you are doing <p>Sensor Type</p> <p>There are several options available but the preferred method is to use the 'Allsky' option. This will read the values generated by the Environment Module. The hardware sensor options provided in this setting are deprecated and will be removed in a future release.</p> <p>The options for sensors other than Allsky are not covered here. Please refer to the Environment module for details on howto use a hardware sensor</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#heater-tab","title":"Heater Tab","text":"<p>The settings on this tab determine how the heater is controlled</p> Setting Description Heater Pin The GPIO pin the heater control is connected to Use PWM If enabled PWM will be used to control the dew heater Min PWM Temp The minimum temperature for PWM, this equates to a 0% duty cycle Max PWM Temp The maximum temperature for PWM, this equates to a 100% duty cycle Extra Pin A second pin that is controlled in the same way as the Heater Pin Use PWM Use PWM for the Extra pin, MIn and Max are the same as the main PWM controls Startup State The intial state of the heater when starting up Invert Relay If using a relay (NOT RECOMMENDED) invert the on state Invert Extra If using a relay (NOT RECOMMENDED) invert the on state","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#dew-control-tab","title":"Dew Control Tab","text":"<p>The settings on this tab determine when the heater is enabled or disabled</p> Setting Description Delay The number of seconds between reading the sensors, 0 switches this off and the sensor is read every time the module runs Limit If the temperature is within this many degrees of the dew point, the heater will be enabled or disabled. This is probably the most important setting as it determines if the heater is on or off Forced Always enable the heater when the ambient termperature is below this value; 0 disables this. This is useful as a quick override if you are going to have prolonged dew Max Time The maximum time in seconds for the heater to be on. 0 disables this. Daytime Disable Disable the dew heater during the daytime","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#debug-tab","title":"Debug Tab","text":"<p>The settings on this tab are used to help test the module</p> Setting Description Debug Mode Enables debug mode. In this mode the sensor is NOT read the values in this tab are used Temperature The temperature to use for testing Dewpoint The depoint to use for testing <p>You can use these values to force the temperature and dewpoint values used by the module. This is useful for testing that the other settings are producing the results you expect.</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#schematics","title":"Schematics","text":"<p>Example Mosfet driven dew heater</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#tips","title":"Tips","text":"<p>Setting up the dew heater can be a little tricky so this section provides some tips on gettin git all running.</p> <p>Its best to start without PWM enabled just to confirm that your hardware is all working so to do this;</p> <ul> <li>Ensure that ALL PWN options are off</li> <li>Set the correct GPIO pin for your heater</li> <li>Set the limit to 5</li> </ul> <p>These setting will enable the dew heater when the temperature is within 5 degrees or less of the dew point</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#faq","title":"FAQ","text":"<ul> <li>My heater stays on all of the time</li> <li>Set the Allsky debug level to 4 and use the 'Test Module' button in the dew heater settings. This will display some debug messages explaining why the heater is in the state it is</li> <li>Check the limit value is not too large. Since the heater is enabled when the dewpoint is within this many degrees of the temeprature large values will cause the heater to stay on</li> <li>Check the 'Forced Temperature' value is not set. Setting this to a low value will also cause the heater to remain on</li> <li> <p>Check your hardware. If you are using a relay, not recommended, then some require an inverted output. The 'Invert relay' option will enable or disable this.</p> </li> <li> <p>My heater never switches on</p> </li> <li>Set the Allsky debug level to 4 and use the 'Test Module' button in the dew heater settings. This will display some debug messages explaining why the heater is in the state it is</li> <li> <p>Check your hardware. If you are using a relay, not recommended, then some require an inverted output. The 'Invert relay' option will enable or disable this.</p> </li> <li> <p>My heater switches on but doesnt clear the dew</p> </li> <li>Confirm that the heater has sufficient power</li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#important-notes","title":"Important Notes","text":"","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#relays","title":"Relays","text":"<p>You will see other examples of people using relays to drive the heater but this is not recommended for the following reasons</p> <ul> <li> <p>GPIO pins cannot supply enough current</p> <ul> <li>Raspberry Pi GPIO can output max ~16 mA, with a TOTAL budget of 50 mA across all pins.</li> <li>Most mechanical relay coils need 70\u2013100 mA (sometimes more).</li> </ul> </li> <li> <p>Relay coils generate voltage spikes (back EMF)</p> <ul> <li>A relay coil is an inductor. When switched off, it releases a high-voltage spike (often 100\u2013200 V).</li> </ul> </li> <li> <p>Without protection:</p> <ul> <li>GPIO pin gets hit with high voltage</li> <li>Pi can lock up, reset, or permanently die</li> </ul> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#blocks","title":"Blocks","text":"<p>Several blocks are provide to make adding data to the overlays easier. These can be access from the variable manager in the overlay editor</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#charts","title":"Charts","text":"<p>A variety of charts are available, see the chart manager for details</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/dew_heater.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/discord.html","title":"Discord","text":"<p>This module allows you to send data to Discord server. You can send the following</p> <ul> <li>Daytime image</li> <li>Nighttime Image</li> <li>Startrails Image</li> <li>Keogram Image</li> <li>Timelapse Video</li> </ul> <p>File Sizes</p> <p>Discord implements a Rate limits  on the API but it is very unlikely that you will hit any of the limits. Discord also implements a limit of 8 MB for any posted item. The timelapse videos may exceed this rate so if you wish to send them to Discord you will have to configure Allsky to limit video to less than 8 MB. The module checks before sending a file and if it exceeds the Discord limit the file is not sent and an error is logged in the allsky log file.</p> <p></p> <p>Example images posted to a Discord server</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#daytime-tab","title":"Daytime Tab","text":"Setting Description Post Images When enabled daytime images will be posted Send Annotated If enabled sends the overlayed image, not this module must run after the overlay module otherwise sends the raw image Daytime Count Sends an image very X captured images, helps prevent flooding the Discord server Bottom Size The size of the bottom border in pixels Webhook URL The webhook for daytime images, see notes below on Webhooks","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#daytime-tab_1","title":"Daytime Tab","text":"Setting Description Post Images When enabled nighttime images will be posted Send Annotated If enabled sends the overlayed image, not this module must run after the overlay module otherwise sends the raw image Nighttime Count Sends an image very X captured images, helps prevent flooding the Discord server Bottom Size The size of the bottom border in pixels Webhook URL The webhook for daytime images, see notes below on Webhooks","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#startrails-tab","title":"Startrails Tab","text":"<p>Use correct Pipeline</p> <p>To send Startrails you must add the module to the night to day transition pipline.</p> Setting Description Post Statrails When enabled startrail images will be posted Webhook URL The webhook for startrails images, see notes below on Webhooks","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#keograms-tab","title":"Keograms Tab","text":"<p>Use correct Pipeline</p> <p>To send Keograms you must add the module to the night to day transition pipline.</p> Setting Description Post Keograms When enabled Keograms images will be posted Webhook URL The webhook for keogram images, see notes below on Webhooks","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#timelapse-tab","title":"Timelapse Tab","text":"<p>Use correct Pipeline</p> <p>To send Timelapse videos you must add the module to the night to day transition pipline.</p> Setting Description Post Timelaps When enabled Timelapse videos will be posted Webhook URL The webhook for timelapse videos, see notes below on Webhooks","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#webhooks","title":"Webhooks","text":"<p>This moduel requires that you create webhooks in the Discord server. Detailed instructions can be found in the Discord Support  pages</p> <p></p> <p>The Discord Server settings for creating webhooks</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/discord.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Night To Day</p> <ul> <li>The Night to Daytime pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/environment.html","title":"Environment","text":"<p>This module reads a variety of external sensors to provide temperature, humidity and dewpoint information for the overlays and other modules.</p> <p>The module can read upto 4 sensors</p> <ul> <li>Core - This is used to provide data to overlays and other Allsky modules</li> <li>Sensor 1 - 3 - These can be used for any purpose, for example you may have a temperature sensor insode the dome and one external. These sensors can alos be used to drive a GPIO pin</li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/environment.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/environment.html#home-tab","title":"Home Tab","text":"<p>The settings on this tab control how the module gets its temeprature and humidity data</p> Setting Description Delay The number of seconds between reading the sensors, 0 switches this off and the sensor is read every time the module runs Units The unit of measure used","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/environment.html#core-tab","title":"Core Tab","text":"<p>This sensor is used for providing environment data to other Allsky modules, it can also be used on overlays</p> <p>See the Sensor Fields Section for details of each sensor that can be used</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/environment.html#sensor-fields","title":"Sensor Fields","text":"<ul> <li> <p> I<sup>2</sup>C Sensors</p> <p>These are sensors that connect to the I<sup>2</sup>C bus on the Pi. There are numerous sensors available. If you find a sensor that is not supported then please raise a discussion thread in the Allsky Github repository and we will look at implement it.</p> <p>Enable The I<sup>2</sup>C Interface</p> <p>Before using any I<sup>2</sup>C devices you must enable the I<sup>2</sup>C interface using the raspi-config utility. To enable the interface run raspi-config and navigate to Interface Options-&gt;I\u00b2C and enable the interface. You may need to reboot the pi before the interface works</p> Select --&gt;SHT31SHT4xBME280-I<sup>2</sup>CBME680HTU21AHTx0SCD30 <p>Select the required I<sup>2</sup>C sensor to view its details</p> <p>Sensirion Temperature/Humidity sensors are some of the finest &amp; highest-accuracy devices you can get. And, finally we have some that have a true I<sup>2</sup>C interface for easy reading. The SHT31-D sensor has an excellent \u00b12% relative humidity and \u00b10.3\u00b0C accuracy for most uses. Adafruit documentation</p> <p>The following settings are available for this sensor</p> <p>I<sup>2</sup>C details</p> <p>The default address for the SHT31 is 0x44 but by connecting the addr pin to +ve this can be changed to 0x45</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays I<sup>2</sup>C address The I<sup>2</sup>C address of the sensor Enable Heater Enables the inbuilt heater in the sht31 <p>Schematic</p> <p></p> <p>Tip</p> <p>If you are going to connect multiple I<sup>2</sup>C devices to the pi then it is strongly suggested you use something like the Gravity I<sup>2</sup>C hub to make connections easier</p> <p>Sensirion Temperature/Humidity sensors are some of the finest &amp; highest-accuracy devices you can get. The SHT41 sensor is the fourth generation of I<sup>2</sup>C temperature and humidity sensor from Sen sirion. (They started at the SHT10 and worked its way up to the top!). The SHT41 has an excellent \u00b11.8% typical relative humidity accuracy from 25 to 75% and \u00b10.2 \u00b0C typical accuracy from 0 to 75 \u00b0C. Adafruit documentation</p> <p>The following settings are available for this sensor</p> <p>I<sup>2</sup>C details</p> <p>The default address for the SHT31 is 0x44 but in some rare cases, like the SHT4x-BD1B, 0x45 is used </p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays I<sup>2</sup>C address The I<sup>2</sup>C address of the sensor Heater Mode Selected the heater mode for the sensor <p>Schematic</p> <p></p> <p>Tip</p> <p>If you are going to connect multiple I<sup>2</sup>C devices to the pi then it is strongly suggested you use something like the Gravity I<sup>2</sup>C hub to make connections easier</p> <p>The BME280 is an environmental sensor module that measures temperature, humidity, and barometric pressure in a single, compact package. It is widely used in projects for weather forecasting, home automation, and IoT, and is compatible with many microcontrollers like Arduino, Raspberry Pi, and ESP32 through its I<sup>2</sup>C or SPI interfaces. Adafruit Documentation</p> <p>The BMP280</p> <p>Do not use a BMP280. The main difference between the BMP280 and BME280 is that the BMP280 measures temperature and pressure, while the BME280 measures temperature, pressure, and humidity. The BME280 is a more comprehensive environmental sensor, while the BMP280 is a simpler, lower-cost barometer and thermometer. </p> <p>I<sup>2</sup>C details</p> <p>The BME280 has two possible I<sup>2</sup>C addresses: (0x77) (default) or (0x76). The address is determined by the logic level on the SDO (or ADDR) pin. Connecting the SDO pin to ground (GND) sets the address to (0x76), while leaving it disconnected or connected to a high logic level (like VCC, depending on the specific board) leaves it at the default of (0x77)</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays I<sup>2</sup>C address The I<sup>2</sup>C address of the sensor <p>Schematic</p> <p></p> <p>The BME680 is a digital 4-in-1 environmental sensor that measures barometric pressure, ambient temperature, relative humidity, and air quality (gas). Adafruit Documentation</p> <p>I<sup>2</sup>C details</p> <p>The BME680 has two possible I<sup>2</sup>C addresses: (0x77) (default) or (0x76). The address is determined by the state of the SDO pin. Connecting SDO to GND sets the address to (0x76), while connecting it to VDD sets the address to the default of (0x77).\u00a0</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays I<sup>2</sup>C address The I<sup>2</sup>C address of the sensor <p>Schematic</p> <p></p> <p>The HTU21D is a digital, low-cost sensor that measures both humidity and temperature, providing calibrated and linearized signals via I<sup>2</sup>C. Adafruit Documentation</p> <p>I<sup>2</sup>C details The I<sup>2</sup>C address for the HTU21 is 0x40 and cannot be changed</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays I<sup>2</sup>C address The I<sup>2</sup>C address of the sensor <p>Schematic</p> <p></p> <p>The AHT10 and AHT20 are compact, high-precision digital temperature and humidity sensors that uses the I<sup>2</sup>C protocol. Adafruit Documentation</p> <p>I<sup>2</sup>C details</p> <p>The default I<sup>2</sup>C address for the AHTx0 sensor (including the AHT10 and AHT20) is 0x38. This address is fixed and cannot be changed directly on the sensor itself,</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays I<sup>2</sup>C address The I<sup>2</sup>C address of the sensor <p>Schematic</p> <p></p> <p>The SCD30 is a sensor module from Sensirion that measures carbon dioxide (CO<sub>2</sub>), temperature, and humidity using Non-Dispersive Infrared (NDIR) technology. It is designed for applications like HVAC systems, air purifiers, and indoor air quality monitoring, providing accurate and stable measurements with an integrated temperature and humidity sensor that compensates for external heat sources.\u00a0Adafruit Documentation</p> <p>I<sup>2</sup>C details</p> <p>The default I<sup>2</sup>C address for the SCD30 sensor is 0x61. This address is set after the sensor powers up and is used for communication with the sensor using I<sup>2</sup>C</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays I<sup>2</sup>C address The I<sup>2</sup>C address of the sensor <p>Schematic</p> <p></p> </li> </ul> <p></p> <ul> <li> <p> API Based Sensors</p> Select --&gt;OpenWeatherEcowittEcowitt LocalHomeassistant <p>OpenWeather provides reliable, easy-to-use weather products, supporting millions of developers around the clock. Its solutions are designed to fit a wide range of applications, from simple projects to complex enterprise systems.</p> <p>Openweather module</p> <p>Do not use this function and the OpenWeather API module as well. If you are using this function then please remove the OpenWeather Module as both create the same overlay data</p> <p>API Keys</p> <p>This module requires an API key before you can request data from the OpenWeather map API. To obtain a key create and account on the https://openweathermap.org</p> <p>After you have created an accoutn and logged in navigate to the 'API Keys' page and generate an API key. This key is then used in the settings</p> <p>Location</p> <p>When the module calls the OPenWeather map API it uses the latitude and longitude specified in the main Allsky settings for your location.</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays API Key Your API key for Openweather Filename The name of the file to write the extra data to Read Every How freuently to read the data. See notes below on API limits Expiry Time How long to keep the data from the API <p>Rate Limits</p> <p>The API provides for 1,000 free calls per 24 hours. So do not request data more frequently than every 87 seconds or you will run out of credits</p> <p>Ecowitt is a brand that provides modular weather and environmental monitoring equipment, including automatic weather stations, sensors, and data integration platforms. Its products can measure various parameters like temperature, rain, wind, soil moisture, and air quality. The systems typically use a gateway to connect wirelessly to the internet, allowing data to be viewed via a mobile app or website, and can integrate with other platforms like. The available hardware can be found on the Ecowitt website</p> <p>Hardware Requirements</p> <p>To use this module you will need to have some Ecowitt hardware with data being shared. Visit the Ecowitt website to view the available hardware. The hardware is also available from other resellers such as Amazon</p> <p>Settings</p> Setting Description Application Key The application key from the Ecowitt dashboard API Key The API key from the Ecowitt dashboard MAC Address The MAC address of your hardware. This can be found on the Ecowitt dashboard <p>This is a special version of the Ecowitt integration that talks to your local Ecowitt hub to obtain the weather data.</p> <p>Experimental</p> <p>This sensor is still experimental and has only been tested with a very limited set of Ecowitt hardware and hibs</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays Local URL The local URL of your Ecowitt hub. This is JUST the IP address <p>This sensor allows you to read any sensor from a Home Assistant (HASS) installation to obtain the temeperature and humidity. </p> <p>Home Assistant Setup</p> <p>The setting up of home assistant is beyond the scope of this document. This documentation assumes you are familiar with Home Assistant</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays URL The URl of the Home Assistant installation including the port number Long Term Token The Long Term Token (LTT) you have created in your HASS profile under the security tab Temperature Unit The unit the temperature is returned in, there is no way to ge this from HASS so you must provide it Temperature Sensor The HASS sensor to read the temperature from, see note below Humidity Sensor The HASS sensor to read the humidity from, see note below Pressure Sensor The HASS sensor to read the pressure from, see note below <p>HASS Sensors</p> <p>The HASS sensor drop downs will be automatically populated from your HASS installation but ONLY if the URL and Long Term Token are correct. If you do not see any sensors then check these values</p> </li> </ul> <p></p> <ul> <li> <p> One Wire Sensors</p> <p>Enable The 1-Wire Interface</p> <p>Before using any 1-Wire devices you must enable the 1-Wire interface using the raspi-config utility. To enable the interface run raspi-config and navigate to Interface Options-&gt;1-Wire and enable the interface. You may need to reboot the pi before the interface works</p> Select --&gt;DHT22/DHT11/AM2302DS18B20 <p>The DHT22 is a low-cost, digital sensor that measures both temperature and relative humidity using a capacitive humidity sensor and a thermistor. It outputs calibrated digital signals on a single data pin, works with a voltage range of (3.3V) to (5V), and has a temperature range of (-40) to (80)\u00b0C.</p> <p>The AM2302 is the same as a DHT22</p> <p>The DHT11 is a low-cost, digital sensor that measures both temperature and relative humidity using a single-wire interface. It is used in projects requiring environmental monitoring, such as in greenhouses or home automation systems. The sensor uses a capacitive humidity sensor and a thermistor for measurement, and its small size and low power consumption make it suitable for a variety of applications. </p> <p>Adafruit provide Documentation and sample code for both sensors</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays Input Pin The GPIO pin the sensor is connected to. You can use any Digital GPIO pin Retry Count The number of times to retry reading the sensor if it fails to read Delay The delay in ms between each attempt to read the sensor <p>Timeouts</p> <p>The DHTxx series of sensors are notorious for failing to read, especially if you attempt to read from them too quickly. The rerty count and delay in the settings will allow you to 'tune' the sensor to get reliable readings    </p> <p>Schematic</p> <p></p> <p>The DS18B20 is a digital temperature sensor that communicates over a unique 1-Wire bus, requiring only a single data line for communication. It can measure temperatures from -55\u00b0C to +125\u00b0C (-67\u00b0F to +257\u00b0F) with a resolution of 9 to 12 bits and an accuracy of \u00b10.5\u00b0C within a specific range. It can operate using either a traditional 3-wire setup or in \"parasite mode,\" which allows it to draw power directly from the data line, eliminating the need for an external power supply. Adafruit Documentation</p> <p>Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays Address The 1-wire address of the sensor <p>Multiple sensors</p> <p>It is possible to connect myltiple sensors ot the pi but determining the 1-Wire address can be tricky. The best method is to connect each device in turn and observe the 1-Wire addresses that are available.</p> <p>Schematic</p> <p></p> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/environment.html#sensor-1-to-3","title":"Sensor 1 to 3","text":"<p>These tabs allow you to define upto three additional sensors that can be used to</p> <pre><code>- Display information on the overlay\n- Control a GPIO pin in the temperature is above a maximum\n</code></pre> <p>The sensors available are defined in the Sensor Fields section.</p> <p>Additional Settings</p> Setting Description Sensor Name The name of the sensor, this will be available for use in overlays Address The 1-wire address of the sensor Max Temp The temperature at which point the GPIO pin will be set high GPIO Pin The GPIO pin to use GPIO on The label to use on the overlay when the GPIO pin is High i.e. on GPIO off The label to use on the overlay when the GPIO pin is Low i.e. off","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/environment.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required","API Required"]},{"location":"allsky_modules/extra/esp32round.html","title":"Round Displays","text":"<p>This module resizes and image for display on round screens, specifically the Waveshare Displays. These displays required additional software that can be found on Github</p> <p>Thanks to Kumar Challa for all of the hard work on the ESP32 software to drive the screen</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Hardware Required"]},{"location":"allsky_modules/extra/esp32round.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description Image Area The area of the image to use, this needs to be a square Size The size the cropped image will be resized to","tags":["Extra Module","Pipeline Day","Pipeline Night","Hardware Required"]},{"location":"allsky_modules/extra/esp32round.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Hardware Required"]},{"location":"allsky_modules/extra/fans.html","title":"Fans","text":"<p>This module allows you to control fans based upon either the internal CPU temperature of the pi or from an external sensor configure in the environment module.</p> <p>This can be useful for controlling a cpu cooler or venting air from the Allsky enclosure.</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/fans.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/fans.html#fans-1-and-2-tabs","title":"Fans 1 and 2 tabs","text":"Setting Description Sensor Type Selects either 'internal', the CPU temp or 'Allsky' allowing another variable to be selected Variable Only available when 'Allsky' selected as the sensor type. Allows the variable containing the required temperature to be selected Temp Limit Above this temperature the fan will be activated Read Every How frequently to read the temperature, helps prevent fans starting and stopping too frequently Output Pin The GPIO pin the fan is connected to Invert Output Inverts the GPIO output i.e. low is considers 'on' Use PWM Use PWM to control the fan PWM Min Only available when 'Use PWM' selected. Sets the min temp for pwm i.e. duty cycle is 0% PWM Max Only available when 'Use PWM' selected. Sets the max temp for pwm i.e. duty cycle is 100%","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/fans.html#data-control-tab","title":"Data Control Tab","text":"<p>Deprecation Warning</p> <p>Please do not use the values on this tab. They will be removed shortly</p> Setting Description Custom Expiry Enable cutom expiry Data Age How long the data is valid for","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/fans.html#schematics","title":"Schematics","text":"<p>5v Fans and Relays</p> <p>Whilst it is possible to drive a 5v PWM fan directly from the gpio pins it is not recommended. Equally it is not recommended to control fans via relays</p> <p></p> <p>Example Mosfet driven 12 Fan</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/fans.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gpio.html","title":"GPIO","text":"<p>This module allows a GPIO pin to be toggled during the transition from day to night and night to day. This can be used to signal other hadrware that the transition has happened, for example an automated cover that protects the camera during daylight hours in very hot environments</p>","tags":["Extra Module","Pipeline Day","Pipeline DayToNight","Pipeline NightToDay"]},{"location":"allsky_modules/extra/gpio.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> Setting Description GPIO Pin The GPIO pin to control State The state to set the GPIO pin to <p>As an example to control a device connected to GPIO pin 18 that goes high at night you would do the following</p> <ul> <li>In the Day To Night pipeline add the module, set the GPIO pin to 18 and check the state</li> <li>In the Night To Day pipline add the module, set the GPIO pin to 18 and un check the state</li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline DayToNight","Pipeline NightToDay"]},{"location":"allsky_modules/extra/gpio.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Day To Night</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nigh To Day</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline DayToNight","Pipeline NightToDay"]},{"location":"allsky_modules/extra/gps.html","title":"GPS","text":"<p>This module allows you to read latitude, longitude and time from a GPS attached to the pi. This module requires gpsd to be installed, the module installer will install this if its not present.</p> <p>Pi Noise</p> <p>NOTE: The HDMI and Wifi on the Pi 4 is VERY noisy and will interfere with most GPS modules. To get around this please ensure that the GPS receiver and antenna is mounted at least one meter (three feet) away from the Pi.</p> <p>Time synchronisation</p>","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#settings","title":"Settings","text":"","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#settings-tab","title":"Settings Tab","text":"Setting Description LAT/LON Warning If enabled a warning will be generated, both in the log files and as an Allsky variable if the GPS position does not match your Latitude and Longitude. The comparison is done to 2 decimal places to allow for GPS fluctuation Set LAT/LON If enabled your Latitude and Longitude will be set from the GPS Set Time If enabled the time on the Pi will be set from the GPS Set Every If the \"Set Time\" option is enabled the time on the Pi will be set every this number of seconds Extra Data Filename The name of the file to create the GPS data in for the Overlay Manager. Normally you will not need to change this Discrepancy Warning if the \"Lat/Lon Warning\" is enabled and a discrepancy is found this text will be set in the variable for the Overlay Manager","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#obfuscation-tab","title":"Obfuscation Tab","text":"Setting Description Obfuscate Position If enabled the values below will be used to modify the GPS position. This is designed to allow you to display the GPS position on an overlay without giving away your exact position Latitude Metres The number of metres to offset the latitude by. Can be a positive or negative number Longitude Metres The number of metres to offset the longitude by. Can be a positive or negative number","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#setting-location","title":"Setting Location","text":"<p>The module has the ability to set your lat and lon in the main Allsky settings from the GPS data. </p> <p>If you are concerned about your exact location being set then the module contains settings allowing these values to be randomly adjusted to help obfuscate your exact location</p>","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#setting-the-time","title":"Setting the time","text":"<p>Even if you set the time sync options in the GPS module the time will only be synchronised if the Pi is NOT having its time updated from the Internet. To test if the time is currently being synchronised from the Internet enter the following command:</p> <p><code>timedatectl status</code></p> <p>Output similar to the following will be produced:</p> <pre><code>            Local time: Fri 2023-02-03 23:18:36 GMT\n        Universal time: Fri 2023-02-03 23:18:36 UTC\n              RTC time: n/a\n              Time zone: Europe/London (GMT, +0000)\n</code></pre> <p>System clock synchronized: no                 NTP service: inactive             RTC in local TZ: no</p> <p>Note that the \"System clock synchronized\" value is \"no\" which means the GPS module will be allowed to set the time.</p>","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#available-variables","title":"Available Variables","text":"Variable Description AS_PIGPSFIX A text string, either \"Yes\" or \"No\", indicating if the GPS has a fix or not AS_PIGPSUTC The UTC time from the GPS AS_PIGPSLOCAL The local time from the GPS AS_PIGPSOFFSET The time offset from UTC in hours AS_PIGPSLAT The GPS latitude in degrees, minutes, and seconds AS_PIGPSLON The GPS longitude in degrees, minutes, and seconds AS_PIGPSLATDEC The GPS latitude in decimal degrees, minutes, and seconds AS_PIGPSLONDEC The GPS longitude in decimal degrees, minutes, and seconds AS_PIGPSFIXDISC The latitude and longitude discrepancy string, if there is a decrepancy found","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#connecting-the-gps","title":"Connecting the GPS","text":"<p>If possible please use a USB based GPS, they are far easier to work with that trying to setup the Pi's UART interface on the GPIO pins</p>","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/gps.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/hddtemp.html","title":"Hard Disk Temp","text":"<p>This module uses SMART (Self-Monitoring, Analysis and Reporting Technology) to monitor the temperature of a hard drive.</p> <p>SMART is a diagnostic and monitoring system used by HDDs and SSDs to track internal health conditions. The drive keeps a set of counters, error logs, temperature records, and performance measurements. These indicators help the drive (and the operating system) detect when the hardware is starting to fail. The goal of SMART is not just to report current problems, but to predict future failure, giving users time to back up data before the drive becomes unusable.</p> <p>Although both HDD's and SSD's use SMART, their behaviours differ:</p> <ul> <li>HDDs mostly fail due to mechanical wear, surface defects, and bad sectors. SMART is excellent at predicting these because they develop gradually.</li> <li>SSDs fail due to flash wear, controller issues, and exhausted write cycles. SMART tracks wear levels and total writes, but SSDs sometimes die suddenly without SMART warnings due to controller failure. Still, wear attributes are reliable indicators of overall health.</li> </ul> <p>Its not perfect</p> <p>SMART is useful, but not perfect. Mechanical parts can fail suddenly without warning, and some manufacturers hide certain attributes. SMART is very good at predicting gradual failures\u2014like increasing bad sectors\u2014but cannot reliably predict sudden electrical failures, controller failures, or catastrophic mechanical damage. That said, if SMART reports a warning, you should assume the drive is at high risk of imminent failure and back up immediately.</p> <p>SMART is available on SSD's and even NVME drives but the implementation is sporadic. It is NOT available for SD cards</p> <p>Whilst SMART prvides a lot of data this module is intended to only provide the temperature of the HDD or SSD</p> <p>The module will attempt to read the temperature from all connected drives</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/hddtemp.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/hddtemp.html#fans-1-and-2-tabs","title":"Fans 1 and 2 tabs","text":"Setting Description Use Colour If enabled the data for the overlay will be coloured based upon the settings below Ok Temp At or below this temperature it is considered ok Ok Colour If 'Use Colour' ie enabled this colour will be used when the temperatur is ok Bad Colour If 'Use Colour' ie enabled this colour will be used when the temperatur is not ok","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/hddtemp.html#charts","title":"Charts","text":"<p>A variety of charts are available, see the chart manager for details</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/hddtemp.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/image_tuning.html","title":"Image Tuning","text":"<p>This module allows for manipulating various aspects of the captured image;</p> <ul> <li>Saturation</li> <li>Contrast, including 'Smart Contrast'</li> <li>Gamma</li> <li>Sharpness</li> <li>Noise Reduction</li> </ul> <p>The module applies enhancements in this specific order for optimal results:</p> <ul> <li>Noise Reduction - Clean the image first</li> <li>Saturation - Adjust color intensity</li> <li>Gamma - Correct brightness</li> <li>Contrast - Enhance separation</li> <li>Sharpening - Final detail enhancement</li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/extra/image_tuning.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p> <ul> <li> <p>Saturation (level)</p> <ul> <li>Range: -10 to 10</li> <li>Default: 0 (neutral)</li> <li>Description: Controls color intensity<ul> <li>-10: Black &amp; White</li> <li>0: Original colors</li> <li>10: Maximum color saturation</li> </ul> </li> <li>Use Case: Enhance nebulae, auroras, or reduce color noise in low-light images</li> </ul> </li> <li> <p>Contrast (contrast)</p> <ul> <li>Range: 0 to 5</li> <li>Default: 1.0 (neutral)</li> <li>Description: Controls separation between light and dark areas<ul> <li>1.0: Original contrast</li> <li> <p>1.0: Increases contrast</p> </li> <li>&lt; 1.0: Decreases contrast</li> </ul> </li> <li>Use Case: Make stars stand out more against the sky background</li> </ul> </li> <li> <p>Gamma (gamma)</p> <ul> <li>Range: 0.1 to 5.0</li> <li>Default: 1.0 (neutral)</li> <li>Description: Brightness control that preserves highlights<ul> <li>1.0: Original brightness</li> <li> <p>1.0: Brightens dark areas (lifts shadows)</p> </li> <li>&lt; 1.0: Darkens the image</li> </ul> </li> <li>Use Case: Reveal faint stars and detail in dark night skies</li> </ul> </li> <li> <p>Sharpness (sharpness)</p> <ul> <li>Range: 0 to 5</li> <li>Default: 0 (off)</li> <li>Description: Edge enhancement strength<ul> <li>0: No sharpening</li> <li>1: Mild sharpening</li> <li>5: Very strong sharpening</li> </ul> </li> <li>Use Case: Make stars appear more defined and crisp</li> <li>Note: Apply sparingly to avoid introducing artifacts</li> </ul> </li> <li> <p>Noise Reduction (denoise)</p> <ul> <li>Range: 0 to 5</li> <li>Default: 0 (off)</li> <li>Description: Removes grain and noise<ul> <li>0: No denoising</li> <li>1-2: Light denoising (preserves faint stars)</li> <li>3-5: Strong denoising (may blur faint stars)</li> </ul> </li> <li>Use Case: Clean up noisy images from high ISO settings</li> <li>Note: Uses bilateral filtering to preserve edges</li> </ul> </li> <li> <p>Smart Contrast (auto_anchor)</p> <ul> <li>Type: Checkbox</li> <li>Default: Off (false)</li> <li>Description: Automatically adjusts brightness when changing contrast</li> <li>Effect: Maintains overall image brightness when contrast is increased/decreased</li> <li>Use Case: Enable when you want to adjust contrast without making the image too bright or dark</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/extra/image_tuning.html#tips","title":"Tips","text":"<p>Tips and Best Practices when using the module</p> <ul> <li>Start Small - Begin with subtle adjustments and increase gradually</li> <li>Denoise First - If using noise reduction, the module applies it first automatically</li> <li>Watch for Artifacts - Too much sharpening can introduce halos around bright objects</li> <li>Balance Adjustments - Heavy denoising may require less sharpening</li> <li>Use Smart Contrast - Enable auto_anchor when adjusting contrast to maintain brightness</li> <li>Test Different Times - Settings that work at night may not work during the day</li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/extra/image_tuning.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night"]},{"location":"allsky_modules/extra/ina3221.html","title":"INA3221","text":"<p>This module has been deprecated please use the Power Module</p>"},{"location":"allsky_modules/extra/influxdb.html","title":"InfluxDB","text":"<p>This module has been deprecated please use the Publish Data Module</p>"},{"location":"allsky_modules/extra/json_import.html","title":"JSON Import","text":"<p>This module reads JSON data from a URl and creates and extra data file containing variables that can be used in overlays.</p> <p>As an example if an url returns the following data</p> <pre><code>{\n  \"var1\": \"var1 value\",\n  \"var2\": \"var2 value\",\n  \"var3\": {\n    \"var3_subvalue\": \"var3_subvalue\"\n  }\n}\n</code></pre> <p>The following allsky variables will be created</p> <p>AS_VAR1</p> <p>AS_VAR2</p> <p>var3 will be ignored as its an object which cannot be imported</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/extra/json_import.html#settings","title":"Settings","text":"Setting Description Read Every How frequently to read data URL The url that returns the data, note this must be unprotected i.e no username or password required Prefix The prefix to add to variables when imported so for example var1 becomes AS_{PREFIX}VAR1 Filename The name of the xtra data file to update","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/extra/json_import.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/extra/light.html","title":"Light Meter","text":"<p>This module produces a Lux level and estimation of Bortle value from various light sensors. The following sensors are supported</p> <ul> <li>TSL2561</li> <li>TSL2591</li> <li>LTR390</li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#lux","title":"Lux","text":"<p>Lux (lx) is the standard unit used to measure illuminance, which means how much light actually falls on a surface.</p> <p>It describes how bright something appears, not how much light a source emits.</p> Environment Typical Lux (lx) Notes Moonless dark sky 0.001 \u2013 0.002 Near Bortle 1; extremely dark Starlight only ~0.0001 Human eye barely detects detail Quarter Moon ~0.02 Soft illumination Full Moon ~0.25 Clearly visible landscape Urban night (street lit) 10 \u2013 20 Typical suburban streetlights Office lighting 300 \u2013 500 Standard working environment Overcast daylight ~1,000 Bright but no direct sun Direct sunlight 100,000+ Can reach 120,000\u2013130,000 lx at noon","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#bortle-scale","title":"Bortle Scale","text":"<p>The Bortle Scale is a 9-level classification system used to describe night-sky brightness and how much light pollution affects your ability to see stars, the Milky Way, and deep-sky objects.</p> <p>It was created by John E. Bortle in 2001 and is widely used by astronomers to compare observing sites.</p> Bortle Class Sky Type Milky Way Visibility Naked-Eye Limit (mag) Notes 1 Excellent dark-sky Extremely bright; may cast shadows 7.6+ No light pollution; zodiacal light and airglow visible 2 Truly dark Very bright and detailed 7.1\u20137.5 Minimal light domes 3 Rural Bright overhead, fades near horizon 6.6\u20137.0 Zodiacal light visible; slight light domes 4 Rural/Suburban transition Visible but washed out 6.1\u20136.5 Noticeable skyglow; reduced contrast 5 Suburban Faint, little structure 5.6\u20136.0 Grey/amber sky; faint DSOs weak 6 Bright suburban Barely visible, if at all 5.1\u20135.5 Significant skyglow 7 Suburban/Urban transition Not visible 4.6\u20135.0 Only bright constellations visible 8 City Not visible 4.1\u20134.5 Very few stars visible 9 Inner city Not visible &lt;4.0 Only brightest stars/planets visible","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#calculating-bortle","title":"Calculating Bortle","text":"<p>Converting Lux to the Bortle scale is not possible. The Bortle scale describes sky quality as seen by a human observer, while lux measures illuminance on a surface. They are related to sky brightness, but they measure completely different things.</p> <p>The values the module calculates are estimates based upon the table below</p> Bortle Class Sky Description Typical Night-Sky Lux (lx) Notes 1 Excellent dark-sky 0.0010 \u2013 0.0020 Natural sky brightness; extremely dark 2 Truly dark 0.0015 \u2013 0.0030 Very faint skyglow only 3 Rural 0.0020 \u2013 0.0040 Slight light domes on horizon 4 Rural/Suburban transition 0.0040 \u2013 0.0100 Noticeable skyglow 5 Suburban 0.0100 \u2013 0.0300 Sky brightening clearly visible 6 Bright suburban 0.0300 \u2013 0.0800 Milky Way usually invisible 7 Suburban/Urban transition 0.0800 \u2013 0.1500 Strong skyglow; only brightest stars visible 8 City 0.1500 \u2013 0.3000 Very few stars visible 9 Inner city 0.3000 \u2013 1.0000+ Bright orange/grey sky; deep-sky impossible","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#settings","title":"Settings","text":"","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#tsl2561","title":"TSL2561","text":"Setting Description I\u00b2C Address The I\u00b2C address of the sensor, leave blank for the default Gain The gain to use Integration Time The time taken to take a reading","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#tsl2591","title":"TSL2591","text":"Setting Description I\u00b2C Address The I\u00b2C address of the sensor, leave blank for the default Gain The gain to use Integration Time The time taken to take a reading","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#ltr390","title":"LTR390","text":"Setting Description I\u00b2C Address The I\u00b2C address of the sensor, leave blank for the default Gain The gain to use Sensor Resolution The resolution of the internal DAC, if in doubt leave at default Gain The gain to use Delay Delay between measurements, only really useful for power saving","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#available-variables","title":"Available Variables","text":"<p>The module generates the following variables</p> Variable Description AS_LUX The measure Lux level AS_BORTLE The estimated Bortle value","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#schematics","title":"Schematics","text":"<p>Example using the tsl2561 and tsl2591</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#protecting-the-sensors","title":"Protecting The Sensors","text":"<p>These sensors are delicate and cannot be exposed to the elements, however they do need clear access to the sky to be able to measure the light levels. You will require some way to protect the sensor</p> Material Suitability Optical Performance Pros Cons Notes PTFE (Teflon) film/sheet \u2b50\u2b50\u2b50\u2b50\u2b50 Best Excellent (90\u201395% transmission) Waterproof, UV-resistant, stable diffusion Slight attenuation if too thick Best overall for outdoor light sensors; use thin PTFE Optical-grade Acrylic (PMMA) \u2b50\u2b50\u2b50\u2b50 Excellent (~92% transmission) Clear, durable, good for windows or domes Brittle under impact; needs sealing Ideal as a protective clear cover Polycarbonate (Lexan) \u2b50\u2b50\u2b50\u2b50 Very good Extremely tough, weather-resistant Slight colour shift; can yellow over years Good when durability matters most Polyethylene (PE) film \u2b50\u2b50 Moderate Cheap, flexible, waterproof UV degradation; inconsistent optical quality OK for temporary use, not long-term Glass \u2b50 Variable (depends on type) Hard, scratch-resistant Absorbs IR/UV; heavy; condensation issues Not recommended unless using optical-grade glass Silicone sealant (over sensor) \ud83d\udeab No Poor Waterproof Strong spectral distortion; fogging; uneven layer Do not apply directly over sensor 3D-printed plastics (PLA/PETG) \ud83d\udeab No Poor Easy to fabricate Not optically clear; scatter light; UV issues Not suitable as a light-transmitting cover","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/light.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/lightning.html","title":"Lightning","text":"<p>This module can detect lightning using a AS3935 sensor</p> <p>The AS3935 is a dedicated lightning detection integrated circuit designed to identify the characteristic electromagnetic signatures produced by lightning activity. Operating around the 500 kHz sferic band, it uses an internal tuned antenna and digital signal processing to distinguish real lightning strikes from man-made electrical noise and other transient RF events. The device can detect cloud-to-ground, cloud-to-cloud, and intra-cloud lightning and provides an estimated storm distance from approximately 40 km down to 1 km, allowing systems to track whether a storm is approaching or directly overhead. It features configurable sensitivity levels, automatic noise-floor adaptation, and \u201cdisturber\u201d rejection to reduce false positives, while communicating via either I\u00b2C or SPI and signalling events through an interrupt pin. The AS3935 requires correct antenna calibration and should be positioned away from high-noise electronics to ensure reliable detection. Widely used in weather stations, outdoor monitoring systems, and IoT nodes, the AS3935 offers a compact and low-power method of adding accurate lightning detection capabilities to embedded applications.</p> <p>False Positives</p> <p>Its very easy to get false positives from these devices. You will need to ensure the device is mounted away from other electrical sources that could cause interferance</p> <p>WARNING</p> <p>The sensor used in this module will only estimate values. It must NEVER be used for any form of personal protection from storms</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/lightning.html#settings","title":"Settings","text":"","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/lightning.html#basic","title":"Basic","text":"Setting Description I\u00b2C Address The I\u00b2C address of the as3935, leave blank for the default Input Pin The pin the as3935 irq pin is connected to, this is set high when lightning is detected","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/lightning.html#advanced","title":"Advanced","text":"Setting Description Mask Disturbers Mask false positives Noise Level The ambient noise level, 1 being the lowest and 7 the highest Watchdog Threshold Minimum signal level to trigger the lightning verification algorithm (1-10) Spike Rejection The default setting is two. The shape of the spike is analyzed during the chip's validation routine. You can round this spike at the cost of sensitivity to distant events (1-11) Strike Threshold The number of strikes detected before an event is triggered Expire Strikes If a strike is detected then after this number of seconds of no strikes the strikes overlay variable and strike counter will be reset. Default is 600 seconds (10 minutes)","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/lightning.html#available-variables","title":"Available Variables","text":"Variable Description AS_LIGHTNING_COUNT Number of strikes detected AS_LIGHTNING_LAST Time of last strike AS_LIGHTNING_DIST Distance of last strike, this is an estimate AS_LIGHTNING_ENERGY Energy of the last strike","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/lightning.html#schematics","title":"Schematics","text":"<p>Example using the as3935</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/lightning.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/ltr390.html","title":"LTR390","text":"<p>This module has been deprecated please use the Light Module</p>"},{"location":"allsky_modules/extra/mlx90640.html","title":"MLX90640","text":"<p>This module uses a Infared Image sensor to generate a 32x32 pixel IR image of the sky</p> <p>The MLX90640 is a compact, high-resolution thermal imaging array designed to capture two-dimensional temperature data without physical contact. Unlike single-pixel IR thermometers (such as the MLX90614), the MLX90640 features a 32 \u00d7 24 matrix of infrared sensing elements, providing 768 individual temperature measurements across its field of view. This allows it to generate true thermal images, detect temperature patterns, identify hotspots, and monitor heat distribution over an area rather than at a single point.</p> <p>At its core, the MLX90640 uses an array of microbolometers, each of which responds to infrared radiation emitted by the environment. These readings are digitised and processed through onboard calibration data to produce accurate temperature values. The sensor supports a wide measurable range, typically from \u201340\u00b0C to +300\u00b0C, and provides object temperature readings with good stability when properly calibrated and thermally stabilised. Its internal DSP compensates for pixel-to-pixel variations, thermal drift, and lens characteristics, producing consistent and repeatable thermal maps.</p> <p>The MLX90640 communicates over I\u00b2C and supports frame rates from about 0.5 Hz up to 64 Hz, depending on resolution mode and bandwidth. It is available in different Field of View (FOV) configurations\u2014such as 55\u00b0 \u00d7 35\u00b0 (standard) or 110\u00b0 \u00d7 75\u00b0 (wide-angle)\u2014making it suitable for a wide variety of applications, including people detection, HVAC optimisation, wildlife monitoring, fire detection, equipment diagnostics, industrial automation, and security systems. Because the sensor is extremely sensitive to thermal disturbances, optimal performance requires careful mounting to minimise self-heating, shielding from airflow or drafts, and avoiding condensation on the lens. With appropriate integration, the MLX90640 offers an accessible and highly capable thermal imaging solution for embedded systems and IoT projects.</p> <p>Module</p> <p>This module is only really useful for getting the minimum and maximum temperatures and a nice image if you want one. It was conceived as part of a system to determine cloud cover but that work was never completed due to it being inaccurate</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/mlx90640.html#settings","title":"Settings","text":"Setting Description I\u00b2C Address The I\u00b2C address of the mlx90640, leave blank for the default Image filename The name of the image to be created, this will then be found in the overlay image manager Resize Image Resizes the image, 0 = no image 1 = 100%","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/mlx90640.html#available-variables","title":"Available Variables","text":"<p>The module generates the following variables</p> Variable Description AS_MLX906040MIN The minimum temperature in the captured image AS_MLX906040MAX The maximum temperature in the captured image","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/mlx90640.html#schematics","title":"Schematics","text":"<p>Example using the mlx90640</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/mlx90640.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/mqtt_subscribe.html","title":"MQTT Subscribe","text":"<p>This module obtains data from given MQTT topic for use in overlays</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/owm.html","title":"Open Weather Map","text":"<p>This module obtains weather data from the Open Weather Map service</p> <p>OpenWeatherMap is a widely used weather data service that provides real-time and historical meteorological information through a simple web-based API. It aggregates data from thousands of weather stations, radars, satellites, and global models, then makes it available to developers for use in applications, dashboards, and IoT devices. The platform offers current conditions, forecasts, air-quality information, severe-weather alerts, and detailed hourly data. Access is provided through RESTful API endpoints, typically returning JSON, and supports both free and paid tiers depending on the level of precision, frequency, and features required.</p> <p>API Key</p> <p>This module requires an API key. To get a key register on the OpenWeatherMap website then visit the API keys section</p> <p>API limits</p> <p>The free API limits you to 1000 requests per day. Please ensure you set the 'Read Every' setting to the correct value so as not to exceed this limit</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/owm.html#settings","title":"Settings","text":"Setting Description API Key You Open Weather Map API Key Read Every Read the data every this number of seconds Units The units to obtain data in Expiry Time How long to keep data for before its removed","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/owm.html#available-variables","title":"Available Variables","text":"Variable Description AS_OWWEATHER Weather Summary AS_OWWEATHERDESCRIPTION Weather Description AS_OWTEMP Temperature AS_OWDEWPOINT Dewpoint AS_OWHEATINDEX Heat Index AS_OWTEMPFEELSLIKE What the temperature feels like AS_OWTEMPMIN Minimum Temperature AS_OWTEMPMAX Maximum Temperature AS_OWPRESSURE Pressure AS_OWHUMIDITY Humidity AS_OWWINDSPEED Wind Speed AS_OWWINDGUST Max Wind Gust AS_OWWINDDIRECTION Wind direction in degrees AS_OWWINDCARDINAL Cardinal Wind Direction AS_OWCLOUDS Percentage Cloud Cover AS_OWRAIN1HR Rain in the last hour AS_OWRAIN3HR Rain in the last 3 hours AS_OWSUNRISE Sunrise time AS_OWSUNSET Sunset time","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/owm.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/power.html","title":"Power","text":"<p>This module is used to measure voltage and current. It supports the ina219 (Single channel) or the ina3221 (Three channels).</p> <p>This can typically be used to monitor the voltage and current being applied to a dew heater, its a pretty reliable way to know if its actually working !</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#settings","title":"Settings","text":"<p>The following settings are available in the module</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#ina219-settings","title":"ina219 settings","text":"<p>When selecting the ina219 as the Sensor type the following settings are available</p> Setting Description Temperature Variable The variable to use for temperature. Do not change this unless you know what yo are doing I\u00b2C Address The I\u00b2C address of the ina219 Channel Name The name of the channel, this will be available in a variable for use in the overlay <p>I\u00b2C Address</p> <p>The INA219 uses a base I\u00b2C address of 0x40, but it has 16 possible addresses (0x40 to 0x4F) determined by setting pins A0 and A1, commonly by soldering jumpers on breakout boards. The default address (no jumpers) is often 0x40, while bridging both A0 and A1 sets it to 0x45, allowing multiple sensors on the same bus.</p> <p>Refer to your board for the I\u00b2C address</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#ina3221-settings","title":"ina3221 settings","text":"<p>When selecting the ina3221 as the Sensor type the following settings are available</p> Setting Description Temperature Variable The variable to use for temperature. Do not change this unless you know what yo are doing I\u00b2C Address The I\u00b2C address of the ina3221 Enable Channel 1 When selected channel 1 will be enabled Channel 1 Name The name ofd the channel, this will be available in a variable for use in the overlay Enable Channel 2 When selected channel 2 will be enabled Channel 2 Name The name ofd the channel, this will be available in a variable for use in the overlay Enable Channel 3 When selected channel 3 will be enabled Channel 3 Name The name ofd the channel, this will be available in a variable for use in the overlay <p>I\u00b2C Address</p> <p>The INA3221 has a default I\u00b2C address of 0x40, but it's configurable to three other addresses (0x41, 0x42, 0x43) by connecting the address pin (A0) to different logic levels (GND, VCC, SDA, or SCL) or by using solder jumpers on breakout boards. This allows multiple sensors on one I\u00b2C bus, with 0x40 being the standard setting. </p> <p>Refer to your board for the I\u00b2C address</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#available-variables","title":"Available Variables","text":"","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#ina219","title":"INA219","text":"<p>The ina219 produces the following variables for use in overlays</p> Variable Description AS_POWER_VOLTAGE1 Channel 1 Voltage AS_POWER_CURRENT1 Channel 1 Current AS_POWER_BUS_VOLTAGE1 Channel 1 Bus Voltage AS_POWER_SHUNT_VOLTAGE1 Channel 1 Shunt Voltage AS_POWER_POWER1 Cannel 1 Power (w)","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#ina3221","title":"INA3221","text":"<p>The ina3221 produces the following variables for use in overlays</p> Variable Description AS_POWER_VOLTAGE1 Channel 1 Voltage AS_POWER_CURRENT1 Channel 1 Current AS_POWER_BUS_VOLTAGE1 Channel 1 Bus Voltage AS_POWER_SHUNT_VOLTAGE1 Channel 1 Shunt Voltage AS_POWER_POWER1 Cannel 1 Power (w) AS_POWER_VOLTAGE2 Channel 2 Voltage AS_POWER_CURRENT2 Channel 2 Current AS_POWER_BUS_VOLTAGE2 Channel 2 Bus Voltage AS_POWER_SHUNT_VOLTAGE2 Channel 2 Shunt Voltage AS_POWER_POWER2 Cannel 2 Power (w) AS_POWER_VOLTAGE3 Channel 3 Voltage AS_POWER_CURRENT3 Channel 3 Current AS_POWER_BUS_VOLTAGE3 Channel 3 Bus Voltage AS_POWER_SHUNT_VOLTAGE3 Channel 3 Shunt Voltage AS_POWER_POWER3 Cannel 3 Power (w)","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#schematics","title":"Schematics","text":"<p>The most common use for these sensors it to monitor the dew heater to ensure its on, its not easy when using PWM (Or a relay !) to really know the heater is on</p> <p></p> <p>Example using an ina219 to measure dew heater voltage and current</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/power.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/publish_data.html","title":"Publish Data","text":"<p>This module allows data from Allsky to be published to a variety of destinations.</p> <ul> <li> <p>Redis - an in-memory, key\u2013value data store designed for extreme speed, used both as a cache and as a primary database for real-time applications. Unlike traditional relational databases, Redis stores data structures directly\u2014such as strings, lists, sets, sorted sets, hashes, bitmaps, streams, and geospatial indexes\u2014allowing efficient operations with minimal latency. It supports persistence to disk, replication, clustering, and high-availability configurations, making it suitable for large-scale systems. Because Redis operations are atomic and single-threaded per shard, it provides predictable performance while avoiding complex locking. Its combination of speed, versatile data structures, and robust ecosystem makes Redis popular for caching, session storage, message queues, real-time analytics, and pub/sub systems.</p> </li> <li> <p>MQTT - (Message Queuing Telemetry Transport) is a lightweight, publish\u2013subscribe messaging protocol designed for reliable communication over constrained networks, making it ideal for IoT devices, sensors, and low-bandwidth or high-latency environments. Instead of devices talking directly to each other, all messages flow through a central broker, which routes published messages to subscribers based on topic filters. The protocol is extremely efficient, using small packet sizes and persistent TCP connections, and it supports quality-of-service levels to ensure messages are delivered as reliably as the application requires. With built-in features like retained messages, last-will notifications, and secure transport via TLS, MQTT provides a flexible and scalable foundation for real-time, event-driven systems across everything from home automation to industrial telemetry.</p> </li> <li>REST - (Representational State Transfer) is an architectural style for building web services that communicate over HTTP using simple, stateless operations. In REST, resources\u2014such as users, orders, or images\u2014are identified by URLs, and clients interact with them using standard HTTP methods like GET, POST, PUT, and DELETE. Because each request contains all the information needed to process it, the server does not maintain client session state, making REST systems highly scalable and easy to distribute. Responses typically use lightweight formats such as JSON, and REST\u2019s uniform interface simplifies integration across diverse platforms. Its simplicity, predictability, and compatibility with existing web infrastructure make REST one of the most widely used approaches for modern APIs.</li> <li>InfluxDB - is a high-performance, open-source time series database designed specifically for storing and querying timestamped data such as metrics, events, and IoT sensor readings. It organizes data into measurements, tags, fields, and timestamps, enabling efficient indexing and fast retrieval even at very high ingest rates. InfluxDB supports powerful time-based queries, downsampling, and data retention policies that automatically manage storage over time. With its SQL-like query language (InfluxQL) or the more advanced Flux language, it provides flexible analytics capabilities. Optimized for real-time monitoring, observability, and IoT workloads, InfluxDB delivers a scalable and performant foundation for applications that must handle large volumes of chronological data.</li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#settings","title":"Settings","text":"","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#general-settings","title":"General Settings","text":"Setting Description Extra Data The Allsky variables to export","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#redis","title":"Redis","text":"Setting Description Publish to Redis Enable to publish data to the Redis server Redis Host The hostname or IP address of the Redis host Redis Port The port number of the Redis server Redis Database The Redis database number to use Use timestamp Uses the current timestamp as the Redis key Redis Key Instead of timestamp use this as the Redis key Password The password for the Redis server if one is required","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#influxdb","title":"InfluxDB","text":"Setting Description Publish to InfluxDB Enable to publish data to the InfluxDB server Access Token The access token for the InfluxDb server Bucket The InfluxDb Bucket Organization The InfluxDb Organization Data Types The allowed data types to export. Only Allsky variables of these types will be exported <p>Data Types</p> <p>InfluxDB only accepts numerical values so please ensure the Data Types contains only numerical data types. If in doubt don't change it</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#mqtt","title":"MQTT","text":"Setting Description Publish to MQTT Enable to publish data to the MQTT server USe Secure Connection If enabled TLS will be used to connect to the MQTT server MQTT Host The MQTT host and port number Loop Delay The loop delay, only increase this if you experience issues with messages missing in the broker MQTT Topic The MQTT topic to publish data to Username The Username used to access the MQTT Server Password The password to use for the above username QoS The Quality of Service to use, see below for details","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#quality-of-service-qos","title":"Quality of Service (QoS)","text":"<p>MQTT uses a QoS system for publishing data, the table below summarises these</p> QoS Delivery Guarantee Duplicate Messages? Speed / Overhead 0 Best effort Possible Loss Fastest, smallest 1 At least Once Yes Moderate 2 Exactly Once No Slowest, largest overhead <p>QoS 0 \u2014 \u201cAt most once\u201d (fire-and-forget).</p> <ul> <li>The publisher sends the message once, with no retries.  </li> <li>The broker does not acknowledge receipt.  </li> <li>Delivery is not guaranteed; messages may be lost.  </li> <li>Fastest and lowest overhead.  </li> </ul> <p>Use when: Metrics, sensor readings, frequent updates where losing one is acceptable.</p> <p>QoS 1 \u2014 \u201cAt least once\u201d (guaranteed delivery, may be duplicated)</p> <ul> <li>The publisher sends the message and waits for an ACK (PUBACK) from the broker.</li> <li>If no ACK arrives, it retransmits.</li> <li>The subscriber may receive duplicates (must handle deduplication if needed).</li> </ul> <p>Guarantee: The message will be delivered, but possibly more than once.</p> <p>Use when: Commands, alerts, data that must arrive but duplicate delivery is acceptable.</p> <p>QoS 2 \u2014 \u201cExactly once\u201d (most reliable, highest overhead)</p> <ul> <li>Uses a four-step handshake (PUBREC, PUBREL, PUBCOMP).</li> <li>Ensures no duplicates and no loss.</li> <li>Slowest and most bandwidth-heavy option.</li> </ul> <p>Guarantee: The message arrives once and only once.</p> <p>Use when: Billing systems, transactions, state changes where duplicates cannot be tolerated.</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#post-rest","title":"POST (REST)","text":"Setting Description Publish to endpoint Enable to publish data to the enspoint Endpoint The endpoint to publish data to","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/publish_data.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic","API Required"]},{"location":"allsky_modules/extra/rain.html","title":"Detect Rain","text":"<p>This module detects rain using a digital sensor.</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#rain-sensors","title":"Rain Sensors","text":"<p>There are a few types of rain sensor available.</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#the-cheap-ones","title":"The 'Cheap' ones","text":"<p>Resistive rain sensor plates</p> <p>The vast majority of low-cost rain sensors consist of a printed circuit board with exposed copper traces arranged in an interleaved pattern. When the surface is dry, the resistance between the traces is very high. When rain, drizzle, or condensation lands on the board, water bridges the traces and reduces the electrical resistance. The sensor electronics measure this change in resistance and convert it into either an analogue voltage or a digital \u201crain detected\u201d signal.</p> <p>The amount of conductivity depends on how much water is present and how conductive that water is. Pure rainwater has relatively high resistance, while polluted rain, mist, or water containing dust and salts conducts much better. As a result, these sensors do not measure rainfall rate or volume; they simply indicate surface wetness. Over time, the exposed copper oxidises or corrodes, which gradually changes the sensor\u2019s response and reduces reliability.</p> <p>\u2e3b</p> <p>Comparator / module behaviour</p> <p>These sensors are often sold with a small interface module that includes a comparator (usually an LM393) and a potentiometer. The potentiometer sets a threshold, allowing the module to output a digital HIGH or LOW when moisture exceeds a chosen level. Many modules also expose the raw analogue signal, which represents the resistance of the wet sensor plate.</p> <p>Because the comparator threshold is fixed once set, the digital output is best interpreted as a binary wet/dry indicator, not a precision measurement. Small droplets, dew, fog, or even high humidity combined with dust can be enough to trigger the output, especially if the threshold is set aggressively.</p> <p>\u2e3b</p> <p>What they are actually detecting</p> <p>Despite being marketed as \u201crain sensors\u201d, these devices detect electrical conductivity on a surface, not rain itself. They cannot distinguish between rain, condensation, splashes, melting frost, or even a wet insect. Wind-driven rain may miss the sensor entirely, while dew forming overnight can trigger it without any rainfall occurring. This makes them unsuitable for meteorological rainfall measurement but acceptable for basic automation tasks.</p> <p>\u2e3b</p> <p>Durability and accuracy limitations</p> <p>Low-cost rain sensor plates are not designed for long-term outdoor exposure. Continuous wetting accelerates corrosion of the copper traces, which permanently alters the sensor\u2019s resistance. Many users mitigate this by powering the sensor only intermittently, applying conformal coating to non-sensing areas, or replacing the plate periodically. Even with these mitigations, readings will drift over time and vary significantly between units.</p> <p>Warning</p> <p>These sensors will corrode very quickly, in my usage they last arounbd 12 months before the sensor is so corroded it can no longer read moisture</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#slightly-better-ones","title":"Slightly better ones","text":"<p>Some variants of the M152 rain sensor include an integrated heating element beneath or near the sensing surface. The heater is designed to slightly warm the sensor plate, reducing the effects of condensation, dew, frost, and light snow. By keeping the sensing surface above the ambient dew point, the heater helps prevent false rain detections that commonly occur overnight or during periods of high humidity.</p> <p>\u2e3b</p> <p>Purpose and behaviour of the heater</p> <p>The heater does not improve rainfall measurement accuracy or enable quantitative precipitation measurement. Instead, its primary role is to stabilise the sensor\u2019s wet/dry behaviour by drying the sensing surface more quickly after rainfall and suppressing triggers caused by mist or condensation. When precipitation stops, the heated surface evaporates residual moisture faster than an unheated sensor, allowing the output to return to a \u201cdry\u201d state sooner and more consistently.</p> <p>In cold conditions, the heater can also prevent ice formation and help melt light frost or snow, allowing the sensor to continue functioning when an unheated resistive sensor would remain permanently \u201cwet.\u201d</p> <p>\u2e3b</p> <p>Electrical and thermal considerations</p> <p>The heater typically operates at a higher current than the sensing circuitry and may be powered continuously or under software control. Continuous heating improves reliability but increases power consumption and accelerates long-term wear of the sensing surface. Many implementations therefore enable the heater only intermittently, such as:     \u2022   Cycling the heater on when wetness is detected     \u2022   Activating it during high humidity or low temperatures     \u2022   Running it at reduced duty cycles to limit corrosion and power draw</p> <p>\u2e3b</p> <p>Limitations remain</p> <p>Even with a heater, the M152 remains a resistive wetness sensor, not a true rain gauge. It still detects surface conductivity and cannot distinguish between rain intensity, duration, or volume. Heavy condensation combined with contamination can still trigger the sensor, and long-term exposure will gradually alter its response due to electrode degradation.</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#settings","title":"Settings","text":"Setting Description Input Pin The gpio pin the detector is connected to Invert Normally the cheap sensors are high when it's not raining and low when it is. This setting reverse that","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#available-variables","title":"Available Variables","text":"Variable Description AS_RAINSTATE Either \"Raining\" or \"Not Raining\" AS_ALLSKYRAINFLAG Either True if it's raining, or False if it's not AS_ALLSKYRAINFLAGINT Either 1 if it's raining, or 0 if it's not","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#allsky-usage","title":"Allsky Usage","text":"<p>Allsky can use the results of this sensor in other modules, for example in the star and meteor count modules if its raining there is little point checking for stars or meteors</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#schematics","title":"Schematics","text":"<p>Example using the cheaper rain sensors</p>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/rain.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Day","Pipeline Night","Pipeline Periodic","Hardware Required"]},{"location":"allsky_modules/extra/run_script.html","title":"Run Script","text":"<p>This module allows you to run a script. This can be useful if you want to perform custom actions. </p> <p>Be careful when running a script in the day or night time pipelines as the time your script takes to run will affect the time duration between captured images. Ideally only use this module in the periodic pipeline</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/extra/run_script.html#settings","title":"Settings","text":"Setting Description File Location The full path to the script to run, this must be on the local Pi Use Shell If enabled a full bash shell will be used to run the script <p>Using Shells</p> <p>Only enable the 'Use Shell' option if you full undserstand th eimplications of running a script in a shell. 99% of scripts will NOT require this.</p>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/extra/run_script.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Daytime</p> <ul> <li>The Day time pipeline</li> </ul> </li> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Pipeline Day","Pipeline Night","Pipeline Periodic"]},{"location":"allsky_modules/extra/sky_quality.html","title":"Sky Quality","text":"<p>Estimate sky quality from captured images</p> <p>The estimated is calculated as follows</p> <pre><code>weighted_sqm_avg = (((night_max_auto_exposure - exposure_us) / 10) + 1) * (sqm_avg * (((night_max_auto_gain - gain) / 10) + 1))\n</code></pre> <p>Where</p> <p>sqm_avg - The mean value of the image after the mask and ROI have been applied night_max_auto_exposure - The Night time max auto exposure from the main settings exposure_us - The last captured image's exposure time  night_max_auto_gain The night max auto gain from the settings gain - The gain used for the captured image</p>","tags":["Experimental","Extra Module","Overlay Data","Pipeline Night"]},{"location":"allsky_modules/extra/sky_quality.html#settings","title":"Settings","text":"","tags":["Experimental","Extra Module","Overlay Data","Pipeline Night"]},{"location":"allsky_modules/extra/sky_quality.html#main-settings","title":"Main Settings","text":"Setting Description Mask Path The Mask to use when estimatig the sky quality ROI The are of the image to calulate the sky quality from Fallback If no ROI specified then use this percentage around the image center Adjustment Python forumula to apply when calculating the sky quality","tags":["Experimental","Extra Module","Overlay Data","Pipeline Night"]},{"location":"allsky_modules/extra/sky_quality.html#debug-settings","title":"Debug Settings","text":"Setting Description Enable When on debug mod is enabled and the Debug Image is used rather than the captured image Debug Image The image to use to test the module","tags":["Experimental","Extra Module","Overlay Data","Pipeline Night"]},{"location":"allsky_modules/extra/sky_quality.html#available-variables","title":"Available Variables","text":"Variable Description AS_SQM The estimated sky quality","tags":["Experimental","Extra Module","Overlay Data","Pipeline Night"]},{"location":"allsky_modules/extra/sky_quality.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Nighttime</p> <ul> <li>The Night time pipeline</li> </ul> </li> </ul>","tags":["Experimental","Extra Module","Overlay Data","Pipeline Night"]},{"location":"allsky_modules/extra/solar_system.html","title":"Solar System","text":"<p>This module calculates data for Solar System objects, the Sun, planets satellites etc. These are called ephemeris, or ephemeris the plural</p> <p>Data used in this modules calculations is obtained from a variety of sources</p> <ul> <li>The Jet Propulsion Labratory  Provides the binary SPICE ephemeris file that contains highly accurate positions and motions of:<ul> <li>The Sun</li> <li>Moon</li> <li>Planets (Mercury \u2192 Neptune)</li> <li>The Earth\u2013Moon barycentre</li> </ul> </li> <li>Celestrak  Provides the data for calculating:<ul> <li>Earth satellite positions</li> </ul> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#settings","title":"Settings","text":"","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#moon","title":"Moon","text":"Setting Description Enable Enable this to calculate ephemeris for the Moon Min Elevation Above this elevation the Moon will be considered visible","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#sun","title":"Sun","text":"Setting Description Enable Enable this to calculate ephemeris for the Sun","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#planets","title":"Planets","text":"Setting Description Enable Mercury Enable this to calculate ephemeris for Mercury Enable Venus Enable this to calculate ephemeris for Venus Enable Mars Enable this to calculate ephemeris for Mars Enable Jupiter Enable this to calculate ephemeris for Jupiter Enable Saturn Enable this to calculate ephemeris for Saturn Enable Uranus Enable this to calculate ephemeris for Uranus Enable Neptune Enable this to calculate ephemeris for Neptune Enable Pluto Enable this to calculate ephemeris for Pluto Min Elevation Above this elevation the planet will be considered visible","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#iss","title":"ISS","text":"Setting Description Enable ISS Select this to calculate ISS data Visible Only When calculating passes only show those where ISS is visible Debug Passes Enabling this will display the pass information when testing the module, only useful for diagnosing issues Pass Days The number of days to look ahead for passes Number Of Passes The number of passes to return AOS/LOS Elevation The elevation at which Acquisition and Loss of satellite times are calculated Min Elevation Only return passes where the max elevation is above this value <p>Calculating passes for ISS can be fairly slow so be careful with the number of days ahead you look. A sensible value is 5 to 15 days. Also note that the TLE data will become less accurate the further out you look.</p>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#satellites","title":"Satellites","text":"Setting Description NORAD Id's List of Norad Id's for satellites, see below for more details Min Elevation Above this elevation the satellites will be considered visible <p>International Space Station</p> <p>Do not add ISS to the list of Norad Id's. Instead use the iSS tab to manage the space station.</p> <p>NORAD ID's Enter norad ID's as a comma separated list of the numeric Id's.</p> <p>So if for example you just want ISS then enter 25544 as the Norad Id.</p> <p>Calculating large numbers of satellites can be slow so be careful</p> <p>Element Set Data formats</p> <p>Data is only retreived from Celestrak every two days to prevent being blocked by the site</p>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#available-variables","title":"Available Variables","text":"<p>Localisation</p> <p>All values are relative to the location and timezone defined in the main Allsky settings</p>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#the-moons-variables","title":"The Moons Variables","text":"Variable Sample Description AS_MOON_AZIMUTH 357 The Azimuth of the Moon AS_MOON_ELEVATION -36.02 The Elevation of the Moon AS_MOON_ILLUMINATION 11.5 The Moons illumination percentage AS_MOON_SYMBOL W The Moon symbol for use with the moon font on overlays","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#the-suns-variables","title":"The Suns Variables","text":"Variable Sample Description AS_SUN_DAWN 20251029 06:14:04 The time of Dawn AS_SUN_SUNRISE 20251029 06:50:27 The time of Sunrise AS_SUN_NOON 20251029 11:42:34 The time of Noon AS_SUN_SUNSET 20251028 16:35:54 The time of Sunset AS_SUN_DUSK 20251028 17:12:07 The time of Dusk AS_SUN_AZIMUTH 307 The Sun's Azimuth AS_SUN_ELEVATION -40 The Sun's Elevation","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#the-planets-variables","title":"The Planets Variables","text":"<p>In the examples below replace Mercury with the relevant planet name</p> Variable Sample Description AS_Mercury_ALT -36deg 58' 52.9\" The altitude of the Planet in Human readable text AS_Mercury_ALTD -36 The degrees portion of the altitude AS_Mercury_ALTM 58 The minutes portion of the altitude AS_Mercury_ALTS 52 The seconds portion of the altitude AS_Mercury_AZ 285deg 40' 14.5\" The azimuth of the Planet in Human readable text AS_Mercury_AZD 285 The degrees portion of the azimuth AS_Mercury_AZM 40 The minutes portion of the azimuth AS_Mercury_AZS 14 The seconds portion of the azimuth AS_Mercury_RA 15h 19m 09.98s The planets RA AS_Mercury_DEC -20deg 05' 17.8\" The planets Dec AS_Mercury_DISTANCE_KM 195626327 The planets distance from Earth in Kilometers AS_Mercury_DISTANCE_KM_FORMATTED 195,626,327 The planets distance from Earth in Kilometers formatted AS_Mercury_DISTANCE_MILES 121556526 The planets distance from Earth in miles AS_Mercury_DISTANCE_MILES_FORMATTED 121,556,526 The planets distance from Earth in miles formatted AS_Mercury_VISIBLE No Is the planet visible","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#the-satellites-variables","title":"The Satellites Variables","text":"<p>In the examples below replace 66645 with the Norad Id.</p> Variable Sample Description AS_66645_NAME ISS (ZARYA) The name of the Satellite AS_66645_ALT -14deg 52' 59.3\" The altitude of the Satellite in Human readable text AS_66645_ALTD -14 The degrees portion of the altitude AS_66645_ALTM 52 The minutes portion of the altitude AS_66645_ALTS 59 The seconds portion of the altitude AS_66645_AZ 107deg 35' 18.5\" The azimuth of the Satellite in Human readable text AS_66645_AZD 107 The degrees portion of the azimuth AS_66645_AZM 35 The minutes portion of the azimuth AS_66645_AZS 18 The seconds portion of the azimuth AS_66645_DISTANCE 4494.53506453087 The planets distance from Earth in Kilometers AS_66645VISIBLE No Is the satellite visible <p>If ISS passes are enabled then the following variables are generated</p> Variable Sample Description AS_25544_VISIBLE_PASSES None Found A text variable that can be used on overlays if no passes are available AS_25544_PASS1_RISE_TIME Date The date and time ISS rises above the 'Min Elevation' setting AS_25544_PASS1_CUL_TIME Date The date and time of the maximum elevation of the pass AS_25544_PASS1_SET_TIME Date The date and time ISS sets below the 'Min Elevation' setting AS_25544_PASS1_DURATION Number The duration of the pass in seconds AS_25544_PASS1_MAX_ELE Number The maximum elevation of the pass AS_25544_PASS1_VISIBLE Boolean Flag to indicate if any part of the pass will be visible Z <p>If you add a table of pass information, or use one of the provided blocks, then you can place the AS_25544_VISIBLE_PASSES on top of the table. If there are no passes this will be displayed, useful for indicating that there are no passes</p>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#blocks","title":"Blocks","text":"<p>Several blocks are provide to make adding data to the overlays easier. These can be access from the variable manager in the overlay editor</p>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#charts","title":"Charts","text":"<p>Several charts are available that display Moon related information. These can be found in the Chart Manager</p>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/extra/solar_system.html#available-in","title":"Available in","text":"Pipelines available In <ul> <li> <p> Periodic</p> <ul> <li>The Periodic pipeline</li> </ul> </li> </ul>","tags":["Extra Module","Overlay Data","Pipeline Periodic"]},{"location":"allsky_modules/interfaces/i2c.html","title":"I2C","text":""},{"location":"allsky_modules/interfaces/i2c.html#i2c-interface-inter-integrated-circuit","title":"I\u00b2C Interface (Inter-Integrated Circuit)","text":"<p>I\u00b2C (Inter-Integrated Circuit) is a simple, low-speed communication bus used to connect sensors, displays, and other peripherals to a controller such as a Raspberry Pi using only two signal wires.</p> <p>It is commonly used for devices such as temperature sensors, light sensors, RTC clocks, ADCs, DACs, OLED displays, and GPIO expanders.</p>"},{"location":"allsky_modules/interfaces/i2c.html#i2c-on-raspberry-pi","title":"I\u00b2C on Raspberry Pi","text":"<p>Raspberry Pi exposes I\u00b2C on the following pins:</p> GPIO Pin Function GPIO2 Pin 3 SDA GPIO3 Pin 5 SCL"},{"location":"allsky_modules/interfaces/i2c.html#enabling-i2c-on-the-pi","title":"Enabling I\u00b2C on the Pi","text":"<p>Before using any I\u00b2C devices you must enable the I\u00b2C interface as it is not enabled by default.</p> <p>Enable I\u00b2C using: - <code>raspi-config</code> \u2192 Interface Options \u2192 I\u00b2C  </p> <p>or by adding to <code>/boot/config.txt</code>:</p> <pre><code>dtparam=i2c_arm=on\n</code></pre> <p>The bus will then appear as: </p><pre><code>/dev/i2c-1\n</code></pre><p></p> <p>If I\u00b2C is not enabled most modules will warn you.</p>"},{"location":"allsky_modules/interfaces/i2c.html#the-i2c-library","title":"The I\u00b2C Library","text":"<p>Allsky uses a library of I\u00b2C  devices that is provided by Adafruit on their Github repository</p> <p>When first selecting an I\u00b2C device use the button on the dialog to build the database.</p>"},{"location":"allsky_modules/interfaces/i2c.html#how-i2c-works","title":"How I\u00b2C Works","text":"<p>I\u00b2C uses two shared lines:</p> Signal Name Purpose SDA Serial Data Carries the data between devices SCL Serial Clock Provides the clock signal for synchronization <p>Both lines are open-drain, meaning devices can only pull the line low. Pull-up resistors (usually 1.8k\u03a9\u201310k\u03a9) are required to bring the lines high. Fortunately the Pi has these built in.</p> <p>Devices connect in parallel on the same two wires.</p>"},{"location":"allsky_modules/interfaces/i2c.html#master-and-slave-devices","title":"Master and Slave Devices","text":"<ul> <li>The master (e.g. Raspberry Pi) controls communication and provides the clock.  </li> <li>Slave devices (e.g. sensors) each have a unique I\u00b2C address.</li> </ul> <p>Example devices on a bus: - Raspberry Pi \u2192 master - SHT40 sensor \u2192 slave at address <code>0x44</code> - TSL2591 sensor \u2192 slave at address <code>0x29</code></p>"},{"location":"allsky_modules/interfaces/i2c.html#i2c-addresses","title":"I\u00b2C Addresses","text":"<ul> <li>Most devices use 7-bit addresses, written as hexadecimal (e.g. <code>0x44</code>)  </li> <li>Some devices allow address selection using jumpers or pins  </li> <li>Two devices with the same address cannot share the same bus unless an I\u00b2C multiplexer is used  </li> </ul> <p>You can scan the bus on Linux with:</p> <pre><code>i2cdetect -y 1\n</code></pre> <p>If the <code>i2cdetect</code> command cannot be found the install it as follows</p> <pre><code>sudo apt update\nsudo apt install I\u00b2C-tools\n</code></pre>"},{"location":"allsky_modules/interfaces/i2c.html#typical-speed-modes","title":"Typical Speed Modes","text":"Mode Speed Standard mode 100 kHz Fast mode 400 kHz Fast mode+ 1 MHz High speed 3.4 MHz <p>Most sensors operate at 100 kHz or 400 kHz.</p>"},{"location":"allsky_modules/interfaces/introduction.html","title":"Introduction","text":""},{"location":"allsky_modules/interfaces/introduction.html#interfaces-for-modules","title":"Interfaces for Modules","text":"<p>Several of the Allsky modules, mainly the extra modules, make use of the Pi's hardware interfaces. This section details each of those interfaces and howto enable them.</p>"},{"location":"allsky_modules/interfaces/onewire.html","title":"One Wire","text":""},{"location":"allsky_modules/interfaces/onewire.html#1-wire-interface-one-wire-bus","title":"1-Wire Interface (One-Wire Bus)","text":"<p>1-Wire is a simple communication protocol developed by Maxim Integrated (Dallas Semiconductor) that allows data and power to be delivered over a single data wire plus ground. It is commonly used for low-speed sensors such as temperature probes.</p> <p>Typical devices include: - DS18B20 temperature sensors - iButton devices - EEPROM identification chips  </p>"},{"location":"allsky_modules/interfaces/onewire.html#enabling-1-wire-on-raspberry-pi","title":"Enabling 1-Wire on Raspberry Pi","text":"<ul> <li><code>raspi-config</code> \u2192 Interface Options \u2192 One Wire </li> </ul> <p>Raspberry Pi provides built-in support for 1-Wire using a kernel driver.</p>"},{"location":"allsky_modules/interfaces/onewire.html#enable-via-bootconfigtxt","title":"Enable via <code>/boot/config.txt</code>","text":"<p>Edit the configuration file:</p> <pre><code>sudo nano /boot/config.txt\n</code></pre> <p>Add the following line:</p> <pre><code>dtoverlay=w1-gpio\n</code></pre> <p>By default this uses: - GPIO4 (Pin 7) as the data pin</p> <p>You can specify a different pin if required:</p> <pre><code>dtoverlay=w1-gpio,gpiopin=17\n</code></pre> <p>Reboot the Pi:</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"allsky_modules/interfaces/onewire.html#how-1-wire-works","title":"How 1-Wire Works","text":"<p>The bus uses: - DQ (Data line) \u2013 carries both data and timing signals - GND (Ground) - Optional VCC (3.3 V or 5 V) if not using parasitic power</p> <p>All devices share the same data line and are identified by a unique 64-bit ID, allowing many devices to exist on the same bus.</p>"},{"location":"allsky_modules/interfaces/onewire.html#power-modes","title":"Power Modes","text":"<p>1-Wire devices can operate in two ways:</p> Mode Description Normal power Device uses VCC, GND, and DATA Parasitic power Device steals power from the data line (DATA + GND only) <p>For reliability, normal powered mode is recommended instead of parasitic power.</p>"},{"location":"allsky_modules/interfaces/onewire.html#verifying-1-wire-is-working","title":"Verifying 1-Wire is Working","text":"<p>After reboot, check that the driver is loaded:</p> <pre><code>ls /sys/bus/w1/devices/\n</code></pre> <p>You should see folders like:</p> <pre><code>28-00000abcdef0\nw1_bus_master1\n</code></pre> <p>Each <code>28-xxxxxxxxxxxx</code> folder represents a detected 1-Wire device.</p>"},{"location":"allsky_modules/interfaces/onewire.html#reading-a-ds18b20-temperature-sensor","title":"Reading a DS18B20 Temperature Sensor","text":"<p>You can read the temperature directly from the system:</p> <pre><code>cat /sys/bus/w1/devices/28-xxxxxxxxxxxx/w1_slave\n</code></pre> <p>Example output: </p><pre><code>aa 01 4b 46 7f ff 0c 10 5e : crc=5e YES\naa 01 4b 46 7f ff 0c 10 5e t=26000\n</code></pre><p></p> <p>The temperature is reported as: - <code>t=26000</code> \u2192 26.000\u00b0C</p>"},{"location":"allsky_modules/interfaces/pwm.html","title":"PWM","text":"<p>PWM (Pulse Width Modulation) is a method of controlling the power delivered to a device\u2014such as a fan or a dew heater\u2014by rapidly switching the power on and off instead of reducing the voltage.</p> <p>For a fan, PWM allows you to control the speed. The controller sends a square-wave signal (often at a fixed frequency), and by changing the duty cycle (the percentage of time the signal is \u201con\u201d during each cycle), the fan receives more or less average power:</p> <ul> <li>Low duty cycle \u2192 fan spins slowly</li> <li>High duty cycle \u2192 fan spins faster</li> <li>100% duty cycle \u2192 full speed</li> </ul> <p>For a dew heater, PWM controls the amount of heat produced. Rather than running continuously, the heater is turned on and off many times per second:</p> <ul> <li>Low duty cycle \u2192 gentle warming (prevents dew with minimal power)</li> <li>Higher duty cycle \u2192 more heat</li> <li>100% duty cycle \u2192 maximum heating</li> </ul> <p>Why PWM is used instead of lowering voltage</p> <ul> <li>More efficient: Less energy wasted as heat in the controller</li> <li>Better control: Fine-grained adjustment of speed/temperature</li> <li>Consistent performance: Devices still receive full voltage during \u201con\u201d pulses</li> <li>Reduced stress: Especially important for fans that may stall at low voltages</li> </ul> <p>In short, PWM lets you precisely and efficiently control output power without sacrificing performance or wasting energy.</p>"},{"location":"allsky_modules/interfaces/pwm.html#which-pins-should-you-use","title":"Which pins should you use","text":"<p>The best are pins 18 and 19</p>"},{"location":"allsky_modules/interfaces/pwm.html#setting-up-pwm-on-raspberry-pi-4-and-raspberry-pi-5","title":"Setting up PWM on Raspberry Pi 4 and Raspberry Pi 5","text":"<p>The Raspberry Pi provides hardware PWM (preferred for fans, heaters, and LEDs) and software PWM (less accurate, higher CPU usage). For driving a fan or dew heater, always use hardware PWM.</p>"},{"location":"allsky_modules/interfaces/pwm.html#hardware-pwm-vs-software-pwm","title":"Hardware PWM vs Software PWM","text":"<ul> <li> <p>Hardware PWM   Generated by dedicated hardware. Stable frequency, low CPU usage, ideal for power control.</p> </li> <li> <p>Software PWM   Generated by the CPU. Timing can jitter under load, not recommended for heaters or fans.</p> </li> </ul>"},{"location":"allsky_modules/interfaces/pwm.html#raspberry-pi-4-hardware-pwm-setup","title":"Raspberry Pi 4 \u2013 Hardware PWM Setup","text":"<p>The Raspberry Pi 4 uses the BCM2711 SoC, which provides two hardware PWM channels via the <code>bcm2835-pwm</code> driver.</p>"},{"location":"allsky_modules/interfaces/pwm.html#pwm-capable-gpios-pi-4","title":"PWM-capable GPIOs (Pi 4)","text":"GPIO Pin Channel GPIO12 Pin 32 PWM0 GPIO13 Pin 33 PWM1 GPIO18 Pin 12 PWM0 GPIO19 Pin 35 PWM1"},{"location":"allsky_modules/interfaces/pwm.html#enable-pwm-pi-4","title":"Enable PWM (Pi 4)","text":"<p>Edit the boot configuration file:</p> <pre><code>sudo nano /boot/config.txt\n</code></pre> <p>Add:</p> <pre><code>dtoverlay=pwm-2chan\n</code></pre> <p>Reboot:</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"allsky_modules/interfaces/pwm.html#raspberry-pi-5-hardware-pwm-setup","title":"Raspberry Pi 5 \u2013 Hardware PWM Setup","text":"<p>Raspberry Pi 5 introduces a new I/O controller (RP1), so PWM is provided by a different driver.</p>"},{"location":"allsky_modules/interfaces/pwm.html#enable-pwm-pi-5","title":"Enable PWM (Pi 5)","text":"<p>Edit:</p> <pre><code>sudo nano /boot/config.txt\n</code></pre> <p>Add:</p> <pre><code>dtoverlay=rp1-pwm\n</code></pre> <p>Reboot:</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"allsky_modules/interfaces/pwm.html#hardware-warning","title":"Hardware Warning","text":"<p>Never connect a fan or heater directly to a GPIO pin.</p> <p>Always use:</p> <ul> <li>A logic-level N-channel MOSFET (for heaters)  </li> <li>A suitable fan driver or transistor  </li> <li>A flyback diode (for inductive loads such as motors)</li> </ul>"},{"location":"developer_guide/available_fields.html","title":"Available Fields","text":""},{"location":"developer_guide/available_fields.html#available-fields","title":"Available fields","text":""},{"location":"developer_guide/available_fields.html#text-field","title":"Text field","text":"<p>This is the default field type and requires no extra values. This will display a text box allowing the user to enter detail</p> <pre><code>\"textfield\": {\n    \"required\": \"false\",\n    \"description\": \"Text Field\",\n    \"help\": \"Example help for the text field.\",\n    \"tab\": \"Field Types\"\n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#select-field","title":"Select field","text":"<p>This displays a drop down list allowing the user to select a value. The only additional value required is the \u2018values\u2019 option which is a comma separated list of the values to display in the dropdown</p> <pre><code>\"select\" : {\n    \"required\": \"false\",\n    \"description\": \"Select Field\",\n    \"help\": \"Example help for a select field.\",\n    \"tab\": \"Field Types\",\n    \"type\": {\n        \"fieldtype\": \"select\",\n        \"values\": \"None,value1,value2,value3\"\n    }                \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#ajax-select-field","title":"Ajax select field","text":"<p>This field type is main intended for use by the core Allsky development team. It displays a dopdown list of values obtained from an ajax request.</p> <pre><code>\"ajaxselect\": {\n    \"required\": \"false\",\n    \"description\": \"Ajax Select\",\n    \"tab\": \"Field Types\",\n    \"help\": \"returns data from an AJAX request.\",\n    \"type\": {\n        \"fieldtype\": \"ajaxselect\",\n        \"url\": \"includes/moduleutil.php?request=Onewire\",\n        \"placeholder\": \"Select a One Wire device\"\n    }           \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#checkbox-field","title":"Checkbox field","text":"<p>This displays a \u2018switch\u2019 that can be used to turn a value on or off. This will be presented in the params data as a boolean</p> <pre><code>\"checkbox\" : {\n    \"required\": \"false\",\n    \"description\": \"Checkbox Field\",\n    \"help\": \"Example help for the checkbox field.\",\n    \"tab\": \"Field Types\",\n    \"type\": {\n        \"fieldtype\": \"checkbox\"\n    }          \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#number-field","title":"Number field","text":"<p>This uses the HTML5 spinner control to allow a number to be entered. You can set the min, max and step values</p> <pre><code>\"number\" : {\n    \"required\": \"true\",\n    \"description\": \"Number Field\",\n    \"help\": \"Example help for the number field.\",\n    \"tab\": \"Field Types\",\n    \"type\": {\n        \"fieldtype\": \"spinner\",\n        \"min\": 0,\n        \"max\": 1000,\n        \"step\": 1\n    }          \n}\n</code></pre>"},{"location":"developer_guide/available_fields.html#i2c-field","title":"I\u00b2C Field","text":"<p>This displays a dialog allowing the user to select an I\u00b2C address. The dialog will display all detected devices on bus zero. A library, courtesy of Adafruit, is also available.</p> <pre><code>\"I\u00b2C\": {\n    \"required\": \"false\",\n    \"description\": \"I\u00b2C Address\",\n    \"help\": \"Example field to select an I\u00b2C address.\",\n    \"tab\": \"Field Types\",           \n    \"type\": {\n        \"fieldtype\": \"I\u00b2C\"\n    }            \n}\n</code></pre> <p></p> <p>The I\u00b2C device selection dialog</p> <p>When Allsky is first installed the I\u00b2C database has to be built. The \u2018Update Database\u2019 button in the dialog will rebuild the database.</p>"},{"location":"developer_guide/available_fields.html#gpio-field","title":"GPIO Field","text":"<p>This field will allow the user to select a gpio pin using a graphical interface. The user simple needs to click on the pin they require.</p> <pre><code>\"gpio\": {\n    \"required\": \"false\",\n    \"description\": \"GPIO Field\",\n    \"help\": \"Example help for the GPIO field.\",\n    \"tab\": \"Field Types 2\",\n    \"type\": {\n        \"fieldtype\": \"gpio\"\n    }           \n}\n</code></pre> <p></p> <p>The GPIO pin selection dialog</p>"},{"location":"developer_guide/available_fields.html#image-field","title":"Image Field","text":"<p>This allows the user to select or upload an image. Typically this would be used where a module requires a mask. This will allow the user to select the mask from the image library</p> <pre><code>\"image\" : {\n    \"required\": \"false\",\n    \"description\": \"Image Field\",\n    \"help\": \"Example help for the image field.\",\n    \"tab\": \"Field Types 2\",            \n    \"type\": {\n        \"fieldtype\": \"image\"\n    }                \n}\n</code></pre> <p></p> <p>The image selection dialog</p>"},{"location":"developer_guide/available_fields.html#region-of-interest-roi-field","title":"Region of Interest (ROI) Field","text":"<p>This allows the user to select a region Of Interest (ROI) in the image. This will then be available to the module. Typically, this would be used for things like sky brightness detection where you only want to run the calculation on a portion of the image</p> <pre><code>\"roi\": {\n    \"required\": \"false\",\n    \"description\": \"Region of Interest field\",\n    \"help\": \"Example help for the region of interest field.\",\n    \"tab\": \"Field Types 2\",            \n    \"type\": {\n        \"fieldtype\": \"roi\"\n    }            \n}\n</code></pre> <p></p> <p>The RIO selection dialog</p>"},{"location":"developer_guide/available_fields.html#variable-field","title":"Variable Field","text":"<p>If you need the user to select another variable from within Allsky then this field type will display the variable manager allowing a variable to be selected. The \u2018selectmode\u2019 option has to options \u2018single\u2019 or \u2018multi\u2019. This controls if the user can select a single variable or multiple. Multiple variables will be presented as a comma separated list.</p> <pre><code>\"variable\": {\n    \"required\": \"false\",\n    \"description\": \"Allsky Variable\",\n    \"help\": \"Allows and Allsky variable to be selected.\",\n    \"tab\": \"Field Types 2\",         \n    \"type\": {\n        \"fieldtype\": \"variable\",\n        \"selectmode\": \"multi\"\n    }                             \n}\n</code></pre> <p></p> <p>The Variable selection dialog</p>"},{"location":"developer_guide/available_fields.html#position-field","title":"Position Field","text":"<p>This field allows the user to select a position from a map. There are three additional parameters required for this field, all refer to the name of the value in the arguments section</p> <p>lat \u2013 The name of the argument to store the latitude in lon \u2013 The name of the argument to store the longitue in height \u2013 The name of the argument to store the height in, note height may not always be available when selecting on the map.</p> <pre><code>\"position\": {\n    \"description\": \"Position\",\n    \"help\": \"Allows latitude, longitude, and altitude to be selected from a map.\",\n    \"tab\": \"Field Types 2\",\n    \"lat\": {\n        \"id\": \"observer_lat\"\n    },\n    \"lon\": {\n        \"id\": \"observer_lon\"                \n    },\n    \"height\": {\n        \"id\": \"observer_height\"                \n    },\n    \"type\": {\n        \"fieldtype\": \"position\"\n    }     \n}\n</code></pre> <p></p> <p>The Position fields on a module dialog</p> <p></p> <p>The map location selection dialog</p>"},{"location":"developer_guide/available_fields.html#url-field","title":"URL Field","text":"<p>This field allows a url to be entered and validate using a button. The validation will check to ensure the url can be connected to.</p> <pre><code>\"url\": {\n    \"required\": \"true\",\n    \"tab\": \"Field Types 2\",          \n    \"description\": \"Allows a url to be entered and then checked to see if it can be reached\",\n    \"help\": \"Select a url.\",\n    \"type\": {\n        \"fieldtype\": \"url\"\n    }          \n}\n</code></pre> <p></p> <p>The URL entry fields</p>"},{"location":"developer_guide/available_fields.html#host-field","title":"Host field","text":"<p>This field allows a host and port number to ben entered. There are two additional parameters required for this field, all refer to the name of the value in the arguments section</p> <p>url \u2013 The url or ip address of the host port \u2013 The port number of the host</p> <pre><code>\"host\": {\n    \"description\": \"Host\",\n    \"help\": \"Allows a host and port to be entered.\",\n    \"tab\": \"Field Types 2\",\n    \"url\": {\n        \"id\": \"influxhost\"\n    },\n    \"port\": {\n        \"id\": \"influxport\"                \n    },\n    \"type\": {\n        \"fieldtype\": \"host\"\n    }     \n}\n</code></pre> <p></p> <p>The Host entry fields</p>"},{"location":"developer_guide/available_fields.html#graph-field","title":"Graph field","text":"<p>This is a special field type that rather than display a field adds a new tab to the modules settings to display the history for this module.</p> <p>For this field to work there are a few criteria that have to be met</p> <ul> <li>The module must be saving data to the database  </li> <li>The module must have a \u2018main\u2019 chart, see the charts section for more details</li> </ul> <p><code>\"graph\": {     \"required\": \"false\",     \"tab\": \"Graph\",     \"type\": {         \"fieldtype\": \"graph\"     } }</code></p> <p></p> <p>The Module Graph</p>"},{"location":"developer_guide/available_fields.html#notice-field","title":"Notice field","text":"<p>This field is used to display text on the modules dialog settings. The \u2018alert\u2019 settings utilise bootstraps alerts.</p> <pre><code>\"notice\" : {\n    \"tab\": \"Home\",      \n    \"message\": \"This module provides centralised temperature, humidity, and pressure data to other modules. This should be used in favour of dedicated sensors in any other modules which will be removed in a future release.\",\n    \"type\": {\n        \"fieldtype\": \"text\",\n        \"style\": {\n            \"width\": \"full\",\n            \"alert\": {\n                \"class\": \"info\"\n            }\n        }\n    }             \n}\n</code></pre> <p></p> <p>The Notice field</p>"},{"location":"developer_guide/available_fields.html#html-field","title":"HTML Field","text":"<p>This field is used to display HTML in a modules dialog. There are a few additional settings available.</p> <p>Source \u2013 Either local, where the html is read from the \u2018html\u2019 value or \u2018file\u2019 where the html is read from a file on the server using the \u2018file\u2019 value to define the source</p> <pre><code>\"html\": {\n    \"tab\": \"Help\",\n        \"source\": \"local\",\n                    \"html\": \"&lt;h1&gt;This help text is defined within the module&lt;/h1&gt;&lt;blockquote&gt;This help is hard coded into the modules config. This is ok for very short text but not good for longer text. For longer text use the file option in the field&lt;/blockquote&gt;&lt;p&gt;Bacon ipsum dolor amet cow \u2026&lt;p&gt;\",\n    \"type\": {\n        \"fieldtype\": \"html\"\n    }\n},\n\"html1\": {\n    \"tab\": \"Help 1\",\n        \"source\": \"file\",\n                    \"file\": \"help.html\",\n    \"type\": {\n        \"fieldtype\": \"html\"\n    }\n}\n</code></pre> <p></p> <p>The HTML field</p>"},{"location":"developer_guide/blocks.html","title":"Blocks","text":"<p>Blocks are designed to simplify the adding of fields to the overlay. Some modules, the solar system moduloe for example, produce a lot of variables that can be added to the overlay. Manually adding each one can be tedious.</p> <p>Blocks are predefined groups of variables defined in a column/row layout that can be added to the overlay together.</p> <p>Blocks are accessed from the variable managier when editing an overlay</p> <p></p> <p>The blocks tab in the variable manager</p>"},{"location":"developer_guide/blocks.html#blocks-structure","title":"Blocks structure","text":"<p>Blocks are json files that define one or more blocks that are made available in the variable manager. The following example is taken from the allsk_solarsystem module and defines two blocks related ot the sun</p> <ul> <li>The first block defines the variables to display for the Sun's timings  </li> <li>The second block defines the variables to display the position of the Sun</li> </ul> <p>There is no limit on the number of columns or rows that can be created in a block.</p> <p>Field spacing</p> <p>If you define multiple columns when the fields are added to the overlay the width will be set to the widest variable name. This is not ideal as the data may be muc narrower than the variable name. To get around this after the block has been added the user should select the variables in each column and line them up as required.</p> <ul> <li>The key name for each block can be anything, given the file is json it must be unique within the file  </li> <li>The name is displayed within the variable manager  </li> <li>The description is displayed within the variable manager</li> <li>The fields section contains each row and column. The keys to the rows are abritrary and the convention for the columns is colXX </li> <li>You do not have to use multiple columns you could just create a single column in each row that contains the field labale and data. Generally its better</li> <li>Each row does not have to have the same number of columns, see the top 5 adsb aircraft below</li> </ul> <pre><code>{\n    \"suntimesblock\": {\n        \"name\": \"Sun Times\",\n        \"description\": \"List of sun time data\",\n        \"fields\": {\n            \"sunrow1\": {\n                \"col1\": {\n                    \"text\": \"Dawn:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_DAWN}\"\n                }\n            },\n            \"sunrow2\": {\n                \"col1\": {\n                    \"text\": \"Sunrise:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_SUNRISE}\"\n                }\n            },\n            \"sunrow3\": {\n                \"col1\": {\n                    \"text\": \"Noon:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_NOON}\"\n                }\n            },\n            \"sunrow4\": {\n                \"col1\": {\n                    \"text\": \"Sunset:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_SUNSET}\"\n                }\n            },\n            \"sunrow5\": {\n                \"col1\": {\n                    \"text\": \"Dusk:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_DUSK}\"\n                }\n            }\n        }\n    },\n    \"sunpositionblock\": {\n        \"name\": \"Sun Position\",\n        \"description\": \"Position of the Sun\",\n        \"fields\": {\n            \"sunrow1\": {\n                \"col1\": {\n                    \"text\": \"Azimuth:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_AZIMUTH}\"\n                }\n            },\n            \"sunrow2\": {\n                \"col1\": {\n                    \"text\": \"Elevation:\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_SUN_ELEVATION}\"\n                }\n            }\n        }\n    }    \n}\n</code></pre> <p>The block defining the Sun position and timings</p> <pre><code>{\n    \"closest\": {\n        \"name\": \"Top 5 Aircraft\",\n        \"fields\": {\n            \"ac1row1\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT1}\"\n            },\n            \"ac1row2\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT1}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT1}\"\n                }\n            },\n            \"ac1row3\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT2}\"\n            },\n            \"ac1row4\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT2}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT2}\"\n                }\n            },\n            \"ac1row5\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT3}\"\n            },\n            \"ac1row6\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT3}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT3}\"\n                }\n            },\n            \"ac1row7\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT4}\"\n            },\n            \"ac1row8\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT4}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT4}\"\n                }\n            },\n            \"ac1row9\": {\n                \"text\": \"${AS_LONGTEXT_AIRCRAFT5}\"\n            },\n            \"ac1row10\": {\n                \"col1\": {\n                    \"text\": \"${AS_SHORT_ROUTE_AIRCRAFT5}\"\n                },\n                \"col2\": {\n                    \"text\": \"${AS_MEDIUM_ROUTE_AIRCRAFT5}\"\n                }\n            }                                              \n        }\n    }\n}\n</code></pre> <p>The block defining the top 5 ADSB aircraft, note the differeing columns per row</p>"},{"location":"developer_guide/blocks.html#distributing","title":"Distributing","text":"<p>To include blocks with your module simply create the config and add them to the blocks folder withing the module repository. The installer will then copy the charts to the correct location within Allsky.</p>"},{"location":"developer_guide/charts.html","title":"Charts","text":"<p>Charts allows you to display data from Allsky and modules within the WebUI</p> <p></p> <p>The Web UI Charts Page</p> <p>You can provide custom charts for use with your module. There are a few prerequisites to doing this</p> <ul> <li>You must be saving data in the database  </li> <li>You should have a good understanding of Highcharts although it is entirley possible to copy and modify existing charts of all you need are basic ones</li> </ul> <p>There are several charts types available</p> <ul> <li>Line - A line graph  </li> <li>Spline - A smoothed line chart  </li> <li>Gauge - A guage  </li> <li>Yes/No - A chart that displays Yes or No</li> </ul> <p>There other charts types supported all of which are standard Highcharts so please refer to the Highcharts documentation for details</p>"},{"location":"developer_guide/charts.html#chart-types","title":"Chart Types","text":""},{"location":"developer_guide/charts.html#line-charts","title":"Line Charts","text":"<p>Single axis line chart </p> <p> </p> <p>Multi axis line chart </p>"},{"location":"developer_guide/charts.html#single-axis","title":"Single axis","text":"<p>The following defines a line chart showing the total number of aircraft seen by the adsb module.</p> field Description icon Any valid fontawesome icon group The group the chart belongs to, when using the Chart Manager charts will appear in these groups title The charts title type The type of chart main If true then this chart will be used in the module manager to display the history table The table the chart is getting data from yAxis Only set the 'text' to the title of the Y axis series Set the variable to the Allsky Variable containing the data to chart <p>The 'main' chart</p> <p>When creating charts for your module it is strongly suggested that you create a chart with main set to true. There must only be one chart within your module with main set to true</p> <pre><code>{\n    \"icon\": \"fas fa-chart-line\",\n    \"group\": \"ADSB\",\n    \"title\": \"Total Aircraft\",\n    \"type\": \"line\",\n    \"main\": true,\n    \"table\": \"allsky_adsb\", \n    \"yAxis\": [\n        {\n            \"title\": {\n                \"text\": \"Total Aircraft\"\n            }\n        }\n    ],\n    \"series\": [\n        {\n            \"name\": \"Aircraft\",\n            \"variable\": \"AS_TOTAL_AIRCRAFT\"\n        }\n    ]\n}\n</code></pre>"},{"location":"developer_guide/charts.html#multiple-axis","title":"Multiple axis","text":"<p>It is possible to create a chart with multiple Y axis.</p> <p>When using multiple axis there are a few things to bear in mind. The opposite setting in the yAxis forces the axis to the other axis. The yAxis value in the series defines which axis the data will appear against</p> <pre><code>{\n    \"icon\": \"fas fa-chart-line\",\n    \"group\": \"Environment\",\n    \"title\": \"Dew Heater Temp/Humidity\",\n    \"type\": \"line\",\n    \"table\": \"allsky_dewheater\",\n    \"main\": true,\n    \"yAxis\": [\n        {\n            \"title\": {\n                \"text\": \"Temperature\"\n            }\n        },\n        {\n            \"title\": {\n                \"text\": \"Humidity\"\n            },\n            \"opposite\": true\n        }\n    ],\n    \"series\": [\n        {\n            \"name\": \"Temperature\",\n            \"yAxis\": 0,\n            \"variable\": \"AS_DEWCONTROLAMBIENT\"\n        },\n        {\n            \"name\": \"Humidity\",\n            \"yAxis\": 1,\n            \"variable\": \"AS_DEWCONTROLHUMIDITY\"\n        }\n    ]\n}\n</code></pre>"},{"location":"developer_guide/charts.html#spline-charts","title":"Spline Charts","text":"<p>The configuration for a spline chart is identical to a line chart except the type is set to spline.</p>"},{"location":"developer_guide/charts.html#gauges","title":"Gauges","text":"<p>An example Gauge </p> <p>Gauges can be built using a very simple config as below.</p> <pre><code>{\n    \"title\": \"Dew Heater PWM %\",\n    \"icon\": \"fa-solid fa-gauge\",\n    \"type\": \"gauge\",\n    \"group\": \"Environment\",\n    \"table\": \"allsky_dewheater\",\n    \"series\": [\n        {\n            \"name\": \"PWM %\",\n            \"variable\": \"AS_DEWCONTROLPWMPERCENT\"\n        }\n    ]\n}\n</code></pre> <p>Gauges can also be overriden using Highcharts to customise the view</p> <p> </p> <p>An example custom Gauge </p> <p>The full extent of customisation is beyon the scope o this document. Please refer to the Highcharts documentation for details </p><pre><code>{\n    \"title\": \"Total Aircraft\",\n    \"icon\": \"fa-solid fa-gauge\",\n    \"type\": \"gauge\",\n    \"group\": \"ADSB\",\n    \"table\": \"allsky_adsb\",\n    \"hc\": {\n        \"yAxis\": [\n            {\n                \"min\": 0,\n                \"max\": 50,\n                \"tickInterval\": 10,\n                \"tickPosition\": \"inside\",\n                \"lineWidth\": 0,\n                \"labels\": {\n                    \"distance\": 20,\n                    \"style\": {\n                        \"fontSize\": \"12px\"\n                    }\n                },\n                \"plotBands\": [\n                    {\n                        \"from\": 0,\n                        \"to\": 200,\n                        \"color\": \"#2ecc71\",\n                        \"thickness\": 30\n                    }\n                ]\n            }\n        ],\n        \"pane\": {\n            \"startAngle\": -90,\n            \"endAngle\": 90,\n            \"center\": [\n                \"50%\",\n                \"75%\"\n            ],\n            \"size\": \"110%\",\n            \"background\": null\n        }\n    },\n    \"series\": [\n        {\n            \"name\": \"Total Aircraft\",\n            \"variable\": \"AS_TOTAL_AIRCRAFT\",\n            \"options\": {\n                \"tooltip\": {\n                    \"valueSuffix\": \"\"\n                },\n                \"dataLabels\": {\n                    \"format\": \"{y}\"\n                },\n                \"dial\": {\n                    \"radius\": \"80%\",\n                    \"baseWidth\": 16,\n                    \"baseLength\": \"0%\",\n                    \"rearLength\": \"0%\"\n                },\n                \"pivot\": {\n                    \"radius\": 8\n                }\n            }\n        }\n    ]\n}\n</code></pre><p></p>"},{"location":"developer_guide/charts.html#yesno-charts","title":"Yes/No Charts","text":"<p>These simply display text based upon a thruthy value.</p> <p> </p> <p>An example Yes / No Chart </p> <p>The important values here are the truetext, falsetext and the associated colour fields</p> <pre><code>{\n    \"icon\": \"fas fa-lightbulb\",\n    \"group\": \"Environment\",\n    \"title\": \"Dew Heater State\",\n    \"type\": \"yesno\",\n    \"table\": \"allsky_dewheater\",\n    \"hc\": {\n      \"yesNo\": {\n        \"trueText\": \"On\",\n        \"falseText\": \"Off\",\n        \"trueColor\": \"#2ecc71\",\n        \"falseColor\": \"#e74c3c\",\n        \"fontSize\": \"72px\"\n      }\n    },        \n    \"series\": [\n        {\n            \"name\": \"Heater State\",\n            \"yAxis\": 0,\n            \"variable\": \"AS_DEWCONTROLHEATERINT\"\n        }\n    ]\n}\n</code></pre>"},{"location":"developer_guide/charts.html#distributing","title":"Distributing","text":"<p>To include charts with your module simply create the config and add them to the charts folder withing the module repository. The installer will then copy the charts to the correct location within Allsky.</p>"},{"location":"developer_guide/contributing.html","title":"Contributing","text":""},{"location":"developer_guide/contributing.html#contributing","title":"CONTRIBUTING","text":"<p>Thank you for your interest in contributing to the Allsky Project. This document explains how to contribute to the repositories within the AllskyTeam GitHub organisation, including:</p> <ul> <li>allsky (the core server, backend, UI, and processing pipeline)</li> <li>allsky-modules (the official library of Allsky extra modules)</li> </ul> <p>Contributions of all kinds are welcome: bug fixes, new modules, documentation, UI improvements, or backend enhancements.</p>"},{"location":"developer_guide/contributing.html#1-repository-overview","title":"1. Repository Overview","text":""},{"location":"developer_guide/contributing.html#allsky","title":"allsky","text":"<p>Contains core Allsky and core modules.</p>"},{"location":"developer_guide/contributing.html#allsky-modules","title":"allsky-modules","text":"<p>Contains individual processing modules used by Allsky (post-processing, device control, AI tools, weather sensors, ADS-B, MQTT, etc.)</p> <p>If your contribution affects modules, submit it to allsky-modules. If your contribution affects the core server, UI, or module runner, submit it to allsky.</p>"},{"location":"developer_guide/contributing.html#2-how-to-contribute","title":"2. How to Contribute","text":""},{"location":"developer_guide/contributing.html#step-1-fork-the-repository","title":"Step 1: Fork the repository","text":"<p>Click \"Fork\" on GitHub, then clone your fork:</p> <pre><code>git clone https://github.com/&lt;your-username&gt;/&lt;repo&gt;.git\ncd &lt;repo&gt;\n</code></pre>"},{"location":"developer_guide/contributing.html#step-2-create-a-branch","title":"Step 2: Create a branch","text":"<pre><code>git checkout -b feature/my-feature\n</code></pre>"},{"location":"developer_guide/contributing.html#step-3-make-your-changes","title":"Step 3: Make your changes","text":""},{"location":"developer_guide/contributing.html#step-4-push-and-open-a-pull-request","title":"Step 4: Push and open a Pull Request","text":"<pre><code>git push origin feature/my-feature\n</code></pre>"},{"location":"developer_guide/contributing.html#3-coding-standards","title":"3. Coding Standards","text":""},{"location":"developer_guide/contributing.html#python","title":"Python","text":"<ul> <li>PEP8</li> <li>Type hints</li> <li>Google-style docstrings</li> </ul>"},{"location":"developer_guide/contributing.html#bash","title":"Bash","text":"<p>Use shellcheck to validate bash scripts</p>"},{"location":"developer_guide/contributing.html#javascript","title":"JavaScript","text":"<ul> <li>ES6+</li> </ul>"},{"location":"developer_guide/contributing.html#4-documentation-standards","title":"4. Documentation Standards","text":"<p>All new features must update docs under /docs.</p> <p>Example module README:</p> <pre><code># Module Name\n\n## Description\n...\n\n## Configuration\n| Setting | Description | Default |\n|--------|-------------|---------|\n\n## Example Output\n</code></pre>"},{"location":"developer_guide/contributing.html#5-testing","title":"5. Testing","text":""},{"location":"developer_guide/contributing.html#allsky_1","title":"allsky","text":"<ul> <li>Server starts</li> <li>API responds</li> <li>Overlay works</li> </ul>"},{"location":"developer_guide/contributing.html#allsky-modules_1","title":"allsky-modules","text":"<pre><code>python3 allsky_module_test.py --module &lt;name&gt;\n</code></pre>"},{"location":"developer_guide/contributing.html#6-pull-request-requirements","title":"6. Pull Request Requirements","text":"<ul> <li>Description</li> <li>Linked Issue</li> <li>Screenshots for UI changes</li> </ul>"},{"location":"developer_guide/contributing.html#7-security-reporting","title":"7. Security Reporting","text":"<p>Do not open public issues for vulnerabilities.</p>"},{"location":"developer_guide/contributing.html#8-thank-you","title":"8. Thank You","text":"<p>Thank you for contributing to Allsky.</p>"},{"location":"developer_guide/database.html","title":"Allsky Database","text":"<p>A module can store data in the Allsky database, primarily this is used in the creation of charts but could also be used for other things</p> <p>The database is configured at installation and in the main Allsky setting. Currently there are two available database types</p> <ul> <li>SQLite3 - SQLite3 is a lightweight, serverless, self-contained SQL database engine that stores the entire database in a single file and requires no separate server process</li> <li>MySQL - MySQL is a popular open-source relational database management system (RDBMS) that uses SQL, supports multi-user access, and runs as a dedicated client\u2013server database server. We actually use MariaDb but most people will probably have heard of MySQL !</li> </ul> <p>The preference is always to use SQLite3, MySQL is provided for advanced users that may already have a MySQL instance they wish to use. For the rest of this documentation we will assume you are using SQLite3.</p> <p>Tip</p> <p>Should you wish to change the database you can either use the main settings or the <code>setup_database.sh</code> script in <code>~/allsky/scripts/utilities</code></p>"},{"location":"developer_guide/database.html#database-structure","title":"Database Structure","text":"<p>The database conrtains a series of tables, typically a table is named after the module that writes data to it, it is possible for modules two write data to other tables if required.</p> <p>Each table consists of two predefined columns</p> <ul> <li>id - This is the primary key for the row</li> <li>timestamp - This is the time the row was created</li> </ul> <p>Why have both? For modules that run in the capture pipelines, day and night, typically the primary key will be the time the last image was captured. For other modules its just a unique id. This mechanism allows other modules that run in the capture pipelines to save their data using the same primary key as the last image captured, this is useful for aligning data on charts.</p>"},{"location":"developer_guide/database.html#the-meta-data-database-section","title":"The Meta Data Database Section","text":"<p>The database section controls how data generated byt he module is saved to the database.</p> Name Description enabled (Optional) \u201ctrue\u201d if this module will write data to the database. Normally you would set this to true, typically on setting it to false when developing or testing table (Optional) If enable then this field IS required and contains the name of the table to write data to. The convention is the module name. pk (Optional) If enable then this field IS required and contains the name of the primary key for the database. This should always be 'id' pk_source (Optional) If enable then this field IS required and contains the variable that the primary key (id) will be obtained from, If omitted the last ime timestamp or current timestamp will be used pk_type (Optional) If enable then this field IS required and contains the primary key. Set this to \u2018int\u2019 Include_all (Optional) If enable then this field IS required and determines if all extra data values are written to the database. If \u201cfalse\u201d then you can specify which data is written against the extra data fields definitions time_of_day_save (Optional) Determines how  data is saved for each pipeline. You may not want to save data during the daytime for example"},{"location":"developer_guide/database.html#some-examples","title":"Some examples","text":"<p>NOTE: In all of these examples only the <code>extradata</code> prtion of the <code>meta_data</code> is shown</p>"},{"location":"developer_guide/database.html#example-1-full-save","title":"Example 1 - Full save","text":"<pre><code>  meta_data = { \n    \"extradata\": {    \n      \"database\": {\n        \"enabled\": \"True\",\n        \"table\": \"allsky_example3\",\n        \"include_all\": \"true\",\n        \"pk\": \"id\",\n        \"pk_type\": \"int\",    \n        \"time_of_day_save\": {\n          \"day\": \"always\",\n          \"night\": \"always\",\n          \"nightday\": \"always\",\n          \"daynight\": \"always\",\n          \"periodic\": \"always\"\n        }      \n      }\n    }\n  }\n</code></pre> <p>This example;</p> <ul> <li>Saves all data to the database defined in the <code>values</code> section of the <code>extradata</code> secion of the <code>meta_data</code> !!!</li> <li>Uses a table called <code>allsky_example3</code></li> <li>Uses 'id' as the name of the primary key for the table</li> <li>Defines the primary key type as an integer</li> <li>Saves the data for all pipelines</li> </ul>"},{"location":"developer_guide/database.html#example-2-limiting-pipelines","title":"Example 2 - Limiting Pipelines","text":"<pre><code>  meta_data = { \n    \"extradata\": {    \n      \"database\": {\n        \"enabled\": \"True\",\n        \"table\": \"allsky_example3\",\n        \"include_all\": \"true\",\n        \"pk\": \"id\",\n        \"pk_type\": \"int\",    \n        \"time_of_day_save\": {\n          \"day\": \"never\",\n          \"night\": \"always\",\n          \"nightday\": \"never\",\n          \"daynight\": \"never\",\n          \"periodic\": \"never\"\n        }      \n      }\n    }\n  }\n</code></pre> <p>This example;</p> <ul> <li>Saves all data to the database defined in the <code>values</code> section of the <code>extradata</code> secion of the <code>meta_data</code> !!!</li> <li>Uses a table called <code>allsky_example3</code></li> <li>Uses 'id' as the name of the primary key for the table</li> <li>Defines the primary key type as an integer</li> <li>Only saves data at night</li> </ul>"},{"location":"developer_guide/database.html#example-3-setting-the-primary-key","title":"Example 3 - Setting the primary key","text":"<pre><code>  meta_data = { \n    \"extradata\": {    \n      \"database\": {\n        \"enabled\": \"True\",\n        \"table\": \"allsky_example3\",\n        \"include_all\": \"true\",\n        \"pk\": \"id\",\n        \"pk_source\": \"image_timestamp\",\n        \"pk_type\": \"int\",    \n        \"time_of_day_save\": {\n          \"day\": \"never\",\n          \"night\": \"always\",\n          \"nightday\": \"never\",\n          \"daynight\": \"never\",\n          \"periodic\": \"never\"\n        }      \n      }\n    }\n  }\n</code></pre> <p>This example;</p> <ul> <li>Saves all data to the database defined in the <code>values</code> section of the <code>extradata</code> secion of the <code>meta_data</code> !!!</li> <li>Uses a table called <code>allsky_example3</code></li> <li>Uses 'id' as the name of the primary key for the table</li> <li>Defines the primary key type as an integer</li> <li>Uses the last captured images time stamp as the primary key, by setting <code>pk_source</code> to the Allsky variable <code>image_timestamp</code></li> <li>Only saves data at night</li> </ul>"},{"location":"developer_guide/database.html#example-4-limiting-variables","title":"Example 4 - Limiting Variables","text":"<pre><code>  meta_data = { \n    \"extradata\": {    \n      \"database\": {\n        \"enabled\": \"True\",\n        \"table\": \"allsky_example3\",\n        \"include_all\": \"false\",\n        \"pk\": \"id\",\n        \"pk_source\": \"image_timestamp\",\n        \"pk_type\": \"int\",    \n        \"time_of_day_save\": {\n          \"day\": \"never\",\n          \"night\": \"always\",\n          \"nightday\": \"never\",\n          \"daynight\": \"never\",\n          \"periodic\": \"never\"\n        }      \n      },\n      \"values\": {\n        \"AS_EXAMPLE3_TEMP\": {\n          \"name\": \"${EXAMPLE3_TEMP}\",\n          \"format\": \"{dp=2|deg}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example 3 Temp from Openweather API\",\n          \"type\": \"number\",\n          \"dbtype\": \"float\",     \n          \"database\": {\n            \"include\" : \"true\"\n          }          \n        },\n        \"AS_EXAMPLE3_HUMIDITY\": {\n          \"name\": \"${EXAMPLE3_HUMIDITY}\",\n          \"format\": \"{dp=0|per}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example 3 Humidity from Openweather API\",\n          \"type\": \"number\"\n        }        \n      }     \n    }\n  }\n</code></pre> <p>This example;</p> <ul> <li>Only saves the <code>AS_EXAMPLE3_TEMP</code> variable by setting the <code>include</code> value in the fields <code>database</code> values to true</li> <li>Uses a table called <code>allsky_example3</code></li> <li>Uses 'id' as the name of the primary key for the table</li> <li>Defines the primary key type as an integer</li> <li>Uses the last captured images time stamp as the primary key, by setting <code>pk_source</code> to the Allsky variable <code>image_timestamp</code></li> <li>Only saves data at night</li> </ul>"},{"location":"developer_guide/database.html#writing-across-tables","title":"Writing across tables","text":"<p>It is possible for a module to write its data to another table. This can be handy for adding columns to existing tables. For example you may have several modules that write the data to the same table</p> <p>Warning</p> <p>It is not advised to add your own data to core allsky tables. This data could be lost during an upgrade</p> <pre><code>  meta_data = { \n    \"extradata\": {    \n      \"database\": {\n        \"enabled\": \"True\",\n        \"table\": \"allsky_example3\",\n        \"include_all\": \"false\",\n        \"pk\": \"id\",\n        \"pk_source\": \"image_timestamp\",\n        \"pk_type\": \"int\",    \n        \"time_of_day_save\": {\n          \"day\": \"never\",\n          \"night\": \"always\",\n          \"nightday\": \"never\",\n          \"daynight\": \"never\",\n          \"periodic\": \"never\"\n        }      \n      },\n      \"values\": {\n        \"AS_EXAMPLE3_TEMP\": {\n          \"name\": \"${EXAMPLE3_TEMP}\",\n          \"format\": \"{dp=2|deg}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example 3 Temp from Openweather API\",\n          \"type\": \"number\",\n          \"dbtype\": \"float\",     \n          \"database\": {\n            \"include\" : \"true\",\n            \"table\": \"allsky_whatever\"\n          }          \n        },\n        \"AS_EXAMPLE3_HUMIDITY\": {\n          \"name\": \"${EXAMPLE3_HUMIDITY}\",\n          \"format\": \"{dp=0|per}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example 3 Humidity from Openweather API\",\n          \"type\": \"number\"\n        }        \n      }     \n    }\n  }\n</code></pre> <p>This example;</p> <ul> <li>Only saves the <code>AS_EXAMPLE3_TEMP</code> variable by setting the <code>include</code> value in the fields <code>database</code> values to true</li> <li>Uses a table called <code>allsky_example3</code> BUT writes the temperature to the <code>allsky_whatever</code> table.</li> <li>Uses 'id' as the name of the primary key for the table</li> <li>Defines the primary key type as an integer</li> <li>Uses the last captured images time stamp as the primary key, by setting <code>pk_source</code> to the Allsky variable <code>image_timestamp</code></li> <li>Only saves data at night</li> </ul>"},{"location":"developer_guide/database.html#database-purging","title":"Database Purging","text":"<p>To prevent the database growing over time a mechanism is provided for purging data from the database. There are several ways to specify the length of time data shoud be kept</p> <ul> <li>The default is the <code>Days To Keep</code> setting from the main Allsky settings</li> <li>A module can create a small json file in its repository to override this. The file will determine how long data is kept for</li> </ul>"},{"location":"developer_guide/database.html#module-specific-purging","title":"Module specific Purging","text":"<p>To purge data for a module create the <code>db</code> directory in the module repository and add a file called <code>db_data.json</code></p>"},{"location":"developer_guide/database.html#basic-purging","title":"Basic purging","text":"<pre><code>{\n  \"allsky_example3\": {\n    \"purge_days\": {\n      \"source_type\": \"settings\",\n      \"source_name\": \"daystokeep\"\n    }\n  }\n}\n</code></pre> <p>In this example the purging is based off of the <code>Days To Keep</code> Allsky setting</p>"},{"location":"developer_guide/database.html#defined-purging","title":"Defined purging","text":"<pre><code>{\n  \"allsky_example3\": {\n    \"purge_days\": 14\n  }\n}\n</code></pre> <p>In this example the purging will be set to 14 days.</p>"},{"location":"developer_guide/dependencies.html","title":"Dependencies","text":""},{"location":"developer_guide/dependencies.html#the-installerjson-file","title":"The installer.json file","text":"<p>This file allows you to configure dependencies and post installation scripts for the module.</p> <pre><code>{\n    \"requirements\": [\n        \"unidecode\"\n    ],\n    \"packages\": [\n        \"somepackage\"\n    ],\n    \"post-install\": {\n        \"run\": \"{install_data_dir}/tools/build_database.py\" \n    }\n}\n</code></pre> <p>There are three sections available in this file</p> <ul> <li>Requirements \u2013 Used to install any Python dependencies  </li> <li>Packages \u2013 Used to install any apt packages  </li> <li>Post-install \u2013 Any scripts to run after the installation is complete  </li> </ul> <p>These are covered in more detail in the following sections</p>"},{"location":"developer_guide/dependencies.html#python-dependencies","title":"Python Dependencies","text":"<p>If your module requires Python dependencies then first check if the dependencies are already available.</p> <p>If the dependencies are not available then inside your module folder create the installer.json file and add the dependencies to it.</p> <p>This file is passed to pip using the -r option so follows all of the normal conventions for installing python modules.</p> <p>Any installed dependencies will be added to the main Allsky virtual python environment, found in ~/allsky/venv</p> <p>numpy</p> <p>NEVER attempt to install numpy in your dependencies. Doing so may break Allsky. We use Numpy version 2 or above so you can not use any libraries that require numpy version 1</p> <p>Legacy Requirements file</p> <p>Some modules use a requirements.txt file \u2013 This is the legacy method for installing dependencies and must not be used.</p>"},{"location":"developer_guide/dependencies.html#apt-packages","title":"APT Packages","text":"<p>If your module requires addition apt packages to be installed then create or amend the installer.json file to add the packages</p> <p>The module installer will install these packages using apt so you can use the apt options for the packages, like setting versions etc</p> <p>Legacy Reqpackagesuirements file</p> <p>Some modules use a packages.txt file \u2013 This is the legacy method for installing dependencies and must not be used.</p>"},{"location":"developer_guide/dependencies.html#additional-data","title":"Additional Data","text":"<p>If your module requires additional data then create a folder inside the module folder with the same name as the module. Inside this folder place any data you require.</p> <p>The module installer will then copy this code into the main Allsky folder. You will need to construct the path to this folder yourself in your code.</p> <p>The allsky_adsb module is a good example to look at for this type of functionality.</p>"},{"location":"developer_guide/dependencies.html#install-scripts","title":"Install scripts","text":"<p>If you need to run any post installation code, so setup data for example then place details of the script to call int eh post-install section of the installer.json file.</p> <p>In the example above the script has been placed in the allsky_adsb/tools folder. This will be copied to the main Allsky folder during installation. The installer file references {install_data_dir} which the installer will replace with the real folder.</p>"},{"location":"developer_guide/dependencies.html#charts","title":"Charts","text":"<p>See the charts section for more details</p>"},{"location":"developer_guide/dependencies.html#blocks","title":"Blocks","text":"<p>See the blocks section for more details</p>"},{"location":"developer_guide/folder_structure.html","title":"Folder Strucuture","text":""},{"location":"developer_guide/folder_structure.html#module-folder-structure","title":"Module folder structure","text":"<p>There are two relevant folder structures, that used when developing a module and that used after a module has been installed.</p>"},{"location":"developer_guide/folder_structure.html#repository-structure","title":"Repository Structure","text":"<p>When developing a new module the following folder structure is required, this is taken from the Allsky ADSB module as an example</p> <pre><code>allsky_adsb                             Top level folder, the module name\n\u251c\u2500\u2500 allsky_adsb                         Data folder, copied into core Allsky. Named the same as the module\n\u2502   \u251c\u2500\u2500 adsb_data                       This can be any data thats needed folder name is only relevant to your code\n\u2502   \u2514\u2500\u2500 tools                           A folder to hold some post install tools\n\u2502       \u2514\u2500\u2500 build_database.py           The post install tool, referenced in the installer.json file\n\u251c\u2500\u2500 allsky_adsb.py                      The actual module itself\n\u251c\u2500\u2500 blocks                              Folder to hold blocks\n\u2502   \u251c\u2500\u2500 aircraft1.json\n\u2502   \u251c\u2500\u2500 aircraft2.json\n\u2502   \u251c\u2500\u2500 aircraft3.json\n\u2502   \u251c\u2500\u2500 aircraft4.json\n\u2502   \u251c\u2500\u2500 aircraft5.json\n\u2502   \u251c\u2500\u2500 closest.json\n\u2502   \u2514\u2500\u2500 top5.json\n\u251c\u2500\u2500 charts                            Folder to hold charts\n\u2502   \u251c\u2500\u2500 total_aircraft_chart.json\n\u2502   \u2514\u2500\u2500 total_aircraft_gauge.json\n\u251c\u2500\u2500 db                                Folder for database config\n\u2502   \u2514\u2500\u2500 db_data.json                  The database config, mainly handles how the database is purged\n\u251c\u2500\u2500 installer.json                    Installtion details file\n\u251c\u2500\u2500 reuirements.txt                   LEGACY file do not use\n\u251c\u2500\u2500 packages.txt                      LEGACY file do not use\n\u2514\u2500\u2500 README.md                         Readme file for people browsing the repo\n</code></pre>"},{"location":"developer_guide/folder_structure.html#installed-structure","title":"Installed structure","text":"<p>Once a module has been installed by the moduel installer the files are copied into the main Allsky folder. The base folder for extra modules is</p> <pre><code>~/allsky/config/myfiles/modules\n</code></pre> <pre><code>modules                                       The modules folder containing all extra modules\n\u251c\u2500\u2500 allsky_adsb.py                            The adsb module\n\u251c\u2500\u2500 moduledata                                Module data folder\n\u2502   \u251c\u2500\u2500 blocks                                Blocks folder, each module has its own folder\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       The blocks for the adsb module\n\u2502   \u2502       \u251c\u2500\u2500 aircraft1.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft2.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft3.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft4.json\n\u2502   \u2502       \u251c\u2500\u2500 aircraft5.json\n\u2502   \u2502       \u251c\u2500\u2500 closest.json\n\u2502   \u2502       \u2514\u2500\u2500 top5.json\n\u2502   \u251c\u2500\u2500 charts                                Charts folder, each module has its own folder\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       The charts for the adsb module\n\u2502   \u2502       \u251c\u2500\u2500 total_aircraft_chart.json\n\u2502   \u2502       \u2514\u2500\u2500 total_aircraft_gauge.json\n\u2502   \u251c\u2500\u2500 data                                  Data folder, each module has its own folder\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       The data folder for the adsb module, copied from the repo\n\u2502   \u2502       \u251c\u2500\u2500 adsb_data\n\u2502   \u2502       \u2514\u2500\u2500 tools\n\u2502   \u2502           \u2514\u2500\u2500 build_database.py\n\u2502   \u251c\u2500\u2500 info\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb\n\u2502   \u251c\u2500\u2500 installer                             Installer info for each module\n\u2502   \u2502   \u2514\u2500\u2500 allsky_adsb                       Installer info for the adsb module\n\u2502   \u2502       \u2514\u2500\u2500 installer.json\n\u2502   \u2514\u2500\u2500 logfiles                              Logs created during installation\n\u2502       \u2514\u2500\u2500 allsky_adsb\n\u2502           \u2514\u2500\u2500 dependencies.log\n\u2514\u2500\u2500 __pycache__                               Compiled python code\n</code></pre>"},{"location":"developer_guide/folder_structure.html#how-allsky-finds-modules","title":"How Allsky finds modules","text":"<p>Allsky ships with core modules which can then be extended by installing the extra modules. Once installed Allsky will search for modules in the following order</p> <ol> <li>The legacy custom modules folder <code>/opt/allsky/modules</code></li> <li>The new custom modules folder <code>~/allsky/config/myfiles/modules</code></li> <li>Core Allsky <code>~/allsky/scripts/modules</code></li> </ol> <p>This mechanism allows you to implement custom versions of the core Allsky modules should you wish to do so.</p> <p>Overriding Core Allsky Modules</p> <p>Before attempting to override a core module you must understand the existing functionality of the module. Failure to understand the modules could result in Allsky failing</p> <p>Legacy Module Locations</p> <p>version v2024.12.06_01 and prior of Allsky stored all modules and module data in the ``/opt/allsky/modules<code>folder. This has now been deprecated and all modules and associated data are stored with the</code>~/allsky``` folder.</p>"},{"location":"developer_guide/glossary.html","title":"Glossary","text":""},{"location":"developer_guide/glossary.html#glossary","title":"Glossary","text":"Item Description Module Python code used to extend the functionality of Allsky Event An event, daytime / nighttime image capture, day to night or night to day transition, periodic Flow A series of modules grouped together and triggered by an event Pipeline Same as a flow Block A small json file that defines the layout of variables on the overlay manager"},{"location":"developer_guide/introduction.html","title":"Introduction","text":""},{"location":"developer_guide/introduction.html#introduction","title":"Introduction","text":"<p>The Allsky system is designed to be modular, extensible, and developer-friendly \u2014 allowing you to add new capabilities without modifying the core software. Modules are self-contained units that integrate seamlessly with the Allsky environment, providing everything from hardware drivers (I\u00b2C sensors, focusers, LED displays) to data processors (star counting, meteor detection, image overlays, AI classification) and even UI extensions for the Allsky Web Portal.</p> <p>By developing modules, you can easily:</p> <ul> <li>Extend Allsky\u2019s functionality without touching its core codebase</li> <li>Integrate custom hardware, APIs, or image-processing pipelines</li> <li>Add new graphs, data outputs, or automation routines</li> <li>Reuse shared features like configuration management, logging, and database access</li> </ul> <p>The Allsky Module SDK provides ready-made helpers for:</p> <ul> <li>Logging and debugging \u2014 integrated with the main Allsky log system.</li> <li>Configuration management \u2014 read and write module-specific settings safely.</li> <li>Database access \u2014 use ALLSKYDATABASEMANAGER for structured data storage.</li> <li>Environment discovery \u2014 access paths, devices, and runtime state from environment variables.</li> <li>Graph and UI integration \u2014 register module outputs as live charts, overlays, or dashboard widgets.</li> </ul> <p>With these tools, creating a new module becomes as simple as defining its purpose, implementing your logic, and declaring how it interacts with the rest of the system. Whether you\u2019re adding a temperature sensor, experimenting with meteor detection algorithms, or building a smart autofocus routine \u2014 the Allsky module system provides a consistent, safe, and maintainable framework for innovation.</p> <p>Allsky is shipoped with a core set of modules, the exta modules when installed extend this functionality.</p>"},{"location":"developer_guide/meta_data_example.html","title":"Meta Data Example","text":""},{"location":"developer_guide/meta_data_example.html#example-meta-data","title":"Example Meta Data","text":"<pre><code>    meta_data = {\n        \"name\": \"ADS-B Aircraft Tracking Data\",\n        \"description\": \"Provide aircraft data for display on images\",\n        \"module\": \"allsky_adsb\",    \n        \"version\": \"v2.0.0\",\n        \"group\": \"Data Capture\",\n        \"events\": [\n            \"periodic\",\n            \"day\",\n            \"night\"\n        ],\n        \"enabled\": \"false\",    \n        \"experimental\": \"true\",\n        \"testable\": \"true\",  \n        \"centersettings\": \"false\",\n        \"extradatafilename\": \"allsky_adsb.json\", \n        \"extradata\": {\n            \"database\": {\n                \"enabled\": \"True\",\n                \"table\": \"allsky_adsb\",\n                \"pk\": \"id\",\n                \"pk_type\": \"int\",\n                \"include_all\": \"false\",       \n                \"time_of_day_save\": {\n                    \"day\": \"always\",\n                    \"night\": \"always\",\n                    \"nightday\": \"always\",\n                    \"daynight\": \"always\",\n                    \"periodic\": \"enabled\"\n                }      \n            },      \n            \"info\": {\n                \"count\": 20,\n                \"firstblank\": \"false\"\n            },\n            \"values\": {\n                \"AS_TOTAL_AIRCRAFT\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"number\",                \n                    \"description\": \"Total Aircraft\",\n                    \"dbtype\": \"int\",\n                    \"database\": {\n                        \"include\" : \"true\"\n                    }     \n                },\n                \"AS_DISTANCE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{allsky}\",\n                    \"type\": \"distance\",            \n                    \"description\": \"Aircraft ${COUNT} distance\"\n                },    \n                \"AS_AZIMUTH_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{dp=2|deg}\",     \n                    \"type\": \"azimuth\",                \n                    \"description\": \"Aircraft ${COUNT} azimuth\"\n                },\n                \"AS_ELEVATION_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{dp=2|deg}\",     \n                    \"type\": \"elevation\",                \n                    \"description\": \"Aircraft ${COUNT} elevation\"\n                },\n                \"AS_ALTITUDE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{flightlevel}\",\n                    \"type\": \"altitude\",                \n                    \"description\": \"Aircraft ${COUNT} altitude\"\n                },                        \n                \"AS_TYPE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} type\"\n                },              \n                \"AS_OWNER_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} owner\"\n                },\n                \"AS_REGISTRATION_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} registration\"\n                },\n                \"AS_MANUFACTURER_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} manufacturer\"\n                },\n                \"AS_MILITARY_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"format\": \"{yesno}\",     \n                    \"type\": \"bool\",                \n                    \"description\": \"Aircraft ${COUNT} military flag\"\n                },\n                \"AS_TEXT_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",\n                    \"description\": \"Aircraft ${COUNT} short text (reg, bearing)\"\n                },\n                \"AS_LONGTEXT_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} medium text (reg, type, bearing, distance, alt, speed)\"\n                },\n                \"AS_SHORT_ROUTE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} short route (ICAO -&gt; ICAO)\"\n                },\n                \"AS_MEDIUM_ROUTE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} short route (City -&gt; CITY)\"\n                },\n                \"AS_LONG_ROUTE_AIRCRAFT${COUNT}\": {\n                    \"group\": \"ADSB Data\",\n                    \"type\": \"string\",                \n                    \"description\": \"Aircraft ${COUNT} long route (ICAO - City -&gt; ICAO - CITY)\"\n                }\n            }\n        },\n        \"arguments\":{\n            \"period\": 60,\n            \"data_source\": \"Local\",\n            \"aircraft_data\": \"local\",\n            \"aircraft_route\": \"true\",\n            \"distance_limit\": 50,\n            \"timeout\": 10,\n            \"local_adsb_url\": \"\",\n            \"observer_altitude\": 0,\n            \"opensky_username\": \"\",\n            \"opensky_password\": \"\",\n            \"opensky_lat_min\": 0,\n            \"opensky_lon_min\": 0,\n            \"opensky_lat_max\": 0,\n            \"opensky_lon_max\": 0,\n            \"airplaneslive_radius\": 50\n        },\n        \"argumentdetails\": {\n            \"data_source\" : {\n                \"required\": \"false\",\n                \"description\": \"Data Source\",\n                \"help\": \"The source for the ASB-D data.\",\n                \"tab\": \"Data Source\",\n                \"type\": {\n                    \"fieldtype\": \"select\",\n                    \"values\": \"Local,OpenSky,AirplanesLive,adsbfi\",\n                    \"default\": \"Local\"\n                }\n            },        \n\n            \"noticeal\" : {\n                \"tab\": \"Data Source\",      \n                \"message\": \"There are no settings required for AirplanesLive\",\n                \"type\": {\n                    \"fieldtype\": \"text\",\n                    \"style\": {\n                        \"width\": \"full\",\n                        \"alert\": {\n                            \"class\": \"info\"\n                        }\n                    }\n                },\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"AirplanesLive\"\n                    ]\n                }                       \n            }, \n            \"noticefi\" : {\n                \"tab\": \"Data Source\",      \n                \"message\": \"There are no settings required for adsbfi\",\n                \"type\": {\n                    \"fieldtype\": \"text\",\n                    \"style\": {\n                        \"width\": \"full\",\n                        \"alert\": {\n                            \"class\": \"info\"\n                        }\n                    }\n                },\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"adsbfi\"\n                    ]\n                }                       \n            },    \n            \"local_adsb_url\": {\n                \"required\": \"false\",\n                \"description\": \"Local ADS-B Address\",\n                \"help\": \"See the help for how to obtain this address.\",\n                \"tab\": \"Data Source\",\n                \"secret\": \"true\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"Local\"\n                    ]\n                }             \n            },\n            \"opensky_username\": {\n                \"required\": \"false\",\n                \"description\": \"OpenSky Username\",\n                \"help\": \"Your Opensky Network username. See the module documentation for details on the API limits with and without a username.\",\n                \"tab\": \"Data Source\",\n                \"secret\": \"true\",    \n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_password\": {\n                \"required\": \"false\",\n                \"description\": \"OpenSky Password\",\n                \"help\": \"Your Opensky Network password.\",\n                \"tab\": \"Data Source\",\n                \"secret\": \"true\",    \n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },        \n            \"opensky_lat_min\": {\n                \"required\": \"false\",\n                \"description\": \"Min latitude\",\n                \"help\": \"The minimum latitude of the bounding box. Use a site like http://bboxfinder.com/ to determine the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_lon_min\": {\n                \"required\": \"false\",\n                \"description\": \"Min longitude\",\n                \"help\": \"The minimum longitude of the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_lat_max\": {\n                \"required\": \"false\",\n                \"description\": \"Max latitude\",\n                \"help\": \"The minimum latitude of the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"opensky_lon_max\": {\n                \"required\": \"false\",\n                \"description\": \"Max longitude\",\n                \"help\": \"The maximum longitude of the bounding box.\",\n                \"tab\": \"Data Source\",\n                \"filters\": {\n                    \"filter\": \"data_source\",\n                    \"filtertype\": \"show\",\n                    \"values\": [\n                        \"OpenSky\"\n                    ]\n                }            \n            },\n            \"aircraft_data\" : {\n                \"required\": \"false\",\n                \"description\": \"Aircraft Type Data Source\",\n                \"help\": \"The source for the aircraft data, see the documentaiton for details.\",\n                \"tab\": \"Settings\",\n                \"type\": {\n                    \"fieldtype\": \"select\",\n                    \"values\": \"Local,Hexdb\",\n                    \"default\": \"Local\"\n                }\n            },\n            \"aircraft_route\" : {\n                \"required\": \"false\",\n                \"description\": \"Get flight route\",\n                \"help\": \"Get the flight's route if possible.\",\n                \"tab\": \"Settings\",\n                \"type\": {\n                    \"fieldtype\": \"checkbox\"\n                }          \n            },\n            \"distance_limit\" : {\n                \"required\": \"true\",\n                \"description\": \"Limit Distance\",\n                \"help\": \"Only include aircraft inside this distance.\",\n                \"tab\": \"Settings\",                        \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 0,\n                    \"max\": 250,\n                    \"step\": 1\n                }\n            },         \n            \"observer_altitude\" : {\n                \"required\": \"true\",\n                \"description\": \"Altitude\",\n                \"help\": \"Your altitude in metres.\",\n                \"tab\": \"Settings\",                        \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 0,\n                    \"max\": 1000,\n                    \"step\": 10\n                }\n            },\n            \"period\" : {\n                \"required\": \"true\",\n                \"description\": \"Read Every\",\n                \"help\": \"Read data every x seconds. Be careful of any API limits when setting this.\",\n                \"tab\": \"Settings\",                          \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 60,\n                    \"max\": 1440,\n                    \"step\": 1\n                }\n            },\n            \"timeout\" : {\n                \"required\": \"true\",\n                \"description\": \"Timeout\",\n                \"help\": \"The number of seconds to wait for a response from the API before aborting.\",\n                \"tab\": \"Settings\",                        \n                \"type\": {\n                    \"fieldtype\": \"spinner\",\n                    \"min\": 1,\n                    \"max\": 20,\n                    \"step\": 1\n                }\n            },\n            \"graph\": {\n                \"required\": \"false\",\n                \"tab\": \"History\",\n                \"type\": {\n                    \"fieldtype\": \"graph\"\n                }\n            }                      \n        },\n        \"businfo\": [\n        ],\n        \"changelog\": {\n            \"v1.0.0\" : [\n                {\n                    \"author\": \"Alex Greenland\",\n                    \"authorurl\": \"https://github.com/allskyteam\",\n                    \"changes\": \"Initial Release\"\n                }\n            ],\n            \"v2.0.0\" : [\n                {\n                    \"author\": \"Alex Greenland\",\n                    \"authorurl\": \"https://github.com/allskyteam\",\n                    \"changes\": \"Updates for new module system\"\n                }\n            ]   \n        }\n    }\n</code></pre>"},{"location":"developer_guide/meta_data_structure.html","title":"Meta Data Structure","text":""},{"location":"developer_guide/meta_data_structure.html#the-meta_data-structure","title":"The meta_data Structure","text":"<p>The meta_data variable contains a complete definition of all of the features this module will provide. The structure is complex so we have broken it down into the main components. </p> <p>Some notes on the data</p> <ul> <li> <p>The structure is a Python dict that is also used as json</p> </li> <li> <p>All Boolean values must be quoted i.e. \u201ctrue\u201d NOT True</p> </li> </ul>"},{"location":"developer_guide/meta_data_structure.html#the-header-section","title":"The \u2018header\u2019 section","text":"<p>This section contains basic information about the module and how it should be displayed in the installer and module manager.</p> Name Description name The name of the module. Displayed in the module manager description Brief description of what he module does, this is displayed in the module installer and module manager module The module name allsky_XXXXX. Note the allsky_ must be present version The version of the module. This uses then MAJOR, MINOR,PATCH convention. i.e. v1.2.3 centersettings If the module has a large amount of settings then set this to \u201cfalse\u201d to display the module dialog at the top of the screen. Setting it to \u201ctrue\u201d will vertically center the module dialog testable If the module can be tested, see later then set this to \u201ctrue\u201d. NOTE: At present no modules that process images can be tested group This is the group the module belongs to, this is used in the module manager to group like modules together extradatafilename (Optional )This is the name of the extra data file that any data generated by the module will be saved in. By convention it\u2019s the module name with .json appended events These are the pipelines (flows) that this module can run in experimental (Optional) If set to \u201ctrue\u201d then the module will be flagged as experimental in the module manager deprecation This section allows control over the deprecation of a module. It can provide both warnings of an upcoming deprecation or a complete deprecation of a module fromversion (Optional) The version a deprecation will be advised from removein (Optional) The version the deprecation will happen in notes (Optional) Any notes related to the deprecation replacedby (Optional) The name of the module replacing the deprecated functionality deprecated \u201ctrue\u201d to deprecate a module, if \u201cfalse\u201d then the optional values above can be used"},{"location":"developer_guide/meta_data_structure.html#the-extra-data-section","title":"The \u2018Extra Data\u2019 section","text":"<p>This section defines what data the module will generate for use in the overlays. It also controls what data can be written to the database for use by the charting system.</p>"},{"location":"developer_guide/meta_data_structure.html#the-databases-section","title":"The \u2018databases\u2019 section","text":"Name Description enabled (Optional) \u201ctrue\u201d if this module will write data to the database. Normally you would set this to true, typically on setting it to false when developing or testing table (Optional) If enable then this field IS required and contains the name of the table to write data to. The convention is the module name. pk (Optional) If enable then this field IS required and contains the name of the primary key for the database. This should always be 'id' pk_source (Optional) If enable then this field IS required and contains the variable that the primary key (id) will be obtained from, If omitted the last ime timestamp or current timestamp will be used pk_type (Optional) If enable then this field IS required and contains the primary key. Set this to \u2018int\u2019 Include_all (Optional) If enable then this field IS required and determines if all extra data values are written to the database. If \u201cfalse\u201d then you can specify which data is written against the extra data fields definitions time_of_day_save (Optional) Determines how  data is saved for each pipeline."},{"location":"developer_guide/meta_data_structure.html#the-values-section","title":"The \u2018values\u2019 section","text":"<p>This section defines all of the extra data that the module will generate for use in overlays. The information defined here is used throughout core Allsky to format and present the data. The section is a list of values, the table below just shows the available fields for a single value</p> Name Description Key The name of the variable, generally prefixed with AS_ name The variable as it will appear when added to an overly format The default format for the variable. See the section in the main Allsky documentation on formats for more details sample This is a sample value used in the Overlay manager, typically this is not needed as you can preview live data in the overlay manager group This the group the variable belongs to. This is used in the variable manager to group variables. description The description of the variable, used in the variable manager type The type of the variable. To find all of the available options look at the 'type' field on the 'Text Properties' editor in the overlay manager, diblue click on a field to display this dbtype (Optional). If writing this field to the database this specifies the type of column created database include If the database is enabled but include_all is \u2018false\u2019 then setting this to \u2018true\u2019 will write this value to the database"},{"location":"developer_guide/meta_data_structure.html#the-arguments-section","title":"The \u2018arguments\u2019 section","text":"<p>This is a list of all of the arguments the module requires along with their default values. This list MUST match the \u2018argumentdetails\u2019 section. If an entry exists in the \u2018argumentdetails\u2019 section but not here then It will not be available to the module.</p> <p>This is the \u2018params\u2019 variable passed into the module function when the module is run.</p>"},{"location":"developer_guide/meta_data_structure.html#the-argumentdetails-section","title":"The \u2018argumentdetails\u2019 section","text":"<p>This section defines all of the fields that are displayed in the module manager for a module.</p> <p>The boilerpate module is setup to display all of the field types allowing you to see how they work</p> <p>Each field has a type, this defines how  the field appears. The fields are documented in the Available Fields section</p> <p>The Boiler plate module implements each of the field types so can be used to see how they work.</p>"},{"location":"developer_guide/meta_data_structure.html#common-field-attributes","title":"Common field attributes","text":"<p>The following keys are available on all fields</p> Key Description required \u201ctrue\u201d or \u201cfalse\u201d to indicate the field must be filled in description The label used when displaying the field help Help text displayed under the field tab The tab the field is displayed on secret This indicates that the value in this field will contain sensitive information. Any details entered into a \u2018secret\u2019 field are stored in a separate file away from the pipeline json files. If the field is a text type field then the value will not be visible in the module manager. A button is displayed allowing the field value to be displayed or hidden"},{"location":"developer_guide/meta_data_structure.html#filtering","title":"Filtering","text":"<p>Filtering allows fields to be displayed or hidden based upon the value of another field. A good example of this is when selecting a sensor in the Environment module. Each sensor has different settings so rather than display all of them, which would make the modules dialog large and confusing only those relevant to the sensor are displayed.</p> <p>To utilise this feature add the \u2018filters\u2019 section to a field. The filters section contains the following values</p> <p>filter \u2013 The field that controls the filter</p> <p>filtertype \u2013 Either \u2018show\u2019 or \u2018hide\u2019 This determines if this field will be shown or hidden based upon the value of the \u2018filter\u2019 field</p> <p>values \u2013 A list of values from the \u2018filter\u2019 field that trigger the filtering on this field </p> <p>So in the example below the \u2018input\u2019 field will be shown if the \u2018type\u2019 field is either DHT22, DHT11 or AM2302</p> <pre><code>\"inputpin\": {\n    \"required\": \"false\",\n    \"description\": \"Input Pin\",\n    \"help\": \"The input pin for DHT type sensors, not required for I\u00b2C devices.\",\n    \"tab\": \"Core\",\n    \"type\": {\n        \"fieldtype\": \"gpio\"\n    },\n    \"filters\": {\n        \"filter\": \"type\",\n        \"filtertype\": \"show\",\n        \"values\": [\n            \"DHT22\",\n            \"DHT11\",\n            \"AM2302\"\n        ]\n    }            \n}\n</code></pre> <p>This is a very powerful feature and developer are encouraged to use it to keep the user interface easier for the end user.</p>"},{"location":"developer_guide/meta_data_structure.html#the-businfo-section","title":"The \u2018businfo\u2019 section","text":"<p>This section is optional and defines which buses on the Pi the module uses.</p> <pre><code>\"businfo\": [\n    \"I\u00b2C\"\n]\n</code></pre> <p>In this example the module uses the I\u00b2C bus</p> <pre><code>\"businfo\": [\n    \"I\u00b2C\",\n    \"onewire\"\n]  \n</code></pre> <p>In this example the module uses both the I\u00b2C bus and the onewire bus</p>"},{"location":"developer_guide/meta_data_structure.html#the-changelog-section","title":"The \u2018changelog\u2019 section","text":"<p>This section contains the changelog for the module. The latest version is at the end of the changelog. In this example there are several different types of entries in the changelog</p> <p>v1.0.0 \u2013 This is a dingle change made by one author v1.0.1 \u2013 This is multiple changes made by one author v1.0.2 \u2013 This is multiple changes made by one author and a single change made by another</p> <pre><code>\"changelog\": {\n    \"v1.0.0\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/allskyteam\",\n            \"changes\": \"Initial Release\"\n        }\n    ],\n    \"v1.0.1\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/Mr-Groch\",\n            \"changes\": [\n                \"Change 1\",\n                \"Change 2\"\n            ]\n        }\n    ],\n    \"v1.0.2\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/allskyteam\",\n            \"changes\": [\n                \"Change 1\",\n                \"Change 2\"\n            ]\n        },            \n        {\n            \"author\": \"Andreas Schminder\",\n            \"authorurl\": \"https://github.com/Adler6907\",\n            \"changes\": \"Change 1\"\n        }\n    ],\n    \"v1.0.3\" : [\n        {\n            \"author\": \"Alex Greenland\",\n            \"authorurl\": \"https://github.com/allskyteam\",\n            \"changes\": [\n                \"Updated for new module structure\",\n                \"Another change\"\n            ]\n        }\n    ]                             \n}\n</code></pre>"},{"location":"developer_guide/module_structure.html","title":"Module Structure","text":""},{"location":"developer_guide/module_structure.html#module-structure","title":"Module Structure","text":""},{"location":"developer_guide/module_structure.html#anatomy-of-a-module","title":"Anatomy of a module","text":"<p>Modules can be implemented in a number of ways but only the preferred method is documented here. A module is essentially a Python script consisting of two methods</p> <ul> <li>A method that is called by Core Allsky to actually run the module</li> <li>A method that is called by Core Allsky when the module is removed from a pipeline, this allows the module to clearup any data</li> </ul> <pre><code>import allsky_shared as allsky_shared\nfrom allsky_base import ALLSKYMODULEBASE\n\nclass ALLSKTUTORIAL(ALLSKYMODULEBASE):\n    meta_data = {\n    }\n\n    def run(self):\n        result = \"\"\n        return result\n\ndef tutorial(params, event):\n    allsky_tutorial = ALLSKTUTORIAL(params, event)\n    result = allsky_tutorial.run()\n    return result \n\ndef tutorial_cleanup():\n    moduleData = {\n        \"metaData\": ALLSKTUTORIAL.meta_data,\n        \"cleanup\": {\n            \"files\": {\n                ALLSKTUTORIAL.meta_data[\"extradatafilename\"]\n            },\n            \"env\": {}\n        }\n    }\n    allsky_shared.cleanupModule(moduleData)\n</code></pre> <p>Breaking this down we have</p>"},{"location":"developer_guide/module_structure.html#two-imports-that","title":"Two imports that","text":"<ul> <li>Import the allsky_shared module, this is a library of functions that a module can use.</li> <li>Import of the base module. The is a base class providing helper functions for a module</li> </ul>"},{"location":"developer_guide/module_structure.html#a-class-definition-allskytutorial","title":"A class definition (ALLSKYTUTORIAL)","text":"<p>that extends the base module (ALLSKYBASE) we imported. Note that the class can be called anything but as a convention its ALLSKY plus the module name all in upper case</p> <p>A meta_data variable. This is described later and contains all of the definitions required for the module</p> <p>A run function, this is the convention we use to run a module. This function must return the result of the module as a string, this is displayed in the module debug dialog.</p>"},{"location":"developer_guide/module_structure.html#the-module-entry-point-tutorial","title":"The module entry point (tutorial)","text":"<p>Every module requires this function. This is the function called by core Allsky to start the module.</p> <p>There are two parameters provided to this function</p> <p>params \u2013 These are the values the user has set for the module in the module manager</p> <p>event \u2013 This is the pipeline(flow) the module was called from</p> <p>In this function we would create a new instance of the module class passing the params and event variables then call the run method</p> <p>Your class does not need a constructor, that\u2019s handled by the base class. If for some reason you do need a constructor then you must ensure that base class constructor is also called</p>"},{"location":"developer_guide/module_structure.html#the-module-cleanup-entry-point-tutorial_cleanup","title":"The module cleanup entry point (tutorial_cleanup)","text":"<p>This function is called by core Allsky when a module is remove from a pipeline. This is to allow the module to cleanup any data required. A core function is provided that you can call that will handle all of the cleanup.</p> <p>This entry point is optional. If the module does not create any extra data for the overlays then there is no need to provide this function.</p>"},{"location":"developer_guide/overview.html","title":"Overview","text":""},{"location":"developer_guide/overview.html#overview","title":"Overview","text":""},{"location":"developer_guide/overview.html#what-are-modules","title":"What Are Modules","text":"<p>Modules are Python components that extend the functionality of Allsky. They typically fall into one of several categories:</p> <ul> <li>Data-enhancement modules \u2014 These add extra information that can be used in overlays. For example, the Solar System module provides details about celestial objects such as the Moon\u2019s position.</li> <li>Hardware-control modules \u2014 These interact with external devices. A common example is the Dew Heater module, which reads sensor data and automatically adjusts the dew heater.</li> <li>Image-processing modules \u2014 These operate on the captured images. Some modify the image itself (such as the Mask module), while others analyse the image to generate additional overlay data, such as the Star Count module.</li> </ul>"},{"location":"developer_guide/overview.html#available-pipelines-flows","title":"Available Pipelines (flows)","text":"<p>There are 5 pipelines available in Allsky.</p> Pipeline Description Daytime Used whilst Allsky is capturing images during the day Nightime Used whilst Allsky is capturing images during the night Day to Night Used when Allsky transitions from Daytime to Nighttime capture Night to Day Used when Allsky transitions from Nighttime  to Daytime capture Periodic Run periodically outside of the main Allsky capture process <p>Each pipeline can run a series of modules in sequence. By default, the Daytime and Nighttime pipelines include the core modules that load and save the captured image; these core modules cannot be removed. All other pipelines start empty. You can use the Module Manager to add additional modules to any pipeline as needed.</p> <pre><code>flowchart TB\n    A[\"Capture Image\"] --&gt; B[\"Remove Bad Images\"]\n    B --&gt; C[\"Resize\"] &amp; A\n    C --&gt; D[\"Crop\"]\n    D --&gt; E[\"Stretch\"]\n    E --&gt; F{\"Flow Type\"}\n    F -- Daytime Pipeline --&gt; FDL[\"Load Image\"]\n    FDL --&gt; FDM[\"Load Modules\"]\n    FDM --&gt; FDR[\"Run Modules\"]\n    FDR --&gt; FDS[\"Save Image\"]\n    FDS --&gt; P[\"Create Thumb\"]\n    F -- Nighttime Pipeline --&gt; FNL[\"Load Image\"]\n    FNL --&gt; FNM[\"Load Modules\"]\n    FNM --&gt; FNR[\"Run Modules\"]\n    FNR --&gt; FNS[\"Save Image\"]\n    FNS --&gt; P\n    PTE[\"Perodic Timer\"] -- Periodic Pipeline --&gt; FPM[\"Load Modules\"]\n    FPM --&gt; FPR[\"Run Modules\"]\n    F -- End Of Night Pipeline --&gt; FEONM[\"Load Modules\"]\n    FEONM --&gt; FEONR[\"Run Modules\"]\n    FEONR --&gt; FEONCS[\"Create Startrails\"]\n    FEONCS --&gt; FEONCT[\"Create Timelapse\"]\n    FEONCT --&gt; FEONCK[\"Create Keogram\"]\n    FEONCK --&gt; FEONU[\"Upload Images / Videos\"]\n    FEONU --&gt; A\n    F -- Start Of Day Pipeline --&gt; FEODM[\"Load Modules\"]\n    FEODM --&gt; FEODR[\"Run Modules\"]\n    FEODR --&gt; P\n    P --&gt; Q[\"Create Mini Timelapse\"]\n    Q --&gt; R[\"Upload Image\"]\n    R --&gt; A</code></pre>"},{"location":"developer_guide/shared_libraries.html","title":"Shared Libraries","text":""},{"location":"developer_guide/shared_libraries.html#the-allsky-base-module","title":"The Allsky Base Module","text":"<p>Every module class must extend this base class. The base class does the following In the constructor;</p> <ul> <li>saves the params and event into class variables  </li> <li>Determines if the module is running in debug mode (i.e. from the test button in the module manager)  </li> <li>Converts any legacy meta data structures to the new meta data structure</li> </ul> <p>It also provides the following functions that the module class should use;</p>"},{"location":"developer_guide/shared_libraries.html#get_parm","title":"get_parm","text":"<p>This function is used to get a parameter from the module settings. Whilst this can be accessed in the params variable this is not encouraged. The function  accepts the following parameters</p> Parameter Description param The parameter to get, this is the name of the value in the arguments section default The default value for the parameter target_type The Python type of the variable to return Use_default_if_blank If the target_type is a string (str) and the found value for the param is an empty tring then use the default value if this parameter is True"},{"location":"developer_guide/shared_libraries.html#log","title":"log","text":"<p>This function logs data to either the console or Allsky debug logs. The function  accepts the following parameters</p> Parameter Description level The Allsky log level, below this nothing wil be logged message The message to log preventNewLine (Optional) If True no newline will be added at the end of the log message exitCode (Optional) Exit code \u2013 Not normally used sendToAllsky (Optional) \u2013 Not normally used <p>Detailed SDK</p> <p>For more details on these functions see the SDK Reference</p>"},{"location":"developer_guide/shared_libraries.html#the-allsky-shared-module","title":"The Allsky Shared Module","text":"<p>The shared module provides a huge library of functions that can assist module developers.</p> <p>Detailed SDK</p> <p>For more details on these functions see the SDK Reference</p>"},{"location":"developer_guide/building_module/3rd_party_api.html","title":"3rd Party API","text":"<p>In this tutorial we will write a module that accesses the Openweathermap api to retrieve weather data</p> <p>Warning</p> <p>Please ensure you have read the simple tutorial before this one as the basics covered in the simple tutorial will not be covered</p> <p>API Limits</p> <p>The Openweather map API has limits on the number of requests that can be made using an API key. If you run out of requests then you can create a new API key.</p> <p>Before using this tutorial you will require an API key to access the API. To get an API key create an account on Open Weather Map and create an API key in your account area.</p> <p>Lets start with the basic framework for the module, after creating this code run add the module to the periodic flow and add your API key then save the module and pipeline</p> <pre><code>import allsky_shared as allsky_shared\nfrom allsky_base import ALLSKYMODULEBASE\n\nclass ALLSKYEXAMPLE1(ALLSKYMODULEBASE):\n\n  meta_data = {\n    \"name\": \"Allsky Example API Module\",\n    \"description\": \"A simple example module for Allsky to access an API.\",\n    \"module\": \"allsky_example1\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example1.json\", \n    \"extradata\": {\n      \"values\": {\n        \"AS_EXAMPLE_TEMP\": {\n          \"name\": \"${EXAMPLE_TEMP}\",\n          \"format\": \"{dp=0|deg}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Temp from Openweather API\",\n          \"type\": \"number\"\n        }\n      }\n    },\n    \"arguments\":{\n      \"owapikey\": \"\"\n    },\n    \"argumentdetails\": {\n      \"owapikey\": {\n        \"required\": \"false\",\n        \"description\": \"API Key\",\n        \"secret\": \"true\",         \n        \"help\": \"Your Open Weather Map API key.\"            \n      },\n      \"units\" : {\n        \"required\": \"false\",\n        \"description\": \"Units\",\n        \"help\": \"Units of measurement: standard, metric, or imperial.\",\n        \"tab\": \"Home\",            \n        \"type\": {\n          \"fieldtype\": \"select\",\n          \"values\": \"standard,metric,imperial\"\n        }                \n      }                   \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n\n  def run(self) -&gt; str:\n    result = \"\"\n\n\n    return result\n\ndef example1(params, event) -&gt; str:\n      allsky_example1 = ALLSKYEXAMPLE1(params, event)\n      result = allsky_example1.run()\n\n      return result    \n\ndef example1_cleanup():   \n      moduleData = {\n          \"metaData\": ALLSKYEXAMPLE1.meta_data,\n          \"cleanup\": {\n              \"files\": {\n                  ALLSKYEXAMPLE1.meta_data['extradatafilename']\n              },\n              \"env\": {}\n          }\n      }\n      allsky_shared.cleanupModule(moduleData)\n</code></pre> <p>A new concept in this code is the addition of the <code>\"secret\": \"true\",</code> in the api key defintion. This ensures that the valeu in this field is saved int the <code>~/allsky/env.json</code> file rather than in the pipeline. This is important in that when submitting support info sensitive data will not be included since we never include the env.json file</p> <p>Next we need to get the weather data for our location from the API. The API uses the follwoing url</p> <pre><code>https://api.openweathermap.org/data/2.5/weather?lat={lat}&amp;lon={lon}&amp;units={units}&amp;appid={api_key}\"\n</code></pre> <p>So to access this we need to get the latitude, longitude, units and API key for the request.</p> <p>The shared module provides some handy function to get the latitude and longitude. The units and api key we will get from the modules settings</p> <p>Add the follwing imports at the top of the module</p> <pre><code>import requests\nfrom typing import Any, Dict, Optional, Tuple\n</code></pre> <p>Add the following function to get data from the API</p> <pre><code>  def _get_weather(\n      self,\n      lat: float,\n      lon: float,\n      api_key: str,\n      units: str = \"metric\",\n      timeout: int = 10\n  ) -&gt; Tuple[Optional[Dict[str, Any]], Optional[str]]:\n      \"\"\"\n      Fetch current weather from OpenWeather API.\n\n      Returns:\n          (data, None) on success\n          (None, error_message) on error\n      \"\"\"\n\n      if not api_key:\n          return None, \"API key is required\"\n\n      url = \"https://api.openweathermap.org/data/2.5/weather\"\n      params = {\n          \"lat\": lat,\n          \"lon\": lon,\n          \"units\": units,\n          \"appid\": api_key,\n      }\n\n      try:\n          response = requests.get(url, params=params, timeout=timeout)\n      except requests.exceptions.Timeout:\n          return None, \"Request timed out\"\n      except requests.exceptions.ConnectionError:\n          return None, \"Network connection error\"\n      except requests.exceptions.RequestException as e:\n          return None, f\"Unexpected request error: {e}\"\n\n      try:\n          data = response.json()\n      except ValueError:\n          return None, \"Invalid JSON response from API\"\n\n      if not response.ok:\n          message = data.get(\"message\", f\"HTTP error {response.status_code}\")\n          return None, f\"API error {response.status_code}: {message}\"\n\n      if data.get(\"cod\") != 200:\n          return None, f\"API error: {data.get('message', 'Unknown error')}\"\n\n      required_keys = [\"weather\", \"main\", \"wind\", \"dt\", \"name\"]\n      missing = [k for k in required_keys if k not in data]\n      if missing:\n          return None, f\"Malformed response, missing keys: {missing}\"\n\n      return data, None\n</code></pre> <p>Then modify the run method to extract the required values after calling the function</p> <pre><code>  def run(self) -&gt; str:\n    result = \"\"\n    extra_data = {}\n\n    api_key = self.get_param(\"owapikey\", \"\", str)\n    units = self.get_param(\"units\", \"\", str)\n    lat, lon = allsky_shared.get_lat_lon()\n\n    data, error = self._get_weather(lat, lon, api_key, units)\n\n    if error:\n      result = f\"ERROR: Failed to obtainweather data {error}\"\n    else:\n      extra_data[\"AS_EXAMPLE1_TEMP\"] = float(data[\"main\"][\"temp\"])\n      allsky_shared.save_extra_data(self.meta_data['extradatafilename'], extra_data, self.meta_data['module'], self.meta_data['extradata'])\n      result = f\"INFO: Data read from Openweather API and variables created\"      \n\n    self.log(4, result)\n\n    return result\n</code></pre> <p>When dealing with API's its important to ensure that you handle errors the API may return.</p> <p>And thats it, you could get other values from the API if needed.</p>"},{"location":"developer_guide/building_module/accessing_sensor.html","title":"Accessing A sensor","text":"<p>In this tutorial we will write a module that accesses an I\u00b2C sensor to get temperature data. We will use the Adafruit sht40 sensor.</p> <p>Important</p> <ul> <li>Please ensure you have read the simple tutorial before this one as the basics covered in the simple tutorial will not be covered </li> <li>This tutorial requires additional hardware and basic understanding of the Pi's GPIO pins</li> <li>Please ensure the Allsky Environment module is installed as this will install the dependencies for this example module</li> </ul> <p>Connect the SHT40 to the PI as shown in the following diagram, the pin connections are the same for the pi3, 4 and 5</p> <p> </p> <p>The SHT40 wiring</p> <p>Lets start with the basic framework for the module, this does nothing other than allow you to add the module to the periodic pipeline</p> <pre><code>import allsky_shared as allsky_shared\nfrom allsky_base import ALLSKYMODULEBASE\n\nclass ALLSKYEXAMPLE2(ALLSKYMODULEBASE):\n\n  meta_data = {\n    \"name\": \"Allsky Example I\u00b2C Module\",\n    \"description\": \"A simple example module to read an sht40 sensor.\",\n    \"module\": \"allsky_example1\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example2.json\", \n    \"extradata\": {\n    },\n    \"arguments\":{\n    },\n    \"argumentdetails\": {                  \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n\n\n  def run(self) -&gt; str:\n    result = \"\"\n    extra_data = {}\n\n    self.log(4, result)\n\n    return result\n\ndef example2(params, event) -&gt; str:\n      allsky_example2 = ALLSKYEXAMPLE2(params, event)\n      result = allsky_example2.run()\n\n      return result    \n\ndef example2_cleanup():   \n      moduleData = {\n          \"metaData\": ALLSKYEXAMPLE2.meta_data,\n          \"cleanup\": {\n              \"files\": {\n                  ALLSKYEXAMPLE2.meta_data['extradatafilename']\n              },\n              \"env\": {}\n          }\n      }\n      allsky_shared.cleanupModule(moduleData)\n</code></pre> <p>The next thing we need to do is to add any settings we need for the sensor. We will only require one settings that allows the I\u00b2C address to be changed if needed. Noramlly you would not need to do this but adding the setting will show how the I\u00b2C device can be selected from a list.</p> <p>Modify the meta data to include the I\u00b2C address field</p> <pre><code>  meta_data = {\n    \"name\": \"Allsky Example I\u00b2C Module\",\n    \"description\": \"A simple example module to read an sht40 sensor.\",\n    \"module\": \"allsky_example1\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example2.json\", \n    \"extradata\": {\n    },\n    \"arguments\":{\n      \"I\u00b2Caddress\": \"\"     \n    },\n    \"argumentdetails\": {           \n      \"I\u00b2Caddress\": {\n        \"required\": \"false\",\n        \"description\": \"I\u00b2C Address\",\n        \"help\": \"Override the standard I\u00b2C address for a device. NOTE: This value must be hex, i.e., 0x76.\",\n        \"type\": {\n          \"fieldtype\": \"I\u00b2C\"\n        }           \n      }             \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n</code></pre> <p>Next we need to add the code to read the sensor, see the notes at the top of this page regardin installing the Environment module to get the correct dependencies.</p> <p>Add the following imports at the top of the module</p> <pre><code>from typing import Optional, Dict, Tuple, Any\n\nimport board\nimport busio\nimport adafruit_sht4x\n</code></pre> <p>Next add a method to read the sensor</p> <pre><code>  def _read_sht40(self, address: int = 0x44) -&gt; Tuple[Optional[Dict[str, Any]], Optional[str]]:\n\n      try:\n        if not isinstance(address, int) or not (0x03 &lt;= address &lt;= 0x77):\n          return None, f\"Invalid I\u00b2C address: {address}\"\n\n        try:\n          I\u00b2C = busio.I\u00b2C(board.SCL, board.SDA)\n        except Exception as e:\n          return None, f\"Failed to initialise I\u00b2C bus: {e}\"\n\n        try:\n          sensor = adafruit_sht4x.SHT4x(I\u00b2C, address=address)\n        except Exception as e:\n          return None, f\"SHT40 not found at I\u00b2C address 0x{address:02X}: {e}\"\n\n        try:\n          sensor.mode = adafruit_sht4x.Mode.NOHEAT_HIGHPRECISION\n        except Exception:\n          pass\n\n        try:\n          temperature, humidity = sensor.measurements\n        except Exception as e:\n          return None, f\"Sensor read failed: {e}\"\n\n        if temperature is None or humidity is None:\n          return None, \"Sensor returned empty values\"\n\n        return {\n          \"temperature_c\": round(float(temperature), 2),\n          \"temperature_f\": round(float(temperature) * 9 / 5 + 32, 2),\n          \"humidity\": round(float(humidity), 2),\n          \"serial_number\": getattr(sensor, \"serial_number\", None),\n          \"address\": f\"0x{address:02X}\"\n        }, None\n\n      except Exception as e:\n        return None, f\"Unexpected error: {e}\"\n</code></pre> <p>Now modify the run function to use it</p> <pre><code>  def run(self) -&gt; str:\n    result = \"\"\n    extra_data = {}\n\n    I\u00b2C_address = self.get_param(\"I\u00b2Caddress\", 0x44, int) \n\n    data, error = self._read_sht40(I\u00b2C_address)\n\n    if error:\n        result = f\"ERROR: SHT40 error: {error}\"\n    else:\n      extra_data[\"AS_EXAMPLE2_TEMP\"] = data[\"temperature_c\"]\n      extra_data[\"AS_EXAMPLE2_HUMIDITY\"] = data[\"humidity\"]\n\n      result = f\"INFO: sht40 read temp_c={data['temperature_c']}, temp_f={data['temperature_f']}, humidity={data['humidity']}, serial={data['serial_number']}, address={data['address']}\"\n\n    self.log(4, result)\n\n    return result\n</code></pre> <p>And finally add the extra data config to the meta_data </p> <pre><code>  meta_data = {\n    \"name\": \"Allsky Example I\u00b2C Module\",\n    \"description\": \"A simple example module to read an sht40 sensor.\",\n    \"module\": \"allsky_example1\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example2.json\", \n    \"extradata\": {\n      \"values\": {\n        \"AS_EXAMPLE2_TEMP\": {\n          \"name\": \"${EXAMPLE2_TEMP}\",\n          \"format\": \"\",\n          \"sample\": \"\",                \n          \"group\": \"User\",\n          \"description\": \"Temperature from the sht40\",\n          \"type\": \"temperature\"\n        },\n        \"AS_EXAMPLE2_HUMIDITY\": {\n          \"name\": \"${EXAMPLE2_HUMIDITY}\",\n          \"format\": \"\",\n          \"sample\": \"\",                 \n          \"group\": \"User\",\n          \"description\": \"Pressure from the sht40\",\n          \"type\": \"number\"\n        }\n      }\n    },\n    \"arguments\":{\n      \"I\u00b2Caddress\": \"\"     \n    },\n    \"argumentdetails\": {           \n      \"I\u00b2Caddress\": {\n        \"required\": \"false\",\n        \"description\": \"I\u00b2C Address\",\n        \"help\": \"Override the standard I\u00b2C address for a device. NOTE: This value must be hex, i.e., 0x76.\",\n        \"type\": {\n          \"fieldtype\": \"I\u00b2C\"\n        }           \n      }             \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n</code></pre> <p>And thats it a fully functioning module to read the temperature and pressure from an SHT40</p>"},{"location":"developer_guide/building_module/database.html","title":"The database","text":"<p>In this tutorial we will modify the API module to save values to the Allsky database</p> <p>Warning</p> <p>Please ensure you have read the simple tutorial before this one as the basics covered in the simple tutorial will not be covered</p> <p>Saving values to the database, for example to using in charts, is accomplished by modifying the <code>extradata</code> section in the <code>meta_data</code></p> <p>Start by taking the API example and renaming everything to example3 and add the humidity variable</p> <pre><code>import requests\nfrom typing import Any, Dict, Optional, Tuple\nimport allsky_shared as allsky_shared\nfrom allsky_base import ALLSKYMODULEBASE\n\nclass ALLSKYEXAMPLE3(ALLSKYMODULEBASE):\n\n  meta_data = {\n    \"name\": \"Allsky Example Database Module\",\n    \"description\": \"A simple example module for Allsky to save data to the database.\",\n    \"module\": \"allsky_example3\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example3.json\", \n    \"extradata\": {       \n      \"values\": {\n        \"AS_EXAMPLE3_TEMP\": {\n          \"name\": \"${EXAMPLE3_TEMP}\",\n          \"format\": \"{dp=2|deg}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Temp from Openweather API\",\n          \"type\": \"number\"\n        },\n        \"AS_EXAMPLE3_HUMIDITY\": {\n          \"name\": \"${EXAMPLE3_HUMIDITY}\",\n          \"format\": \"{dp=0|per}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Humidity from Openweather API\",\n          \"type\": \"number\"\n        }        \n      }\n    },\n    \"arguments\":{\n      \"owapikey\": \"\",\n      \"units\": \"metric\"\n    },\n    \"argumentdetails\": {\n      \"owapikey\": {\n        \"required\": \"false\",\n        \"description\": \"API Key\",\n        \"secret\": \"true\",         \n        \"help\": \"Your Open Weather Map API key.\"            \n      },\n      \"units\" : {\n        \"required\": \"false\",\n        \"description\": \"Units\",\n        \"help\": \"Units of measurement: standard, metric, or imperial.\",           \n        \"type\": {\n          \"fieldtype\": \"select\",\n          \"values\": \"standard,metric,imperial\"\n        }                \n      }                   \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n\n  def _get_weather(\n      self,\n      lat: float,\n      lon: float,\n      api_key: str,\n      units: str = \"metric\",\n      timeout: int = 10\n  ) -&gt; Tuple[Optional[Dict[str, Any]], Optional[str]]:\n      \"\"\"\n      Fetch current weather from OpenWeather API.\n\n      Returns:\n          (data, None) on success\n          (None, error_message) on error\n      \"\"\"\n\n      if not api_key:\n          return None, \"API key is required\"\n\n      url = \"https://api.openweathermap.org/data/2.5/weather\"\n      params = {\n          \"lat\": lat,\n          \"lon\": lon,\n          \"units\": units,\n          \"appid\": api_key,\n      }\n\n      try:\n          response = requests.get(url, params=params, timeout=timeout)\n      except requests.exceptions.Timeout:\n          return None, \"Request timed out\"\n      except requests.exceptions.ConnectionError:\n          return None, \"Network connection error\"\n      except requests.exceptions.RequestException as e:\n          return None, f\"Unexpected request error: {e}\"\n\n      try:\n          data = response.json()\n      except ValueError:\n          return None, \"Invalid JSON response from API\"\n\n      if not response.ok:\n          message = data.get(\"message\", f\"HTTP error {response.status_code}\")\n          return None, f\"API error {response.status_code}: {message}\"\n\n      if data.get(\"cod\") != 200:\n          return None, f\"API error: {data.get('message', 'Unknown error')}\"\n\n      required_keys = [\"weather\", \"main\", \"wind\", \"dt\", \"name\"]\n      missing = [k for k in required_keys if k not in data]\n      if missing:\n          return None, f\"Malformed response, missing keys: {missing}\"\n\n      return data, None\n\n  def run(self) -&gt; str:\n    result = \"\"\n    extra_data = {}\n\n    api_key = self.get_param(\"owapikey\", \"\", str)\n    units = self.get_param(\"units\", \"\", str)\n    lat, lon = allsky_shared.get_lat_lon()\n\n    data, error = self._get_weather(lat, lon, api_key, units)\n\n    if error:\n      result = f\"ERROR: Failed to obtainweather data {error}\"\n    else:\n      extra_data[\"AS_EXAMPLE3_TEMP\"] = float(data[\"main\"][\"temp\"])\n      extra_data[\"AS_EXAMPLE3_HUMIDITY\"] = float(data[\"main\"][\"humidity\"])\n\n      allsky_shared.save_extra_data(self.meta_data['extradatafilename'], extra_data, self.meta_data['module'], self.meta_data['extradata'])\n      result = f\"INFO: Data read from Openweather API and variables created\"      \n\n    self.log(4, result)\n\n    return result\n\ndef example3(params, event) -&gt; str:\n      allsky_example3 = ALLSKYEXAMPLE3(params, event)\n      result = allsky_example3.run()\n\n      return result    \n\ndef example3_cleanup():   \n      moduleData = {\n          \"metaData\": ALLSKYEXAMPLE3.meta_data,\n          \"cleanup\": {\n              \"files\": {\n                  ALLSKYEXAMPLE3.meta_data['extradatafilename']\n              },\n              \"env\": {}\n          }\n      }\n      allsky_shared.cleanupModule(moduleData)\n</code></pre> <p>Next we modify the <code>extradata</code> section of the <code>meta_data</code> to tell Allsky how to manage the extra data in the database</p> <p>Change the <code>extradata</code> section to the following</p> <pre><code>    \"extradata\": {    \n            \"database\": {\n                \"enabled\": \"True\",\n                \"table\": \"allsky_example3\",\n                \"include_all\": \"true\",\n            \"pk\": \"id\",\n            \"pk_type\": \"int\",    \n        \"time_of_day_save\": {\n                    \"day\": \"always\",\n                    \"night\": \"always\",\n                    \"nightday\": \"always\",\n                    \"daynight\": \"always\",\n                    \"periodic\": \"always\"\n                }      \n            },        \n      \"values\": {\n        \"AS_EXAMPLE3_TEMP\": {\n          \"name\": \"${EXAMPLE3_TEMP}\",\n          \"format\": \"{dp=2|deg}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example3 Temp from Openweather API\",\n          \"type\": \"number\"\n        },\n        \"AS_EXAMPLE3_HUMIDITY\": {\n          \"name\": \"${EXAMPLE3_HUMIDITY}\",\n          \"format\": \"{dp=0|per}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example3 Humidity from Openweather API\",\n          \"type\": \"number\"\n        }        \n      }\n    }\n</code></pre> <p>This adds the database section that will</p> <ul> <li>Create a table called <code>allsky_example3</code></li> <li>Include ALL of the data from the <code>values</code> section i.e. all of the extra data</li> <li>use a sequential primary key</li> <li>Allways save data for each pipeline</li> </ul> <p> </p> <p>The resulting database table</p> <p> </p> <p>The fields available when creating a custom chart</p> <p>There may be instances where you do not want to save all of the data to the database. If we only wanted to save the temperature and not the humidity we would change the <code>`metadata</code> section as follows</p> <pre><code>    \"extradata\": {    \n      \"database\": {\n        \"enabled\": \"True\",\n        \"table\": \"allsky_example3\",\n        \"include_all\": \"false\",\n        \"pk\": \"id\",\n        \"pk_type\": \"int\",    \n        \"time_of_day_save\": {\n          \"day\": \"always\",\n          \"night\": \"always\",\n          \"nightday\": \"always\",\n          \"daynight\": \"always\",\n          \"periodic\": \"always\"\n        }      \n      },          \n      \"values\": {\n        \"AS_EXAMPLE3_TEMP\": {\n          \"name\": \"${EXAMPLE3_TEMP}\",\n          \"format\": \"{dp=2|deg}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example 3 Temp from Openweather API\",\n          \"type\": \"number\",\n          \"dbtype\": \"float\",     \n          \"database\": {\n            \"include\" : \"true\"\n          }          \n        },\n        \"AS_EXAMPLE3_HUMIDITY\": {\n          \"name\": \"${EXAMPLE3_HUMIDITY}\",\n          \"format\": \"{dp=0|per}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"Example 3 Humidity from Openweather API\",\n          \"type\": \"number\"\n        }        \n      }\n    }\n</code></pre> <p>This modfifies the <code>meta_data</code> to</p> <ul> <li>Not add every field to the database automatically</li> <li>Sets the database type for the Temperature field</li> <li>Saves the temperature field to the database</li> <li>Since the Humidity field has no database settings it will not be saved</li> </ul> <p> </p> <p>The resulting database table when only saving one value</p>"},{"location":"developer_guide/building_module/database.html#database-rules","title":"Database Rules","text":"<ul> <li>Only store numeric values, text values are of little use at present</li> <li>Be mindful of data volumes, don't store huge amounts of data</li> <li>Ensure your plugin provides the db config purge information</li> </ul>"},{"location":"developer_guide/building_module/overview.html","title":"Overview","text":"<p>This section provides guides on building some example modules for Allsky. </p> <p>The following points should be considered when developing modules</p> <ul> <li>All module filenames must be prefixed with <code>allsky_</code></li> <li>All modules must be unique i.e. there can only be one <code>allsky_example</code> module</li> <li>The module manager is sensitive to errors in the meta_data structure. Please ensure the structure is valid JSON</li> <li>Modules must return a result, a text string indicating the outcome of the module. This is used in the module debug popup in the module manager</li> <li>All of the example modules here can be found in the allsky modules repository</li> </ul>"},{"location":"developer_guide/building_module/overview.html#tips-when-writing-modules","title":"Tips when writing modules","text":"<ul> <li>Ensure you limit the modules to the correct pipelines. Some modules make sense to run in the capture pipelines, dya and night and some don't</li> <li>Ensure you keen the version numbers and changelog updated when releasing new versions, this helps the module installer identify new versions</li> <li>DO NOT write modules that take a long time to execute and put them in the capture pipelines, this can cause delays in capturing imgages</li> <li>Make use of the functions available in the Shared Module module</li> <li>Make use of the env.json file, by setting <code>\"secret\": \"true\"</code> where required for module arguments, This ensures that sensitive data is never passed outside of Allsky</li> <li>If you are using the database ensure you setup the required purging</li> </ul>"},{"location":"developer_guide/building_module/simple_module.html","title":"Simple Module","text":"<p>Lets build a simple module. The module will</p> <ul> <li>Read data from a json file somewhere in the filesystem</li> <li>Extract a value from the json file and create an allsky variable</li> </ul> <p>Tip</p> <p>This module has the 'testable' meta_data value set. This means that you can add the module to a pipeline and use the test button in the module settings to check on progress. </p> <p>We will be using the following json file so create a file somewhere on the pi and add the following contents to it.</p> <pre><code>{\n  \"example\": 21.22,\n  \"example1\": 45.01\n}\n</code></pre>"},{"location":"developer_guide/building_module/simple_module.html#basic-framework","title":"Basic Framework","text":"<p>First we need the very basic framework for a module</p> <pre><code>import allsky_shared as allsky_shared\nfrom allsky_base import ALLSKYMODULEBASE\n\nclass ALLSKYEXAMPLE(ALLSKYMODULEBASE):\n\n  meta_data = {\n    \"name\": \"Allsky Example Module\",\n    \"description\": \"A simple example module for Allsky.\",\n    \"module\": \"allsky_example\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\",\n      \"day\",\n      \"night\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example.json\", \n    \"arguments\":{\n    },\n    \"argumentdetails\": {                     \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n\n  def run(self):\n    result = ''\n\n    return result\n\ndef example(params, event):\n    allsky_example = ALLSKYEXAMPLE(params, event)\n    result = allsky_example.run()\n\n    return result    \n\ndef example_cleanup():   \n    moduleData = {\n        \"metaData\": ALLSKYEXAMPLE.meta_data,\n        \"cleanup\": {\n            \"files\": {\n                ALLSKYEXAMPLE.meta_data['extradatafilename']\n            },\n            \"env\": {}\n        }\n    }\n    allsky_shared.cleanupModule(moduleData)\n</code></pre> <p>This will allow the module to be displayed in the module manager for the relevant pipelines but it wont actually do anything just yet.</p>"},{"location":"developer_guide/building_module/simple_module.html#add-arguments","title":"Add Arguments","text":"<p>Next we need to add some fields that specify where the file is that contains the json data. This is accomplished by adding values to the <code>arguments</code> and <code>argumentsdetails</code> sections of the <code>meta_data</code></p> <p>Change the <code>arguments</code> and <code>argumentdetails</code> section of the <code>meta_data</code> variable to the following</p> <pre><code>    \"arguments\":{\n      \"filename\": \"\"\n    },\n    \"argumentdetails\": {\n      \"filename\": {\n        \"required\": \"true\",\n                \"description\": \"Filename\",\n        \"help\": \"The location of the json file to read data from\"\n      }                \n    },\n</code></pre> <p>This adds a field called <code>Filename</code> to the module options</p>"},{"location":"developer_guide/building_module/simple_module.html#use-the-arguments","title":"Use the arguments","text":"<p>Next we need to make use of the arguments to read the json file.</p> <p>Change the <code>run</code> module method to the following</p> <pre><code>  def run(self):\n    result = \"\"\n\n    file_name = self.get_param(\"filename\", \"\", str, True) \n\n    json_data = allsky_shared.load_json_file(file_name)\n\n    if json_data:\n      pass\n    else:\n      result = f\"ERROR: File {file_name} does not contain valid JSON.\"\n\n\n    return result\n</code></pre> <p>A couple of important points here</p> <ul> <li><code>self.get_param</code> has been used to get the value entered in the module manager. This method must be used to access all values from the module manager. Refer to the Base Class documentation for details of this method.</li> <li>The <code>load_json_file</code> helper function from the <code>allsky_shared</code> module is used to read the json file. This makes reading json files a lot easier. Refer to the Shared Module documentation for details of this method.</li> <li>Note how the result variable is set in any error condition to ensure we have more than an empty string returned.</li> </ul>"},{"location":"developer_guide/building_module/simple_module.html#create-the-allsky-variable","title":"Create The Allsky Variable","text":"<p>Next we need to use the data from the json file to create the allsky variable, which will be available in the overlay manager</p> <p>Change the <code>run</code> module method to the following</p> <pre><code>  def run(self):\n    result = \"\"\n\n    file_name = self.get_param(\"filename\", \"\", str, True) \n\n    json_data = allsky_shared.load_json_file(file_name)\n\n    if json_data:\n      if \"example\" in json_data:\n        value = json_data[\"example\"]\n        extra_data = {}\n        extra_data[\"AS_EXAMPLE\"] = value\n        allsky_shared.save_extra_data(self.meta_data['extradatafilename'], extra_data, 'internal')\n        result = f\"INFO: Data read from {file_name} and variable AS_EXAMPLE created\"\n      else:\n        result = f\"ERROR: The 'example' value is missing from the json file\"\n\n    else:\n      result = f\"ERROR: File {file_name} does not contain valid JSON.\"\n\n    self.log(4, result)\n\n    return result\n</code></pre> <p>This creates the extra_data dict and then calls the <code>allsky_shared.save_extra_data</code> method to actually save the data. This will create a file in <code>~/allsky/tmp/extra</code> called <code>allsky_example.json</code> containing the variable and value, this can then be used in the overlay editor</p>"},{"location":"developer_guide/building_module/simple_module.html#define-the-allsky-variable","title":"Define the Allsky Variable","text":"<p>In the example above Allsky knows nothing about what the variable you have created is, this will cause limitations in the overlay editor.</p> <p>To get the best out of the overlay editor it needs to understand what the variable you have created actually is. The <code>meta_data</code> structure can be used to define the variable in more detail</p> <p>Change the <code>meta_data</code> structure to the following</p> <pre><code>  meta_data = {\n    \"name\": \"Allsky Example Module\",\n    \"description\": \"A simple example module for Allsky.\",\n    \"module\": \"allsky_example\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\",\n      \"day\",\n      \"night\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example.json\", \n    \"extradata\": {\n      \"values\": {\n        \"AS_EXAMPLE\": {\n          \"name\": \"${EXAMPLE}\",\n          \"format\": \"{dp=0|per}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"My Example Value\",\n          \"type\": \"number\"\n        }\n      }      \n    },\n    \"arguments\":{\n      \"filename\": \"\"\n    },\n    \"argumentdetails\": {\n      \"filename\": {\n        \"required\": \"true\",\n        \"description\": \"Filename\",\n        \"help\": \"The location of the json file to read data from\"\n      }                \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n</code></pre> <p>This adds the <code>extradata</code> section that defines the variable(s) the module is going to create. The structure of this ection is detailed in Meta Data Documentation.</p> <p>In the definition we added we are telling Allsky that </p> <ul> <li>the variable is number, formatted to 0 decimal places with a percent sign added</li> <li>The variable will be displayed in a group called 'User' in the Variable Manager</li> </ul>"},{"location":"developer_guide/building_module/simple_module.html#adding-more-variables","title":"Adding more variables","text":"<p>Our json file contains a second value so lets add that as well by adding the new variable to the <code>meta_data</code> and setting it in the <code>run</code> method</p> <p>Make the following changes</p> <pre><code>  meta_data = {\n    \"name\": \"Allsky Example Module\",\n    \"description\": \"A simple example module for Allsky.\",\n    \"module\": \"allsky_example\",    \n    \"version\": \"v1.0.0\",\n    \"group\": \"Data Capture\",\n    \"events\": [\n      \"periodic\",\n      \"day\",\n      \"night\"\n    ],\n    \"enabled\": \"false\",    \n    \"experimental\": \"true\",\n    \"testable\": \"true\",  \n    \"centersettings\": \"false\",\n    \"extradatafilename\": \"allsky_example.json\", \n    \"extradata\": {\n      \"values\": {\n        \"AS_EXAMPLE\": {\n          \"name\": \"${EXAMPLE}\",\n          \"format\": \"{dp=0|per}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"My Example Value\",\n          \"type\": \"number\"\n        },\n        \"AS_EXAMPLE1\": {\n          \"name\": \"${EXAMPLE1}\",\n          \"format\": \"{dp=2}\",\n          \"sample\": \"\",                   \n          \"group\": \"User\",\n          \"description\": \"My Example Value 2\",\n          \"type\": \"number\"\n        }        \n      }      \n    },\n    \"arguments\":{\n      \"filename\": \"\"\n    },\n    \"argumentdetails\": {\n      \"filename\": {\n        \"required\": \"true\",\n        \"description\": \"Filename\",\n        \"help\": \"The location of the json file to read data from\"\n      }                \n    },\n    \"businfo\": [\n    ],\n    \"changelog\": {\n      \"v1.0.0\" : [\n        {\n          \"author\": \"Alex Greenland\",\n          \"authorurl\": \"https://github.com/allskyteam\",\n          \"changes\": \"Initial Release\"\n        }\n      ] \n    }\n  }\n</code></pre> <pre><code>  def run(self):\n    result = \"\"\n\n    file_name = self.get_param(\"filename\", \"\", str, True) \n\n    json_data = allsky_shared.load_json_file(file_name)\n\n    if json_data:\n      if \"example\" in json_data and \"example1\" in json_data:\n        extra_data = {}\n        extra_data[\"AS_EXAMPLE\"] = json_data[\"example\"]\n        extra_data[\"AS_EXAMPLE1\"] = json_data[\"example1\"]\n        allsky_shared.save_extra_data(self.meta_data['extradatafilename'], extra_data, self.meta_data['module'], self.meta_data['extradata'])\n        result = f\"INFO: Data read from {file_name} and variable AS_EXAMPLE created\"\n      else:\n        result = f\"ERROR: The 'example' and 'example1' values are missing from the json file\"\n\n    else:\n      result = f\"ERROR: File {file_name} does not contain valid JSON.\"\n\n    self.log(4, result)\n\n    return result\n</code></pre> <p>Now when you test the module two variables are created. Note that the second variable differs from the first in that its formatted to 2 decimal places</p>"}]}