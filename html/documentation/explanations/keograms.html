<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="../documentation.js" type="application/javascript"></script>
	<link href="../css/light.css" rel="stylesheet">
	<link href="../css/documentation.css" rel="stylesheet">
	<link href="../documentation-favicon.ico" rel="shortcut icon" type="image/png">
	<title>Keograms</title>
</head>
<body>
<div class="d-flex flex-column flex-md-row gh-header">
	<h1 class="flex-auto min-width-0 mb-2 mb-md-0 mr-0 mr-md-2 gh-header-title" id="onPage">Keograms Explained</h1>
</div>
<div class="xcontainer-xl px-3 px-md-4 px-lg-5 mt-4">
<div data-view-component="true" class="Layout Layout--flowRow-until-md Layout--sidebarPosition-end Layout--sidebarPosition-flowRow-end">
<div data-view-component="true" class="Layout-sidebar wiki-rightbar">
	<div w3-include-html="/documentation/sidebar.html" id="sidebar"></div>
</div>
<div data-view-component="true" class="Layout-main"><div class="markdown-body" id="mainContents">

<p>
A <b>Keogram</b> is an image giving a quick view of a night's activity.
For each nighttime image a central vertical column 1 pixel wide is extracted.
All these columns are then stitched together from left to right.
This results in a timeline that reads from dusk to dawn.
</p>
<img allsky="true" src="keogram.png" title="Sample Keogram" class="imgBorder">
<p>
To get the best results north should be at the top of the image.
If it's not, include <code>--rotate DEG</code> in the
<span class="shSetting">KEOGRAM_EXTRA_PARAMETERS</span> setting in <code>config.sh</code>,
where "DEG" is the degrees of rotation.
That way, using a fisheye lens, you end up with the bottom of the keogram
being the southern horizon and the top being the northern horizon.
</p>

<blockquote>
The keogram will only show what happens at the meridian during the night
and will not display events on the east or west.
</blockquote>

<p>
The <code>keogram</code> program takes multiple arguments:
</p>
<pre>
Usage:  keogram -d <imagedir> -e <ext> -o <outputfile> [KEOGRAM_EXTRA_PARAMETERS]

Arguments:
-d | --directory <str> : directory from which to load images (required)
-e | --extension <str> : image extension to process (required)
-o | --output-file <str> : name of output file (required)
-r | --rotate <float> : number of degrees to rotate image, counterclockwise (0)
-s | --image-size <int>x<int> : only process images of a given size, eg. 1280x960
-h | --help : display this help message
-v | --verbose : Increase logging verbosity
-n | --no-label : Disable hour labels
-C | --font-color <str> : label font color, in HTML format (0000ff)
-L | --font-line <int> : font line thickness (3)
-N | --font-name <str> : font name (simplex)
-S | --font-size <float> : font size (2.0)
-T | --font-type <int> : font line type (1)
-Q | --max-threads <int> : limit maximum number of processing threads. (use all cpus)
-q | --nice-level <int> : nice(2) level of processing threads (10)
-x | --image-expand : expand image to get the proportions of source - avoids tall and narrow images
-c | --channel-info : show channel infos - mean value of R/G/B
-f | --fixed-channel-number <int> : define number of channels 0=auto, 1=mono, 3=rgb (0=auto)

Font name is one of these OpenCV font names:
        Simplex, Plain, Duplex, Complex, Triplex, ComplexSmall, ScriptSimplex, ScriptComplex
Font Type is an OpenCV line type: 0=antialias, 1=8-connected, 2=4-connected
</pre>

<p>
Example when running the program manually:
</p>
<pre>
cd ~/allsky
./keogram -d images/20220710/ -e jpg -o images/20220710/keogram/keogram.jpg --rotate 42 --font-size 2
</pre>

<p>
To disable keograms, open <code>config.sh</code> in the WebUI's <b>Editor</b> page
and set <span class="shSetting">KEOGRAM</span> to "false".
</p>

<blockquote>
If you set the
<span class="WebUISetting">Image Width</span> and
<span class="WebUISetting">Image Height</span>
of your camera in the WebUI <b>Camera Settings</b> page to the actual values of your camera,
keogram generation will skip any file that's not the correct size.
This will eliminate any garbage images that happen to be generated.
</blockquote>


</div><!-- markdown-body --></div><!-- Layout-main ... -->
</div><!-- Layout -->
</div><!-- xcontainer-x1 ... -->
</body>
</html>
<script> includeHTML(); </script>
