<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="../js/documentation.js" type="application/javascript"></script>
	<link href="../css/light.css" rel="stylesheet">
	<link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="../bower_components/jquery/dist/jquery.min.js"></script>
	<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<style>
		#pageTitle::before {
			content: "Modules";
		}
	</style>
	<link href="../css/documentation.css" rel="stylesheet">
	<link href="../documentation-favicon.ico" rel="shortcut icon" type="image/png">
	<script src="../js/all.min.js" type="application/javascript"></script>
	<title>Modules</title>
</head>

<body>
	<div w3-include-html="/documentation/pageHeader.html" id="pageHeader"></div>
	<div class="Layout">
		<div class="Layout-sidebar" w3-include-html="/documentation/sidebar.html" id="sidebar"></div>
		<div class="Layout-main markdown-body" id="mainContents">


			<p><strong>Modules</strong> provide functionality that can be used to enhance
				images created by Allsky.
				Different modules perform different tasks,
				and the <span class="managerName">Module Manager</span>
				allows you to control which modules run and when.
			</p>
			<p>There are two types of modules:</p>
			<ol>
				<li><strong>Allsky Modules</strong> are developed and maintained
					by the Allsky team and are installed with Allsky.</li>
				<li><strong>User Modules</strong> are developed and maintained
					by other people and can optionally be installed
					and deleted if no longer required.
					<blockquote class="warning">
						User Modules should only be installed from the official
						<a external="true" href="https://github.com/AllskyTeam/allsky-modules">
						user-modules</a> repository using the directions listed there.
						Installing from other source can be dangerous.
					</blockquote>
					</li>
			</ol>

			Warning:
			<ul>
				<li>Some modules are shown as <strong>experimental</strong>.
					Before using these modules you should ensure that you are proficient
					in analysing Linux log files.
					Experimental modules can be unstable and as such may "break" Allsky.
					In the <span class="managerName">Module Manager</span>
					settings you can enable/disable showing experimental modules.</li>
				<li>Some modules are designed to operate with external hardware,
					typically connected to the Pi's GPIO pins.
					Before attempting to use any of these modules you should ensure
					you have an understanding of interfacing hardware to the PI's GPIO.
			</ul>

			<p>Please don't be discouraged by the above warnings.
				The module system is very flexible and allows you to
				customise the Allsky software to your requirements without having to
				change any Allsky code.</p>


			<h2>Module Flows</h2>
			<div>
				<p>Modules are run within <strong>Flows</strong>
					which determine when the modules are run.
					Each flow can have a different list of modules that are run
					and the order in which they are run.
					The different flows are listed below.
				</p>
				<details>
					<summary></summary>
					<p>The flows in which modules run are:</p>
					<ul class="minimalPadding">
						<li><strong>Daytime Capture</strong> - Modules in this flow
							are run after every daytime image is captured and saved.
						</li>
						<li><strong>Nighttime Capture</strong> - Modules in this flow
							are run after every nighttime image is captured and saved.
						</li>
						<li><strong>Day to Night Transition</strong> - Modules in this flow
							are run when Allsky switches from Daytime to Nighttime capturing per the
							<span class="WebUISetting">latitude</span>,
							<span class="WebUISetting">longitude</span>, and
							<span class="WebUISetting">angle</span>
							you've defined in the WebUI.
						</li>
						<li><strong>Night to Day Transition</strong> - Modules in this flow
							are run when Allsky switches from Nighttime to Daytime capturing.
						</li>
						<li><strong>Periodic jobs</strong> - Modules in this flow
							are run periodically and are not related to image capture.
							Each module defines how often it runs.</li>
					</ul>
					<p>The diagram below shows each stage of the capture process and how modules fit into it.
					</p>

					<img allsky="true" loading="lazy" src="Flows.png" alt="Flows" class="imgCenter" />
				</details>
			</div>


			<h2>The 'Module Manager'</h2>
			<div>
				<p>The <span class="managerName">Module Manager</span>
					is the main interface for managing the modules and in
					which flows they are used.</p>
				<details>
					<summary></summary>
					<img allsky="true" loading="lazy" src="Module-Manager.png" alt="Module Manager" />

					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Annotation</th>
								<th>Icon</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td class="WebUISetting">Save</td>
								<td><i class="fa fa-save fa-lg"></i></td>
								<td>This will be enabled when any changes have been made</td>
							</tr>
							<tr>
								<td class="WebUISetting">Upload</td>
								<td><i class="fa-solid fa-upload"></i></td>
								<td>This will allow you to upload a zip file containing a new or updated module.
									Please see the section on uploading a modules for more details on
									how to use this feature.</td>
							</tr>
							<tr>
								<td class="WebUISetting">Flow</td>
								<td></td>
								<td>The flow you wish to manage. If you have un saved changes from the current
									flow you will be prompted to save them before switching</td>
							</tr>
							<tr>
								<td class="WebUISetting">Settings</td>
								<td><i class="fa-solid fa-gear"></i></td>
								<td>Displays the settings dialog for the <span class="managerName">Module Manager</span></td>
							</tr>
							<tr>
								<td class="WebUISetting">Debug</td>
								<td><i class="fa-solid fa-bug"></i></td>
								<td>Displays the debug data for modules. This icon is only visible if its been
									enabled in the settings</td>
							</tr>
							<tr>
								<td class="WebUISetting">Reset</td>
								<td><i class="fa-solid fa-rotate-right"></i></td>
								<td>Resets the selected flow to the installation default</td>
							</tr>
							<tr>
								<td class="WebUISetting">Restore</td>
								<td><i class="fa-solid fa-upload"></i></td>
								<td>Restores the flow to the last backup. This option will only be visible if there is a
									restore poitn available</td>
							</tr>


						</tbody>
					</table>

					<h4>Selecting a flow</h4>
					<div>
						<p>From the drop down list select the flow that you wish to amend. If there are unsaved
							changes for the current flow then you will be prompted to save them before switching
							to a new flow. The current day/night flow will automatically be selected depending
							upon the current time of day
						</p>
					</div>

					<h4>Uploading a module</h4>
					<blockquote>WARNING: Please only upload modules from trusted sources. All modules uploaded are done
						so at your own risk.</blockquote>
					<p>To upload a module it must be contained within a zip file with the same name as the module. So
						for example if I have a module called allsk_test.py the zip file must be called allsky_test.zip
					</p>

					<h4>Enabling a module</h4>
					<div>
						<p>To enable a module drag it from the Available column to the Enabled column. The
							module will become active after the flow has been saved.</p>
						<p>Most modules will require some configuration. Modules can only be configured after
							they have been moved to the Enabled column, clicking the settings button will
							display any configuration options for the module</p>
						<p><strong>Don't</strong> forget to ensure the enabled checkbox is selected otherwise
							the module will not run. You can set modules to be automatically enabled when
							dragging them to the enabled column by setting the appropriate options in the module
							editor settings</p>
					</div>

					<h4>Disabling a Module</h4>
					<div>
						<p>There are two ways to disable a module</p>
						<ul>
							<li>Drag the module to the Available column - This will disable the module and lose
								any settings for it</li>
							<li>Uncheck the enable checkbox - This will disable the module but retain any
								settings. This is the preferred method if you just wish to temporarily disable a
								module</li>
						</ul>

						<h4>Setting the Module execution order</h4>
						<p>The modules will be run in the order they appear in the Enabled column. To change the
							order simply drag the modules up or down the list.</p>
						<p>It is <strong>not</strong> possible to move any modules displayed in red</p>
					</div>

					<h3>Module Manager Settings</h3>
					<div>
						<table class="module-settings vtop">
							<tr>
								<td><img allsky="true" loading="lazy" src="module-manager-settings.png"
										alt="Module manager Settings" /></td>
								<td>
									<ul>
										<li><strong>Enable Watchdog</strong> - When enabled any modules that
											take longer than the max timer will automatically be disabled</li>
										<li><strong>Module Max Time</strong> - The maximum time a module can run
											for before its automatically disabled</li>
										<li><strong>Auto Enable</strong> - If enabled then when a module is
											added to the 'Selected' column it is enabled</li>
										<li><strong>Show Experimental</strong> - When enabled any experimental
											modules will be available</li>
										<li><strong>Debug Mode</strong> - When enabled a debug option is
											available in the toolbar which will show the results and execution
											time for each module</li>
										<li><strong>Periodic Timer</strong> - How frequently, in seconds, the periodic
											flow is run</li>
									</ul>
									<blockquote>On occasion you may find that a module has been deactivated. THis can be
										caused by the module taking longer than the 'Module Max Time' if the watchdog is
										enabled. To prevent this happening you can either up the time value or disable
										the watchdog all together</blockquote>
								</td>
							</tr>
						</table>
					</div>
				</details>
			</div>


			<h2 id="Modules">Modules</h2>
			<div>
				<p>Modules form the heart of the module manager and there is a wide variety available. In this
					section each module is described in details along with all of the available settings.</p>
				<h3>Core Modules</h3>
				<details>
					<summary></summary>
					<p>The Core Modules are installed along with the main Allsky installer. The available
						modules are</p>

					<h4>Load Image</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Loads the last image taken by Allsky. This is always the first module
										that is run during the daytime and nighttime capture to ensure that
										the image is available to all subsequent modules</p>
									<p>This module is enabled in the day and nighttime flows by default so
										there is no need to install it</p>
									<blockquote>Since this module must always run first it is not possible
										to move or remove this module from the day and nighttime capture
										flows</blockquote>
								</td>
							</tr>
						</tbody>
					</table>

					<h4>Save Image</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Saves the final image after all of the modules have run. This is
										always the last module that is run during the daytime and nighttime
										capture</p>
									<p>This module is enabled in the day and nighttime flows by default so
										there is no need to install it</p>
									<blockquote>Since this module must always run last it is not possible to
										move or remove this module from the day and nighttime capture flows
									</blockquote>
								</td>
							</tr>
						</tbody>
					</table>

					<h4>Mask Image</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This applies a mask to the image. This can be useful if there are
										artefacts outside of the image circle that you wish to remove.
										Create a mask with white in the areas you wish to keep and black in
										the areas you wish to be black, see the section on creating and
										using masks</p>
								</td>
							</tr>
						</tbody>
					</table>


					<h4>Clear Sky</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This attempts to work out if the sky is clear. It does this by
										counting the stars in a Region of Interest (ROI) and if this is
										above a threshold the sky is assumed to be clear. The modules
										settings allow you to specify the ROI on the image and the
										parameters for detecting stars. If required the current calculated
										sky state can be sent to an MQTT broker. Certain other modules can
										also use the results of this module. For example the Star Count
										module can be set to only run if the sky is clear, as determined by
										this module. It is recommended to run this module early in the flow,
										generally after the mask module</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-clearksy-settings-home.png"
									alt="Clearksy Settings" /></td>
							<td>
								<ul>
									<li><strong>Region Of Interest</strong> - The region (ROI) of the image
										to use for clear sky detection</li>
									<li><strong>Fallback %</strong> - If no ROI is specified then this %
										around the center of the image will be used</li>
									<li><strong>Clear Sky</strong> - The sky will be assumed clear if more
										than this number of stars are found within the ROI</li>
									<li><strong>Detection Threshold</strong> - Lowering this value will
										detect more stars, possibly false positives. Increasing it will
										detect less stars</li>
									<li><strong>Distance Threshold</strong> - Any stars fond within this
										number of pixels of another star will only count as a single star.
										Reducing this value will increase the number of detected stars but
										also increase the number of false positives found</li>
									<li><strong>Star Template Size</strong> - The size of a 'standard' star.
										reducing this value will detect more stars and false positives</li>
									<li><strong>Mask Path</strong> - The mask that is applied to the image
										before any star detection. This is useful to exclude areas of the
										image that you do not want examined for stars.</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-clearksy-settings-debug.png"
									alt="Clearksy Settings" />
							</td>
							<td>
								<p>These options are for debugging and should not be used for normal
									operation</p>
								<ul>
									<li><strong>Annotate Stars</strong> - Draws a circle around each
										detected star.
										This is useful when tuning the detection values</li>
									<li><strong>Enable Debug Mode</strong> - When selected an image is saved
										into
										the allsky/tmp/debug folder after each stage of the detection
										process.</li>
									<li><strong>Debug Image</strong> - If an image is specified then this is
										used
										rather than the last image taken by Allsky. This is useful for
										configuring
										the star detection during the day by using a previously captured
										image</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-clearksy-settings-mqtt.png"
									alt="Clearksy Settings" /></td>
							<td>
								<blockquote>This is an advanced option and requires a MQTT broker. The setup
									and operation of
									a broker is beyond the scope of this document</blockquote>
								<ul>
									<li><strong>Enable MQTT</strong> - Select this option to enable
										publishing to
										the MQTT Broker</li>
									<li><strong>MQTT Broker Address</strong> - The FQDN or IP address of the
										broker
									</li>
									<li><strong>MQTT Broker Address</strong> - The port number of the Broker
									</li>
									<li><strong>MQTT Username</strong> - The username to login to the Broker
									</li>
									<li><strong>MQTT Password</strong> - The password to login to the Broker
									</li>
									<li><strong>MQTT Topic</strong> - The topic to post the Sky State to
									</li>
								</ul>
							</td>
						</tr>
					</table>


					<h4>Star Count</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This counts stars in the captures Allsky Image.</p>
									<p>Stars are counted by using a template that looks like a star and
										attempts to locate anything in the image that looks like it. This
										works well when the image is well exposed and masked to remove any
										areas</p>
									<p>You will need to experiment with the detection values to get the best
										results, annotating the stars in the image can be very helpful. The
										Moon can also cause issues and a future versions of this module
										will automatically mask the Moon, or any other bright areas and also
										allow you to disable the module when the Moon meets certain critera
										such as over a certain % brightness and elevation</p>
									<blockquote>This module is experimental and as such may produce
										erroneous results</blockquote>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-starcount-settings-home.png"
									alt="Starcount Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Detection Threshold</strong> - Lowering this value will
										detect more stars, possibly false positives. Increasing it will
										detect less stars</li>
									<li><strong>Distance Threshold</strong> - Any stars fond within this
										number of pixels of another star will only count as a single star.
										Reducing this value will increase the number of detcted stars but
										also increase the number of false positives found</li>
									<li><strong>Star Template Size</strong> - The size of a 'standard' star.
										reducing this value will detect more stars and false positives</li>
									<li><strong>Mask Path</strong> - The mask that is applied to the image
										before any star detection. This is useful to exclude areas of the
										image that you do not want examined for stars.</li>
									<li><strong>Use Clear Sky</strong> - If the 'Clear Sky' module is
										running then its results will be used to determine if stars should
										be counted. If the sky is not clear then no attempt will be made to
										count stars</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-starcount-settings-debug.png"
									alt="Starcount Settings" />
							</td>
							<td>
								<blockquote>These options are for debugging and should not be used for
									normal operation</blockquote>
								<ul>
									<li><strong>Annotate Stars</strong> - Draws a circle around each
										detected star. This is useful when tuning the detection values</li>
									<li><strong>Enable Debug Mode</strong> - When selected an image is saved
										into the allsky/tmp/debug folder after each stage of the detection
										process.</li>
									<li><strong>Debug Image</strong> - If an image is specified then this is
										used rather than the last image taken by Allsky. This is useful for
										configuring the star detection during the day by using a previosuly
										captured image</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>Meteor Detection</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This attempts to detect any meteors in the image. The detection
										method looks for hard edged in the images and thus is susceptible to
										false positives if the image is not masked.</p>
									<p>You will need to experiment with the detection values to get the best
										results, annotating the meteors in the image can be very helpful.
										The Moon can also cause issues and a future versions of this module
										will automatically mask the Moon, or any other bright areas and also
										allow you to disable the module when the Moon meets certain criteria
										such as over a certain % brightness and elevation</p>
									<blockquote>This module is experimental and as such may produce
										erroneous results</blockquote>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-meteor-settings-home.png"
									alt="Meteorcount Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Mask Path</strong> - The mask that is applied to the image
										before any meteor detection. This is useful to exclude areas of the
										image that you do not want examined for stars.</li>
									<li><strong>Minimum</strong> - Any streaks longer than this number of
										pixels will be considered a meteor</li>
									<li><strong>Use Clear Sky</strong> - If the 'Clear Sky' module is
										running then its results will be used to determine if meteors should
										be detected. If the sky is not clear then no meteor detection will
										be attempted</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-meteor-settings-debug.png"
									alt="Meteorcount Settings" />
							</td>
							<td>
								<blockquote>These options are for debugging and should not be used for
									normal operation</blockquote>
								<ul>
									<li><strong>Annotate Meteors</strong> - Any detected meteors will be
										highlighted in the image</li>
									<li><strong>Enable Debug Mode</strong> - When selected an image is saved
										into the allsky/tmp/debug folder after each stage of the detection
										process.</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>Export</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Exports all internal Allsky variables to a json file. By default all
										environment variables prefixed with AS_ are exported but via the
										module options other Allsky variables can also be made available.
										This can be used by external programs</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-export-settings-home.png"
									alt="Export Settings" /></td>
							<td>
								<ul>
									<li><strong>File Location</strong> - The location to save the file.
										Certain Allsky variables can be used to construct the path. See the
										variables section for more details</li>
									<li><strong>Extra Data To Export</strong> - A comma separated list of
										additional variables to save</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>Overlay</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>Overlays data on the captured image. This module applies the fields
										defined in the 'Overlay Editor'. A full description of the editor is
										available in this documentation so is not covered here.</p>
									<blockquote>Typically the overlay module will run towardsm if not at the
										end of the flow. This will allow it access to other variables
										created by modules</blockquote>
								</td>
							</tr>
						</tbody>
					</table>

					<h4>Script</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This allows a script to be run. This should only be used by users
										that understand how script are developer/run on Linux.
										<strong>Extreme</strong> care must be taken when using this module
										is it could cause the main Allsky software to stop operating
									</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-script-settings-home.png"
									alt="Script Settings" /></td>
							<td>
								<ul>
									<li><strong>File Location</strong> - The script to execute. The module
										will check to ensure it exists and is executable before any attempt
										is made to run it</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>Save Image Data</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<p>This module writes image related data to a database allowing it to be
										graphed in the Web UI</p>
								</td>
							</tr>
						</tbody>
					</table>

				</details>

				<h3>User Modules</h3>
				<details>
					<summary></summary>
					<p>The User Modules are installed from a separate GitHub repository and not included with
						the mainAllsky installation</p>

					<h4>Cloud Cover</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
									</ul>
								</td>
								<td>
									<blockquote><strong>This is an advanced module and requires external
											hardware for its operation</strong></blockquote>
									<p>This module use an <a
											href="https://www.sparkfun.com/datasheets/Sensors/Temperature/MLX90614_rev001.pdf"
											target="_blank">MLX90614</a> to determine the cloud cover. The
										MLX90614 is a non contact Infra Red thermometer. It is used to
										measure the temperature of the sky and compare it to the ambient
										temperature. Generally the difference between the Sky temperature
										and
										ambient can be used to determine the amount of cloud. The exact
										theory for the calculations is beyond the scope of this
										documentation
									</p>
									<p>One of the big issues with using any for of sky temperature
										measurement is the sensor and water/snow ! If the sensor gets
										wet/covered then the readings will be useless. The best way to
										mounts the sensor is in a protective enclosure with the sensor
										mounted at 90 degrees to the sky and some form of reflective device
										used to reflect the sky at the sensor</p>
									<p>Two different methods are available for determining the cloud cover
									</p>
									<ul>
										<li><strong>Simple</strong> - The difference between Sky and ambient
											temperature is used to determine the cloud cover.</li>
										<li><strong>Advanced</strong> - Uses a polynomial model to correct
											the sky temperature reading. The forumale used in thei method have
											been derived from <a
												href="https://indiduino.wordpress.com/2013/02/02/meteostation/"
												target="_blank">https://indiduino.wordpress.com/2013/02/02/meteostation/</a>
											and <a
												href="https://lunaticoastro.com/aagcw/TechInfo/SkyTemperatureModel.pdf"
												target="_blank">https://lunaticoastro.com/aagcw/TechInfo/SkyTemperatureModel.pdf</a>
										</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-cloudcover-settings-sensor.png"
									alt="Cloud Cover Settings" />
							</td>
							<td>
								<ul>
									<li><strong>i2C Address</strong> - The default i2C address for the
										MLX90614 is 0x5A. If you need a different address specify it here in
										Hex</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-cloudcover-settings-settings.png"
									alt="Cloud Cover Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Clear Below</strong> - Below this Sky temperature it is
										assumed to be clear</li>
									<li><strong>Cloudy Above</strong> - Above this Sky temperature it is
										assumed to be cloudy</li>
								</ul>
								<p>Between the two above temperatures the sky is assumed to be partially
									cloudy</p>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-cloudcover-settings-advanced.png"
									alt="Cloud Cover Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Use Advanced Mode</strong> - If enabled the polynomial model
										will be used</li>
									<li><strong>k1</strong> - TBC</li>
									<li><strong>k2</strong> - TBC</li>
									<li><strong>k3</strong> - TBC</li>
									<li><strong>k4</strong> - TBC</li>
									<li><strong>k5</strong> - TBC</li>
									<li><strong>k6</strong> - TBC</li>
									<li><strong>k7</strong> - TBC</li>
								</ul>
								<p>Details of the formulae used cen be found on the lunaticoastro website <a
										href="https://lunaticoastro.com/aagcw/TechInfo/SkyTemperatureModel.pdf"
										target="_blank">here</a></p>
								<blockquote>Setting these values requires a lot of experimentation</blockquote>
							</td>
						</tr>
						<tr>
							<td>
								<img allsky="true" loading="lazy" src="cloud-cover.png" alt="Cloud Cover Circuit"
									width="500px" />
							</td>
							<td>
								<p>A typical connection diagram for a Cloud Cover sensor. As mentioned above the
									process of detecting clouds is not a simple one. The basic principle is to
									measure the difference between the ambient temperature and the temperature
									of the sky. The ambient is fairly easy to measure but the sky temperature
									presenets a few problems</p>
								<ul>
									<li>Field of View (FOV) - A narrow FOV will lead to results just above the
										sensor whereas a wide FOV will have less sensitivity. Testing has found
										that the narrow FOV versions provide a more accurate reading albeit with
										the much narrower FOV</li>
									<li>Moisture - Since the sensor needs to be pointed vertically if any
										moisture from rain/snow sits on it then the reading will be inaccurate
									</li>
								</ul>
								<p>The moisture problem is a little more difficult to solve and the best
									solution found is to mount the sensor horizontally and use a reflective
									surface to reflect the sky onto the sensor. This will allos the sensor to
									stay dry.</p>

								<p>Several environment variables are created that can be used in the overlay
									manager</p>
								<ul>
									<li><strong>CLOUDAMBIENT</strong> - The ambient temperature</li>
									<li><strong>CLOUDSKY</strong> - The sky temperature</li>
									<li><strong>CLOUDCOVER</strong> - A string, either 'Clear', 'Partial' or
										'Coudy'</li>
									<li><strong>CLOUDCOVERPERCENT</strong> - The percentage of cloud cover, only
										available when using the Advanced method</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>Dew Heater</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Daytime Capture</li>
										<li>Nighttime Capture</li>
										<li>Periodic</li>
									</ul>
								</td>
								<td>
									<blockquote><strong>This is an advanced module and requires external
											hardware for its operation</strong></blockquote>
									<p>This module allows you to control a digital GPIO pin that can in turn
										be used to drive a dew heater. The GPIO pin cannot directly drive
										the heater instead it must be used to drive some form of switch,
										relay / transistor etc to control the heater. The electronics to do
										this are beyond the scope of this documentation
									</p>
									<p>Some form of sensor is required to obtain the current temperature and
										humidity. The module supports the most common form of sensors
										available on the market today</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-dew-settings-sensor.png"
									alt="Dew Heater Settings" /></td>
							<td>
								<ul>
									<li><strong>Sensor Type</strong> - The type of sensor to use
										<ul>
											<li><strong>SHT31</strong> - Uses an SHT31 on i2c address 0x44.
												The alert mode on the SHT31 is not supported</li>
											<li><strong>DHT22</strong> - Uses a DHT22 sensor connected to a
												GPIO pin, the pin is selected in the 'Input Pin' option</li>
											<li><strong>DHT11</strong> - Uses a DHT11 sensor connected to a
												GPIO pin, the pin is selected in the 'Input Pin' option</li>
											<li><strong>BME280-I2C</strong> - Uses a BME280 in i2c mode on
												address 0x77</li>
										</ul>

									</li>
									<li><strong>Input Pin</strong> - The GPIO pin for the DHT11/22 sensors
									</li>
									<li><strong>i2C Address</strong> - If your sensor uses i2c and has a
										different address to the standard one for the sensor enter the HEX
										address here</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-dew-settings-heater.png"
									alt="Dew Heater Settings" /></td>
							<td>
								<ul>
									<li><strong>Heater Pin</strong> - The GPIO pin for the heater control
									</li>
									<li><strong>Startup Mode</strong> - Determines if the heater should be
										on when allsky starts or off</li>
									<li><strong>Invert Relay</strong> - Normally the GPIO pin will go high
										to enable a relay. Selecting this option if the relay is wired to
										activate on the GPIO pin going Low</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-dew-settings-control.png"
									alt="Dew Heater Settings" /></td>
							<td>
								<ul>
									<li><strong>Delay</strong> - The delay in seconds between sensor
										readings. If running in day or night flows then the frame exposure
										time needs to be taken into account.</li>
									<li><strong>Limit</strong> - If the temperature is within this many
										degrees of the dew point the heater will be enabled or disabled</li>
									<li><strong>Forced Temperature</strong> - If the temperature is below
										this value the heater will always be enabled</li>
									<li><strong>Max Heater Time</strong> - Not yet implemented</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td>
								<img allsky="true" loading="lazy" src="dew-heater.png" alt="Dew Heater Circuit"
									width="800px" />
							</td>
							<td>
								<p>A typical connection diagram for a dew heater. In this example a SHT31 is
									being used to provide the temperature and humidity data. The module will
									then determine if the heater is required and by enabling the relevant GPIO
									pin, 20 in this case</p>
								<blockquote><strong>WARNING</strong> driving relays directly from the pi's GPIO
									pins can be problematic and cause damage to your Pi. If you are using a
									module then please ensure its has a <a href="https://en.wikipedia.org/wiki/Snubber"
										target="_blank">snubber</a>
									and is optically isolated. Please check this <a
										href="https://forums.raspberrypi.com/viewtopic.php?f=91&t=83372&p=1225448#p1225448"
										target="_blank">FAQ</a> for more details.</blockquote>

								<p>Several environment variables are created that can be used in the overlay
									manager</p>
								<ul>
									<li><strong>DEWCONTROLAMBIENT</strong> - The ambient temperature</li>
									<li><strong>DEWCONTROLDEW</strong> - The calculated Dew point</li>
									<li><strong>DEWCONTROLHUMIDITY</strong> - The Humidity</li>
									<li><strong>DEWCONTROLHEATER</strong> - Either 'on' or 'off' indicating the
										status of the dew heater</li>
								</ul>
							</td>
						</tr>
					</table>


					<h4>GPIO</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Night/Day Transition</li>
										<li>Day/Night Transition</li>
									</ul>
								</td>
								<td>
									<blockquote><strong>This is an advanced module and requires external
											hardware for its operation</strong></blockquote>
									<p>This module allows a GPIO pin's state to be set on the transitions
										between day/night and night/day. This could for example be used to
										trigger some external electronics to cover and uncover the camera to
										protect it from direct sunlight in very warm climates</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-gpio-settings-home.png"
									alt="GPIO Settings" /></td>
							<td>
								<ul>
									<li><strong>GPIO Pin</strong> - The GPIO pin to set</li>
									<li><strong>Pin State</strong> - The state to set the pin to</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>Discord</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
										<li>Daytime Capture</li>
										<li>End of Night</li>
									</ul>
								</td>
								<td>
									<blockquote><strong>This is an advanced module and requires
											configuration in Discord</strong></blockquote>
									<blockquote>
										<strong>Python Version</strong> This module requires python 3.9.0 or
										greater. The module installer will not allow the module to be
										installed if you do not have the correct version of python installed
									</blockquote>
									<p>This module allows images to be sent to Discord channels. Currently
										the following images can be sent to Discord</p>
									<ul>
										<li>Daytime Images - To post these include the module in the daytime
											flow</li>
										<li>Nightime Images - To post these include the module in the
											nighttime flow</li>
										<li>Startrails - To post these include the module in the endofnight
											flow</li>
										<li>Keograms - To post these include the module in the endofnight
											flow</li>
										<li>Timelapse videos - To post these include the module in the
											endofnight flow</li>
									</ul>

									<blockquote>
										<strong>Rate Limits</strong> Discord implement a <a
											href="https://discord.com/developers/docs/topics/rate-limits"
											target="_blank">rate limit</a> on the API. It is very unlikely
										that by using this module you will hit any of the limits
									</blockquote>
									<blockquote>
										<strong>Post Sizes</strong> Discord implements a limit of 8Mb for
										any
										posted item. Its possible that the timelapse videos may exceed this
										rate so if you wish to send them to Discord you will have to
										configure AllskY to ensure that the video is less than 8Mb. The
										module will check before sending the file and if it exceeds the
										Discord limit it will not be sent and an error logged in the allsky
										log file
									</blockquote>
									<p>You will need to create Webhooks in your Discord server. These can be
										created from the server settings.</p>
									<img allsky="true" loading="lazy" src="discord-webhooks.png"
										alt="Discord Webhook" />
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-discord-settings-day.png"
									alt="Discord Settings" /></td>
							<td>
								<ul>
									<li><strong>Post Daytime Images</strong> - Select this option to post
										daytime images to the Discord Server</li>
									<li><strong>Daytime Count</strong> - Every x images send the current
										image to the Discord server</li>
									<li><strong>Daytime Webhook</strong> - The webhook for the daytime
										images. The value for this field is created in the Discord servers
										settings under integration</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-discord-settings-night.png"
									alt="Discord Settings" /></td>
							<td>
								<ul>
									<li><strong>Post Nighttime Images</strong> - Select this option to post
										nighttime images to the Discord Server</li>
									<li><strong>Nighttime Count</strong> - Every x images send the current
										image to the Discord server</li>
									<li><strong>Nighttime Webhook</strong> - The webhook for the nighttime
										images. The value for this field is created in the Discord servers
										settings under integration</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-discord-settings-startrails.png"
									alt="Discord Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Post Startrail Images</strong> - Select this option to post
										startrail images to the Discord Server</li>
									<li><strong>Startrail Webhook</strong> - The webhook for the startrail
										images. The value for this field is created in the Discord servers
										settings under integration</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-discord-settings-keograms.png"
									alt="Discord Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Post Keograms Images</strong> - Select this option to post
										keogram images to the Discord Server</li>
									<li><strong>Keograms Webhook</strong> - The webhook for the keogram
										images. The value for this field is created in the Discord servers
										settings under integration</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-discord-settings-timelapse.png"
									alt="Discord Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Post Timelapse Videos</strong> - Select this option to post
										timelapse videos to the Discord Server</li>
									<li><strong>Timelapse Webhook</strong> - The webhook for the timelapse
										videos. The value for this field is created in the Discord servers
										settings under integration</li>
								</ul>
								<blockquote>
									<strong>Post Sizes</strong> Discord implements a limit of 8Mb for any
									posted item. Its possible that the timelapse videos may exceed this rate
									so if you wish to send them to Discord you will have to configure AllskY
									to ensure that the video is less than 8Mb. The module will check before
									sending the file and if it exceeds the Discord limit it will not be sent
									and an error logged in the allsky log file
								</blockquote>
							</td>
						</tr>
					</table>

					<h4>Rain</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Nighttime Capture</li>
										<li>Daytime Capture</li>
									</ul>
								</td>
								<td>
									<blockquote>This is an advanced module and requires external hardware
									</blockquote>
									<p>This module uses an external sensor to detect rain. There are various
										cheap sensors available to detect rain that either provide an analog
										or digital output. This module only supports sensors with a digital
										output</p>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-rain-settings-home.png"
									alt="Rain Settings" /></td>
							<td>
								<ul>
									<li><strong>GPIO Pin</strong> - The GPIO pin the rain sensor is
										connected to</li>
									<li><strong>Invert Sensor</strong> - Normally the sensor will be high
										for clear and low for rain. This setting will reverse this</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td>
								<img allsky="true" loading="lazy" src="rain-detection.png" alt="Cloud Cover Circuit"
									width="500px" />
							</td>
							<td>
								<p>A typical connection diagram for rain detection using a cheap rain detection
									module. These modules provide both an analog and digital output but this
									module only works with the digital output.</p>
								<p>From testing these cheap sensors will work but the contact boards suffer
									badly from corrosion. A much better module is described <a
										href="https://www.kemo-electronic.de/en/House/Garden/M152-Rain-Sensor-12-V-DC.php"
										taregt="_blank">here</a>. Whilst more expensive and requiring a 12 volt
									supply this is a far superior rain/snow detector.</p>
								<p>Two environment variables are created that can be used in other
									modules or the overlay manager</p>
								<ul>
									<li><strong>RAINSTATE</strong> - A text string either 'Not Raining'
										or 'Raining'</li>
									<li><strong>ALLSKYRAINFLAG</strong> - A text string either 'False'
										or 'True'</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>Open Weather Map</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Periodic</li>
									</ul>
								</td>
								<td>
									<p>This module reads weather data from the free Open Weather Map API. To
										use this module you will need to signup for a free API key on the <a
											href="https://openweathermap.org/" target="_blank">openweathermap</a>
										website. The location used
										for the weather is the coordinates you have specified in the main
										Allsky settings</p>
									<blockquote>The free tier of the api is limited to 1,000 calls per day
										so you will need to configure the settings appropriately. Reading
										the data every 10 minutes is more than frequent enough and will
										ensure you do not exceed the api limit</blockquote>
									<p>Several environment variables are created that can be used in the
										overlay manager</p>
									<ul>
										<li><strong>OWWEATHER</strong> - A text string representing the
											weather</li>
										<li><strong>OWWEATHERDESCRIPTION</strong> - A text string
											representing the weather</li>
										<li><strong>OWTEMP</strong> - The temperature</li>
										<li><strong>OWTEMPFEELSLIKE</strong> - What the temperature feels
											like</li>
										<li><strong>OWTEMPMIN</strong> - The minimum temperature</li>
										<li><strong>OWTEMPMAX</strong> - The maximum temperature</li>
										<li><strong>OWPRESSURE</strong> - The pressure</li>
										<li><strong>OWHUMIDITY</strong> - The humidity</li>
										<li><strong>OWWINDSPEED</strong> - The wind speed</li>
										<li><strong>OWWINDDIRECTION</strong> - The wind direction</li>
										<li><strong>OWWINDGUST</strong> - The wind gust speed</li>
										<li><strong>OWCLOUDS</strong> - The cloud cover</li>
										<li><strong>OWRAIN1HR</strong> - Rainfall within the last hour</li>
										<li><strong>OWRAIN3HR</strong> - Rainfall within the last three
											hours</li>
										<li><strong>OWSUNRISE</strong> - Time the Sun rises</li>
										<li><strong>OWSUNSET</strong> - Time the Sun sets</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-openweathermap-settings-home.png"
									alt="Open Weather Map Settings" /></td>
							<td>
								<ul>
									<li><strong>API Key</strong> - The api key you generated after signing
										up to Open Weather Map</li>
									<li><strong>Filename</strong> - The name of the 'extra data' file the
										Open Weather Map data is saved in. Normally you should not need to
										change this</li>
									<li><strong>Read Every</strong> - Call the API every x seconds. Be
										mindful of the 1,000 API limit per day when setting this value</li>
									<li><strong>Units</strong> - The units to express the data in, Either
										'Standard' (SI Units), 'Metric' or 'Imperial'</li>
									<li><strong>Expiry Time</strong> - The number of seconds the data is
										valid for, see the overlay manager documentation for details</li>
								</ul>
							</td>
						</tr>
					</table>

					<h4>GPS</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Periodic</li>
									</ul>
								</td>
								<td>
									<p>This module was developed for those that use their Allsky cameras in mobile
										locations. It was developed to allow the Pi's location and clock to be set from
										the GPS data</p>
									<p>This module requires a gps connected to the pi that can be managed by gpsd</p>
									<blockquote><strong>NOTE:</strong> The HDMI and Wifi on the Pi 4 is VERY noise and
										will interfere with most GPS modules. To get around this problem please ensure
										that the GPS receiver and antenna is mounted at least three feet away from the
										Pi.</blockquote>
									<h4>Time synchronisation</h4>
									<p>Even if you set the time sync options in the GPS module the time will only be
										synchronised if the pi is NOT having its time updated from the internet.</p>
									<p>To test if the time is currently being synchronised fom the internet enter the
										following command</p>
									<div><tt>timedatectl status</tt></div>
									<p>Output similar to the following will be produced</p>

									<div class="modulecode">
										<div><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Local
												time: Fri 2023-02-03 23:18:36 GMT</tt></div>
										<div><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Universal
												time: Fri 2023-02-03 23:18:36 UTC</tt></div>
										<div><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RTC
												time: n/a</tt></div>
										<div><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time
												zone: Europe/London (GMT, +0000)</tt></div>
										<div><tt>System clock synchronized: <span class="red">no</span></tt></div>
										<div><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NTP
												service: <span class="red">inactive</span></tt></div>
										<div><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RTC in
												local TZ: <span class="red">no</span></tt></div>
									</div>

									<p>Note that the 'System clock synchronized' value is 'no'. With this value 'no' the
										GPS module will be allowed to set the time</p>
									<p>Several environment variables are created that can be used in the overlay manager
									</p>
									<ul>
										<li><strong>PIGPSFIX</strong> - A text string, either 'Yes' or 'No' indicating
											if the GPS has a fix</li>
										<li><strong>PIGPSUTC</strong> - The UTC time from the GPS</li>
										<li><strong>PIGPSLOCAL</strong> - The local time from the GPS</li>
										<li><strong>PIGPSOFFSET</strong> - The time offset from UTC in hours</li>
										<li><strong>PIGPSLAT</strong> - The GPS latitude in Degrees, Minutes and Seconds
										</li>
										<li><strong>PIGPSLON</strong> - The GPS longitude in Degrees, Minutes and
											Seconds</li>
										<li><strong>PIGPSLATDEC</strong> - The GPS latitude in decimal degrees, Minutes
											and Seconds</li>
										<li><strong>PIGPSLONDEC</strong> - The GPS longitude in decimal degrees, Minutes
											and Seconds</li>
										<li><strong>PIGPSFIXDISC</strong> - The lat/lon discrepancy string, if there is
											a decrepancy found</li>
									</ul>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-gps-home.png" alt="GPS Settings" /></td>
							<td>
								<ul>
									<li><strong>LAT/LON Warning</strong> - If enabled a warning will be generated, both
										in the log files and as an allsky variable if the GPS position does not match
										the All Sky settings. The comparison is done to 2 decimal places to allow for
										GPS fluctuation</li>
									<li><strong>Set LAT/LON</strong> - If enabled the lat/lon in the Allsky settings
										will get set from the GPS</li>
									<li><strong>Set Time</strong> - If enabled the tim eon the Pi will be set from the
										GPS</li>
									<li><strong>Set Every</strong> - If the 'Set Time' option is enabled the time on the
										Pi will be set every this number of seconds</li>
									<li><strong>Extra Data Filename</strong> - The name of the file to create the GPS
										data in for the overlay manager. Normally you will nto need to change this</li>
									<li><strong>Discrepancy Warning</strong> - if the 'LAt/Lon Warning' is enabled and a
										discrepancy is found this text will be set in the variable for the overlay
										manager</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="module-gps-obfuscate.png"
									alt="GPS Obfuscation Settings" /></td>
							<td>
								<ul>
									<li><strong>Obfuscate Position</strong> - If enabled the values below will be used
										to modify the GPS position. This is designed to allow you to display the GPS
										position on an overlay without giving away your exact position</li>
									<li><strong>Latitude Metres</strong> - The number of metres to offset the latitude
										by, can be a psotive or negative number</li>
									<li><strong>Longitude Metres</strong> - The number of metres to offset the longitude
										by, can be a psotive or negative number</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td><img allsky="true" loading="lazy" src="gps.png" alt="GPS connection" /></td>
							<td>
							</td>
						</tr>
					</table>

					<h4>PI Status</h4>
					<table class="module-info vtop">
						<thead>
							<tr>
								<th>Flows Available In</th>
								<th>Description</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<ul>
										<li>Periodic</li>
									</ul>
								</td>
								<td>
									<p>This module reads information about the Pi and makes it availbale for use in the
										overlay manager</p>

									<p>Several environment variables are created that can be used in the overlay manager
									</p>
									<ul>
										<li><strong>DISKSIZE</strong> - The size of the main disk in the Pi</li>
										<li><strong>DISKUSAGE</strong> - Amount of space used on the disk</li>
										<li><strong>DISKFREE</strong> - Amount of free space on the disk</li>
										<li><strong>CPUTEMP</strong> - CPU temp in C/F Only available if the Allsky temp
											settings is Celcius or Fahrenheit</li>
										<li><strong>CPUTEMP_C</strong> - CPU temp in C Only available if the Allsky temp
											settings is set to Celcius</li>
										<li><strong>CPUTEMP_F</strong> - CPU temp in F Only available if the Allsky temp
											settings is set to Fahrenheit</li>
										<li><strong>THROTTLEDBINARY</strong> - Output of vcgencmd get_throttled</li>
										<li><strong>TSTAT{X}</strong> - Throttled bits, see table below</li>
										<li><strong>TSTATSUMARYTEXT</strong> - Textual summary of all of the tstats bits
										</li>
									</ul>
									<blockquote>Several other variables are also available, These are mainly related to
										clock frequencies and voltages</blockquote>
									<h4>Tstat bits</h4>
									<p>These values are text and either 'true' or 'false'</p>
									<table style="width: 50%">
										<tr>
											<th>Variable</th>
											<th>Meaning</th>
										</tr>
										<tr>
											<td>TSTAT0</td>
											<td>Under-voltage detected</td>
										</tr>
										<tr>
											<td>TSTAT1</td>
											<td>Arm frequency capped</td>
										</tr>
										<tr>
											<td>TSTAT2</td>
											<td>Currently throttled</td>
										</tr>
										<tr>
											<td>TSTAT2</td>
											<td>Currently throttled</td>
										</tr>
										<tr>
											<td>TSTAT3</td>
											<td>Soft temperature limit active</td>
										</tr>
										<tr>
											<td>TSTAT16</td>
											<td>Under-voltage has occurred</td>
										</tr>
										<tr>
											<td>TSTAT17</td>
											<td>Arm frequency capping has occurred</td>
										</tr>
										<tr>
											<td>TSTAT18</td>
											<td>Throttling has occurred</td>
										</tr>
										<tr>
											<td>TSTAT19</td>
											<td>Soft temperature limit has occurre</td>
										</tr>
									</table>

								</td>
							</tr>
						</tbody>
					</table>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="module-pi-status.png" alt="PI Status Settings" />
							</td>
							<td>
								<ul>
									<li><strong>Read Every</strong> - Reads the pi status every this number of seconds
									</li>
								</ul>
							</td>
						</tr>

					</table>


				</details>

			</div>


			<h2>Creating and using Masks</h2>
			<div>
				<p>Several of the modules make use of masks. Masks are used to 'hide' areas of the image to
					prevent them creating issues in the modules. For example the star detection module can use a
					mask to hide all areas of the image that may contain things that will confuse the star
					detection typically local light pollution</p>
				<blockquote>Masks must be created in image editing software such as Gimp or Photoshop. There are no
					tools available within Allsky to create masks</blockquote>
				<details>
					<summary></summary>

					<p>Masks can also be used to 'clean' up the non image circle parts of the image.</p>

					<table class="module-settings vtop">
						<tr>
							<td>
								<p>Consider the following image which is a raw image from the camera. The areas
									outside of the main image contain a lot of noise</p>
							</td>
							<td><img allsky="true" loading="lazy" src="mask-raw.png" alt="Raw Mask Image" />
							</td>
						</tr>
						<tr>
							<td>
								<p>To clean this up we create a 'mask' The mask is a Black and White image. Any
									areas in white will be kept any areas in black will be masked. So creating a
									mask like this</p>
							</td>
							<td><img allsky="true" loading="lazy" src="mask-raw-mask.png" alt="Mask" /></td>
						</tr>
						<tr>
							<td>
								<p>After the mask has been applied the resulting image looks a lot cleaner</p>
							</td>
							<td><img allsky="true" loading="lazy" src="mask-raw-final.png" alt="Masked Image" />
							</td>
						</tr>
					</table>

					<p>Masks are also used to mask areas of the image for some modules, such as the star count. This is
						to prevent false positive. Consider the following example</p>
					<table class="module-settings vtop">
						<tr>
							<td>
								<p>Consider the following image which is a raw image from the camera. There is a lot of
									non sky in the image, houses trees etc. These 'artifacts' can cause some detection
									modules to get confused so by masking them they will not be included in any of the
									calculations</p>
							</td>
							<td><img allsky="true" loading="lazy" src="mask-stars-raw.png" alt="Raw Mask Image" />
							</td>
						</tr>
						<tr>
							<td>
								<p>This mask was created in an external image editing program to mask out the areas of
									the image that are not sky</p>
								<blockquote>Since this mask is being used to mask specific areas of the image if the
									camera is moved then the mask may have to be recreated</blockquote>
							</td>
							<td><img allsky="true" loading="lazy" src="mask-stars-mask.png" alt="Mask" /></td>
						</tr>
						<tr>
							<td>
								<p>After the mask has been applied the resulting image will allow the various modules to
									process the image</p>
							</td>
							<td><img allsky="true" loading="lazy" src="mask-stars-result.png" alt="Masked Image" />
							</td>
						</tr>
					</table>


					<blockquote>
						<p>Some modules will apply the mask but it will not be used for the final image.
							Examples of this are masks used to mask the image for star/meteor detection</p>
					</blockquote>
					<blockquote>
						<p>Masks do not have to be circular, they can be any shape you like. In fact the masks
							used for star and meteor detection are very likely to be a strange shape</p>
					</blockquote>
				</details>
			</div>

			<h2>GPIO</h2>
			<div>
				<p>Several of the modules require the selection of a GPIO pin on the pi. The module editor has
					an inbuilt GPIO selector to help ease the process of selecting the required pin</p>
				<details>
					<summary></summary>
					<table class="module-settings vtop">
						<tr>
							<td>
								<p>When clicking on the GPIO selection the GPIO selector is displayed allowing
									you to select the required pin, in the example GPIO27 is currently selected
								</p>
								<blockquote>Currently only the PI 3/4 GPIO pins are implemented</blockquote>
							</td>
							<td><img allsky="true" loading="lazy" src="gpio.png" alt="GPIO Selector" /></td>
						</tr>
					</table>
				</details>
			</div>


			<h2>Module Performance / Debugging</h2>
			<div>
				<p>Its important that modules do not take too much time to run as this will cause load issues on
					the PI.</p>
				<details>
					<summary></summary>
					<p>After Allsky has taken an image the save image process is run in background, including
						running the relevant module flow. Its important that this process finishes before the
						next image is captured. If the module flow takes too long multiple save image process
						will be running, this will start to cause performance issues on the PI</p>
					<p>The best way to ensure this does not happen is to make sure that the module watchdog is
						enabled in the <span class="managerName">Module Manager</span> Settings</p>
					<blockquote><strong>TIP</strong> - When installing a new module ensure debug mode is enabled
						in the <span class="managerName">Module Manager Settings and monitor how long the new module is taking and what
						effect its having on the overall flow time</blockquote>
					<h3>The Module Manager Debug Window</h3>
					<table class="module-settings vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="Module-Manager-Debug.png"
									alt="Module Debug Window" /></td>
							<td>
								<p>The debug dialog shows each of the enabled modules, how long it took to run,
									the result of the last run and the total execution time for all modules</p>
								<p>This information is useful if you find there are too many save image
									processes running for determining if any particular module is causing an
									issue</p>
							</td>
						</tr>
					</table>
					<h3>The Allsky debug log</h3>
					<p>The main Allsky debug log will contain information from the module processor. The amount
						of information logged will depend upon the main Allsky debug level. When the debug level
						is 0 only critical module errors will be logged. Any other log level will display
						verbose information as shown below.</p>
					<blockquote>Periodic module output is logged to the allskyperiodic.log log file. This file
						will be in the same location as the main Allsky log file, typically /var/log
					</blockquote>
					<div class="code">
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Loading config...<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Loading recipe...<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_loadimage.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_loadimage<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Image
						/home/alex/allsky/tmp/image-20221023210636.jpg Loaded<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_loadimage.py ran ok in
						0.493601s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_pistatus.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_pistatus<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_pistatus.py ran ok in
						0.041586s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_saveintermediateimage.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_saveintermediateimage<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: /home/alex/allsky/images/20221023-clean<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Image
						/home/alex/allsky/images/20221023-clean/image-20221023210636.jpg Saved<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module
						allsky_saveintermediateimage.py ran ok in 0.442361s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_clearsky.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_clearsky<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Created star template. Radius - 6<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Sky is NOT clear. 5 Stars found,
						clear limit is 40<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: MQTT disabled<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_clearsky.py ran ok in
						0.677157s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_starcount.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_starcount<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Sky is not clear so ignoring
						starcount<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_starcount.py ran ok in
						9.8e-05s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_meteor.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load allsky_meteor<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Sky is not clear so ignoring meteor
						detection<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_meteor.py ran ok in
						6.8e-05sv<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_dewheater.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_dewheater<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Turning Heater on<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Temperature within limit temperature
						11.13, limit 10, dewPoint 8.74<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Sensor SHT31 read. Temperature 11.13
						Humidity 85.19 Dew Point 8.74 Heat Index -14.47<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_dewheater.py ran ok in
						0.040973s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_maskimage.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_maskimage<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_maskimage.py ran ok in
						0.516113s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_cloud.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load allsky_cloud<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Cloud state - Cloudy 100.0. Sky Temp
						10.370000000000005, Ambient 10.450000000000045<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_cloud.py ran ok in
						0.002392s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_export.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load allsky_export<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Allsky data exported to
						/home/alex/allsky/tmp/allskydata.json<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Module allsky_export.py ran ok in
						0.001127s<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_overlay.py -----------------------<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Attempting to load allsky_overlay<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Config file set to
						/home/alex/allsky/config/overlay.json<br>
						Oct 23 21:08:15 allskytest allsky.sh[24948]: INFO: Loading Config took 0.00063 Seconds.
						Elapsed Time 0.000662 Seconds.<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Adding Text Fields took 0.255803
						Seconds. Elapsed Time 0.685933 Seconds.<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Adding Image Fields took 0.248668
						Seconds. Elapsed Time 0.934638 Seconds.<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Saving Final Image took 0.006398
						Seconds. Elapsed Time 0.941075 Seconds.<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Writing debug data took 4.5e-05
						Seconds. Elapsed Time 0.941138 Seconds.<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Debug information written to
						/home/alex/allsky/tmp/overlaydebug.txt<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Annotation Complete Elapsed Time
						0.942793 Seconds.<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Module allsky_overlay.py ran ok in
						0.951637s<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_savedetails.py -----------------------<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_savedetails<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Module allsky_savedetails.py ran ok
						in 0.128938s<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: ----------------------- Running
						Module allsky_saveimage.py -----------------------<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Attempting to load
						allsky_saveimage<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Image
						/home/alex/allsky/tmp/image-20221023210636.jpg Saved, quality 100<br>
						Oct 23 21:08:16 allskytest allsky.sh[24948]: INFO: Module allsky_saveimage.py ran ok in
						0.388242s<br>

					</div>
				</details>
			</div>

			<h2>Developing Custom Modules</h2>
			<div>
				<p>The module system is designed to be extended by developing custom modules</p>
				<details>
					<summary></summary>
					<h3>Python Versions</h3>
					<p>Modules are developed in <a href="https://www.python.org/" target="_blank">Python</a> and
						should use the latest version available for the Pi. Its should be noted that whilst
						multiple versions of Python can be installed on a Pi its best just to use the version
						that ships with the OS. Generally that may mean reinstalling your Allsky installation to
						get the latest version of python. Running multiple versions of python is beyond the
						scope of this documentation.</p>
					<h3>Contributing a module</h3>
					<p>There is a central GitHub repository that you can contribute your modules to. You do not have to
						do this but over time we wouls like to build this into a comprehensive library of available
						modules.</p>
					<p>If you wish to contribute your module then please follow these instructions</p>
					<p>
					<ul>
						<li>Create a fork of the User Modules repository <a
								href="https://github.com/Alex-developer/allsky-modules"
								target="_blank">https://github.com/Alex-developer/allsky-modules</a></li>
						<li>Create a new branch in your forked repository, call the branch the name of your module</li>
						<li>Develop your module and commit it to the branch</li>
						<li>Create a pull request into the main repo from your branch</li>
						<li>The module will be checked and if all is ok will be merged into the main repository</li>
						<li>If you need to make changes to the module after its been merged then refork the main repo
							create a branch from the master branch named as your module then commit ad PR to main master
						</li>
					</ul>
					</p>
					<p>The structure of a module is important so please use the following folder/file structure</p>
					<p><strong>allsky_MODULENAME</strong></p>
					<p>-- <strong>allsky_MODULENAME.py</strong> <span>The main modules code</span></p>
					<p>-- <strong>requirements.txt</strong> <span>Any python packages required by the plugin, will be
							installed with pip3. If you do not need any additional packages do not include this
							file</span></p>
					<p>-- <strong>packages.txt</strong> <span>Any aditional libraries required by the module, will be
							installed using apt. If you do not need any additional packages do not include this
							file</span></p>
					<p>-- <strong>README.md</strong> <span>Markdown file with any special instructions required for the
							module. If there are none do not include this file</span></p>
					<blockquote>When specifying python libraries DO NOT include numpy in ANY requirements.txt file as
						changing the version could cause issues with Allsky</blockquote>
					<h3>Anatomy Of A Module</h3>
					<p>A module consists of two key parts</p>
					<ul>
						<li><strong>The metadata variable</strong> - This variable defines everything the module
							manager needs to run the module. This includes basic information about the module
							and the configuration options it requires</li>
						<li><strong>The module entry point</strong> - The main function that is called by the
							<span class="managerName">Module Manager</span></li>
					</ul>
					<p>Every module MUST import the allsky_shared module. This module is used to pass data from
						the flow processor to each module</p>

					<h4>The Meta Data Variable</h4>
					<blockquote>Please refer to the BoilerPlate example module for more details of the variable.
						The Boiler Plate example includes all of the available options</blockquote>

					<table class="vtop">
						<tr>
							<th>Field</th>
							<th>Type</th>
							<th>Mandatory</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>name</td>
							<td>String</td>
							<td>Yes</td>
							<td>The name of the module. This field is displayed as the heading for a module when
								its displayed in the module manager</td>
						</tr>
						<tr>
							<td>description</td>
							<td>String</td>
							<td>Yes</td>
							<td>The description of the module. This field is displayed in the module manager
							</td>
						</tr>
						<tr>
							<td>module</td>
							<td>String</td>
							<td>Yes</td>
							<td>The module name. <strong>MUST</strong> be in the format allsky_{module name}
								i.e. allsky_boilerplate</td>
						</tr>
						<tr>
							<td>version</td>
							<td>String</td>
							<td>No</td>
							<td>The version of the module. If this field is not present then the version of the
								main Allsky software will be used</td>
						</tr>
						<tr>
							<td>enabled</td>
							<td>String</td>
							<td>No</td>
							<td>'true' or 'false'. If set to true the module is enabled, handy for setting its
								initial state. <strong>NOTE:</strong> If the option to auto enable modules is
								enabled in the module manager then this will take priority over this value</td>
						</tr>
						<tr>
							<td>events</td>
							<td>Dictionary</td>
							<td>Yes</td>
							<td>A list of the flows the module should be displayed in. Valid flows are
								<ul>
									<li><strong>day</strong> - Tells the module manager to display the module in
										the daytime flows</li>
									<li><strong>night</strong> - Tells the module manager to display the module
										in the nighttime flows</li>
									<li><strong>daynight</strong> - Tells the module manager to display the
										module in the day to night transition flows</li>
									<li><strong>nightday</strong> - Tells the module manager to display the
										module in the night to day transition flows</li>
									<li><strong>periodic</strong> - Tells the module manager to display the
										module in the periodic flows</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td>experimental</td>
							<td>String</td>
							<td>No</td>
							<td>'true' or 'false'. If set to true a warning is displayed in the module manager
								indicating the module is experimental</td>
						</tr>
						<tr>
							<td>arguments</td>
							<td>Dictionary</td>
							<td>No</td>
							<td>A list of the values that will be passed to the main processing methof of the
								module in the params array. This exists to allow you to specify defaults for the
								fields. Definitions for the fields are defined in the argumentdetails field
								below</td>
						</tr>
						<tr>
							<td>argumentdetails</td>
							<td>Dictionary</td>
							<td>No</td>
							<td>Dictionary of definitions for each of the arguments</td>
						</tr>
					</table>

					<h5>The argumentdetails Dictionary</h5>
					<p>A module may require that the user can set values for its paramaters. This is implemented
						via the argumens and argumentdetails sections. If there are any argumentdetails present
						then a settings option will be displayed in the module manager. Clicking on the settings
						option will display a dialog allowing the modules settings to be changed. The dialog is
						created automatically from the options defined in the argumentdetails section</p>
					<table class="vtop">
						<tr>
							<th>Field</th>
							<th>Type</th>
							<th>Mandatory</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>required</td>
							<td>String</td>
							<td>Yes</td>
							<td>'true' or 'false'. If set to true the field is required. <strong>NOTE:</strong>
								This is not currently implemented but will be in a future release</td>
						</tr>
						<tr>
							<td>description</td>
							<td>String</td>
							<td>Yes</td>
							<td>This is the label for the field in the module settings dialog</td>
						</tr>
						<tr>
							<td>help</td>
							<td>String</td>
							<td>No</td>
							<td>This is the help text for the field in the module settings dialog</td>
						</tr>
						<tr>
							<td>tab</td>
							<td>String</td>
							<td>No</td>
							<td>The tab to display the field in. If left blank the field will be displayed on
								the 'Home' tab. This is handy for grouping fields into seperate tabs</td>
						</tr>
						<tr>
							<td>type</td>
							<td>Dictionary</td>
							<td>No</td>
							<td>A Dictionary defining the type of field. The key is the name of the field, the
								same name as used in the arguments section. If no type is defined the field is
								assumed to be a text field
							</td>
						</tr>
					</table>
					<h5>Available field types</h5>
					<table class="vtop">
						<tr>
							<th>fieldtype</th>
							<th>Description</th>
							<th>Additional paramaters</th>
						</tr>
						<tr>
							<td colspan="3">If blank the field will be assumed to be a text entry field</td>
						</tr>
						<tr>
							<td>select</td>
							<td>A drop down list from which the user can select an option</td>
							<td>
								<ul>
									<li><strong>values</strong> A comma separated list of values for the drop
										down. The default value for the drop down list is specified in the
										arguments section</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td>checkbox</td>
							<td>A checkbox allowing the entry of a true or false value</td>
							<td>None</td>
						</tr>
						<tr>
							<td>spinner</td>
							<td>A numerical entry field with up down controls to alter the value</td>
							<td>
								<ul>
									<li><strong>min</strong> The minimum value for the field</li>
									<li><strong>max</strong> The maximum value for the field</li>
									<li><strong>step</strong> The step for the field</li>
								</ul>
							</td>
						</tr>
						<tr>
							<td>gpio</td>
							<td>Displays a dialog allowing the user to select a GPIO pin on the Pi. This field
								type is useful when developing a module that requries a user to select a GPIO
								pin</td>
							<td>None</td>
						</tr>
						<tr>
							<td>image</td>
							<td>Displays a dialog allowing the user to select/upload an image. This is useful
								where a module may require the user to select a mask</td>
							<td>None</td>
						</tr>
						<tr>
							<td>roi</td>
							<td>Displays a dialog allowing the user to select a Region Of Interest (ROI) from
								the captured image</td>
							<td>None</td>
						</tr>
					</table>

					<h5>Complete metadata example</h5>
					<table class="vtop">
						<tr>
							<td><img allsky="true" loading="lazy" src="metadata.png"></td>
							<td>
								<p>This is a full example of all of the possible options available in the
									metaData dictionary</p>
								<p>This example can be found in the boilerplate module in the additional modules
									repository on GitHub</p>
							</td>
						</tr>
					</table>

					<h4>The Allsky Shared module</h4>
					<p>To improve the performance of modules a common shared module is used. This shared module
						allsky_shared contains both helper functions and data from the main capture process. The
						module exists so that each individual module does not have to perform length taks like
						loading an image</p>

					<h5>Allsky Shared module data</h5>
					<table>
						<tr>
							<th>Variable</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>args</td>
							<td>The arguments passed to the module processor (not normally needed)</td>
						</tr>
						<tr>
							<td>LOGLEVEL</td>
							<td>The allsky debug level (not normally ndded)</td>
						</tr>
						<tr>
							<td>CURRENTIMAGEPATH</td>
							<td>The full path to the current image (not normally needed, not available in
								daynight, nightday or periodic)</td>
						</tr>
						<tr>
							<td>TOD</td>
							<td>The time of day not available in daynight, nightday or periodic)</td>
						</tr>
						<tr>
							<td>fullFilename</td>
							<td>The final image filename i.e. image.jpg not available in daynight, nightday or
								periodic)</td>
						</tr>
						<tr>
							<td>image</td>
							<td>a numpy array of the current image - Use this for any processing of the captured
								image. <strong>DO NOT</strong> attempt to load the image from disk within a
								module as this will have a severe performance impact on the module. Not
								available in daynight, nightday or periodic)</td>
						</tr>
					</table>

					<h5>Allsky Shared module helpers</h5>
					<table class="vtop">
						<tr>
							<th>Function</th>
							<th>Description</th>
						</tr>
						<tr>
							<td>log(level, message)</td>
							<td>Logs an entry to the allsky log file if the debug level is above 'level'. Errors
								are always logged. When a module needs to write to a log it should use this
								function rather than write to any log files directly. THis function will ensure
								that the log message appears in the main Allsky log file</td>
						</tr>
						<tr>
							<td>getEnvironmentVariable(name, fatal=False, error='')</td>
							<td>Gets an environment variable, can terminate if needed by setting the fatal
								variable and an error code</td>
						</tr>
						<tr>
							<td>var_dump(variable)</td>
							<td>Pretty dump of a variable. This is handy for debugging modules. The output will
								appear in the main Allsky log file.</td>
						</tr>
						<tr>
							<td>getSetting(settingName)</td>
							<td>Gets a setting from the camera settings file</td>
						</tr>
						<tr>
							<td>writeDebugImage(module, fileName, image)</td>
							<td>Writes a debug image to the $ALLSKY/tmp/debug/{module} folder. This can be
								useful when debugging a module to check the output at various stages</td>
						</tr>
						<tr>
							<td>startModuleDebug(module)</td>
							<td>Creates the debug directories for a module</td>
						</tr>
						<tr>
							<td>convertPath(path)</td>
							<td>Replaces allsky variables in a string, this is useful if a module enters a
								directory based upon any of the Allsky variables. So for example
								'${ALLSKY_TMP}/allskydata.json' will have the allsky tmp avriable replaced with
								its real path. This function can be used to replace any of the allsky variables
								in a string</td>
						</tr>
						<tr>
							<td>checkAndCreatePath(filePath)</td>
							<td>Checks if the passed file exists and if not creates it</td>
						</tr>
						<tr>
							<td>checkAndCreateDirectory(filePath)</td>
							<td>Checks if the passed directory exists and if not creates it</td>
						</tr>
						<tr>
							<td>raining()</td>
							<td>Only available if the rain module is being used - Returns a boolean flags to
								indicate the rain state</td>
						</tr>
						<tr>
							<td>convertLatLon(input)</td>
							<td>Converts 52.2N to 52.2 i.e converts to decimal</td>
						</tr>
						<tr>
							<td>setLastRun(module)</td>
							<td>Sets the last run time for a module. Useful for where a module only needs to run
								periodically</td>
						</tr>
						<tr>
							<td>shouldRun(module, period)</td>
							<td>Determines if a module should run based on the period</td>
						</tr>
						<tr>
							<td>dbAdd(key, value)</td>
							<td>Adds the key/value pair to the internal database</td>
						</tr>
						<tr>
							<td>dbUpdate(key, value)</td>
							<td>Updates the key/value pair to the internal database</td>
						</tr>
						<tr>
							<td>isFileWriteable(fileName)</td>
							<td>Determines of the file is writeable</td>
						</tr>
						<tr>
							<td>isFileReadable(fileName)</td>
							<td>Determines of the file is readable</td>
						</tr>
						<tr>
							<td>saveExtraData(fileName, extraData)</td>
							<td>Saves the extraData in fileName.</td>
						</tr>
						<tr>
							<td>deleteExtraData(fileName)</td>
							<td>Deletes the extra data fileName.</td>
						</tr>
						<tr>
							<td>getGPIOPin(pin)</td>
							<td>Returns the board.Pin from the passed in pin (int)</td>
						</tr>
					</table>
				</details>
			</div>



		</div><!-- Layout-main -->
	</div><!-- Layout ... -->
</body>

</html>
<script> includeHTML(); </script>

